# Unix Shell

Search Tag(s): #post-exploitation #enumeration-and-discovery #active-directory #windows

## 01 - Current user enumeration

### 1.1 - Samba Suite Utils

Authentication syntax.

```
$ rpcclient -U "<username>%<password>" [-p 593] <IP>
```

Authenticate `guest` account.

```
$ rpcclient <IP> -U 'guest%' <IP>
rpcclient $>
```

Retrieve current domain user password information.

```
rpcclient $> getusrdompwinfo <username_rid_value>
```

### 1.2 - NetCommands

```
$ net <ads | rpc> user info "<username>" -U "<username>%<password>" -S <IP>

$ net <ads | rpc> user info "<username>" -U "<username>" --pw-nt-hash <nt_hash> -S <IP>
```

## 02 - Enumerate user accounts

### 2.1 - NetCommands

```
$ net <ads | rpc> user -U "<username>%<password>" -S <IP>

$ net <ads | rpc> user -U "<username>" --pw-nt-hash <nt_hash> -S <IP>
```

### 2.2 - NetExec

Enumerate **domain users**.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --users
```

Enumerate **current domain users**.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --users <user_1>,<user_2>,<user_n>
```

### 2.3 - Nmap

```
$ nmap -p 445 -Pn --script smb-enum-users --script-args "smbuser='<username>',smbpassword='<password>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-users "smbuser='<username>',smbpassword='<password>'" <IP>
```

Pass the Hash

```
$ nmap -p 445 -Pn --script smb-enum-users --script-args "smbuser='<username>',smbhash='<nt_hash>' <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-users --script-args "smbuser='<username>',smbhash='<nt_hash>'" <IP>
```

## 03 - Enumerate groups

### 3.1 - RPCClient

#### 3.1.1 - Enumerate Domain Users

```
rpcclient $> enumdomusers

rpcclient $> querygroupmem <group_rid_value>
```

SAM lookup.

```
rpcclient $> samlookupnames domain <username>

rpcclient $> samlookuprids domain <username_rid_value>
```

#### 3.1.2 - Enumerate Domain Groups

```
rpcclient $> enumdomgroups

rpcclient $> enumalsgroups domain

rpcclient $> querygroup <group_rid_value>
```

#### 3.1.3 - Enumerate user accounts

Display Query Information. You can find information in the description that my contain credentials.

```
rpcclient $> querydispinfo
```

Lookup SID accounts.

```
rpcclient $> lookupsids <SID>
```

Lookup username accounts.

```
rpcclient $> lookupnames <username>
```

### 3.2 - NetCommand

Authentication syntax

```
$ net rpc group members '<group_name>' -U '[<domain>/]<username>%<password>' -I '<IP>'
```

Pass The Hash

```
$ net rpc group members '<group_name>' -U '[<domain>/]<username>' --pw-nt-hash <nt_hash> -I '<IP>'
```

Retrieve domain groups.

```
$ net rpc group list -U '[<domain>/]<username>%<password>' -I <IP>
```

Retrieve **domain users**.

```
$ net rpc group members 'Domain Users' -U '[<domain>/]<username>%<password>' -I '<IP>'
```

Retrieve **domain administrators**.

```
$ net rpc group members 'Domain Admins' -U '[<domain>/]<username>%<password>' -I '<IP>'

$ net rpc group members 'Enterprise Admins' -U '[<domain>/]<username>%<password>' -I '<IP>'

$ net rpc group members 'Administrators' -U '[<domain>/]<username>%<password>' -I '<IP>'
```

### 3.3 - NetExec

Retrieve **domain groups**.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --groups
```

Retrieve **domain administrators**.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --groups "Domain Admins"

$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --groups "Enterprise Admins"
```

### 3.4 - Nmap

```
$ nmap -p 445 -Pn --script smb-enum-groups --script-args "smbuser='<username>',smbpassword='<password>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-groups "smbuser='<username>',smbpassword='<password>'" <IP>
```

Pass the Hash

```
$ nmap -p 445 -Pn --script smb-enum-groups --script-args "smbuser='<username>',smbhash='<nt_hash>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-groups --script-args "smbuser='<username>',smbhash='<nt_hash>'" <IP>
```

## 04 - User enumeration via RID Cycling

### 4.1 - Samba Suite Utils

User enumeration via RID Cycling.

```
$ for i in $(seq 500 1100); do rpcclient -N -U "" <IP> -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo ""; done
```

### 4.2 - NetExec

Bruteforce via RID Cycling.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --rid-brute [max_rid_value]

$ netexec smb <IP> -u "guest" -p "" [-d <domain> | --local-auth] --rid-brute [max_rid_value]
```

### 4.3 - Impacket

Authentication for RID lookup.

```
$ samrdump.py <domain>/<username>:<password>@<IP>

$ samrdump.py <domain>/<username>@<IP> -hashes :<nt_hash>
```

User enumeration.

```
$ samrdump.py guest@<IP> -no-pass
```

## 05 - User enumeration via SID Cycling

### 5.1 - Impacket

Authentication for SID lookup.

```
$ lookupsids.py <domain>/<username>:<password>@<IP>

$ lookupsids.py <domain>/<username>@<IP> -hashes :<nt_hash>
```

User enumeration.

```
$ lookupsids.py guest@<IP> -no-pass
```