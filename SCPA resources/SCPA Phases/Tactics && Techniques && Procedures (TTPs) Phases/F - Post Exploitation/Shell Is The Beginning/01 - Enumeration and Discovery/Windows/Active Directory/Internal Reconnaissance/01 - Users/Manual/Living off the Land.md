# Living off the Land

Search Tag(s): #post-exploitation #enumeration-and-discovery #active-directory #living-off-the-land #windows

## 01 - Command Prompt

### 1.1 - Users

Enumerate current user.

```
C:\> whoami /fqdn

C:\> whoami /upn
```

Retrieve basic domain user information.

```
C:\> net user <username> /domain

C:\> net user %USERNAME% /domain
```

Gather logged-on domain users.

```
C:\> net accounts /domain
```

### 1.2 - Groups

Enumerate **domain users**.

```
C:\> net user /domain

C:\> net group "Domain Users" /domain

C:\> set userdomain
```

Enumerate **domain admins**.

```
C:\> net group "Domain Admins" /domain

C:\> net group "Enterprise Admins" /domain
```

## 02 - Powershell

### 2.1 - Users

Import powershell module.

```
PS C:\> Import-Module ActiveDirectory
```

Retrieve basic domain user information.

```
PS C:\> Get-ADUser <username>

PS C:\> Get-ADUser $Env:USERNAME
```

Find obsolete users.

```
PS C:\> Get-ADUser -Filter { -Not (ScriptPath -Like "*")}
```

### 2.2 - Groups

Enumerate local groups.

```
PS C:\> Get-LocalGroup | Format-Table Name -AutoSize
```

Enumerate local **administrator users**.

```
PS C:\> Get-LocalGroupMember Administrators | Format-Table Name, PrincipalSource
```

Enumerate **domain users**.

```
PS C:\> Get-LocalGroupMember "Domain Users" | Format-Table Name, PrincipalSource
```

Enumerate **domain admins**.

```
PS C:\> Get-LocalGroupMember "Domain Admins" | Format-Table Name, PrincipalSource

PS C:\> Get-LocalGroupMember "Enterprise Admins" | Format-Table Name, PrincipalSource
```