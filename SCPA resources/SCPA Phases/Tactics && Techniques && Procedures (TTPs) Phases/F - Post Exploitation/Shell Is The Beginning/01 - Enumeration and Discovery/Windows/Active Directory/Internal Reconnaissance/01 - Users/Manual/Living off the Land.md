# Living off the Land

Search Tag(s): #post-exploitation #enumeration-and-discovery #active-directory #living-off-the-land #windows

## 01 - Current User Enumeration

### 1.1 - Command Prompt

Enumerate current user.

```
C:\> whoami /fqdn

C:\> whoami /upn
```

Retrieve basic domain user information.

```
C:\> set userdomain

C:\> net user %USERNAME% /domain

C:\> net user <username> /domain
```

Gather logged-on domain users.

```
C:\> net accounts /domain
```

### 1.2 - Powershell

Import powershell module.

```
PS C:\> Import-Module ActiveDirectory
```

Retrieve basic domain user information.

```
PS C:\> Get-ADUser $Env:USERNAME

PS C:\> Get-ADUser <username>
```

## 02 - User accounts enumeration

### 2.1 - Command Prompt

```
C:\> dir C:\Users\

C:\> dir \\<IP>\C$\Users\
```

### 2.2 - Powershell

Find obsolete users.

```
PS C:\> Get-ADUser -Filter { -Not (ScriptPath -Like "*")}

PS C:\> Get-ChildItem C:\Users\

PS C:\> Get-ChildItem \\<IP>\C$\Users\
```

## 03 - Enumerate Usernames

### 3.1 - Command Prompt

Enumerate usernames in a active directory network.

```
C:\> net user /domain
```

## 04 - Enumerate domain groups

### 4.1 - Command Prompt

Enumerate groups in a active directory.

```
C:\> net group /domain

C:\> net group /domain:<DOMAIN>
```

Enumerate **domain users**.

```
C:\> net group "Domain Users" /domain
```

Enumerate **domain admins**.

```
C:\> net group "Domain Admins" /domain

C:\> net group "Enterprise Admins" /domain
```

### 4.2 - Powershell

Enumerate local groups.

```
PS C:\> Get-LocalGroup | Format-Table Name -AutoSize
```

Enumerate local **administrator users**.

```
PS C:\> Get-LocalGroupMember Administrators | Format-Table Name, PrincipalSource
```

Enumerate **domain users**.

```
PS C:\> Get-LocalGroupMember "Domain Users" | Format-Table Name, PrincipalSource
```

Enumerate **domain admins**.

```
PS C:\> Get-LocalGroupMember "Domain Admins" | Format-Table Name, PrincipalSource

PS C:\> Get-LocalGroupMember "Enterprise Admins" | Format-Table Name, PrincipalSource
```