# Archive Files

## 01 - Makecab

### 1.1 - Archive

```
C:\> makecab <source> <destination>

C:\> makecab file.txt archive.cab
```

- Makecab can archive from a list of files specified in a text file with destinations.

```
C:\> dir /a-d |find "04/25/2021" |findstr /V COMPONENTS > C:\ProgramData\list.txt && for /f "tokens=4,* delims= " %a in (C:\ProgramData\list.txt) do @echo %b >> C:\ProgramData\mca.txt

C:\> makecab /d CabinetNameTemplate=enum_results.cab /D DiskDirectoryTemplate=C:\ProgramData /f C:\ProgramData\mca.txt
```

- You perform Alternate Data Streams (ADS) in hidden files.

```
C:\> makecab file.txt C:\Windows\eula.txt:archive.cab

C:\> dir /r C:\Windows\eula.txt
```

### 1.2 - Extract

```
C:\> extrac32 archive.cab /l "C:\path\to\directory\"

$ cabextract archive.cab
```

## 02 - Zip

### 2.1 - Powershell

#### 2.1.1 - Archive

`PS C:\> Compress-Archive -Path .\Desktop\1.txt -DestinationPath file.zip -CompressionLevel Fastest`

- Update with new files

`PS C:\> Compress-Archive -Path .\Desktop\1.txt -Update -DestinationPath file.zip -CompressionLevel Fastest`

- Archive multiple files

```
PS C:\> Get-ChildItem 1.txt,2.txt | Compress-Archive -DestinationPath file.zip -CompressionLevel Fastest

PS C:\> Get-ChildItem -Path 1.txt,2.txt | Compress-Archive -DestinationPath file.zip -CompressionLevel Fastest

PS C:\> Get-ChildItem -Path 1.txt,2.txt | Compress-Archive -Update -DestinationPath file.zip -CompressionLevel Fastest
```

- Recursively archive files with specific file extensions

```
PS C:\> Get-ChildItem -Recurse -Path C:\path\to\directory\ -Include *.txt,*.pdf,*.doc,*.docx,*.jpg,*.jpeg,*.png,*.ppt,*.pptx,*.xls,*.xlsx | Compress-Archive -Update -DestinationPath file.zip -CompressionLevel Optimal -Confirm

PS C:\> Get-ChildItem -Recurse -Path C:\path\to\directory\ -Include *.txt,*.pdf,*.doc,*.docx,*.jpg,*.jpeg,*.png,*.ppt,*.pptx,*.xls,*.xlsx | Compress-Archive -Update -DestinationPath file.zip -CompressionLevel Optimal -Force
```

- Recursively archive files with specific file extensions. Ensure the filenames are unique to avoid duplicates.

```
PS C:\> Get-ChildItem -Recurse -Path C:\path\to\directory\ -Include *.txt,*.pdf,*.doc,*.docx,*.jpg,*.jpeg,*.png,*.ppt,*.pptx,*.xls,*.xlsx | Sort-Object | Get-Unique | Compress-Archive -DestinationPath unique-backup.zip -CompressionLevel Optimal -Force
```

TODO: Use a checksum hash to uniquely identity to archive the files to avoid exact duplicates with the names nor `Sort-Object` and `Get-Unique`.

#### 2.1.2 - Extract

```
PS C:\> Expand-Archive -Path .\file.zip -DestinationPath C:\path\to\directory
```

## 03 - Tarball

Refer to [[Tactics && Techniques && Procedures (TTPs) Phases/Post Exploitation/Shell Is The Beginning/07 - File Transfer and Data Exfiltration/Linux/Archive Files|Tarball]] under **Linux** section

```
c:\windows\syswow64\tar.exe

%windir%\syswow64\tar.exe
```

---
## References

- [SS64 Makecab](https://ss64.com/nt/makecab.html)

- [SS64 Extract](https://ss64.com/nt/extract.html)

- [SS64 Powershell Assembly Zip](https://ss64.com/ps/zip.html)

- [SS64 Powershell Compress-Archive](https://ss64.com/ps/compress-archive.html)

- [SS64 Powershell Expand-Archive](https://ss64.com/ps/expand-archive.html)