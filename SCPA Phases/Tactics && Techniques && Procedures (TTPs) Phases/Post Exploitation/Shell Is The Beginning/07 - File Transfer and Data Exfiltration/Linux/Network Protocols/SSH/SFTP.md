# SFTP

Search Tags: #post-exploitation #file-transfer-and-data-exfiltration #ssh #linux

## 01 - Setup

### 1.1 - Hardening

```
$ sudo groupadd sftp

$ sudo mkdir -p /data/<USERNAME>/uploads

$ sudo useradd -g sftp -s /bin/false -M <USERNAME>

$ passwd <USERNAME>

$ sudo chown <USERNAME>:sftp /data/<USERNAME>/uploads

$ sudo chmod 755 /data/<USERNAME>
```

```
$ cat /etc/ssh/sshd_config
..[snip]..
# AllowGroups sftp

# Subsystem     sftp    /usr/libexec/openssh/sftp-server
Subsystem       sftp    internal-sftp

Match User <USERNAME>
	ForceCommand internal-sftp
	PasswordAuthentication yes
	# PubkeyAuthentication no
	ChrootDirectory /data/<USERNAME>
	AllowAgentForwarding no
	AllowTcpForwarding no
	X11Forwarding no
```

`$ sudo systemctl restart sshd`

### 1.2 - Usage

`$ sftp [-P <PORT>] <username>@<IP>`