# Living off the Land

## 01 - Basic User Information

### 1.1 - Command Prompt

- Note: The percent/modulus sign means for Windows operating systems it will echo out the variable (for example: `%VARIABLE%`) which is similar to bash script in Linux (for example: `$VARIABLE`)

`C:\> echo %USERNAME%`

`C:\> hostname`

`C:\> quser`

`C:\> query user <username> /server:<IP>`

`C:\> whoami`

- Retrieves the SID

`C:\> whoami /user`

`C:\> net accounts`

- **Check the user's privileges**

`C:\> whoami /priv`

`C:\> whoami /groups`

`C:\> whoami /all`

`C:\> net users`

`C:\> dir /b /ad "C:\Users\"`

- Windows XP and below

`C:\> dir /b /ad "C:\Documents and Settings\"`

- Gather group users

`C:\> net localgroup "<local_group_name>"`

### 1.2 - Powershell

`PS C:\> $env:username`

```
PS C:\> $env:computername

PS C:\> Get-CimInstance -Classname Win32_ComputerSystem

PS C:\> Write-Output (Get-CimInstance Win32_ComputerSystem).Name

PS C:\> Write-Output (Get-WMIObject Win32_ComputerSystem).Name
```

- Check the user's privileges

```
PS C:\> Get-LocalUser

PS C:\> Get-LocalUser | ft Name,Enabled,LastLogon

PS C:\> Get-ChildItem C:\Users -Force | Select-Object Name
```

## 02 - Enumerate User Information

### 2.1 - Command Prompt

```
C:\> net user

C:\> net user <username>

C:\> net user %USERNAME%
```

- Using `wmic.exe`

```
C:\> wmic useraccount

C:\> wmic useraccount list

C:\> wmic useraccount get name,sid

C:\> wmic useraccount get /all
```

### 2.2 - Powershell

`PS C:\> Get-CimInstance -ClassName Win32_Account | Format-Table -AutoSize`

`PS C:\> Get-CimInstance -ClassName Win32_Group | Format-Table -AutoSize`

`PS C:\> Get-CimInstance -ClassName Win32_UserAccount | Format-Table -AutoSize`

`PS C:\> Get-CimInstance -ComputerName $env:computername -ClassName Win32_UserAccount -filter "LocalAccount=True" | select PSComputername, Name, Status, Disabled, AccountType, Lockout, PasswordRequired, PasswordChangeable`

`PS C:\> Get-CimInstance -ComputerName $env:computername -ClassName Win32_UserAccount -filter "LocalAccount=True" | select PSComputername, Name, Status, Disabled, AccountType, Lockout, PasswordRequired, PasswordChangeable | Out-GridView`

`PS C:\> Get-CimInstance -ClassName Win32_UserDesktop | ft -AutoSize`

## 03 - Logged On Users

### 3.1 - Powershell

`PS C:\> Get-CimInstance -Query "Select * FROM Win32_LoggedOnUser" | ?{$_.LogonType -notmatch '(Service|Network|System)'}`

## 04 - User Environment

### 4.1 - Command Prompt

- Shows all current environmental variables. Specific ones to look for are `USERDOMAIN`, `USERNAME`, `USERPROFILE`, `HOMEPATH`, `LOGONSERVER`, `COMPUTERNAME`, `APPDATA`, and `ALLUSERPROFILE`.

`C:\> echo %PATH%`

`C:\> set`

Check the user logon settings

`C:\> net accounts`

### 4.2 - Powershell

```
PS C:\> Get-ChildItem Env:

PS C:\> Get-ChildItem Env:* | ft Key,Value
```

---
## References

- [CmdLine Scripts for Reverse TCP Shell Addicts](https://github.com/r00t-3xp10it/venom/wiki/CmdLine-%26-Scripts-for-reverse-TCP-shell-addicts)

- [Bazarloader to Conti Ransomware in 32 Hours](https://thedfirreport.com/2021/09/13/bazarloader-to-conti-ransomware-in-32-hours/)

- [Active Directory Domain Enumeration Part 1](https://nored0x.github.io/red-teaming/active-directory-domain-enumeration-part-1/)