# Unix Shell

## 01 - Powershell

### 1.1 - Running WinRM cmdlets in Linux

`user@pentestos:~$ pwsh`

```powershell
PS /home/user> $creds = Get-Credential

PS /home/user> Enter-PSSession -ComputerName <IP> -Authentication Negotiate -Credential $creds
```

We can also **New-PSSession** feature to send commands via **Invoke-Command**

```powershell
PS /home/user> $session = New-PSSession -ComputerName <IP> -Authentication Negotiate -Credential $creds

PS /home/user> Invoke-Command -Session $session -ScriptBlock {hostname}
```

We can also pass multiple sessions as well

```powershell
PS /home/user> $multisession = New-PSSession -ComputerName <IP_1>,<IP_2>,<IP_n> -Authentication Negotiate -Credential $creds

PS /home/user> Invoke-Command -Session $multisession -ScriptBlock { hostname }
```

## 02 - NetExec

`$ netexec winrm <IP>/<CIDR> -u "<username>" -p "<password>" [-d <domain_name> | --local-auth]`

- Pass the Hash

`$ netexec winrm <IP>/<CIDR> -u "<username>" -H "<nt_hash>" [-d <domain_name> | --local-auth]`

## 03 - Evil-WinRM

### 3.1 - Help Menu

```
$ evil-winrm -h
                                        
Evil-WinRM shell v3.5

Usage: evil-winrm -i IP -u USER [-s SCRIPTS_PATH] [-e EXES_PATH] [-P PORT] [-p PASS] [-H HASH] [-U URL] [-S] [-c PUBLIC_KEY_PATH ] [-k PRIVATE_KEY_PATH ] [-r REALM] [--spn SPN_PREFIX] [-l]
    -S, --ssl                        Enable ssl
    -c, --pub-key PUBLIC_KEY_PATH    Local path to public key certificate
    -k, --priv-key PRIVATE_KEY_PATH  Local path to private key certificate
    -r, --realm DOMAIN               Kerberos auth, it has to be set also in /etc/krb5.conf file using this format -> CONTOSO.COM = { kdc = fooserver.contoso.com }
    -s, --scripts PS_SCRIPTS_PATH    Powershell scripts local path
        --spn SPN_PREFIX             SPN prefix for Kerberos auth (default HTTP)
    -e, --executables EXES_PATH      C# executables local path
    -i, --ip IP                      Remote host IP or hostname. FQDN for Kerberos auth (required)
    -U, --url URL                    Remote url endpoint (default /wsman)
    -u, --user USER                  Username (required if not using kerberos)
    -p, --password PASS              Password
    -H, --hash HASH                  NTHash
    -P, --port PORT                  Remote host port (default 5985)
    -V, --version                    Show version
    -n, --no-colors                  Disable colors
    -N, --no-rpath-completion        Disable remote path completion
    -l, --log                        Log the WinRM session
    -h, --help                       Display this help message

*Evil-WinRM* PS C:\Users\user\Documents> menu

   ,.   (   .      )               "            ,.   (   .      )       .
  ("  (  )  )'     ,'             (     '    ("     )  )'     ,'   .  ,)
.; )  ' (( (" )    ;(,      .     ;)  "  )"  .; )  ' (( (" )   );(,   )((
_".,_,.__).,) (.._( ._),     )  , (._..( '.._"._, . '._)_(..,_(_".) _( _')
\_   _____/__  _|__|  |    ((  (  /  \    /  \__| ____\______   \  /     \
 |    __)_\  \/ /  |  |    ;_)_') \   \/\/   /  |/    \|       _/ /  \ /  \
 |        \\   /|  |  |__ /_____/  \        /|  |   |  \    |   \/    Y    \
/_______  / \_/ |__|____/           \__/\  / |__|___|  /____|_  /\____|__  /
        \/                               \/          \/       \/         \/

       By: CyberVaca, OscarAkaElvis, Jarilaos, Arale61 @Hackplayers
[+] Dll-Loader 
[+] Donut-Loader 
[+] Invoke-Binary
[+] Bypass-4MSI
[+] services
[+] upload
[+] download
[+] menu
[+] exit
```

### 3.2 - Usage

`$ evil-winrm -i <IP> -r <domain_name> -u <username> -p "<password>"`

- Pass the Hash

`$ evil-winrm -i <IP> -r <domain_name> -u <username> -H "<nt_hash>"`