# SSLH

## 01 - Setup

### 1.1 - Dependencies

```
$ sudo apt install -y libconfig-dev libwrap0-dev libsystemd-dev libcap-dev libbsd libbsd-dev libpcre-dev libev-dev

$ sudo apt install libconfig-dev libwrap0-dev libsystemd-dev libcap-dev libbsd-dev libpcre2-dev
```

### 1.2 - Installation

#### 1.2.1 - Compile From Source

```
$ git clone https://github.com/yrutschle/sslh && \
cd sslh && make install && \
cp sslh-fork /usr/local/sbin/sslh && \
cp basic.cfg /etc/sslh.cfg
```

#### 1.2.2 - Package Manager

- Debian/Ubuntu distros

`$ sudo apt install -y sslh`

- Arch-based distros

`$ sudo pacman -S sslh`

## 02 - Help Menu

```
$ sslh -h
sslhcfg: invalid option "-h"
 [-Vfin] [-F <file>] [-v <n>] [--transparent] [-t <n>] [-u <str>] [-P <file>] [-C <path>] [--syslog-facility=<str>] [--on-timeout=<str>] [--prefix=<str>] [-p <host:port>]... [--ssh=<host:port>]... [--tls=<host:port>]... [--openvpn=<host:port>]... [--tinc=<host:port>]... [--xmpp=<host:port>]... [--http=<host:port>]... [--adb=<host:port>]... [--socks5=<host:port>]... [--syslog=<host:port>]... [--anyprot=<host:port>]...
  -F, --config=<file>           Specify configuration file
  -v, --verbose=<n>        
  -V, --version                 Print version information and exit
  -f, --foreground              Run in foreground instead of as a daemon
  -i, --inetd                   Run in inetd mode: use stdin/stdout instead of network listen
  -n, --numeric                 Print IP addresses and ports as numbers
  --transparent                 Set up as a transparent proxy
  -t, --timeout=<n>             Set up timeout before connecting to default target
  -u, --user=<str>              Username to change to after set-up
  -P, --pidfile=<file>          Path to file to store PID of current instance
  -C, --chroot=<path>           Root to change to after set-up
  --syslog-facility=<str>       Facility to syslog to
  --on-timeout=<str>            Target to connect to when timing out
  --prefix=<str>                Reserved for testing
  -p, --listen=<host:port>      Listen on host:port
  --ssh=<host:port>             Set up ssh target
  --tls=<host:port>             Set up TLS/SSL target
  --openvpn=<host:port>         Set up OpenVPN target
  --tinc=<host:port>            Set up tinc target
  --xmpp=<host:port>            Set up XMPP target
  --http=<host:port>            Set up HTTP (plain) target
  --adb=<host:port>             Set up ADB (Android Debug) target
  --socks5=<host:port>          Set up socks5 target
  --syslog=<host:port>          Set up syslog target
  --anyprot=<host:port>         Set up default target
```

## 03 - Usage

A **protocol demuliplexer** gains the ability to accept remote ports to bypass the restricted network as the protocol was tunneled as HTTP, TLS/SSL, SSH, OpenVPN, tinc, XMPP, and SOCKS5. It combines the two ports into one.

### 3.1 - Syntax

TODO: Fill this info

`$ sudo sslh [-u <username>] -p <bind_local_IP>:<local_PORT>`

## 04 - Scenarios

### 4.1 - Bind HTTP port as SSH

```
$ sudo sslh -p 0.0.0.0:80 --ssh <remote_IP>:<SSH_PORT> --http <remote_IP>:<HTTP_PORT>

$ ssh -p 80 <username>@127.0.0.1
```

### 4.2 - Bind HTTPS port as SSH

```
$ sudo sslh -p 0.0.0.0:443 --ssh <remote_IP>:<SSH_PORT> --ssl <remote_IP>:<HTTPS_PORT>

$ ssh -p 443 <username>@127.0.0.1
```

---
## References

### Program

- [SSLH Source Repository](https://github.com/yrutschle/sslh)

- [SSLH](https://www.rutschle.net/tech/sslh/README.html)

### Scenarios

- [Unixmen: A SSL/SSH Multiplexer for Linux](https://unixmen.com/sslh-a-sslssh-multiplexer-for-linux/)

- [Pentest Tools: SSLH – Applicative Protocol Multiplexer](https://pentesttools.net/sslh-applicative-protocol-multiplexer/)

- [OSTechNix: SSLH – Share A Same Port For HTTPS And SSH](https://ostechnix.com/sslh-share-port-https-ssh/)

- [Transparent SSLH: using a single port to transparently route incoming traffic for Apache, OpenVPN, and SSH](https://confluence.jaytaala.com/display/TKB/Transparent+SSLH%3A+using+a+single+port+to+transparently+route+incoming+traffic+for+Apache%2C+OpenVPN%2C+and+SSH)

- [Jitendra Patro: SSLH Transparent Proxy for Apache, OpenVPN and SSH](https://blog.jitendrapatro.me/sslh-transparent-proxy-for-apache-openvpn-and-ssh/)

- [SSLH and OpenVPN TCP 443 Setup Configuration Files](https://gist.github.com/hostmaster/7819751)