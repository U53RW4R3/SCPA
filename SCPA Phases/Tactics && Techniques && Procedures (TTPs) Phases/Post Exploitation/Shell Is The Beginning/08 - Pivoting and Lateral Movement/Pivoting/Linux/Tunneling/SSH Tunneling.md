# SSH Tunneling

## 01 - Jump Host

### 1.1 - Usage

TODO: Demonstrate jumping hosts via SSH

## 02 - Pseudo-VPN Network

### 2.1 - Conditions

- SSH configuration requires `PermitRootLogin` and `PermitTunnel` enabled

```
user@sshserver:~$ cat /etc/ssh/sshd_config
..[snip]..
PermitRootLogin yes
PermitTunnel yes
..[snip]..
```

### 2.2 - Setup

TODO: Test it to make sure it works

```
user@pentestos:~$ ssh <username>@<IP> -w any:any

user@pentestos:~$ ip a

user@pentestos:~$ sudo ip address add 192.168.0.2/32 peer 192.168.0.1 dev tun0

user@pentestos:~$ sudo route add -net 10.0.0.0/24 gw 192.168.0.1
```

```
user@sshserver:~$ sudo ip address add 192.168.0.1/32 peer 192.168.0.2 dev tun0

user@sshserver:~$ sudo sysctl -w net.ipv4.ip_forward=1

user@sshserver:~$ sudo iptables -t nat -A POSTROUTING -s 192.168.0.1 -o <interface> -j MASQUERADE
```

## 03 - SSHuttle

### 3.1 - Usage

```
$ sudo sshuttle --dns -vr <username>@<IP> -x <IPv4>/<CIDR>

$ sudo sshuttle --dns [-e <'ssh -i /path/to/key'>] -vr <username>@<IP> -x <IPv4>/<CIDR>
```

- Prevent sshuttle redirect

`$ sudo sshuttle -r <username>@<IP> -x <same_ssh_IP> <IPv4>/<CIDR>`

---
## References

- [Arch Linux: VPN over SSH](https://wiki.archlinux.org/title/VPN_over_SSH)

- [Certcube: Pivoting Port Forwarding](https://blog.certcube.com/pivoting-port-forwarding/)

- [RawSec: Overview of Network Pivoting and Tunneling](https://blog.raw.pm/en/state-of-the-art-of-network-pivoting-in-2019/)