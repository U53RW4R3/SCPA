# IP Address

## 01 - Manual

### 1.1 - Basic

#### 1.1.1 - Command Prompt

- **IP Addresses and Subnet**

`C:\> ipconfig`

`C:\> ipconfig /displaydns`

`C:\> ipconfig /all`

`C:\> ipconfig /allcompartments /all`

`C:\> type C:\Windows\System32\drivers\etc\hosts`

`C:\> netsh interface ip addresses`

`C:\> netsh interface ip route`

`C:\> netsh interface ip neighbors`

`C:\> wmic rdtoggle list`

`C:\> wmic netlogin get name,lastlogon,badpasswordcount`

`C:\> wmic nicconfig get description,ipaddress,macaddress`

#### 1.1.2 - Powershell

- **IP Addresses and Subnet**

`PS C:\> Get-NetIPAddress -AddressFamily IPv4 | ft Interfacealias, IPv4Address`

`PS C:\> Get-NetIPConfiguration | ft InterfaceAlias,InterfaceDescription,IPv4Address`

`PS C:\> Get-DnsClientServerAddress -AddressFamily IPv4 | ft -Autosize`

`PS C:\> Get-CimInstance -ClassName CIM_System | Format-Table -AutoSize`

`PS C:\> Get-CimInstance -ClassName Win32_NTDomain | Format-Table -AutoSize`

### 1.2 - ARP Discovery

#### 1.2.1 - Command Prompt

- Returns an ARP network with a list of ip address

`C:\> arp -a`

#### 1.2.2 - Powershell

- Returns an ARP network with a list of ip address

`PS C:\> Get-NetNeighbor -AddressFamily IPv4 | ft ifIndex,IPAddress,LinkLayerAddress,State`

### 1.3 - Route Table

#### 1.3.1 - Command Prompt

- **Routing table**

Print the routing table

`C:\> route print`

`C:\> netstat -r`

`C:\> netstat -ano`

All in one go

`C:\> ipconfig /all && route print && arp -a`

#### 1.3.2 - Powershell

- **Routing table**

Print the routing table

`PS C:\> Get-NetRoute -AddressFamily IPv4 | ft DestinationPrefix,NextHop,RouteMetric,ifIndex`

### 1.4 - Netstat

#### 1.4.1 - Command Prompt

- Note: Must be with elevated privileges when running a flag with `netstat.exe -b`

`C:\Windows\system32> netstat -abno`

- Prints the network statistics. Display the loopback services and other computers that is which the machine is interacting with

`C:\> netstat -anto`

- Find all `LISTENING` ports and connection on port 445

`C:\> netstat -na | findstr :445`

- Find all `ESTABLISHED` ports connections

`C:\> netstat -an | findstr ES`

- Specify a protocol with -p flag either via `IP`, `IPv6`, `ICMP`, `ICMPv6`, `TCP`, `TCPv6`, `UDP`, and `UDPv6`

`C:\> netstat -antp <IP | IPv6 | ICMP | ICMPv6 | TCP | TCPv6 | UDP | UDPv6>`

- for example:

`C:\> netstat -antp icmp`

### 1.5 - DNS

#### 1.5.2 - Command Prompt

`C:\> type c:\Windows\system32\drivers\etc\hosts`

#### 1.5.2 - Powershell

`PS C:\> Resolve-DnsName <dns_server> -Type A`

`PS C:\> Get-DNSServerZone`

`PS C:\> Get-DNSServerZoneResourceRecord -ZoneName <domain.com>`

### 1.6 - Network Configuration

#### 1.6.1 - Command Prompt

`C:\> netsh wlan show profiles`

`C:\> netsh wlan show profile "<Name>" key=clear`

`C:\> netsh wlan show wlanreport`

`C:\> netsh dump`

`C:\> reg query HKLM\SYSTEM\CurrentControlSet\Services\SNMP /s`

#### 1.6.2 - Powershell

`PS C:\> Get-ChildItem -Path HKLM:\SYSTEM\CurrentControlSet\Services\SNMP -Recurse`

## 02 - Metasploit

### 2.1 - Ping Sweep

`meterpreter > run post/multi/gather/ping_sweep rhosts=<IP>/<CIDR>`

### 2.2 - ARP Discovery

```
meterpreter > run arp_scanner
Meterpreter Script for performing an ARPS Scan Discovery.

OPTIONS:

    -h   Help menu.
    -i   Enumerate Local Interfaces
    -r   The target address range or CIDR identifier
    -s   Save found IP Addresses to logs.

meterpreter > run arp_scanner -i

meterpreter > run arp_scanner -r <IP>/<CIDR>

meterpreter > run arp_scanner -r 10.0.2.1-15 -s
[*] ARP Scanning 10.0.2.1-15
[*] IP: 10.0.2.2 MAC 52:54:00:12:35:00
[*] IP: 10.0.2.1 MAC 52:54:00:12:35:00
[*] IP: 10.0.2.3 MAC 08:00:27:a5:d7:df
[*] IP: 10.0.2.4 MAC 08:00:27:8f:39:74
[*] IP: 10.0.2.15 MAC 08:00:27:3c:90:25
[*] Saving found IP's to /root/.msf4/logs/scripts/arp_scanner/DEFALT_20220515.2800/DEFALT_20220515.2800.txt

meterpreter > run post/windows/gather/arp_scanner rhosts=<IP>/<CIDR> threads=8
```

### 2.3 - Netstat

`meterpreter > run post/windows/gather/tcpnetstat`

### 2.4 - Network Configuration

#### 2.4.1 - WLAN

`meterpreter > run post/windows/wlan/wlan_bss_list`

`meterpreter > run post/windows/wlan/wlan_current_connection`

`meterpreter > run post/windows/wlan/wlan_profile`

`meterpreter > run post/windows/wlan/wlan_probe_request`

#### 2.4.2 - RDP

`meterpreter > run post/windows/gather/enum_termserv`

## 03 - Powersploit

### 3.1 - PowerView

- **Output the network configuration of the workstation**

`PS C:\> Get-NetSubnet`

- **Displays the Domain Controllers (the servers such as Active Directories) and Workstations (StandAlonePCs)**

`PS C:\> Get-NetComputer -ping`

### 3.2 - DNS

- **Reverse DNS Lookup**

`PS C:\> impo Invoke-ReverseDnsLookup.ps1`

`PS C:\> Invoke-ReverseDnsLookup <IP>/<CIDR>`

`PS C:\> Invoke-ReverseDnsLookup 192.168.0.6-192.168.0.22`

## 04 - Cobalt Strike

- **Retrieves IP Addresses**

`beacon> net view`

`beacon> net computers`

`beacon> run ipconfig /all`

`beacon> powerpick <Get-NetIPConfiguration | gip>`