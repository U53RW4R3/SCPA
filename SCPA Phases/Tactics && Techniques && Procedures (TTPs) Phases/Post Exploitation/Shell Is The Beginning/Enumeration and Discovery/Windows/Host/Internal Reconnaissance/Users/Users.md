# Users

## 01 - Manual

### 1.1.1 - Basic User Information

#### 1.1.1.1 - Command Prompt

- Note: The percent/modulus sign means for Windows operating systems it will echo out the variable (for example: `%VARIABLE%`) which is similar to bash script in Linux (for example: `$VARIABLE`)

`C:\> echo %USERNAME%`

`C:\> hostname`

`C:\> quser`

`C:\> query user <username> /server:<IP>`

`C:\> whoami`

- Retrieves the SID

`C:\> whoami /user`

`C:\> net accounts`

- **Check the user's privileges**

`C:\> whoami /priv`

`C:\> whoami /groups`

`C:\> whoami /all`

`C:\> net users`

`C:\> dir /b /ad "C:\Users\"`

- Windows XP and below

`C:\> dir /b /ad "C:\Documents and Settings\"`

#### 1.1.1.2 - Powershell

`PS C:\> $env:username`

`PS C:\> echo (Get-CimInstance Win32_ComputerSystem).Name`

`PS C:\> echo (Get-WMIObject Win32_ComputerSystem).Name`

- **Check the user's privileges**

`PS C:\> Get-LocalUser`

`PS C:\> Get-LocalUser | ft Name,Enabled,LastLogon`

`PS C:\> Get-ChildItem C:\Users -Force | Select-Object Name`

### 1.1.2 - Enumerate User Information

#### 1.1.2.1 - Command Prompt

`C:\> net user`

`C:\> net user <username>`

`C:\> net user %USERNAME%`

`C:\> wmic useraccount`

`C:\> wmic useraccount list`

`C:\> wmic useraccount get name,sid`

`C:\> wmic useraccount get /all`

#### 1.1.2.2 - Powershell

`PS C:\> Get-CimInstance -ClassName Win32_Account | Format-Table -AutoSize`

`PS C:\> Get-CimInstance -ClassName Win32_Group | Format-Table -AutoSize`

`PS C:\> Get-CimInstance -ClassName Win32_UserAccount | Format-Table -AutoSize`

`PS C:\> Get-CimInstance -ComputerName $env:computername -ClassName Win32_UserAccount -filter "LocalAccount=True" | select PSComputername, Name, Status, Disabled, AccountType, Lockout, PasswordRequired, PasswordChangeable`

`PS C:\> Get-CimInstance -ComputerName $env:computername -ClassName Win32_UserAccount -filter "LocalAccount=True" | select PSComputername, Name, Status, Disabled, AccountType, Lockout, PasswordRequired, PasswordChangeable | Out-GridView`

`PS C:\> Get-CimInstance -ClassName Win32_UserDesktop | ft -AutoSize`

### 1.1.3 - Logged On Users

#### 1.1.3.1 - Powershell

`PS C:\> Get-CimInstance -Query "Select * FROM Win32_LoggedOnUser" | ?{$_.LogonType -notmatch '(Service|Network|System)'}`

### 1.1.4 - User Environment

#### 1.1.3.1 - Command Prompt

- **Shows all current environmental variables. Specific ones to look for are `USERDOMAIN`, `USERNAME`, `USERPROFILE`, `HOMEPATH`, `LOGONSERVER`, `COMPUTERNAME`, `APPDATA`, and `ALLUSERPROFILE`.**

`C:\> echo %PATH%`

`C:\> set`

`C:\> set computername`

`C:\> hostname`

Check the user logon settings

`C:\> net accounts`

#### 1.1.3.2 - Powershell

`PS C:\> Get-ChildItem Env:* | ft Key,Value`

`PS C:\> $env:computername`

`PS C:\> Get-CimInstance -Classname Win32_ComputerSystem`

## 02 - CrackMapExec

`$ crackmapexec smb <IP> -u <username> -p <password> --users`

## 03 - Powersploit

### 3.1 - PowerView

#### 3.1.1 - Basic

- Getting users on the windows workstation

`PS C:\> <Get-NetUser | Get-DomainUser>`

- cn stands for Common Names

`PS C:\> Get-NetUser | Select-Object cn`

`PS C:\> Get-NetUser | select cn`

SID will come in handy when using mimikatz to dump and get a golden ticket so look out for an SID object that ends with `"-500"` which is typically has Admin Rights

`PS C:\> Get-NetUser | select cn, objectsid`

- Retrieve user accounts

`PS C:\> Get-NetUser | select samaccountname`

#### 3.1.2 - Enumerate User Accounts

TODO: Fill this information

#### 3.1.3 - Logged On Users

- **Enumerate users** who are part of the **Administrators Group.**

`PS C:\> [Invoke-EnumerateLocalAdmin|Find-DomainLocalGroupMember]`

`PS C:\> Invoke-EnumerateLocalAdmin`

- Retrieve information to check which users are currently logged on in the computer.

`PS C:\> Get-NetLoggedon`

`PS C:\> Get-NetLoggedon -ComputerName <IP>`

- Retrieve information to print which is the last user who logged on the computer.

`PS C:\> Get-LastLoggedOn`

`PS C:\> Get-LastLoggedon -ComputerName <IP>`

- Check if a user is currently logged on with a RDP (Remote Desktop Protocol) session.

`PS C:\> Get-NetRDPSession`

`PS C:\> Get-NetRDPSession -ComputerName <IP>`

## 04 - Mimikatz

### 4.1  - Basic

`mimikatz # hostname`

## 05 - Metasploit

### 5.1 - Basic

- **Check the user's privileges**

`meterpreter > run post/windows/gather/win_privs`

### 5.2 - User Environment

#### 5.2.1 - Modules

##### 5.2.1.1 - Post

```
msf > use post/multi/gather/env

msf post(multi/gather/env) > options

Module options (post/multi/gather/env):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION                   yes       The session to run this module on

msf post(multi/gather/env) > set session <session_id>

msf post(multi/gather/env) > exploit
```

#### 5.2.2 - Meterpreter

`meterpreter > run post/windows/gather/enum_powershell_env`

`meterpreter > run post/windows/gather/enum_logged_on_users`

## 06 - Metasploit

## 07 - Cobalt Strike

### 7.1 - Basic User Information

`beacon> getuid`

`beacon> getprivs`

### 7.2 - Enumerate User Information

`beacon> net users [\\<target_IP>]`

### 6.3 - Logged On Users

`beacon> net sessions [\\<target_IP>]`

---
## References

- [CmdLine Scripts for Reverse TCP Shell Addicts](https://github.com/r00t-3xp10it/venom/wiki/CmdLine-%26-Scripts-for-reverse-TCP-shell-addicts)

- [Bazarloader to Conti Ransomware in 32 Hours](https://thedfirreport.com/2021/09/13/bazarloader-to-conti-ransomware-in-32-hours/)

- [Active Directory Domain Enumeration Part 1](https://nored0x.github.io/red-teaming/active-directory-domain-enumeration-part-1/)