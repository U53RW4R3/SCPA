# Unix Shell

Search Tag(s): #post-exploitation #enumeration-and-discovery #active-directory #windows

## 01 - Samba Suite Utils

### 1.1 - RPCClient

#### 1.1.1 - Authentication

Authentication syntax.

```
$ rpcclient -U "<username>%<password>" [-p 593] <IP>
```

Authenticate `guest` account.

```
$ rpcclient <IP> -U 'guest%' <IP>
rpcclient $>
```

#### 1.1.2 - Username enumeration

Retrieve current domain user password information.

```
rpcclient $> getusrdompwinfo <username_rid_value>
```

#### 1.1.3 - Enumerate Domain Users

```
rpcclient $> enumdomusers

rpcclient $> querygroupmem <group_rid_value>
```

SAM lookup.

```
rpcclient $> samlookupnames domain <username>

rpcclient $> samlookuprids domain <username_rid_value>
```

#### 1.1.4 - Enumerate Domain Groups

```
rpcclient $> enumdomgroups

rpcclient $> enumalsgroups domain

rpcclient $> querygroup <group_rid_value>
```

#### 1.1.5 - Enumerate user accounts

Display Query Information. You can find information in the description that my contain credentials.

```
rpcclient $> querydispinfo
```

Lookup SID accounts.

```
rpcclient $> lookupsids <SID>
```

Lookup username accounts.

```
rpcclient $> lookupnames <username>
```

User enumeration via RID Cycling.

```
$ for i in $(seq 500 1100); do rpcclient -N -U "" <IP> -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo ""; done
```

#### 1.1.6 - Group Policy Objects

Domain Password Information.

```
rpcclient $> getdompwinfo
```

Retrieve password policy.

```
rpcclient $> polenum
```

### 1.2 - NetCommand

#### 1.2.1 - Authentication

Authentication syntax

```
$ net rpc group members '<group_name>' -U '[<domain_name>/]<username>%<password>' -I '<IP>'
```

Pass The Hash

```
$ net rpc group members '<group_name>' -U '[<domain_name>/]<username>' --pw-nt-hash <nt_hash> -I '<IP>'
```

#### 1.2.2 - User enumeration

```
$ net rpc group members 'Domain Users'  -U '%' -I '<IP>'
```

## 02 - NetExec

### 2.1 - Users

Enumerate domain users.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain_name> | --local-auth] --users
```

Enumerate current domain users.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain_name> | --local-auth] --users <user_1>,<user_2>,<user_n>
```

Bruteforce via RID Cycling.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain_name> | --local-auth] --rid-brute [max_rid_value]

$ netexec smb <IP> -u "guest" -p "" [-d <domain_name> | --local-auth] --rid-brute [max_rid_value]
```

### 2.2 - Groups

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain_name> | --local-auth] --groups

$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain_name> | --local-auth] --groups "Domain Admins"

$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain_name> | --local-auth] --groups "Enterprise Admins"
```

## 2.3 - Group Policy Objects

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain_name> | --local-auth] --pass-pol
```

## 03 - Impacket

### 3.1 - User enumeration via RID Cycling

Authentication for RID lookup.

```
$ samrdump.py <domain>/<username>:<password>@<IP>

$ samrdump.py <domain>/<username>@<IP> -hashes :<nt_hash>
```

User enumeration.

```
$ samrdump.py guest@<IP> -no-pass
```

### 3.2 - User enumeration via SID Cycling

Authentication for SID lookup.

```
$ lookupsids.py <domain>/<username>:<password>@<IP>

$ lookupsids.py <domain>/<username>@<IP> -hashes :<nt_hash>
```

User enumeration.

```
$ lookupsids.py guest@<IP> -no-pass
```

## 04 - Nmap

### 4.1 - Users

```
$ nmap -p 445 -Pn --script smb-enum-users --script-args "smbuser='<username>',smbpassword='<password>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-users "smbuser='<username>',smbpassword='<password>'" <IP>
```

Pass the Hash

```
$ nmap -p 445 -Pn --script smb-enum-users --script-args "smbuser='<username>',smbhash='<nt_hash>' <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-users --script-args "smbuser='<username>',smbhash='<nt_hash>'" <IP>
```

### 4.2 - Groups

```
$ nmap -p 445 -Pn --script smb-enum-groups --script-args "smbuser='<username>',smbpassword='<password>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-groups "smbuser='<username>',smbpassword='<password>'" <IP>
```

Pass the Hash

```
$ nmap -p 445 -Pn --script smb-enum-groups --script-args "smbuser='<username>',smbhash='<nt_hash>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-groups --script-args "smbuser='<username>',smbhash='<nt_hash>'" <IP>
```