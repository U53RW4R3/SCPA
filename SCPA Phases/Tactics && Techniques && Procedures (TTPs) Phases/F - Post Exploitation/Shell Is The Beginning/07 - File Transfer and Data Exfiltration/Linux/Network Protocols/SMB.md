# SMB

## 01 - Server Setup

### 1.1 - Samba

`$ cat /etc/samba/smb.conf`

---

```
Please note that you also need to set appropriate Unix permissions
# to the drivers directory for these users to have write rights in it
;   write list = root, @lpadmin

# client min protocol = LANMAN1
# client min protocol = NT1
# client min protocol = SMB2
[global]
client min protocol = CORE
client max protocol = SMB3

[visualstudio]
path = /path/to/directory
browseable = yes
read only = no
```

```
$ sudo smbpasswd -a <username>

$ sudo systemctl restart smbd

$ sudo /etc/init.d/smbd restart

$ sudo service smbd restart
```

### 1.2 - Impacket

```
$ sudo smbserver.py <share_name> .

$ sudo smbserver.py <share_name> $(pwd)
```

## 02 - Usage

### 2.1 - Smbclient

#### 2.1.1 - Samba Util Suite

1. `smbclient` method.

```
$ smbclient //<IP>/c$

smb:\>
```

- Download everything on the SMB server

```
smb:\> recurse on

smb:\> prompt off

smb:\> mget *
```

- Archive everything in a tarball file

`smb: \> tar c backup.tar *`

Once you've setup the CIFS/SMB/Samba server on the Client Side for Windows workstation in this will copy the files from the attacker's server. Visit this [[Tactics && Techniques && Procedures (TTPs) Phases/F - Post Exploitation/Shell Is The Beginning/07 - File Transfer and Data Exfiltration/Windows/Network Protocols/SMB|section]] to see the practical methods

2. `smbget` method.

TODO: Confirm this works

- Download Recursively

`$ smbget -R`

#### 2.1.2 - Impacket

```
$ smbclient.py <domain>/<username>@<IP>

# shares

# use <share_name>

# mget *
```

---
## References

- [SMB Client Configuration](https://notes.benheater.com/books/kali-optimizations/page/smb-client-configuration)