# Metasploit

Search Tag(s): #post-exploitation #enumeration-and-discovery #active-directory #metasploit-framework #windows

## 01 - Modules

### 1.1 - Auxiliary

```
msf > use auxiliary/scanner/smb/smb_enumshares

msf auxiliary(scanner/smb/smb_enumshares) > options

Module options (auxiliary/scanner/smb/smb_enumshares):

   Name            Current Setting  Required  Description
   ----            ---------------  --------  -----------
   LogSpider       3                no        0 = disabled, 1 = CSV, 2 = table (txt), 3 = one liner (txt) (Accepted: 0, 1, 2, 3)
   MaxDepth        999              yes       Max number of subdirectories to spider
   RHOSTS                           yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   SMBDomain       .                no        The Windows domain to use for authentication
   SMBPass                          no        The password for the specified username
   SMBUser                          no        The username to authenticate as
   ShowFiles       false            yes       Show detailed information when spidering
   SpiderProfiles  true             no        Spider only user profiles when share is a disk share
   SpiderShares    false            no        Spider shares recursively
   THREADS         1                yes       The number of concurrent threads (max one per host)

msf auxiliary(scanner/smb/smb_enumshares) > set smbuser <username>

msf auxiliary(scanner/smb/smb_enumshares) > set smbpass <password | aad3b435b51404eeaad3b435b51404ee:<nt_hash>>

msf auxiliary(scanner/smb/smb_enumshares) > set rhosts <IP>

msf auxiliary(scanner/smb/smb_enumshares) > set smbdomain [<domain_name>]

msf auxiliary(scanner/smb/smb_enumshares) > set showfiles <true | false>

msf auxiliary(scanner/smb/smb_enumshares) > set spidershares [true | false]

msf auxiliary(scanner/smb/smb_enumshares) > set threads 4

msf auxiliary(scanner/smb/smb_enumshares) > set logspider <0 | 1 | 2 | 3>

msf auxiliary(scanner/smb/smb_enumshares) > run
```

### 1.2 - Post

run post/windows/gather/enum_domain

run post/windows/gather/enum_tokens

run post/windows/gather/enum_domain_tokens

run post/windows/gather/enum_ad_managedby_groups

run post/windows/gather/enum_ad_to_wordlist

run post/windows/gather/enum_ad_user_comments

run post/windows/gather/enum_ad_users

run post/windows/gather/credentials/enum_laps

```
msf > use post/windows/gather/enum_domain_group_users

msf post(windows/gather/enum_domain_group_users) > options

Module options (post/windows/gather/enum_domain_group_users):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   GROUP                     yes       Domain Group to enumerate
   SESSION                   yes       The session to run this module on

msf post(windows/gather/enum_domain_group_users) > set group <domain_group>

msf post(windows/gather/enum_domain_group_users) > set session <session_id>

msf post(windows/gather/enum_domain_group_users) > exploit
```

- One liner

```
meterpreter > run post/windows/gather/enum_domain_group_users group="Domain Admins"

meterpreter > run post/windows/gather/enum_domain_group_users group="Enterprise Admins"
```

TODO: Fill this info

- LDAP query

```
meterpreter > run post/windows/gather/enum_ad_groups
```

- Bitlocker

```
metepreter > run post/windows/gather/enum_ad_bitlocker
```

---
## References

- [Rapid7: Metasploit Framework Enumerate Domain Controller Gather Post Module](https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/windows/gather/enum_domain.md)

- [Rapid7: Metasploit Framework Enumerate Tokens Gather Post Module](https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/windows/gather/enum_tokens.md)