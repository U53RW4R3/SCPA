# SMB

## 01 - Anonymous Login

## 1.1 - Nmap

```
$ nmap -p 445 -Pn -n --script smb-enum-* <IP>

$ nmap -p 445 -Pn -n --script smb-enum-* -iL ip_targets.txt
```

## 1.2 - Nuclei

`$ nuclei -l ip_targets.txt -id smb-anonymous-access -t ~/nuclei-templates`

## 02 - RCE

### 2.1 - EternalBlue

- Nmap

```
$ nmap -p 445 -Pn -n --script smb-vuln-ms17-010 <IP>

$ nmap -p 445 -Pn -n --script smb-vuln-ms17-010 -iL ip_targets.txt
```

- Metasploit

```
msf > use auxiliary/scanner/smb/smb_ms17_010

msf auxiliary(scanner/smb/smb_ms17_010) > options

Module options (auxiliary/scanner/smb/smb_ms17_010):

   Name         Current Setting                                              Required  Description
   ----         ---------------                                              --------  -----------
   CHECK_ARCH   true                                                         no        Check for architecture on vulnerable hosts
   CHECK_DOPU   true                                                         no        Check for DOUBLEPULSAR on vulnerable hosts
   CHECK_PIPE   false                                                        no        Check for named pipe on vulnerable hosts
   NAMED_PIPES  /usr/share/metasploit-framework/data/wordlists/named_pipes.  yes       List of named pipes to check
                txt
   RHOSTS                                                                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT        445                                                          yes       The SMB service port (TCP)
   SMBDomain    .                                                            no        The Windows domain to use for authentication
   SMBPass                                                                   no        The password for the specified username
   SMBUser                                                                   no        The username to authenticate as
   THREADS      1                                                            yes       The number of concurrent threads (max one per host)


View the full module info with the info, or info -d command.

msf auxiliary(scanner/smb/smb_ms17_010) > set check_arch <true | false>

msf auxiliary(scanner/smb/smb_ms17_010) > set check_dopu <true | false>

msf auxiliary(scanner/smb/smb_ms17_010) > set check_pipe [true | false]

msf auxiliary(scanner/smb/smb_ms17_010) > set threads 4

msf auxiliary(scanner/smb/smb_ms17_010) > set rhosts <<IP/<CIDR> | file:/path/to/ip_targets.txt>

msf auxiliary(scanner/smb/smb_ms17_010) > run
```