# Nmap

## Usage

### 01 - Port Specification and Scan Order

* **Specify port to scan**

`$ sudo nmap -p <PORT>`

* **Port range to scan**

`$ sudo nmap -p 21-23 <IP>`

* **Port list to scan**

`$ sudo nmap -p 25,53,80,443`

* **Port range and list to scan**

`$ sudo nmap -p 21-23,25,53,80 <IP>`

* **Scan all ports**

`$ sudo nmap -p- <IP>`

* **Show open ports**

`$ sudo nmap --open <IP>`

### 02 - Host Discovery

#### a. IP Range and List

* **Range of IP targets to scan**

`$ sudo nmap 192.168.0.23-110`

* **List of IP targets to scan**

`$ sudo nmap 192.168.0.23,110,166`

* **List of IP targets in a text file**

`$ sudo nmap -iL targets.txt`

* **Nmap can check which hosts to scan without scanning them**

`$ sudo nmap -sL <IP>/<CIDR>`

#### b. ICMP Scan

* **Ping Sweep**

`$ sudo nmap -sn <IP>/<CIDR>`

`$ nmap -sn -T4 <IP>/<CIDR> -oG - | awk '/Up$/{print $2}'`

* **Echo Scan**

`$ sudo nmap -PE -sn <IP>/<CIDR>`

* **Timestamp Scan**

`$ sudo nmap -PP -sn <IP>/<CIDR>`

* **Address Mask Scan**

`$ sudo nmap -PM -sn <IP>/<CIDR>`

#### c. ARP Scan

`$ sudo nmap -PR -sn <IP>/<CIDR>`

#### d. TCP Scan

* **TCP SYN Ping Scan**

`$ sudo nmap -PS22,80,443 -sn <IP>/<CIDR>`

* **TCP ACK Ping Scan**

`$ sudo nmap -PA22,80,443 -sn <IP>/<CIDR>`

#### e. UDP Scan

`$ sudo nmap -PU53,88,161,162 -sn <IP>/<CIDR>`

#### f. DNS Lookup

* **No Reverse-DNS Lookup**

`$ sudo nmap -n <IP>/<CIDR>`

* **Reverse-DNS lookup**

`$ sudo nmap -R <IP>/<CIDR>`

If you want to specify a specific dns server to lookup

`$ sudo nmap --dns-servers <dns_server_1>,<dns_server_2>,<dns_server_n> <IP>/<CIDR>`

### 03 -Verbose

* **Print more information during a scan**

`$ nmap -v <IP>`

* **Increase more verbosity**

`$ nmap -vv <IP>`

### 04 - Timing and Performance

* **Timing scan**

`$ sudo nmap -T[0-5] <IP>`

### 05 - Scan Techniques

#### a. TCP

* **TCP Connect Scan**

`$ sudo nmap -sT <IP>`

* **Syn "Half-open" Scan (Stealth Mode)**

`$ sudo nmap -sS <IP>`

#### b. UDP

* **UDP Scan**

`$ sudo nmap -sU <IP>`

#### c. Other Scan Types

* **TCP Null Scan**

`$ sudo nmap -sN <IP>`

* **FIN Scan**

`$ sudo nmap -sF <IP>`

* **Xmas Scan**

`$ sudo nmap -sX <IP>`

* **ACK Scan**

`$ sudo nmap -sA <IP>`

* **Window Scan**

`$ sudo nmap -sW <IP>`

* **Maimon Scan**

`$ sudo nmap -sM <IP>`

#### d. Version Detection

* **Detect operating system**

`$ sudo nmap -O <IP>`

* **Service Version detection**

`$ sudo nmap -sV <IP>`

`$ sudo nmap -sV --version-all <IP>`

### 06 - Output File Formats

* **Normal output format**

`$ sudo nmap -oN initial.nmap <IP>`

`$ grep -o '[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}' initial.nmap > ips.txt`

* **1337 5P34K 0U7PU7 F0rM47**

`$ sudo nmap -oS initial.nmap <IP>`

* **XML output format**

`$ sudo nmap -oX initial.xml <IP>`

* **Grepable output format**

`$ sudo nmap -oG initial.gnmap <IP>`

* **All output formats**

`$ sudo nmap -oA initial <IP>`

### 07 - Miscellaneous

* **Aggressive scan**

Note: This is equialvent to these switches `nmap -O -sVC --traceroute <IP>`

`$ sudo nmap -A <IP>`

### 08 - Evasion

#### 8.1 - Bypass Firewalls and IDS

##### a. Disable ICMP and ARP

* **Disable ICMP scans to ensure the target is online**

`$ nmap -Pn <IP>`

* **Disable ARP pings**

`$ nmap --disable-arp-ping <IP>`

##### b. Forge Packets

* **Fragment Packets**

`$ sudo nmap -f <IP>`

`$ sudo nmap --mtu 8 <IP>`

* **Customize Packets**

`$ nmap --data <hex> <IP>`

`$ nmap --data 0xdeefbeef <IP>`

`$ nmap --data-string "<string>" <IP>`

`$ nmap --data-string "Scan conducted by Security Ops, extension 7192" <IP>`

* **Send length of arbitrary data**

`$ nmap --data-length <int> <IP>`

No random data

`$ nmap --data-length 0 <IP>`

Send randomized data

`$ nmap --data-length 5 <IP>`

* **Send forged packets**

`$ nmap --badsum <IP>`

##### c. Spoofing

1. Decoys

* **Using SOCKS proxies to disguise ourselves**

`$ nmap --proxies <schema>://<IP>:<PORT> <target_IP>`

`$ nmap --proxies socks4://<IP>:<PORT>,http://<IP>:<PORT> <IP>`

* **Send decoys to the target IP**

`$ sudo nmap -D <IP_1>,<IP_2>,<IP_3> <IP>`

`$ sudo nmap -D RND:<int> <IP>`

`$ sudo nmap -D RND:10 <IP>`

Specify the network interface

`$ sudo nmap -e <interface> <IP>`

Spoof source IP address

`$ sudo nmap -e <interface> -Pn -S <source_IP> <target_IP>`

Exploit misconfigured firewall rules with a source port

`$ sudo nmap -g <PORT> <IP>`

* **Spoof source IP**

`$ sudo hping3 <target_IP> -a <source_IP>`

2. Idle Zombie Scan

`$ sudo nmap -sI <zombie_IP> <target_IP>`

##### d. FTP Bounce

* **Using a FTP server as a proxy server to scan the target**

`$ nmap -b <username>:<password>@<FTP_server_IP> <target_IP>`

`$ nmap -v -p 21,22,80,443,445 -Pn -b <username>:<password>@<FTP_server_IP> <target_IP>/<CIDR>`

##### e. Rate Limit

`$ nmap --host-timeout 10ms <IP>`

`$ nmap --host-timeout 100ms <IP>`

`$ nmap --max-retries [0-5] <IP>`

`$ nmap -sn --min-hostgroup 3 --max-hostgroup 3 <IP>/<CIDR>`

`$ nmap --scan-delay 11s <IP>`

`$ nmap --max-rate 2 <IP>`

`$ nmap --min-rate 2 <IP>`

`$ nmap --min-parallelism 2 --max-parallelism 2 <IP>`

`$ nmap --min-rtt-timeout 5ms <IP>`

`$ nmap --max-rtt-timeout 50ms <IP>`

`$ nmap --initial-rtt-timeout 50ms <IP>`

##### f. NSE Script

`$ sudo nmap --script firewall-bypass --script-args firewall-bypass.helper="ftp",firewall-bypass.targetport=<PORT> <target_IP>`

#### 8.2 - Spoof User Agent

`$ sudo nmap -Pn -n -sC --script-args http.useragent="<User_Agent>" <target_IP>`

### References

• [Nmap Bypass Firewalls and IDS](https://nmap.org/book/man-bypass-firewalls-ids.html)

• [Nmap Scan with Timing Parameters](https://www.hackingarticles.in/nmap-scan-with-timing-parameters/)

• [FTP Bounce Attack](https://book.hacktricks.xyz/pentesting/pentesting-ftp/ftp-bounce-attack)

• [Top 10 Firewall and IDS Evasion Techniques](https://medium.com/@IamLucif3r/top-10-firewall-ids-evasion-techniques-cb1e1cc06f24)

• [Nmap Firewall Evasion Techniques](https://www.dimz-it.com/berkas/Nmap_Firewall_Evasion_Techniques.pdf)

• [Firewall Bypassing Techniques with Nmap and Hping3](https://dzone.com/articles/firewall-bypassing-techniques-with-nmap-and-hping3)