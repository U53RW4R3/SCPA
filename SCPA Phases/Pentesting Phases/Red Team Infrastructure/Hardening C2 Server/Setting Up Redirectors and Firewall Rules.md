# Setting Up Redirectors and Firewall Rules

## 01 - Linux

### 1.1 - Socat

`$ sudo socat TCP4-LISTEN:433,fork TCP4:<C2_IP>:443 &`

`$ sudo iptables -I INPUT -p tcp -m tcp –dport 443 -j ACCEPT`

`$ sudo iptables -t nat -A PREROUTING -p tcp –dport 443 -j DNAT -–to-destination <C2_IP>:443`

`$ sudo iptables -t nat -A POSTROUTING -j MASQUERADE`

`$ sudo iptables -I FORWARD -j ACCEPT`

`$ sudo iptables -P FORWARD ACCEPT`

`$ sudo sysctl net.ipv4.ip_forward=1`

## 02 - Windows

### 2.1 - Netsh

`C:\> netsh interface portproxy add v4tov4 listenport=443 listenaddress=<redirector_IP> connectport=443 connectaddress=<C2_IP>`

`C:\> netsh advfirewall firewall add rule name="Relay Port <PORT>" dir=in action=allow protocol=tcp localport=443`

## References

- [Hardening For Your C&C](https://medium.com/void-security/the-red-fortress-hardening-for-your-c-c-9c06af8147bd)

- [Nginx for Red Teams](https://0xda.de/blog/2020/02/nginx-for-red-teams/)