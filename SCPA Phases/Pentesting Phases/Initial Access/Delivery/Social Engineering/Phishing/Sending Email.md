# Sending Email

## 01 - Manual

### 1.1.1 - Sendemail

#### 1.1.1.1 - Sending email via Linux CLI

- Syntax

```
$ sendemail -t <reciever_email_address> -f <sender_email_address> -s <smtp_relay_server_IP>:<PORT> -u "<Subject>" -a file.txt
If you are manually typing in a message:
  - First line must be received within 60 seconds.
  - End manual input with a CTRL-D on its own line.
If you are manually typing in a message:
  - First line must be received within 60 seconds.
  - End manual input with a CTRL-D on its own line.

A body paragraph that is written line by line
until you press CTRL-D to end the input
```

`$ swaks --to <reciever_email_address> --from <sender_email_address> --header "Subject: test" --body "<body_paragraph>" --server <mail_server>`

- Here's an example just to show you how it works

```
$ sendemail -t itdept@victim.com -f techsupport@bestcomputers.com -s 192.168.8.131 -u Important Upgrade Instructions -a /tmp/BestComputers-UpgradeInstructions.pdf
Reading message body from STDIN because the '-m' option was not used.
If you are manually typing in a message:
  - First line must be received within 60 seconds.
  - End manual input with a CTRL-D on its own line.

IT Dept,

We are sending this important file to all our customers. It contains very important instructions for upgrading and securing your software. Please read and let us know if you have any problems.

Sincerely,

$ swaks --to $(cat emails | tr '\n', ',' | less) --from test@website.com --header "Subject: test" --body "Please click the link <attacker_URL>" --server <mail_server>
```

## 02 - Metasploit

```
msf > use auxiliary/client/smtp/emailer

msf auxiliary(client/smtp/emailer) > options

Module options (auxiliary/client/smtp/emailer):

   Name         Current Setting                                           Required  Description
   ----         ---------------                                           --------  -----------
   DATE                                                                   no        Override the DATE: field with this value
   DOMAIN                                                                 no        SMTP Domain to EHLO to
   MAILFROM     random@example.com                                        yes       The FROM address of the e-mail
   PASSWORD                                                               no        SMTP Password for sending email
   RHOST        127.0.0.1                                                 yes       SMTP server address
   RHOSTS       127.0.0.1                                                 yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT        25                                                        yes       SMTP server port (TCP)
   USERNAME                                                               no        SMTP Username for sending email
   VERBOSE                                                                no        Display verbose information
   YAML_CONFIG  /usr/share/metasploit-framework/data/emailer_config.yaml  yes       Full path to YAML Configuration file

msf auxiliary(client/smtp/emailer) > set rhost <attacker.com>

msf auxiliary(client/smtp/emailer) > set rhosts <target.com>

msf auxiliary(client/smtp/emailer) > set mailfrom <sysadmin@target.com>

msf auxiliary(client/smtp/emailer) > set yaml_config <YAML_file>

msf auxiliary(client/smtp/emailer) > run -j
```

## 03 - Cobalt Strike

TODO: Demonstrate a spear phishing feature in cobalt strike

## References

- [Use an Office Macro to Download and Execute a Payload Red Team Tips](https://medium.com/@riffsandhacks/use-an-office-macro-to-download-and-execute-a-payload-red-team-tips-ddbc7cc1a99)