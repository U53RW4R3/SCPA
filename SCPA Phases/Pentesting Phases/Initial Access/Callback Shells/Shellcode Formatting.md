# Shellcode Formatting

## 01 - Scripts

`$ cat shellcode-formatter.py`

---

```python
#!/usr/bin/env python3  
import sys  
  
if len(sys.argv) < 2 or sys.argv[1] == "-h" or sys.argv[1] == "--help":  
    print("Usage: %s <FILE>" % sys.argv[0])  
    sys.exit()  
  
try:  
    shellcode = open(sys.argv[1], "rb").read()  
except:  
    print("File not Found: %s " % sys.argv[1])  
    sys.exit()  
  
print("Payload size: %d" % (len(shellcode)))  
print('{ 0x' + ', 0x'.join(hex(i)[2:] for i in shellcode) + ' };')
```

`$ cat shellcode-formatter.pl`

---

```perl
#!/usr/bin/env perl

if($#ARGV == -1) {
    print "Usage: $0 <FILE>\n";
    exit;
}

open(my $FILE, "<$ARGV[0]") || die("Cannot open file $ARGV[0]\n");
binmode($FILE);
$count = 0;
my $hexadecimal;

while(read $FILE, $data, 1) {
    $hexadecimal .= sprintf(" 0x%02x,", ord($data));
    $count++;
}
close($FILE);
print "Payload size: $count\n";
print chr(123);
print "$hexadecimal";
print chr(125) . chr(59);
```

`$ cat shellcode-formatter.go`

---

```go
package main

import (
    "bufio"
    "fmt"
    "os"
)

func main() {
    filename := os.Args[1]

    file, err := os.Open(filename)

    if err != nil {
    //  return nil, err
    }
    defer file.Close()

    stats, statsErr := file.Stat()
    if statsErr != nil {
    //  return nil, statsErr
    }

    var size int64 = stats.Size()
    bytes := make([]byte, size)

    bufr := bufio.NewReader(file)
    _, err = bufr.Read(bytes)

    fmt.Print("{ ")
    for i := 0; i < len(bytes); i++ {
        if i < len(bytes)-1 {
            fmt.Printf("0x%02x, ", bytes[i])
        } else {
            fmt.Printf("0x%02x };\n", bytes[i])
        }
    }
}

```

## 02 - Commands

### 2.1 - Bash

- Hexadecimal C array shellcode

`$ xxd -i shellcode.bin`

`$ hexdump -v -e '"\\\x" 1/1 "%02x"' shellcode.bin`

- One line of hex shellcode format

`$ xxd -p shellcode.bin | tr -d "\n"`

`$ hexdump -v -e '"\" 1/1 "%x"' shellcode.bin`

### 2.2 - Powershell

- **Read bytes from the shellcode using Powershell**

```powershell
PS C:\> $file = "shellcode.bin"

PS C:\> $bytes = [IO.File]::ReadAllBytes($file)
```

C language shellcode format

```
PS C:\> $shellcode_format = '\x' + (($bytes | ForEach-Object ToString x2) -join '\x')

PS C:\> "`nStandard shellcode format:`n`n" + $shellcode_format | Add-Content ($file + ".b64")`
```

C# shellcode format

```
PS C:\> $csharpformat = '0x' + (($bytes | ForEach-Object ToString x2 | ForEach-Object { $_ + ',' }) -join '0x')

PS C:\> $csharpformat = $csharpformat.SubString(0, $csharpformat.Length - 1)

PS C:\> "`nC# formatted shellcode:`n`n" + $csharpformat | Add-Content ($file + ".txt")

PS C:\> $cs_bytes = [System.Text.Encoding]::UTF8.GetBytes($csharpformat)

PS C:\> $cs_b64 = [Convert]::ToBase64($cs_bytes)

PS C:\> "`nBase64 Encoded C# shellcode:`n`n" + $cs_b64 | Add-Content ($file + ".b64")
```

F# shellcode format

```
PS C:\> $fsharpformat = '0x' + (($bytes | ForEach-Object ToString x2 | ForEach-Object { $_ + 'uy;' }) -join '0x')

PS C:\> $fsharpformat = $fsharpformat.SubString(0, $fsharpformat.Length - 1)

PS C:\> "`nF# formatted shellcode:`n`n" + $fsharpformat | Add-Content ($file + ".txt")
```

## References

- [Shellcode Formatter](https://www.redteam.cafe/red-team/shellcode-injection/shellcode-formatter)