# Add Firewall Rule

## 01 - Usage

### 1.1 - Command Prompt

`C:\> netsh advfirewall firewall add rule name="<rule_name>" dir=<in | out> action=<allow | block | bypass> protocol=<any | tcp | udp | icmpv4 | icmpv6> localport=<PORT>`

`C:\> netsh -r <IP> advfirewall`

### 1.2 - Powershell

`PS C:\> New-NetFirewallRule -DisplayName "<rule_name>" -Direction <Inbound | Outbound> -LocalPort <PORT> -Action <NotConfigured | Allow | Block> -Protocol <TCP | UDP | ICMPV4 | ICMPV6>`

## 02 - Example

### 2.1 - Block Outbound Packets

#### 2.1.1 - Command Prompt

- Limit certain UDP outbound packets for NETBIOS fingerprinting

`C:\> netsh advfirewall firewall add rule name="Load Balancer" protocol=udp dir=out localport=137 action=block`

- Limit certain UDP outbound packets for DNS lookup fingerprinting

`C:\> netsh advfirewall firewall add rule name="Endpoint Response Agent" protocol=udp dir=out localport=53 action=block`

#### 2.1.2 - Powershell

- Limit certain UDP outbound packets for NETBIOS fingerprinting

`PS C:\> New-NetFirewallRule -DisplayName "Load Balancer" -Direction Outbound -LocalPort 137 -Action Block -Protocol UDP`

- Limit certain UDP outbound packets for DNS lookup fingerprinting

`PS C:\> New-NetFirewallRule -DisplayName "Endpoint Response Agent" -Direction Outbound -LocalPort 53 -Action Block -Protocol UDP`

### 2.2 - Block Security Endpoints

TODO: Fill this information

#### 2.2.1 - Windows Defender

#### 2.2.2 - Advanced Threat Protection

#### 2.2.3 - Third Party

### 2.3 - Allow programs with incoming/outgoing connection

TODO: Provide examples such as in a restricted network by adding a firewall rule to establish a callback shell connection