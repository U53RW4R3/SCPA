# SSTIMap

## Setup

### Install Dependencies

- In Debian/Ubuntu based distros

```
$ sudo apt install python3-requests python3-urllib3 python3-mechanize python3-html5lib
```

### Install SSTIMap

```
$ sudo git clone https://github.com/vladko312/SSTImap /opt/exploitation/SSTImap && \
sudo ln -sf /opt/exploitation/SSTImap/sstimap.py /usr/local/bin/sstimap
```

## Help Menu

```
$ sstimap -h
usage: sstimap.py [-h] [-v] [--config CONFIG] [-u URL] [-i] [--load-urls LOAD_URLS] [--load-forms LOAD_FORMS] [-M MARKER] [-d DATA] [-H HEADER] [-C COOKIE] [-m METHOD] [-a USER_AGENT] [-A]
                  [--delay DELAY] [-p PROXY] [-V] [--log-response] [-c CRAWL_DEPTH] [-f] [--crawl-exclude CRAWL_EXCLUDE] [--crawl-domains CRAWL_DOMAINS] [--save-urls SAVE_URLS]
                  [--save-forms SAVE_FORMS] [-l LEVEL] [-L LEVEL CLEVEL] [-e ENGINE] [-r TECHNIQUE] [--blind-delay TIME_BASED_BLIND_DELAY] [-P] [-t] [-T TPL_CODE] [-x] [-X EVAL_CODE] [-s]
                  [-S OS_CMD] [-B PORT] [-R HOST PORT] [-F] [-U LOCAL REMOTE] [-D REMOTE LOCAL]

SSTImap is an automatic SSTI detection and exploitation tool with predetermined and interactive modes.

options:
  -h, --help            show this help message and exit
  -v, --version         show program's version number and exit
  --config CONFIG       Use custom config file or directory

target:
  At least one of these options has to be provided to define target(s)

  -u URL, --url URL     Target URL (e.g. 'https://example.com/?name=test')
  -i, --interactive     Run SSTImap in interactive mode
  --load-urls LOAD_URLS
                        File or directory to load URLs from
  --load-forms LOAD_FORMS
                        File or directory to load forms from

request:
  These options can specify how to connect to the target URL and add possible attack vectors

  -M MARKER, --marker MARKER
                        Use string as injection marker (default '*')
  -d DATA, --data DATA  POST data param to send (e.g. 'param=value') [Stackable]
  -H HEADER, --header HEADER
                        Header to send (e.g. 'Header: Value') [Stackable]
  -C COOKIE, --cookie COOKIE
                        Cookie to send (e.g. 'Field=Value') [Stackable]
  -m METHOD, --method METHOD
                        HTTP method to use (default 'GET')
  -a USER_AGENT, --user-agent USER_AGENT
                        User-Agent header value to use
  -A, --random-user-agent
                        Random User-Agent header value from a list of desktop browsers on every request
  --delay DELAY         Delay between requests (Default/0: no delay)
  -p PROXY, --proxy PROXY
                        Use a proxy to connect to the target URL
  -V, --verify-ssl      Verify SSL certificates (not verified by default)
  --log-response        Include HTTP responses into ~/.sstimap/sstimap.log

crawler:
  These options can specify how to detect URLs and forms on the target website.

  -c CRAWL_DEPTH, --crawl CRAWL_DEPTH
                        Depth to crawl (default/0: don't crawl)
  -f, --forms           Scan page(s) for forms
  --crawl-exclude CRAWL_EXCLUDE
                        Regex in URLs to not crawl
  --crawl-domains CRAWL_DOMAINS
                        Crawl other domains: Y(es) / S(ubdomains) / N(o). Default: S
  --save-urls SAVE_URLS
                        File or directory to save crawled URLs to
  --save-forms SAVE_FORMS
                        File or directory to save crawled forms to

detection:
  These options can be used to customize the detection phase.

  -l LEVEL, --level LEVEL
                        Level of escaping to perform (1-5, Default: 1)
  -L LEVEL CLEVEL, --force-level LEVEL CLEVEL
                        Force a LEVEL and CLEVEL to test
  -e ENGINE, --engine ENGINE
                        Check only this backend template engine
  -r TECHNIQUE, --technique TECHNIQUE
                        Techniques R(endered) T(ime-based blind). Default: RT
  --blind-delay TIME_BASED_BLIND_DELAY
                        Delay to detect time-based blind injection (Default: 4 seconds)
  -P, --legacy, --legacy-payloads
                        Include old payloads, that no longer work with newer versions of the engines

payload:
  These options can be used to get access to the template engine, filesystem or OS shell after an attack.

  -t, --tpl-shell       Prompt for an interactive shell on the template engine
  -T TPL_CODE, --tpl-code TPL_CODE
                        Inject code in the template engine
  -x, --eval-shell      Prompt for an interactive shell on the template engine base language
  -X EVAL_CODE, --eval-code EVAL_CODE
                        Evaluate code in the template engine base language
  -s, --os-shell        Prompt for an interactive operating system shell
  -S OS_CMD, --os-cmd OS_CMD
                        Execute an operating system command
  -B PORT, --bind-shell PORT
                        Spawn a system shell on a TCP PORT of the target and connect to it
  -R HOST PORT, --reverse-shell HOST PORT
                        Run a system shell and back-connect to local HOST PORT
  -F, --force-overwrite
                        Force file overwrite when uploading
  -U LOCAL REMOTE, --upload LOCAL REMOTE
                        Upload LOCAL to REMOTE files
  -D REMOTE LOCAL, --download REMOTE LOCAL
                        Download REMOTE to LOCAL files
```

## Usage

### Basic

`$ ./sstimap.py -u "<URL>"`

`$ ./sstimap.py --load-urls urls.txt`

`$ ./sstimap.py --load-forms urls.txt`

`$ ./sstimap.py -u "<URL>" -C "Cookie:<cookie_session_ID>"`

`$ ./sstimap.py -u "<URL>" -e <backend_template_engine>`

`$ ./sstimap.py -u "<URL>" -l <level_number>`

### Crawl

`$ ./sstimap.py -u "<URL>" -c <depth> -f`


## Techniques

`$ ./sstimap.py -u "<URL>"  -r <R | T>`

---
## References

- [SSTIMap](https://github.com/vladko312/SSTImap)