---
author(s):
  - Userware
tags:
  - post-exploitation
  - file-transfer-and-data-exfiltration
  - network-ports
  - ssh
  - linux
---
# Server

## 01 - Installation

```
$ sudo apt install openssh-server
```

## 02 - Hardening

### 2.1 - SCP

```
$ sudo mkdir -p /var/www/storage/

$ sudo useradd -s /bin/false -M aiden

$ passwd aiden

$ sudo chown aiden:aiden /var/www/storage/

$ sudo usermod -d /var/www/storage/ aiden
```

### 2.2 - SFTP

```
$ export username=<USERNAME>

sudo groupadd sftp

sudo mkdir -p /data/$username/uploads

sudo useradd -g sftp -s /bin/false -M $username

sudo passwd $username

sudo chown $user:sftp /data/$username/uploads

$ sudo chmod 755 /data/$username
```

```
$ cat /etc/ssh/sshd_config
..[omitted]..
# AllowGroups sftp

# Subsystem     sftp    /usr/libexec/openssh/sftp-server
Subsystem       sftp    internal-sftp

Match User <USERNAME>
	ForceCommand internal-sftp
	PasswordAuthentication yes
	# PubkeyAuthentication no
	ChrootDirectory /data/<USERNAME>
	AllowAgentForwarding no
	AllowTcpForwarding no
	X11Forwarding no
```

Restart SSH server.

```
$ sudo systemctl restart sshd
```

## 03 - Defense Evasion

### 3.1 - [[06 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x01 - Defense Evasion/03 - Process Manipulation/Linux/Manual/Living off the Land|Hidden Process]]

Spawn a hidden background process as a SSH daemon.

```
$ (exec -a '/usr/bin/sshd' <commands> &)
```