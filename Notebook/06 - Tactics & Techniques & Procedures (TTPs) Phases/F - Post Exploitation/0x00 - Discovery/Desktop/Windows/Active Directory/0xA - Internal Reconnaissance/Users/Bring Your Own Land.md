---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - active-directory
  - bring-your-own-land
  - windows
---
# Bring Your Own Land

TODO: Simplify the writeup from this [[06 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x00 - Discovery/Desktop/Windows/Host/0xA - Internal Reconnaissance/Users/Manual/Living off the Land]]

## 01 - Scripts

### 1.1 - Enumerate Current User

Query a specific user account.

```
PS C:\> Get-NetUser -UserName <username>
```

### 1.2 - Enumerate Usernames

#### 1.2.1 - PowerView

`adspath` which will print out the **GPP (Group Policy Object)** that uses the LDAP protocol. Especially the `description` object property that some sysadmins are intended to leave sensitive notes like passwords since they can't remember every credentials so they needed someone to store in case they forgot.

```
PS C:\> Get-NetUser | Select-Object -Property cn, description, objectsid, adspath
```

Find domain user's location in the current system.

```
PS C:\> Find-DomainUserLocation

PS C:\> Invoke-UserHunter
```

#### 1.3 - `Get-ObjectAcl`

Enumerate object permissions from the current username.

```
PS C:\> Get-ObjectAcl -Identify "<username>"
```

#### 1.4 - `Convert-SidToName`

Identify the current SID username(s).

```
PS C:\> Convert-SidToName "<SID>"

PS C:\> "<SID_1>","<SID_n>" | Convert-SidToName
```

### 1.3 - Enumerate Domain Groups

#### 1.3.1 - PowerView

Retrieve **group names**.

```
PS C:\> Get-NetLocalGroup [-ComputerName <IP>]
```

Retrieve information related to a specific **group name**.

```
PS C:\> Get-NetLocalGroupMember [-ComputerName <IP>] -Group <GroupName>
```

Displays list of all the groups in the domain controller.

```
PS C:\> Get-NetGroup
```

Enumerate groups in a active directory that is part of administrators.

```
PS C:\> Get-NetGroup -AdminCount
```

Enumerate a specific username in a active directory to display what privileges does the user have based of what member of.

```
PS C:\> Get-NetGroup -UserName <username>
```

Display the users that is part of the specific **group name**. In this example we want to find out which users have admin privileges.

```
PS C:\> Get-NetGroupMember -GroupName "Administators"

PS C:\> Get-NetGroupMember -GroupName "Domain Admins"

PS C:\> Get-NetGroupMember -GroupName "Enterprise Admins"

PS C:\> Get-NetGroup -GroupName *admin*
```

Find domain users location in the from different computers.

```
PS C:\> Find-DomainUserLocation -ComputerFile .\hostnames.txt -GroupName "Administrators"

PS C:\> Find-DomainUserLocation -ComputerFile .\hostnames.txt -GroupName "Domain Admins"

PS C:\> Find-DomainUserLocation -ComputerFile .\hostnames.txt -GroupName "Enterprise Admins"

PS C:\> Find-DomainUserLocation -ComputerFile .\hostnames.txt -GroupName "*admin*"
```

##### 2.3 - `Get-ObjectAcl`

List all of the SIDs from a current group name.

```
PS C:\> Get-ObjectAcl -Identify "<group_name>" | ? { $_.ActiveDirectoryRights -eq "GenericAll" } | Select-Object SecurityIdentifier,ActiveDirectoryRights
```

##### 2.4 - `Convert-SidToName`

Identify the current SID group(s).

```
PS C:\> Convert-SidToName "<SID>"

PS C:\> "<SID_1>","<SID_n>" | Convert-SidToName
```

### 04 - Logged On Users

```
PS C:\> Find-DomainUserLocation [-ComputerName <IP>] -UserName *
```

Identity which user accounts are active or suspiciously having high amount of logins that is humanly impossible that might be a honey pot.

```
PS C:\> Get-UserProperty -Properties logoncount
```

TODO: Re-arrange in the privilege escalation for **Impersonating Logged-on Users**

Retrieve active sessions of which users that is still interacting with the computer

```
PS C:\> Get-NetSession -ComputerName <IP>
```

### 05 - Account Lockouts and Password Policies

Look for potential user accounts that have bad amount of weak passwords for a chance to breach it successfully (requires to connect the dots and some critical thinking to do I think).

```
PS C:\> Get-NetUser | Select-Object samaccountname, badpwdcount
```

Check for accounts that hasn't been changed their passwords for how long to coordinate with the current organization's date depending on the Group Policy's for changing passwords of how frequently.

```
PS C:\> Get-UserProperty -Properties pwdlastset
```

## 02 - Binaries

### 2.1 - Enumerate Current User

#### 2.1.1 - [[Cable|Cable]]

```
C:\> .\Cable.exe user --user <username>
```

### 2.2 - Enumerate Usernames

#### 2.2.1 - [[03 - Offensive Infrastructure/E - Setup Machine/0x03 - Bring Your Own Land/Windows/Privilege Escalation/Active Directory/ADSearch|ADSearch]]

```
C:\> .\ADSearch.exe [-d <domain>.<tld>] [-u <username> -p <password> -h <computername>] -U
```

#### 2.2.2 - [[Cable|Cable]]

```
C:\> .\Cable.exe user --getgroups

C:\> .\Cable.exe ldap --users
```

### 2.3 - Enumerate Domain Groups

#### 2.3.1 - [[03 - Offensive Infrastructure/E - Setup Machine/0x03 - Bring Your Own Land/Windows/Privilege Escalation/Active Directory/ADSearch|ADSearch]]

```
C:\> .\ADSearch.exe [-d <domain>.<tld>] [-u <username> -p <password> -h <computername>] -G
```

Enumerate **domain admins**.

```
C:\> .\ADSearch.exe [-d <domain>.<tld>] [-u <username> -p <password> -h <computername>] --domain-admins
```

#### 2.3.2 - [[Cable|Cable]]

```
C:\> .\Cable.exe group --group "Domain Users"

C:\> .\Cable.exe group --getusers
```

### 2.3 - Enumerate Token Groups

#### 2.3.1 - [[03 - Offensive Infrastructure/E - Setup Machine/0x03 - Bring Your Own Land/Windows/Privilege Escalation/Seatbelt|Seatbelt]]

```
C:\> .\Seatbelt.exe TokenGroups
```