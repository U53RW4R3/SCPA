---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - active-directory
  - staying-off-the-land
  - networking
  - network-ports
  - smb
  - ldap
  - windows
---
# NetExec

## 01 - Enumerate User Accounts

### 1.1 - LDAP Port

```
$ netexec ldap <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --users
```

## 02 - Enumerate groups

### 2.1 - SMB Port

Retrieve **domain groups**.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --groups
```

Retrieve **domain administrators**.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --groups "Domain Admins"

$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --groups "Enterprise Admins"
```

## 03 - User enumeration via RID Cycling

> [!IMPORTANT] Condition
> `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa` registry path with a registry name `RestrictAnonymous` must be set with a value of `0x1`.

Bruteforce via RID Cycling.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --rid-brute [max_rid_value] --log rid-brute.txt

$ netexec smb <IP> -u "guest" -p "" [-d <domain> | --local-auth] --rid-brute [max_rid_value]
```

Filter the users from the log file.

```
$ grep User rid-brute.txt | grep <DOMAIN> | cut -d '\\' -f 2 | cut -d ' ' -f 1 | sort -uo user-DOMAIN.txt
```

---
## References

### SMB Port

- [[06 - Tactics & Techniques & Procedures (TTPs) Phases/A - Information Gathering/0x02 - Active Fingerprinting/Network Ports/Cross Platform/Remote Services/SMB|Manual: SMB Active Enumeration]]

- [Juggernaut-Sec: AD Recon â€“ MSRPC Over SMB (135/139/445)](https://juggernaut-sec.com/ad-recon-msrpc-over-smb/)

### LDAP Port

- [Hacktricks: Pentesting LDAP](https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-ldap.html)