---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - living-off-the-land
  - windows
---
# Living off the Land

## 01 - List Installed Software

### 1.1 - Command Prompt

DotNET MSBuild compilers

```
C:\> dir C:\Windows\Microsoft.NET\Framework64\ /ad

C:\> dir /b C:\Windows\Microsoft.NET\Framework64\v*
```

### 1.2 - PowerShell

```
PS C:\> Get-ChildItem -Recursive -Path C:\Windows\Microsoft.NET\Framework64\

PS C:\> Get-Item C:\Windows\Microsoft.NET\Framework64\v4.0.30319\clr.dll | Format-Table
```

### 1.3 - Sysinternals

#### 1.3.1 - Copy File from WebDAV

##### 1.3.1.1 - Command Prompt

```
C:\> net.exe use z: \\live.sysinternals.com\tools

copy z:\PsService64.exe .

net.exe use z: /delete
```

##### 1.3.1.2 - PowerShell

```
PS C:\> New-PSDrive -Name Z -PSProvider FileSystem -Root "\\live.sysinternals.com\tools"

PS C:\> Copy-Item z:\PsService64.exe .

PS C:\> Remove-PSDrive -Name Z
```

Using sysinternals toolkit to enumerate the path to look for possible misconfigured services. Automatically accept the EULA in order to use the binary.

```
C:\> .\PsService64.exe /accepteula
```

#### 1.3.2 - Enumerate Available Software

Enumerate the system.

```
C:\ .\PsInfo64.exe [\\<IP> -u <username> -p <password>] -s
```

## 02 - List directories including hidden files and folders

### 2.1 - Command Prompt

```
C:\> dir /a "C:\Program Files"

C:\> dir /a "C:\Program Files (x86)"
```

### 2.2 - PowerShell

```
PS C:\> Get-ChildItem 'C:\Program Files\','C:\Program Files (x86)\' | Format-Table Parent,Name,LastWriteTime

PS C:\> Get-ChildItem '\\<IP>\C$\Program Files\','\\<IP>\C$\Program Files (x86)\' | Format-Table Parent,Name,LastWriteTime
```

## 03 - Find a specific program

### 3.1 - Command Prompt

Syntax

```
C:\> where.exe <program.exe>

C:\> where.exe /r <C:\ | \\<IP>\C$> <program.exe>

C:\> where.exe /r <program.exe>

C:\> dir /s /b c:\ | findstr.exe "<program.exe>"
```

File Explorer

```
C:\> where.exe explorer.exe

C:\> where.exe /r C:\ explorer.exe

C:\> dir /s /b c:\ | findstr.exe "explorer.exe"
```

Internet Explorer

```
C:\> where.exe iexplore.exe

C:\> where.exe /r C:\ iexplore.exe

C:\> dir /s /b c:\ | findstr.exe "iexplore.exe"
```

Java Updater

```
C:\> where.exe jucheck.exe

C:\> where.exe /r <C:\ | \\<IP>\C$> jucheck.exe

C:\> dir /s /b c:\ | findstr.exe "jucheck.exe"
```

Find MSBuild C# compiler versions

```
C:\> where.exe /r <C:\ | \\<IP>\C$> MSBuild.exe

C:\> dir /s /b c:\ | findstr.exe "MSBuild.exe"
```

### 3.2 - PowerShell

Syntax

```
PS C:\> Get-Command <program.exe> | Format-Table CommandType, Name, Definition

PS C:\> (Get-Command <program.exe>).Definition

PS C:\> (Get-ChildItem -Recurse -Path <C:\ | \\<IP>\C$\> -Include "<program.exe>" -ErrorAction SilentlyContinue).FullName

PS C:\> Get-ChildItem -Recurse -Path <C:\ | \\<IP>\C$\> -Include "<program.exe>" -ErrorAction SilentlyContinue | ForEach-Object {$_.FullName}

PS C:\> Get-ChildItem -Recurse -Path <C:\ | \\<IP>\C$\> -ErrorAction SilentlyContinue | Where-Object {($_.Name -eq "<program.exe>")} | % {$_.FullName}
```

File Explorer

```
PS C:\> (Get-Command explorer.exe).Definition

PS C:\> (Get-ChildItem -Recurse -Path C:\ -Include "explorer.exe" -ErrorAction SilentlyContinue).FullName
```

Internet Explorer

```
PS C:\> (Get-Command iexplore.exe).Definition

PS C:\> (Get-ChildItem -Recurse -Path C:\ -Include "iexplore.exe" -ErrorAction SilentlyContinue).FullName
```

Java Updater

```
PS C:\> (Get-ChildItem -Recurse -Path C:\ -Include "jucheck.exe" -ErrorAction SilentlyContinue).FullName
```

Find MSBuild C# compiler versions

```
PS C:\> (Get-ChildItem -Recurse -Path C:\ -Include "MSBuild.exe" -ErrorAction SilentlyContinue).FullName

PS C:\> (Get-ChildItem -Recurse -Path \\<IP>\C$ -Include "MSBuild.exe" -ErrorAction SilentlyContinue).FullName
```

## 04 - Common Language Runtime

### 4.1 - Command Prompt

Enumerate available **Common Language Runtime (CLR)** versions.

```
C:\> dir %WINDIR%\Microsoft.Net\Framework\ /s /b | find.exe "System.dll"
```

### 4.2 - PowerShell

Enumerate available Common Language Runtime (CLR) versions.

```powershell
PS C:\> [AppDomain]::CurrentDomain.GetAssemblies() | Sort-Object -Property FullName | Format-Table FullName

PS C:\> [System.IO.File]::Exists("$Env:WINDIR\Microsoft.Net\Framework\v2.0.50727\System.dll")
```

## 05 - Device Drivers

### 5.1 - Command Prompt

```
C:\> driverquery.exe [/s <IP>] [/u [<DOMAIN>\]username>] [/p <password>] [/v] /fo list

C:\> driverquery.exe [/s <IP>] [/u [<DOMAIN>\]username>] [/p <password>] /fo table

C:\> driverquery.exe [/s <IP>] [/u [<DOMAIN>\]username>] [/p <password>] --no-msft
```

### 5.2 - PowerShell

Filtering the installed 3rd party drivers with WMI.

```powershell
PS C:\> driverquery.exe [/s <IP>] [/u [<DOMAIN>\]username>] [/p <password>] /v /fo csv | ConvertFrom-CSV | Select-Object 'Display Name', 'Start Mode', Path
```

## 06 - Windows Security

### 6.1 - Command Prompt

```
C:\> sc.exe [\\<IP>] query WinDefend
```

Check to confirm it scans for malware with [[Bad Bytes Sample|bad bytes sample]].

```
C:\> "C:\Program Files\Windows Defender\MpCmdRun.exe" -Scan -ScanType 3 -File .\bad_bytes.txt
```

### 6.2 - PowerShell

```
PS C:\> Get-MpComputerStatus

PS C:\> Get-WindowsFeature -Name Windows-Defender
```

Retrieve exclusions of Windows Security.

```
PS C:\> Get-MpPreference | Select-Object -Property ExclusionPath | Format-Table -AutoSize

PS C:\> $exclusions = Get-MpPreference
$exclusions.ExclusionPath
```

Check to confirm it scans for malware with [[Bad Bytes Sample|bad bytes sample]].

```
PS C:\> Start-MpScan -ScanType Custom -ScanPath .\bad_bytes.txt
```

## 07 - Antivirus and EDR

### 7.1 - PowerShell

Look for Kaspersky software.

```
PS C:\> Get-Service | Where-Object { $_.DisplayName -like "*Kaspersky*" }
```

---
## References

### LOFLCAB

- [LOFLCAB: Get-ChildItem](https://lofl-project.github.io/loflcab/Cmdlets/Get-ChildItem/)

- [LOFLCAB: driverquery](https://lofl-project.github.io/loflcab/Binaries/driverquery/)

### Config Server Firewall

- [Config Server Firewall: CMD Where Command | Find Files Using Command Prompt](https://www.configserverfirewall.com/windows-10/cmd-where-command/)