---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - metasploit-framework
  - windows
---
# Metasploit

## 01 - Installed Programs

### 1.1 - List Installed Software

```
meterpreter > wmi_query "SELECT Name, Version, Vendor FROM Win32_Product"

meterpreter > run post/windows/gather/wmic_command command="product get name,version,vendor"
```

### 1.2 - Find a specific program

Find MSBuild C# compiler versions

```
meterpreter > wmi_query "SELECT Description FROM Win32_Product"

meterpreter > run post/windows/gather/wmic_command command="product get description"

userware@hackware-os:~$ grep ".NET" /root/.msf4/loot/msf-loot-file.txt
```

## 02 - Device Drivers

## 2.1 - Meterpreter API

```
meterpreter > load extapi

meterpreter > wmi_query "SELECT DeviceName,DriverVersion,Manufacturer FROM Win32_PnPSignedDriver"
```

### 2.2 - PowerShell Extension

```
meterpreter > powershell_execute 'Get-CimInstance -ClassName Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object {$_.DeviceName -like "*VMWare*"}'
```

## 03 - Antivirus and EDR

```
meterpreter > wmi_query "SELECT DisplayName, ProductState, PathToSignedProductExe FROM AntivirusProduct" "root\securitycenter2"
```

---
## References

- [[04 - PowerShell|Metasploit: Powershell Meterpreter Extension]]

- [Rapid7: Metasploit Framework - Enumerate AV Gather Post Module](https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/windows/gather/enum_av.md)