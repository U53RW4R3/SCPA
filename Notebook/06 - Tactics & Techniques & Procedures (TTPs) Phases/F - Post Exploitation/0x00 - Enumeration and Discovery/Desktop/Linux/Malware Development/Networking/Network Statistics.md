# Network Statistics

## Bash

```bash
#!/bin/bash

# Function to convert hex IP address and port to human-readable format
function convert_address() {
    local hex_address_port=$1
    local hex_address=${hex_address_port%:*}
    local hex_portess=${hex_address_port##*:}

    local ip=""
    for i in {6..0..2}; do
        ip+=$((16#${hex_address:i:2})).
    done
    ip=${ip::-1} # Remove the trailing dot
    local port=$((16#${hex_port}))

    echo "${ip}:${port}"
}

function network_statistics() {
	local network="${1}"

	# Print the header
	printf "%-4s %-6s %-25s %-25s %-8s %-8s\n" "seq" "uid" "local" "remote" "timeout" "inode"

	while IFS= read -r line
    do
	    if [[ "${line}" =~ ^\ *sl ]]
        then
	        continue
	    fi
	
	    # Extract and parse fields
	    local seq=$(echo "${line}" | awk -F ":" '{print $1}')
	    local local_address=$(convert_address "$(echo "${line}" | awk '{print $2}')")
	    local remote_address=$(convert_address "$(echo "${line}" | awk '{print $3}')")
	    local uid=$(echo "$line" | awk '{print $8}')
	    local timeout=$(echo "$line" | awk '{print $9}')
	    local inode=$(echo "$line" | awk '{print $10}')

	    # Format and output the results
	    printf "%-4s %-6s %-25s %-25s %-8s %-8s\n" "${seq}" "${uid}" "${local_address}" "${remote_address}" "${timeout}" "${inode}"
	done < "${network}"
}

function main() {
	echo "[+] Reading TCP network statistics"
	network_statistics "/proc/net/tcp"

	echo -e "\n[+] Reading UDP network statistics"
	network_statistics "/proc/net/udp"
}
main "${@}"
```

## Python

```python
# -*- coding: utf-8 -*-
import re
import sys

def process_file(procnet):
    sockets = procnet.split('\n')[1:-1]
    return [line.strip() for line in sockets]

def split_every_n(data, n):
    return [data[i:i+n] for i in range(0, len(data), n)]

def convert_linux_netaddr(address):

    hex_address, hex_port = address.split(':')

    address_list = split_every_n(hex_address, 2)
    address_list.reverse()

    address = ".".join(map(lambda x: str(int(x, 16)), address_list))
    port = str(int(hex_port, 16))

    return "{}:{}".format(address, port)

def format_line(data):
    return (("%(seq)-4s %(uid)5s %(local)25s %(remote)25s %(timeout)8s %(inode)8s" % data) + "\n")

with open(sys.argv[1]) as f:
    sockets = process_file(f.read())

columns = ("seq", "uid", "inode", "local", "remote", "timeout")
title = dict()
for c in columns:
    title[c] = c

rv = []
for info in sockets:
    _ = re.split(r'\s+', info)

    _tmp = {
        'seq': _[0],
        'local': convert_linux_netaddress(_[1]),
        'remote': convert_linux_netaddress(_[2]),
        'uid': _[7],
        'timeout': _[8],
        'inode': _[9],
    }
    rv.append(_tmp)

if len(rv) > 0:
    sys.stderr.write(format_line(title))

    for _ in rv:
        sys.stdout.write(format_line(_))
```

---
## References

### Source Repositories

- [LFI-Enum](https://github.com/mthbernardes/LFI-Enum/blob/master/utils/linux_net_tcp.py)