# Windows

## 01 - Gathering Information

Enumerate available virtual machines.

```
C:\> "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" list vms
```

Get the guest machine's NIC IDs, MAC & network mode (NAT/Bridged Adapter etc.).

```
C:\> "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" showvminfo --details "<vm_name or ID>" | findstr.exe "MAC"
```

Get the guest machine's IP.

```
C:\> "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" guestproperty enumerate "<vm_name or ID>" | findstr.exe "IP"
```

## 02 - Modify VM's Network Modes

^f2d2f1

```
C:\> "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" VBoxManage modifyvm "<vm_name or ID>" --nic <NIC_ID> bridged
```

## 03 - Search VDI Files

```
C:\Users\%USERNAME%\VirtualBox VMs\
```

```
C:\> "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" showvminfo --details "<vm_name or ID>" | findstr.exe "Location:"
```

## 04 - Brute Force VM Login

Copy the `Strings64.exe` sysinternals tool from a WebDAV share.

```
C:\> net.exe use z: \\live.sysinternals.com\tools

C:\> copy z:\Strings64.exe .

C:\> net.exe use z: /delete
```

You can do this in PowerShell as well.

```
PS C:\> New-PSDrive -Name Z -PSProvider FileSystem -Root "\\live.sysinternals.com\tools"

PS C:\> Copy-Item z:\Strings64.exe .

PS C:\> Remove-PSDrive -Name Z
```

Accept the EULA.

```
C:\> .\Strings64.exe /accepteula
```

Enumerate the virtual machine's username.

```
C:\> .\Strings64.exe "C:\Users\%USERNAME%\VirtualBox VMs\<VM_name>\<VM_name>.vdi" | findstr.exe "USER_ID="
```

Start the virtual machine.

```
C:\> "C:\Program Files\Oracle\VirtualBox\VBoxHeadless.exe" -s "<vm_name or ID>"
```

Create a simple script to perform brute force attempts on the current virtual machine.

> [!WARNING] Security Events & Account Lockout
> The brute force attempts will generate security event 4625 and will result a lockout if the policy is configured. Usually in virtual machines it's meant to be disposable.

```
C:\> "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" guestcontrol "<vm_name or ID>" --username <username> --password <password> run --exe "[drive_letter:/]path/to/binary"
```

## 05 - Network Scanning VMs

After modifying the virtual machine's [[#^f2d2f1|network mode]]. Scan the target to look for vulnerabilities.

## 06 - Sensitive Data

Search for credentials stored in virtual machine.

```
C:\> .\Strings64.exe "C:\Users\%USERNAME%\VirtualBox VMs\<VM_name>\<VM_name>.vdi" | findstr.exe /i password > passwords.txt
```

Enumerate username inside the virtual machine.

```
C:\> .\Strings64.exe "C:\Users\%USERNAME%\VirtualBox VMs\<VM_name>\<VM_name>.vdi" | findstr.exe /i <username> > sensitive_data.txt
```

## 07 - Creating a VM for Evasion

TODO: Write one more about deploying a VM to evade security endpoints

---
## References

### Mrd0x

- [Mrd0x: Leveraging VirtualBox During Engagements](https://mrd0x.com/leveraging-virtualbox-during-pentest-engagements/)

### Hackmag

- [Hackmag: Spying penguin. Windows post-exploitation with a Linux-based VM](https://hackmag.com/security/windows-mitm)