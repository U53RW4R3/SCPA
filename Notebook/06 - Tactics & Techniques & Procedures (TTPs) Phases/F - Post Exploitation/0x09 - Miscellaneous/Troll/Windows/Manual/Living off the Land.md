# Living off the Land

## 01 - Locking a Computer

### 1.1 - Command Prompt

```
C:\> rundll32.exe user32.dll,LockWorkstation
```

## 02 - Wallpaper

### 2.1 - Command Prompt

```
C:\> reg.exe add "HKCU\Control Panel\Desktop" /v Wallpaper /t REG_SZ /d "C:\path\to\file.jpg" /f

C:\> reg.exe add "HKCU\Control Panel\Desktop" /v WallpaperStyle /t REG_SZ /d 2 /f

C:\> rundll32.exe user32.dll,UpdatePerUserSystemParameters
```

### 2.2 - PowerShell

```
PS C:\> Set-ItemProperty -Force -Path "HKCU:\Control Panel\Desktop\" -name Wallpaper -value "C:\path\to\file.png"

PS C:\> rundll32.exe user32.dll,UpdatePerUserSystemParameters
```

## 03 - Kick Out User Session

### 3.1 - Command Prompt

```
C:\> net.exe session \\<IP> /del /y

C:\> for /l %i in (1,0,2) do @net.exe session \\<IP> /del /y & ping.exe -n 127.0.0.1 >nul
```

## 04 - Power Management

### 4.1 - Restart Computer

#### 4.1.1 - Command Prompt

```
C:\> shutdown.exe [/m \\<IP>] /t 0 /r
```

#### 4.1.2 - PowerShell

```
PS C:\> Restart-Computer [-ComputerName <IP>] -Force
```

#### 4.1.3 - Sysinternals

##### 4.1.3.1 - Copy File from WebDAV

###### 4.1.3.1.1 - Command Prompt

```
C:\> net.exe use z: \\live.sysinternals.com\tools

copy z:\psshutdown64.exe .

net.exe use z: /delete
```

###### 4.1.3.1.2 - PowerShell

```
PS C:\> New-PSDrive -Name Z -PSProvider FileSystem -Root "\\live.sysinternals.com\tools"

PS C:\> Copy-Item z:\psshutdown64.exe .

PS C:\> Remove-PSDrive -Name Z
```

Accept EULA

```
C:\> .\psshutdown64.exe -accepteula
```

Restart computer.

```
C:\> .\psshutdown64.exe [\\<IP> -u <username> -p <password>] -f -r
```

Restart multiple computers.

```
C:\> .\psshutdown64.exe [@ips.txt -u <username> -p <password>] -f -r

C:\> .\psshutdown64.exe [\\*.<domain>.<tld> -u <username> -p <password>] -f -r
```

### 4.2 - Shutdown Computer

#### 4.2.1 - Command Prompt

Turn off the computer in an instant.

```
C:\> shutdown.exe [/m \\<IP>] /t 0 /s
```

#### 4.2.2 - PowerShell

```
PS C:\> Stop-Computer [-ComputerName <IP>] -Force
```

#### 4.2.3 - Sysinternals

Shutdown computer (optionally turn off the physical monitor if supported).

```
C:\> .\psshutdown64.exe [\\<IP> -u <username> -p <password>] -f -s [-x]
```

Shutdown multiple computers (optionally turn off the physical monitor if supported).

```
C:\> .\psshutdown64.exe [@ips.txt -u <username> -p <password>] -f -s [-x]

C:\> .\psshutdown64.exe [\\*.<domain>.<tld> -u <username> -p <password>] -f -s [-x]
```

---
## References

### LOLFCAB

- [LOFLCAB: reg](https://lofl-project.github.io/loflcab/Binaries/reg/)

### CYBER ARMS

- [CYBER ARMS: Bringing Metasploit Exploits to Life with Powershell](https://cyberarms.wordpress.com/2015/01/22/bringing-metasploit-exploits-to-life-with-powershell/)