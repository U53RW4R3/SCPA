# Change Wallpaper

## WinAPI

### Python

```python
import ctypes

user32 = ctypes.windll.user32
SystemParametersInfoA = user32.SystemParametersInfoA

def change_wallpaper(image_file):
	SystemParametersInfoA(20, 0, image_file, 0)	

if __name__ == '__main__':
	change_wallpaper(r'C:\path\to\image.jpg')
```

> [!INFO]
> Using `SystemParametersInfoW` windows function works only in 64-bit architecture.

```python
import ctypes

user32 = ctypes.windll.user32
SystemParametersInfoW = user32.SystemParametersInfoW

def change_wallpaper(image_file):
	SystemParametersInfoW(20, 0, image_file, 0)	

if __name__ == '__main__':
	change_wallpaper(r'C:\path\to\image.jpg')
```

### C\#

```cs
using System.Net;

namespace Wallpaper {
	public class Wallpaper {
		[DllImport("user32.dll", CharSet = CharSet.Auto)]
		private static extern int SystemParametersInfo(int uAction, int uParam, string lpvParam, int fuWinIni);

		public static async Task DownloadWallpaper(string wallpaperUrl, string wallpaperPath) {
			using (HttpClient client = new HttpClient()) {
				HttpResponseMessage response = await client.GetAsync(wallpaperUrl);
				response.EnsureSuccessStatusCode();

				using (Stream contentStream = await response.Content.ReadAsStreamAsync()) {
					using (FileStream fileStream = new FileStream(wallpaperPath, FileMode.Create)) {
						await contentStream.CopyToAsync(fileStream);
					}
				}
			}
		}

		public static void SetWallpaper(string wallpaperPath) {
			const int SPI_SETDESKWALLPAPER = 0x0014;
			const int SPIF_UPDATEINFILE = 0x01;
			const int SPIF_SENDCHANGE = 0x02;

			SystemParametersInfo(SPI_SETDESKWALLPAPER, 0, wallpaperPath, SPIF_UPDATEINFILE | SPIF_SENDCHANGE);
		}
	}
}
```

### VBA

```vb
Declare Function SystemParametersInfo Lib "user32" Alias "SystemParametersInfoA" (ByVal uAction As Long, ByVal uParam As Long, ByVal lpvParam As Any, ByVal fuWinIni As Long) As Long
Public Const SPI_SETDESKWALLPAPER = 20
Public Const SPIF_UPDATEINIFILE = &H1

' The final parameter "SPIF_UPDATEINIFILE" tells us to save the changes (so our new wallpaper is sill with us on restart).
' Setting this parameter to 0 will cause us not to update the registery and wont save the wallpaper.
Dim thePic As String
thePic = "C:\some_image.bmp"
Call SystemParametersInfo(SPI_SETDESKWALLPAPER, 0, thePic, SPIF_UPDATEINIFILE)
```

## .NET

### PowerShell

```powershell
$WinAPI = @"
using System.Runtime.InteropServices;

public class Wallpaper {
    public const int SetDesktopWallpaper = 20;
    public const int UpdateIniFile = 0x01;
    public const int SendWinIniChange = 0x02;
    [DllImport("user32.dll", SetLastError = true, CharSet = CharSet.Auto)]
    private static extern int SystemParametersInfo(int uAction, int uParam, string lpvParam, int fuWinIni);
    public static void SetWallpaper(string path) {
        SystemParametersInfo(SetDesktopWallpaper, 0, path, UpdateIniFile | SendWinIniChange);
    }
}
"@

Add-Type -TypeDefinition $WinAPI

[Wallpaper]::SetWallpaper("C:\path\to\image.jpg")
```

---
## References

### Microsoft

- [Microsoft: `SystemParameterInfoA`](https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-systemparametersinfoa)

- [Microsoft: `IDesktopWallpaper::SetWallpaper`](https://learn.microsoft.com/en-us/windows/win32/api/shobjidl_core/nf-shobjidl_core-idesktopwallpaper-setwallpaper)

### Source Repositories

- [Jakoby: Set-Wallpaper](https://github.com/I-Am-Jakoby/PowerShell-for-Hackers/blob/main/Functions/Set-WallPaper.md)

### patorjk

- [patorjk: Visual Basic 6.0 Code Bank - Set the Picture For You Windows Wall Paper](https://patorjk.com/programming/tutorials/vb6codebank.htm)