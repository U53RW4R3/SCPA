# Detect Virtual Machine

## Scripting

### PowerShell

```powershell
$VMwareDetected = $False
$VMDiskDrive = Get-WmiObject Win32_DiskDrive -Filter 'Model LIKE "%VMware%"'
$VMToolsRunning = Get-WmiObject Win32_Process -Filter 'Name="vmtoolsd.exe"'
$VMService = Get-WmiObject Win32_Service -Filter 'Name="%VMware%"'
if ($VMDiskDrive -or $VMToolsRunning -or $VMService) { $VMwareDetected = $True}
```

## .NET

### C\#

```cs
using System;

namespace SandboxDetection {
    internal class DetectSandbox {
        public static void detectVM() {
            var system_manufacturer = string.Empty;
            var system_model = string.Empty;
            var gpu_name = string.Empty;

            ManagementObjectSearcher searcher1 = new ManagementObjectSearcher("SELECT * FROM Win32_ComputerSystem");

            foreach (ManagementObject obj in searcher1.Get()) {
                system_manufacturer = obj["Manufacturer"].ToString();
                system_model = obj["Model"].ToString();
            }

            ManagementObjectSearcher searcher2 = new ManagementObjectSearcher("SELECT * FROM Win32_VideoController");

            foreach (ManagementObject obj in searcher2.Get()) {
                gpu_name = obj["Name"].ToString();
            }

            if (system_manufacturer.ToLower().Contains("vmware")
                || system_model.ToUpperInvariant().Contains("VIRTUAL")
                || gpu_name.ToLower().Contains("vmware")) {
                    Console.WriteLine("Virtual Environment Detected!");
                } else {
                    Console.WriteLine("No virtualization! Running malware...");
                }
        }
    }
}
```

## WinAPI

### Python

#### `pywin32`

```python
import wmi

def detect_virtual_machine():
    c = wmi.WMI()
    return False
```