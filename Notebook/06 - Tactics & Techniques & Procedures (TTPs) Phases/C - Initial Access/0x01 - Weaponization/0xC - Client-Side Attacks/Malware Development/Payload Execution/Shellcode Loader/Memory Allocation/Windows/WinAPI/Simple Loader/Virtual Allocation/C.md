# C

> [!TIP] Evade Static Analysis
> Insert a simple shellcode with a payload module for **[[06 - Tactics & Techniques & Procedures (TTPs) Phases/C - Initial Access/0x01 - Weaponization/0xC - Client-Side Attacks/Malware Development/Bypass Defenses/Anti-Sandbox/MessageBox/C|MessageBox]]** (`windows/x64/messagebox`) or command execution payload module to open a program such as, a calculator (`windows/x64/exec`).

## WinAPI

### VirtualAlloc

Reserves, commits, or changes the state of a region of memory within the virtual address space of the calling process.

```c
#include <windows.h>
#include <memoryapi.h>

#pragma comment(lib, "onecore.lib")
```

### VirtualFree

Releases, decommits, or releases and decommits a region of memory within the virtual address space of the calling process.

```c

```

### VirtualFreeEx

```c

```

### VirtualProtect

Changes the protection on a region of committed pages in the virtual address space of the calling process.

```
VirtualProtect(memory_execute, memory_allocation, PAGE_EXECUTE, &ignore);
```

### VirtualProtectEx

```
VirtualProtectEx
```

### Copy Memory

```
CopyMemory(&destMemAddr,&source, length);
```

### Move Memory

```c
RtlMoveMemory(&destMemAddr, &source, length);
MoveMemory(&destMemAddr, &source, length);
FillMemory(&destMemAddr, 1, ByteByteOfShellcode);
```

```
$ x86_64-w64-mingw32-gcc -l kernel32 -o payload.exe payload.c
```

## NTAPI

https://redops.at/en/blog/direct-syscalls-vs-indirect-syscalls

---
## References

### Github

- [DimopoulosEilas: SimpleShellcodeInjector](https://github.com/DimopoulosElias/SimpleShellcodeInjector)

### Microsoft Documentation

- [Microsoft Documentation: Reserving and Committing Memory](https://learn.microsoft.com/en-us/windows/win32/memory/reserving-and-committing-memory)

### MalAPI

- [MalAPI: `VirtualAlloc`](https://malapi.io/winapi/VirtualAlloc)

- [MalAPI: `VirtualAllocEx`](https://malapi.io/winapi/VirtualAllocEx)

- [MalAPI: `VirtualProtect`](https://malapi.io/winapi/VirtualProtect)

- [MalAPI: `VirtualProtectEx`](https://malapi.io/winapi/VirtualProtectEx)

- [MalAPI: `RtlCopyMemory`](https://malapi.io/winapi/RtlCopyMemory)

- [MalAPI: `RtlMoveMemory`](https://malapi.io/winapi/RtlMoveMemory)

### Tenouk

- [Tenouk: Windowsâ€™s Virtual Address Space](https://www.tenouk.com/WinVirtualAddressSpace.html)

### Mr. Rc

- [Mr. Rc: Exploring Virtual Memory and the Virtual Memory Management API.](https://de-engineer.github.io/Understanding-Virtual-Memory-Paging-and-other-memory-related-concepts/)

## RedOps

- [RedOps: Unleashing Assembly for Shellcode Execution](https://redops.at/en/blog/shell-we-assemble-unleashing-x86-inline-assembly-for-shellcode-execution)