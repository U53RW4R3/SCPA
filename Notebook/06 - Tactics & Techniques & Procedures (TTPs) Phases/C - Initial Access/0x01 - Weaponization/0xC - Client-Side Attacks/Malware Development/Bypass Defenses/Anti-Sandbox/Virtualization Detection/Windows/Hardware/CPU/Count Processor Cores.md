# Count Processor Cores

## Scripting

### Macros

```vb
Sub CPU()
	Dim Processors As String
	Processors = Environ("NUMBER_OF_PROCESSORS")

	If Processors >= 2 Then
		MsgBox "Executing payload!"
	Else
		MsgBox "Sandbox detected!"
	End If
End Sub
```

## WinAPI

### C

```c
#include <stdio.h>
#include <string.h>
#include <windows.h>

BOOL check_processor() {
    SYSTEM_INFO system_info;
    GetSystemInfo(&system_info);
    DWORD number_of_processors = system_info.dwNumberOfProcessors;
    if (number_of_processors < 2) {
        printf("Unusually low number of processors. Likely a VM\n");
        return FALSE;
    }
}

int main() {
    if (!check_processor()) {
        printf("Looks like we might be in a sandbox. Don't do anything suspicious\n");
        return 0;
    }

    printf("Looks safe! Continue with malicious stuff!\n");
}
```

---
## References

### Backlinks

- [[06 - Tactics & Techniques & Procedures (TTPs) Phases/C - Initial Access/0x01 - Weaponization/0xC - Client-Side Attacks/Malware Development/Bypass Defenses/Obfuscation/Obfuscation Techniques/String Manipulation/Windows/Batch]]

- [[06 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x00 - Enumeration and Discovery/Desktop/Windows/Malware Development/Hardware/CPU]]

### Jake Adelson

- [Jake Adelson: Malware Development for Dummies](https://defcontoronto.com/wp-content/uploads/2022/10/malware_development_for_dummies_Jake_Adelson.pdf)