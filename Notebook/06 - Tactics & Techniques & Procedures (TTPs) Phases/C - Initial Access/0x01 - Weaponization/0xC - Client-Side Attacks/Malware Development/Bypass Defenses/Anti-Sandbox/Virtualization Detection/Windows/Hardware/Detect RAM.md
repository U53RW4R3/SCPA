# Detect RAM

## WinAPI

### Python

#### `pywin32`

```python
import time
import wmi

computer = wmi.WMI()

os_info = computer.Win32_OperatingSystem()[0]

system_ram = float(os_info.TotalVisibleMemorySize) / 1048576

LockRAM = str(int(round(system_ram)))

if LockRAM < 4:
    time.sleep(999999)
```

### C

```c
#include <stdio.h>
#include <string.h>
#include <windows.h>

BOOL check_random_access_memory() {
    MEMORYSTATUSEX memory_status_ex;
    memory_status_ex.dwLength = sizeof(memory_status_ex);
    GlobalMemoryStatusEx(&memory_status_ex);
    DWORD ram_megabytes = memory_status_ex.ullTotalPhys / 1024 / 1024;
    if (ram_megabytes < 2048) {
        printf("Unusually low amount of RAM. Likely a VM\n");
        return FALSE;
    }

    return TRUE;
}

int main() {
    if (!check_random_access_memory()) {
        printf("Looks like we might be in a sandbox. Don't do anything suspicious\n");
        return 0;
    }

    printf("Looks safe! Continue with malicious stuff!\n");
}
```

### C++

```cpp
bool ram_check() {
	MEMORYSTATUSEX status;
	DWORD max = 4294496257; // 4GB
	status.dwLength = sizeof(status);
	GlobalMemoryStatusEx(&status);
	if ((DWORD)status.ullTotalPhys < max) {
		return true;
	}
	return false;
}

int main() {
	if (ram_check()) {
		return 0;
	}
}
```

---
## References

### TrustedSec

- [TrustedSec: Enumerating Anti-Sandboxing Techniques](https://trustedsec.com/blog/enumerating-anti-sandboxing-techniques)

### Jake Adelson

- [Jake Adelson: Malware Development for Dummies](https://defcontoronto.com/wp-content/uploads/2022/10/malware_development_for_dummies_Jake_Adelson.pdf)

### Tarik Saleh

- [Tarik Saleh: Dissecting Ransomware to Defeat Threat Actors](https://www.issa.org/wp-content/uploads/2020/02/ISSA-Webinar_Mar11_2020_compressed.pdf)