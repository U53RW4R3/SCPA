# Detect RAM

## WinAPI

### C

```c
#include <stdio.h>
#include <string.h>
#include <windows.h>

BOOL check_random_access_memory() {
    MEMORYSTATUSEX memory_status_ex;
    memory_status_ex.dwLength = sizeof(memory_status_ex);
    GlobalMemoryStatusEx(&memory_status_ex);
    DWORD ram_megabytes = memory_status_ex.ullTotalPhys / 1024 / 1024;
    if (ram_megabytes < 2048) {
        printf("Unusually low amount of RAM. Likely a VM\n");
        return FALSE;
    }

    return TRUE;
}

int main() {
    if (!check_random_access_memory()) {
        printf("Looks like we might be in a sandbox. Don't do anything suspicious\n");
        return 0;
    }

    printf("Looks safe! Continue with malicious stuff!\n");
}
```

### C++

```cpp
bool ram_check() {
	MEMORYSTATUSEX status;
	DWORD max = 4294496257; // 4GB
	status.dwLength = sizeof(status);
	GlobalMemoryStatusEx(&status);
	if ((DWORD)status.ullTotalPhys < max) {
		return true;
	}
	return false;
}

if (ram_check()) {
	return 0;
}
```

---
## References

### TrustedSec

- [TrustedSec: Enumerating Anti-Sandboxing Techniques](https://trustedsec.com/blog/enumerating-anti-sandboxing-techniques)

### Jake Adelson

- [Jake Adelson: Malware Development for Dummies](https://defcontoronto.com/wp-content/uploads/2022/10/malware_development_for_dummies_Jake_Adelson.pdf)