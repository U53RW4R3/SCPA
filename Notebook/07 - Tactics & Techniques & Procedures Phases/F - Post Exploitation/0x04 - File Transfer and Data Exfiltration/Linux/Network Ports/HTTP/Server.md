---
author(s):
  - Userware
tags:
  - post-exploitation
  - file-transfer-and-data-exfiltration
  - living-off-the-land
  - linux
---
# Server

## 01 - Python

> [!NOTE]
> By default it runs the service with port 8000 if it is not specified

```
$ sudo python2 -m SimpleHTTPServer 80

$ sudo python3 -m http.server 80
```

A python script to start a server with HTTP `PUT` method.

```python
import sys
import signal
from threading import Thread
from BaseHTTPServer import HTTPServer, BaseHTTPRequestHandler

class PUTHandler(BaseHTTPRequestHandler):
	def do_PUT(self):
		length = int(self.headers['Content-Length'])
		content = self.rfile.read(length)
		self.send_response(200)
		with open(self.path[1:], "w") as f:
			f.write(content)

def run_on(port):
	print("Starting a HTTP PUT Server on {0} port {1} (http://{0}:{1}) ...".format(sys.argv[0], port))
	server_address = (sys.argv[1], port)
	httpd = HTTPServer(server_address, PUTHandler)
	httpd.serve_forever()

if __name__ == "__main__":
	if len(sys.argv) < 3:
		print("Usage:\n\tpython {0}) <IP> <PORT>".format(sys.argv[0]))
		sys.exit(1)
	ports = [int(arg) for arg in sys.argv[2:]]
	try:
		for port_number in ports:
			server = Thread(target=run_on, args=[port_number])
			server.daemon = True
		server.start()
		signal.pause()
	except KeyboardInterrupt:
		print("\nPython HTTP PUT Server Stopped.")
		sys.exit(1)
```

## 02 - Ruby

> [!NOTE]
> You'll need to install `webrick`. By default it'll use port 8080 if port is not specified.

To install the ruby gem:

```
$ gem install webrick
```

To install in Debian/Ubuntu

```
$ sudo apt install ruby-webrick
```

Host a webserver via Ruby

```
# ruby -run -ehttpd . -p 80
```

You can do it interactively.

```
# irb
require 'webrick'; WEBrick::HTTPServer.new(:Port => 8888, :DocumentRoot => Dir.pwd).start;
```

## 03 - Perl

```
$ perl -MHTTP::Server::Brick -e '$s=HTTP::Server::Brick->new(port=><PORT>); $s->mount("/"=>{path=>"."}); $s->start'

$ perl -MIO::All -e 'io(":8080")->fork->accept->(sub { $_[0] < io(-x $1 +? "./$1 |"
```

## 04 - OpenSSL

Generate self-signed **certificate** (`.crt`) and **private key** (`.key`).

```
$ openssl req -x509 -nodes -days 365 -newkey rsa:4096 -keyout private.key -out certificate.crt
```

Start an encrypted web server. The default port is 4433.

```
$ openssl s_server -cert certificate.crt -accept <PORT> -WWW
```

## 05 - PHP

Create a server side PHP code snippet to upload files in `/var/www/html/upload.php`.

```php
<?php
$target_directory = "uploads/"
$target_file = $target_directory . basename($_FILES["fileToUpload"]["name"]);

echo "Source=" . $_FILES["fileToUpload"]["name"] . "<br/>";
echo "Target path=" . $target_directory . "<br/>";
echo "Size=" . $_FILES["fileToUpload"]["size"] . "<br/>";

if(move_uploaded_file($_FILES["fileToUpload"]["tmp_name"], $target_file)) {
    echo "The file " . basename($_FILES["fileToUpload"]["name"]) . " has been uploaded!\n";
} else {
    echo "There was an error uploading the file, please try again!\n";
}
?>


<!DOCTYPE html>
<html>
    <body>
        <form method="post" enctype="multipart/form-data">
            Select File to upload:
            <input type="file" name="fileToUpload" id="fileToUpload">
            <input type="submit" name="Upload">
        </form>
    </body>
</html>
```

^2d615d

Create a `uploads/` directory.

```
# mkdir -p /var/www/html/uploads/

# chown www-data:www-data /var/www/html/
```

To install in Debian/Ubuntu

```
$ sudo apt install apache2

$ sudo apt install nginx
```

Host a web server via PHP

```
$ sudo php -S 0.0.0.0:80 [-t /path/to/directory/]

$ sudo systemctl start apache2

$ sudo systemctl start nginx
```

## 06 - Busybox

```
$ busybox httpd -f -p <PORT> -h .
```

## 07 - Nginx

Create directory then modify the user and group for low privileges. Enter the nginx virtual host directory.

```
$ mkdir -p /var/www/upload/

$ chown www-data:www-data /var/www/upload/

$ cd /etc/nginx/sites-available/
```

Write a simple configuration file to accept `PUT` HTTP method. Call it `file_upload`.

```
server {
	listen <attacker_PORT> default_server;
	server_name <computer_name>;
		location / {
			root /var/www/upload;
			dav_methods PUT;
		}
}
```

Enable `file_upload` virtual host startup directory then start the web server.

```
$ cd /etc/nginx/sites-enable/

$ ln -s /etc/nginx/sites-available/file_upload file_upload

$ sudo systemctl start nginx
```

---
## References

### ExploitDB

- [ExploitDB: File Transfer Skills in the Red Team Post Penetration Test](https://www.exploit-db.com/docs/english/46515-file-transfer-skills-in-the-red-team-post-penetration-test.pdf)

### Hacking Articles

- [Hacking Articles: Data Exfiltration Using Linux Binaries](https://www.hackingarticles.in/data-exfiltration-using-linux-binaries/)