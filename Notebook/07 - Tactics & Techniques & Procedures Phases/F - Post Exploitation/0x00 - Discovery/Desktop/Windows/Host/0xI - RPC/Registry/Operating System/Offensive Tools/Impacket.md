# Impacket

## 01 - Kernel

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> query -keyName "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" -v ProductName

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> query -keyName "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" -v ProductName
```

## 02 - System

### 2.1 - Hostname

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> query -keyName "HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName"

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> query -keyName "HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName"

$ reg.py [<domain>/]<username>:"<password>"@<IP> query -keyName "HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" -v Hostname

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> query -keyName "HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" -v Hostname
```

### 2.2 - Date and Time

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> query -keyName "HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation"

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> query -keyName "HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation"
```

### 2.3 - Mounted Drives

Check if there are external USB drives history activity to the workstation. This will provide leverage to insert malware to spread the infection or possibly to exfiltrate data.

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> query -keyName "HKLM" -v some

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> query -keyName "HKLM" -v something
```

### 2.4 - CPU

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> query -keyName "HKLM\HARDWARE\DESCRIPTION\System\CentralProcessor" -v ProcessNameString

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> query -keyName "HKLM\HARDWARE\DESCRIPTION\System\CentralProcessor" -v ProcessNameString
```

### 2.5 - Security Restrictions

> [!INFO]
> If registry's value is set to `0x00`. Execute PsExec as `NT AUTHORITY\SYSTEM`.

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> query -keyName "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -v EnableLUA

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> query -keyName "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -v EnableLUA
```

Checking UAC prompt level.

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> query -keyName "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -v ConsentPromptBehaviorAdmin

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> query -keyName "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -v ConsentPromptBehaviorAdmin
```

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> query -keyName "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -v PromptOnSecureDesktop

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> query -keyName "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -v PromptOnSecureDesktop

https://web.archive.org/web/20240317074756/https://notes.offsec-journey.com/privilege-escalation/local-privilege-escalation
```