---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - networking
  - network-protocols
  - msrpc
  - rdp
  - icmp
  - arp
  - dns
  - metasploit-framework
  - windows
---
# Metasploit

## 01 - NETBIOS Discovery

Metasploit auxiliary module to enumerate NetBIOS.

![[07 - Tactics & Techniques & Procedures Phases/F - Post Exploitation/0x00 - Discovery/Desktop/Windows/Host/0xB - Networking/Scan Network/Live Host Identification/Network Ports/NetBIOS Enumeration/C2 Frameworks/Metasploit#^68ef3d]]

## 02 - Network Configuration

### 2.1 - IP Address

```
meterpreter > ifconfig

meterpreter > ipconfig
```

Using interactive ruby shell to enumerate IP address.

```
meterpreter > irb
>> init = client.net.config.interfaces
>> init.each { |x| puts x.pretty }
```

Enumerate route network.

```
meterpreter > route

IPv4 network routes
===================

    Subnet           Netmask          Gateway    Metric  Interface
    ------           -------          -------    ------  ---------
    0.0.0.0          0.0.0.0          10.0.2.1   25      12
    10.0.2.0         255.255.255.0    10.0.2.15  281     12
    10.0.2.15        255.255.255.255  10.0.2.15  281     12
    10.0.2.255       255.255.255.255  10.0.2.15  281     12
    127.0.0.0        255.0.0.0        127.0.0.1  331     1
    127.0.0.1        255.255.255.255  127.0.0.1  331     1
    127.255.255.255  255.255.255.255  127.0.0.1  331     1
    224.0.0.0        240.0.0.0        127.0.0.1  331     1
    224.0.0.0        240.0.0.0        10.0.2.15  281     12
    255.255.255.255  255.255.255.255  127.0.0.1  331     1
    255.255.255.255  255.255.255.255  10.0.2.15  281     12

No IPv6 routes were found.
```

### 2.2 - ARP Discovery

```
meterpreter > arp

ARP cache
=========

    IP address       MAC address        Interface
    ----------       -----------        ---------
    10.0.2.1         52:54:00:12:35:00  12
    10.0.2.3         08:00:27:32:5d:a1  12
    10.0.2.4         08:00:27:8f:39:74  12
    10.0.2.255       ff:ff:ff:ff:ff:ff  12
    224.0.0.22       00:00:00:00:00:00  1
    224.0.0.22       01:00:5e:00:00:16  12
    224.0.0.251      01:00:5e:00:00:fb  12
    224.0.0.252      01:00:5e:00:00:fc  12
    239.255.255.250  00:00:00:00:00:00  1
    239.255.255.250  01:00:5e:7f:ff:fa  12
    255.255.255.255  ff:ff:ff:ff:ff:ff  12
```

### 2.3 - Netstat

```
meterpreter > netstat

Connection list
===============

    Proto  Local address                    Remote address      State        User  Inode  PID/Program name
    -----  -------------                    --------------      -----        ----  -----  ----------------
    tcp    0.0.0.0:135                      0.0.0.0:*           LISTEN       0     0      924/svchost.exe
    tcp    0.0.0.0:445                      0.0.0.0:*           LISTEN       0     0      4/System
    tcp    0.0.0.0:5040                     0.0.0.0:*           LISTEN       0     0      5112/svchost.exe
    tcp    0.0.0.0:7680                     0.0.0.0:*           LISTEN       0     0      7780/svchost.exe
    tcp    0.0.0.0:49664                    0.0.0.0:*           LISTEN       0     0      696/lsass.exe
    tcp    0.0.0.0:49665                    0.0.0.0:*           LISTEN       0     0      544/wininit.exe
    tcp    0.0.0.0:49666                    0.0.0.0:*           LISTEN       0     0      632/svchost.exe
    tcp    0.0.0.0:49667                    0.0.0.0:*           LISTEN       0     0      1540/svchost.exe
    tcp    0.0.0.0:49668                    0.0.0.0:*           LISTEN       0     0      2120/spoolsv.exe
    tcp    0.0.0.0:49669                    0.0.0.0:*           LISTEN       0     0      672/services.exe
    tcp    10.0.2.15:139                    0.0.0.0:*           LISTEN       0     0      4/System
    tcp    10.0.2.15:49928                  20.198.162.78:443   ESTABLISHED  0     0      2548/svchost.exe
    tcp    10.0.2.15:49980                  10.0.2.4:445        ESTABLISHED  0     0      7268/powershell.exe
    tcp    10.0.2.15:49999                  52.179.216.235:443  TIME_WAIT    0     0      0/[System Process]
    tcp6   :::135                           :::*                LISTEN       0     0      924/svchost.exe
    tcp6   :::445                           :::*                LISTEN       0     0      4/System
    tcp6   :::7680                          :::*                LISTEN       0     0      7780/svchost.exe
    tcp6   :::49664                         :::*                LISTEN       0     0      696/lsass.exe
    tcp6   :::49665                         :::*                LISTEN       0     0      544/wininit.exe
    tcp6   :::49666                         :::*                LISTEN       0     0      632/svchost.exe
    tcp6   :::49667                         :::*                LISTEN       0     0      1540/svchost.exe
    tcp6   :::49668                         :::*                LISTEN       0     0      2120/spoolsv.exe
    tcp6   :::49669                         :::*                LISTEN       0     0      672/services.exe
    udp    0.0.0.0:123                      0.0.0.0:*                        0     0      7200/svchost.exe
    udp    0.0.0.0:5050                     0.0.0.0:*                        0     0      5112/svchost.exe
    udp    0.0.0.0:5353                     0.0.0.0:*                        0     0      1436/svchost.exe
    udp    0.0.0.0:5355                     0.0.0.0:*                        0     0      1436/svchost.exe
    udp    0.0.0.0:56498                    0.0.0.0:*                        0     0      1436/svchost.exe
    udp    0.0.0.0:58224                    0.0.0.0:*                        0     0      1436/svchost.exe
    udp    10.0.2.15:137                    0.0.0.0:*                        0     0      4/System
    udp    10.0.2.15:138                    0.0.0.0:*                        0     0      4/System
    udp    10.0.2.15:1900                   0.0.0.0:*                        0     0      7044/svchost.exe
    udp    10.0.2.15:63859                  0.0.0.0:*                        0     0      7044/svchost.exe
    udp    127.0.0.1:1900                   0.0.0.0:*                        0     0      7044/svchost.exe
    udp    127.0.0.1:59238                  0.0.0.0:*                        0     0      2428/svchost.exe
    udp    127.0.0.1:63860                  0.0.0.0:*                        0     0      7044/svchost.exe
    udp6   :::123                           :::*                             0     0      7200/svchost.exe
    udp6   :::5353                          :::*                             0     0      1436/svchost.exe
    udp6   :::5355                          :::*                             0     0      1436/svchost.exe
    udp6   :::56498                         :::*                             0     0      1436/svchost.exe
    udp6   :::58224                         :::*                             0     0      1436/svchost.exe
    udp6   ::1:1900                         :::*                             0     0      7044/svchost.exe
    udp6   ::1:63858                        :::*                             0     0      7044/svchost.exe
    udp6   fe80::60ca:62c2:b4fd:807a:1900   :::*                             0     0      7044/svchost.exe
    udp6   fe80::60ca:62c2:b4fd:807a:63857  :::*                             0     0      7044/svchost.exe

meterpreter > run post/windows/gather/tcpnetstat
```

### 2.4 - RDP

```
meterpreter > run post/windows/gather/enum_termserv
```

## 03 - Ping Sweep

```
meterpreter > run post/multi/gather/ping_sweep rhosts=<IP>/<CIDR>
```

## 04 - ARP Discovery

```
meterpreter > run arp_scanner
Meterpreter Script for performing an ARPS Scan Discovery.

OPTIONS:

    -h   Help menu.
    -i   Enumerate Local Interfaces
    -r   The target address range or CIDR identifier
    -s   Save found IP Addresses to logs.

meterpreter > run arp_scanner -i

meterpreter > run arp_scanner -r <IP>/<CIDR>

meterpreter > run arp_scanner -r 10.0.2.1-15 -s
[*] ARP Scanning 10.0.2.1-15
[*] IP: 10.0.2.2 MAC 52:54:00:12:35:00
[*] IP: 10.0.2.1 MAC 52:54:00:12:35:00
[*] IP: 10.0.2.3 MAC 08:00:27:a5:d7:df
[*] IP: 10.0.2.4 MAC 08:00:27:8f:39:74
[*] IP: 10.0.2.15 MAC 08:00:27:3c:90:25
[*] Saving found IP's to /root/.msf4/logs/scripts/arp_scanner/DEFALT_20220515.2800/DEFALT_20220515.2800.txt

meterpreter > run post/windows/gather/arp_scanner rhosts=<IP>/<CIDR> threads=8
```

## 05 - Reverse DNS Lookup

TODO: Fill in the information

```
meterpreter > run post/multi/recon/reverse_lookup address=<IPv4>
```

```
meterpreter > run post/multi/recon/reverse_lookup range=192.168.0.<start_IP>-<end_IP>

meterpreter > run post/multi/gather/dns_reverse_lookup rhosts=<IP>/<CIDR>
```

---
## References

### Rapid7

- [Rapid7: Metasploit Framework - Reverse Lookup Post Module](https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/multi/recon/reverse_lookup.md)