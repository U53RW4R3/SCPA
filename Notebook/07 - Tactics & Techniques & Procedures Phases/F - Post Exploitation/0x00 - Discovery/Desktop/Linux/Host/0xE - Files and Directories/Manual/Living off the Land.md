---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - living-off-the-land
  - linux
---
# Living off the Land

## 01 - Print Working Directory

```
$ pwd

$ dirs

$ realpath /proc/self/cwd

$ echo $PWD

$ echo ~+

$ echo $DIRSTACK
```

Print the previous old working directory.

```
$ echo $OLDPWD

$ echo ~-
```

## 02 - Files and Directories

### 2.1 - View Files

List all files.

```
$ printf "%s\n" *
```

View files but with specific extensions.

```
$ printf "%s\n" *.{txt, bak, bkp}
```

View only directories.

```
$ printf "%s\n" */
```

### 2.2 - View Hidden Files

Enumerate all files.

```
$ tree $HOME

$ find $HOME -print | sed -e 's;[^/]*/;|__;g;s;__|; |;g'
```

Enumerate only directories.

```
$ ls -R | grep ":$" | sed -e 's/:$//' -e 's/[^-][^\/]*\//--/g' -e 's/^/ /' -e 's/-/|/'
```

## 03 - File Permissions

### 3.1 - Enumerate Specific File

```
$ stat /path/to/file

$ stat --printf "File: %n\nUser: %U\nGroup: %G\nAccess rights: %A\n" /path/to/file

$ stat --printf "File: %n\nUser: %U\nGroup: %G\nAccess rights: %A\n" /path/to/directory/
```

### 3.2 - World-Writable Folders

```
$ find / -writable -type d 2>/dev/null

$ find / -perm -222 -type d 2>/dev/null

$ find / -perm -o+w -type d 2>/dev/null
```

### 3.3 - World-Executable Folders

```
$ find / -perm -o+x -type d 2>/dev/null
```

### 3.4 - World-Readable and Writeable Files

```
$ find / -perm -2 -type f 2>/dev/null
```

Retrieve files that have the following permissions (readable, writeable and executable by all users)

```
$ find / -type f -perm 0777 2>/dev/null
```

Find executable files.

```
$ find / -perm a=x
```

Display a list of files that belongs to a different user under `/home`.

```
$ find /home -user <username>
```

Search for files that were modified in the last 10 days

```
$ find / -mtime 10 2>/dev/null
```

### 3.5 - SetUID/SetGID

Find all SUID/SGID executable binaries.

```
$ find / -perm -g=s -o -perm -u=s -type f 2>/dev/null

$ find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2> /dev/null

$ find / -perm -04000 -type f -ls 2>/dev/null

$ find / -perm -6000 -type f -exec ls -la {} 2>/dev/null \;
```

Look for common places: `/bin`, `/sbin`, `/usr/bin`, `/usr/sbin`, `/usr/local/bin`, `/usr/local/sbin`.

```
$ for i in `locate -r "bin$"`; do find $i \( -perm -4000 -o -perm -2000 \) -type f 2>/dev/null; done

$ for i in $(locate -r "bin$"); do find $i \( -perm -4000 -o -perm -2000 \) -type f 2>/dev/null; done
```

### 3.6 - SetUID

Find SUID (user owned) executable binaries.

```
$ find / -perm -u=s -type f 2>/dev/null

$ find / -perm -4000 -type f -exec ls -la {} 2>/dev/null \;

$ find / -perm -u=s -type f -exec ls -la {} 2>/dev/null \;

$ find / -perm -u=s 2>/dev/null | xargs ls -la
```

### 3.7 - SetGID

Find SGID  (group owned) executable binaries.

```
$ find / -perm -g=s -type f 2>/dev/null

$ find / -perm -02000 -type f  -ls 2>/dev/null

$ find / -perm -2000 -type f -exec ls -la {} 2>/dev/null \;

$ find / -perm -g=s -type f -exec ls -la {} 2>/dev/null \;

$ find / -perm -g=s 2>/dev/null | xargs ls -la
```

## 04 - Configuration Files

Users that are able to alter configuration files in `/etc`.

> [!INFO]
> `2>/dev/null` ignores the error messages to make it easier search the results you're looking for.

World readable files.

```
$ find /etc/ -readable -type f 2>/dev/null

$ find /etc/ -readable -type f -maxdepth 1 2>/dev/null

$ ls -aRl /etc/ | awk '$1 ~ /^.*w.*/' 2>/dev/null
```

User owned files

```
$ ls -aRl /etc/ | awk '$1 ~ /^..w/' 2>/dev/null
```

Group owned files.

```
$ ls -aRl /etc/ | awk '$1 ~ /^.....w/' 2>/dev/null
```

## 05 - Timestamps

Search for files that were accessed in the last 10 days.

```
$ find / -atime 10 2>/dev/null
```

Display the files that were modified within the last hour (60 minutes).

```
$ find / -cmin -60
```

Display the files that were accessed within the last hour (60 minutes).

```
$ find / -amin -60
```

Search for files that have only 50 MB of size.

```
$ find / -size 50M
```

Search for files that are more than 50 MB of size.

```
$ find / -size +50M
```

Search for files that have only 50 MB of size

```
$ find / -size -50M
```

The previous commands from above will just show you where you can payload a malware when performing persistence, finding interesting files, or other kind of methods you're trying to achieve.

Looking for any file that is modifiable to anyone that can exploit the misconfigurations with root privileges. These methods are a quick way to search weak configurations and a few others.

```
$ find / -writable ! -user $(whoami) -type f ! -path "/proc/*" ! -path "/sys/*" -exec ls -al {} \; 2>/dev/null

$ find / ! -path "*/proc/*" -perm -2 -type f -print 2>/dev/null
```

## 06 - Calculate File Size

### 6.1 - Bytes

```
$ du -bs /path/to/file.txt

$ du -bs [--exclude=*.xml,*.conf] /path/to/directory/
```

### 6.2 - Kilobytes

```
$ du -bsk /path/to/file.txt

$ du -bsk [--exclude=*.xml,*.conf] /path/to/directory/
```

To display the size with the unit.

```
$ du -bs -BK /path/to/file.txt

$ du -bs -BK [--exclude=*.xml,*.conf] /path/to/directory/
```

### 6.3 - Megabytes

```
$ du -bsm /path/to/file.txt

$ du -bsm [--exclude=*.xml,*.conf] /path/to/directory/
```

To display the size with the unit.

```
$ du -bs -BM /path/to/file.txt

$ du -bs -BM [--exclude=*.xml,*.conf] /path/to/directory/
```

### 6.4 - Gigabytes

```
$ du -bs -BG /path/to/file.txt

$ du -bs -BG [--exclude=*.xml,*.conf] /path/to/directory/
```

---
## References

### Hacktricks

- [Hacktricks: Useful Linux Commands](https://book.hacktricks.wiki/en/linux-hardening/useful-linux-commands.html)