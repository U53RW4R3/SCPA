---
author(s):
  - Userware
tags:
  - post-exploitation
  - defense-evasion
  - anti-forensics
  - living-off-the-land
  - T1070-003
  - windows
---
# Living off the Land

## 01 - Registry Logs

### 1.1 - Windows Dialog Box

#### 1.1.1 - Command Prompt

Delete commands history that was executed from windows dialog box.

```
C:\> reg.exe query HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU

C:\> reg.exe delete HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU /va /reg:64 /f
```

#### 1.1.2 - PowerShell

TODO: Convert it to cmdlets

Delete commands history that was executed from windows dialog box.

```
PS C:\> HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU

PS C:\> HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU
```

### 1.2 - Windows Search

#### 1.2.1 - Command Prompt

```
C:\> reg.exe query "HKLM\SOFTWARE\Policies\Microsoft\Windows\Windows Search"

C:\> reg.exe delete "HKLM\SOFTWARE\Policies\Microsoft\Windows\Windows Search" /va /reg:64 /f
```

## 03 - Command Prompt History Commands

To clear command prompt history the shortcut keys are **ALT+F7** and check the if it's gone

```
C:\> doskey.exe /history
```

## 04 - PowerShell History Commands

### 4.1 - Command Prompt

```
C:\> del C:\Users\%USERNAME%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

C:\> del %USERPROFILE%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
```

### 4.2 - PowerShell

```powershell
PS C:\> Clear-Content C:\Users\$Env:USERNAME\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

PS C:\> Clear-Content $Env:USERPROFILE\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

PS C:\> Write-Output "null" > (Get-PSReadlineOption).HistorySavePath
```