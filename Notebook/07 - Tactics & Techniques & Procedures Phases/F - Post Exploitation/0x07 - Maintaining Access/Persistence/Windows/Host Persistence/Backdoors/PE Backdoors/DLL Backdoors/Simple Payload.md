# Simple Payload

## C

```c
#include <stdlib.h>
#include <windows.h>
#include <winbase.h>
#include <winuser.h>

#pragma comment(lib, "user32.lib")

DLLIMPORT void ExecutePayload() {
	// Add your own payload herer
	MessageBox(NULL, "Executing malware!", "DLL Payload", MB_ICONINFORMATION);
}

BOOL WINAPI DllMain(
    HINSTANCE hinstDLL,
    DWORD fdwReason,
    LPVOID lpReserved) {
    switch(fdwReason) { 
        case DLL_PROCESS_ATTACH:
	        MessageBox(NULL, "Attaching Process!", "DLL Payload", MB_ICONINFORMATION);
            break;
        case DLL_PROCESS_DETACH:
	        MessageBox(NULL, "Detaching Process!", "DLL Payload", MB_ICONINFORMATION);
            break;
        case DLL_THREAD_ATTACH:
	        MessageBox(NULL, "Attaching Thread!", "DLL Payload", MB_ICONINFORMATION);
	        break;
        case DLL_THREAD_DETACH:
	        MessageBox(NULL, "Detaching Thread!", "DLL Payload", MB_ICONINFORMATION);
            break;
    }

    return TRUE;  
}
```

Compile the payload.

```
$ x86_64-w64-mingw32-gcc -shared -l user32 -o payload.dll payload.c
```

To execute the payload.

```
C:\> rundll32.exe C:\path\to\payload.dll,ExecutePayload
```

---
## References

### TBHaxor

- [TBHaxor: Loading DLLs Using CPP in Windows](https://tbhaxor.com/loading-dlls-using-cpp-in-windows/)

### Cocomelonc

- [Cocomelonc: Malware Persistence Part 3](https://cocomelonc.github.io/tutorial/2022/05/02/malware-pers-3.html)

### Elliot on Security

- [Elliot on Security: Perfect DLL Hijacking](https://elliotonsecurity.com/perfect-dll-hijacking/)

### DMCXBlue

- [DMCXBlue: DLL Search Order Hijacking](https://dmcxblue.gitbook.io/red-team-notes-2-0/red-team-techniques/persistence/t1574-hijack-execution-flow/dll-search-order-hijacking)