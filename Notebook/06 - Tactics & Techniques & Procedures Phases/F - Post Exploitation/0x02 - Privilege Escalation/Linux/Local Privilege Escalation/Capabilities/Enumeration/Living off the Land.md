# Living off the Land

Capabilities main purpose is to resemble by managing privileges. In addition, in the kernel level it has split into different categories for probable privileged kernel calls up into groups that shares functionality. If the system administrator has carelessly or accidentally configured it poorly. An attacker will take an advantage by elevating it.

## 01 - Table Reference

| Capability Name        | Description                                                                                     |
| ---------------------- | ----------------------------------------------------------------------------------------------- |
| `CAP_AUDIT_CONTROL`    | Control kernel auditing, enabling or disabling it as needed.                                    |
| `CAP_AUDIT_WRITE`      | Write to the kernel's auditing log, recording system events.                                    |
| `CAP_BLOCK_SUSPEND`    | Prevent the system from suspending, ensuring continuous operation.                              |
| `CAP_CHOWN`            | Change file ownership, allowing arbitrary UID and GID modifications.                            |
| `CAP_DAC_OVERRIDE`     | Bypass file permission checks, granting unrestricted access to files and directories.           |
| `CAP_DAC_READ_SEARCH`  | Bypass read and execute permission checks for files and directories, but not write.             |
| `CAP_FOWNER`           | Override file permission checks, allowing operations that normally require matching UIDs.       |
| `CAP_KILL`             | Send signals to processes owned by other users, allowing for process management.                |
| `CAP_SETGID`           | Change the group ID (GID) of a process, allowing for group membership changes.                  |
| `CAP_SETUID`           | Change the user ID (UID) of a process, allowing for user impersonation or privilege escalation. |
| `CAP_SETPCAP`          | Modify the capabilities of other processes, allowing for fine-grained control.                  |
| `CAP_IPC_LOCK`         | Lock memory segments, preventing them from being swapped or modified.                           |
| `CAP_MAC_ADMIN`        | Configure Mandatory Access Control (MAC) settings, influencing system security policies.        |
| `CAP_NET_RAW`          | Create raw sockets, allowing for low-level network communication.                               |
| `CAP_NET_BIND_SERVICE` | Bind a socket to a privileged port, allowing for service access.                                |
| `CAP_SYS_CHROOT`       | Change the root directory of a process, isolating it from the rest of the system.               |

## 02 - Enumeration

Keep on a eye out on **`cap_setuid+ep`**.

```
$ getcap -r / 2>/dev/null
```

Check on [GTFOBins](https://gtfobins.github.io/) depending on what binary that has **capabilities** privileges that you're looking for to exploit the misconfigured kernel privileges. Here's an example of what the output may contain:

```
$ getcap -r / 2>/dev/null
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep
/usr/bin/traceroute6.iputils = cap_net_raw+ep
/usr/bin/mtr-packet = cap_net_raw+ep
/usr/bin/ping = cap_net_raw+ep
/home/karen/vim = cap_setuid+ep
/home/ubuntu/view = cap_setuid+ep
```

---
## References

### Hacktricks

- [Hacktricks: Privilege Escalation](https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html)

### Hacking Articles

- [Hacking Articles: Linux Privilege Escalation Using Capabilities](https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/)

### Juggernaut-Sec

- [Juggernaut-Sec: Capabilities - Linux Privilege Escalation](https://juggernaut-sec.com/capabilities/)