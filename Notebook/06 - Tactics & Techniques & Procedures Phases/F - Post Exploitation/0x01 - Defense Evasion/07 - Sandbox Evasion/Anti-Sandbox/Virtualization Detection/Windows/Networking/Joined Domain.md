# Joined Domain

## .NET

### PowerShell

https://github.com/KurtDeGreeff/PlayPowershell/blob/master/Join-Domain-dotNet.ps1

## WinAPI

### C++

```cpp
bool is_member_of_domain() {
	bool ret = false;
	DWORD dwLevel = 100;
	LPWKSTA_INFO_100 pBuf = NULL;
	NET_API_STATUS nStatus;
	LPWSTR pszServerName = L"localhost";
	nStatus = NetWkstaGetInfo(pszServerName, dwLevel, (LPBYTE *)&pBuf);
	if (nStatus == NERR_Success) {
		char response[500];
		wcstombs(response, pBuf->wki100_langroup, 500);

		char workgroup[] = "WORKGROUP";

		if (strcmp(response, workgroup)) { // returns 0 if identical
			ret = true;
		}
	}
	return ret;
}

if (!is_member_of_domain()) {
	return 0;
}
```

### Go

```go
func checkDomain() (bool, error) {
	var domain *uint16
	var status uint32
	err := syscall.NetGetJoinInformation(nil, &domain, &status)
	if err != nil {
		return false, err
	}
	syscall.NetApiBufferFree((*byte)(unsafe.Pointer(domain)))
	return status == syscall.NetSetupDomainName, nil
}
```

---
## References

### Microsoft

- [WinAPI Documentation: `NetWkstaGetInfo`](https://learn.microsoft.com/en-us/windows/win32/api/lmwksta/nf-lmwksta-netwkstagetinfo)

### TrustedSec

- [TrustedSec: Enumerating Anti-Sandboxing Techniques](https://trustedsec.com/blog/enumerating-anti-sandboxing-techniques)

### vaadata

- [vaadata: Antivirus and EDR Bypass Techniques](https://www.vaadata.com/blog/antivirus-and-edr-bypass-techniques/)