---
author(s):
  - Userware
tags:
  - post-exploitation
  - defense-evasion
  - hidden-artifacts
---
# ANSI Escape Sequences

## 01 - Obfuscate

Using raw escape codes or CRLF injection to hide the text.

```
#!/bin/sh echo "MALWARE" \033[Aecho "innocent"

#!/bin/sh\necho "MALWARE"\nexit\n\033[A\033[Aecho "innocent"

$ echo -e #!/bin/sh\necho "MALWARE"\nexit\n\033[A\033[Aecho "innocent"' > malware.sh
```

Another variant.

```
$ echo -e '#!/bin/sh\necho "...doing something bad here..."\nexit\n\033[A\033[Aecho "Hello dear reader, I am just a harmless script, safe to run me!"' > demo.sh

$ cat demo.sh
#!/bin/sh
echo "Hello dear reader, I am just a harmless script, safe to run me!"

$ chmod +x demo.sh

$ ./demo.sh
...doing something bad here...
```

## 02 - Detect

To detect the malicious strings.

```
$ file demo.sh 
demo.sh: POSIX shell script, ASCII text executable, with escape sequences

$ strings demo.sh
#!/bin/sh
echo "...doing something bad here..."
exit
[Aecho "Hello dear reader, I am just a harmless script, safe to run me!"

$ cat -v demo.sh
#!/bin/sh
echo "...doing something bad here..."
exit
^[[A^[[Aecho "Hello dear reader, I am just a harmless script, safe to run me!"
```

---
## References

### Source Repositories

- [mgeeky: ANSI Escape Sequences](https://gist.github.com/mgeeky/6efe08300a6034a213071b8c24911ebb)

### InternalAllTheThings

- [Internal All The Things: Linux - Evasion](https://swisskyrepo.github.io/InternalAllTheThings/redteam/evasion/linux-evasion/)

### Stok

- [Stok: Weaponizing Plain Text - ANSI Escape Sequences as a Forensic Nightmare](https://i.blackhat.com/BH-US-23/Presentations/US-23-stok-weponizing-plain-text-ansi-escape-sequences-as-a-forensic-nightmare-appendix.pdf)