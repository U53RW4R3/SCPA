# Living off the Land

## 01 - Locking a Computer

### 1.1 - Command Prompt

```
C:\> rundll32.exe user32.dll,LockWorkstation
```

## 02 - Wallpaper

### 2.1 - Command Prompt

```
C:\> reg.exe add "HKCU\Control Panel\Desktop" /v Wallpaper /t REG_SZ /d "C:\path\to\file.jpg" /f

C:\> reg.exe add "HKCU\Control Panel\Desktop" /v WallpaperStyle /t REG_SZ /d 2 /f

C:\> rundll32.exe user32.dll,UpdatePerUserSystemParameters
```

### 2.2 - PowerShell

```
PS C:\> Set-ItemProperty -Force -Path "HKCU:\Control Panel\Desktop\" -name Wallpaper -value "C:\path\to\file.png"

PS C:\> rundll32.exe user32.dll,UpdatePerUserSystemParameters
```

## 03 - Kick Out User Session

### 3.1 - Command Prompt

```
C:\> net.exe session \\<IP> /del /y

C:\> for /l %i in (1,0,2) do @net.exe session \\<IP> /del /y & ping.exe -n 127.0.0.1 >nul
```

## 04 - Disable Peripherals

### 4.1 - Mouse

```
C:\> rundll32.exe mouse,disable
```

### 4.2 - Keyboard

```
C:\> rundll32.exe keyboard,disable
```

## 05 - Power Management

### 5.1 - Restart Computer

#### 5.1.1 - Command Prompt

```
C:\> shutdown.exe [/m \\<IP>] /t 0 /r
```

#### 5.1.2 - PowerShell

```
PS C:\> Restart-Computer [-ComputerName <IP>] -Force
```

#### 5.1.3 - Sysinternals

> [!IMPORTANT] Conditions
> To execute sysinternal tool. EULA must be accepted (`-accepteula`). Otherwise this can be done in registry hive.
> ```
> C:\> reg.exe add [\\<IP>\]HKCU\Software\Sysinternals /t REG_DWORD /v 'EulaAccepted' /d 0x00000001
> 
> PS C:\> Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Sysinternals' -Type DWord -Name 'EulaAccepted' -Value 0x00000001
> ```

##### 5.1.3.1 - Copy File from WebDAV

###### 5.1.3.1.1 - Command Prompt

```
C:\> net.exe use z: \\live.sysinternals.com\tools

copy z:\psshutdown64.exe .

net.exe use z: /delete
```

###### 5.1.3.1.2 - PowerShell

```
PS C:\> New-PSDrive -Name Z -PSProvider FileSystem -Root "\\live.sysinternals.com\tools"

PS C:\> Copy-Item z:\psshutdown64.exe .

PS C:\> Remove-PSDrive -Name Z
```

Accept EULA

```
C:\> .\psshutdown64.exe -accepteula
```

Restart computer.

```
C:\> .\psshutdown64.exe [\\<IP> -u <username> -p <password>] -f -r
```

Restart multiple computers.

```
C:\> .\psshutdown64.exe [@ips.txt -u <username> -p <password>] -f -r

C:\> .\psshutdown64.exe [\\*.<domain>.<tld> -u <username> -p <password>] -f -r
```

### 5.2 - Shutdown Computer

#### 5.2.1 - Command Prompt

Turn off the computer in an instant.

```
C:\> shutdown.exe [/m \\<IP>] /t 0 /s
```

#### 5.2.2 - PowerShell

```
PS C:\> Stop-Computer [-ComputerName <IP>] -Force
```

#### 5.2.3 - Sysinternals

Shutdown computer (optionally turn off the physical monitor if supported).

```
C:\> .\psshutdown64.exe [\\<IP> -u <username> -p <password>] -f -s [-x]
```

Shutdown multiple computers (optionally turn off the physical monitor if supported).

```
C:\> .\psshutdown64.exe [@ips.txt -u <username> -p <password>] -f -s [-x]

C:\> .\psshutdown64.exe [\\*.<domain>.<tld> -u <username> -p <password>] -f -s [-x]
```

### 5.3 - Cancel Shutdown

#### 5.3.1 - Command Prompt

Turn off the computer in an instant.

```
C:\> shutdown.exe [/m \\<IP>] /a
```

#### 5.3.2 - PowerShell

```
PS C:\> Stop-Computer [-ComputerName <IP>] -Cancel
```

## 06 - Blue Screen Of Death

> [!IMPORTANT] Elevated Privileges is required
> The current user must executed as an `Administrator`.

### 6.1 - Command Prompt

```
C:\> echo testing > C:\Windows\System32\config\OSDATA
```

### 6.2 - PowerShell

```
PS C:\> Write-Output testing | Out-File -FilePath "C:\Windows\System32\config\OSDATA"
```

---
## References

### LOLFCAB

- [LOFLCAB: reg](https://lofl-project.github.io/loflcab/Binaries/reg/)

### Hacking Articles

- [Hacking Articles: Remote Windows PC Enumeration using PSTools](https://www.hackingarticles.in/remote-windows-pc-enumeration-using-pstools/)

### CYBER ARMS

- [CYBER ARMS: Bringing Metasploit Exploits to Life with Powershell](https://cyberarms.wordpress.com/2015/01/22/bringing-metasploit-exploits-to-life-with-powershell/)