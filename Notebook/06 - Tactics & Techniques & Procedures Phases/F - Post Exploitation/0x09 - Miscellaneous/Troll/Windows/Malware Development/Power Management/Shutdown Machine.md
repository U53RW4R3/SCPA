# Shutdown Machine

## WinAPI

### C

```c
#include <windows.h>

static BOOL EnableShutdownPrivilege(void) {
    HANDLE tok;
    TOKEN_PRIVILEGES tp = {1};

    if (!OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES|TOKEN_QUERY, &tok)) return FALSE;

    LookupPrivilegeValue(NULL, SE_SHUTDOWN_NAME, &tp.Privileges[0].Luid);
    tp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;
    AdjustTokenPrivileges(tok, FALSE, &tp, 0, NULL, NULL);
    CloseHandle(tok);

    return GetLastError() == ERROR_SUCCESS;
}

int main(void) {
    if (!EnableShutdownPrivilege()) return 1;
    ExitWindowsEx(EWX_POWEROFF, 0);

    return 0;
}
```