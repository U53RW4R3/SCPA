# Ping Sweep

## Scripting

### Bash

```bash
#!/usr/bin/env bash

set -euo pipefail

function usage() {
    >&2 echo "Usage: $(basename ${0}) <IP range>"
    >&2 echo "Example: 192.168.1.0-127"
    exit 1
}

function scan_host() {
    local ip="${1}"

    ping -c 1 -W 1 -n "${ip}" > /dev/null 2>&1
    return "${?}"
}

function main() {
    local ip_range_input="${1:-}" # Use :- for robustness with set -u
    local pattern='^([0-9]{1,3}\.){3}([0-9]{1,3})-([0-9]{1,3})$'

    if ((${#} == 0))
    then
        usage
    fi

    # Input Validation
    if [[ ! "${ip_range_input}" =~ ${pattern} ]]
    then
        >&2 echo "Wrong argument format: ${ip_range_input}"
        usage
    fi

    # Extract components using BASH_REMATCH from the regex
    local ip_base_prefix="${BASH_REMATCH[1]}" # e.g., 192.168.1.
    local ip_start_octet="${BASH_REMATCH[2]}" # e.g., 0
    local ip_end_octet="${BASH_REMATCH[3]}" # e.g., 127

    # Re-extract the base IP (first three octets) cleanly for the message
    local ip_base="${ip_base_prefix%?}" # Remove the trailing dot

    echo "Pinging IP range ${ip_base}.${ip_start_octet}-${ip_end_octet}..."
    echo "---"

    # Scan network by looping through the last octet range
    for ((current_octet = ip_start_octet; current_octet <= ip_end_octet; current_octet++))
    do
        local ip_address="${ip_base}.${current_octet}"

        scan_host "${ip_address}"
        if (("${?}" == 0))
        then
            echo "${ip_address}"
        fi

    done
    echo "---"
    echo "Ping sweep complete."
}

main "${@}"
```

Scan the network with a single port.

```
$ chmod +x icmpscan.sh

$ ./icmpscan.sh 192.168.1.1-254
```

---
## References

### Debugging Everything

- [Debugging Everything: Ping in Network Discovery](https://ladydebug.com/blog/2020/03/10/ping-in-network-discovery/)