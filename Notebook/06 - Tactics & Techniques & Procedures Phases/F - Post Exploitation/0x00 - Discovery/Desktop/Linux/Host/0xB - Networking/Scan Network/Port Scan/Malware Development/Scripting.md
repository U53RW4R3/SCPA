# Scripting

## Bash

```bash
#!/usr/bin/env bash

set -euo pipefail

function usage() {
    >&2 echo "Usage: $(basename ${0}) <IP range and port>"
    >&2 echo "Example: 192.168.1.0-127:1234"
    exit 1
}

function scan_port() {
    local ip="${1}"
    local port="${2}"

    # Use curl to check the service. Exit status 0 means success (connection established/data received).
    curl --silent --head --connect-timeout 5 --max-time 5 "http://${ip}:${port}" > /dev/null 2>&1
    return "${?}"
}

function main() {
    local ip="${1}"
    local pattern='^([0-9]{1,3}\.){3}([0-9]{1,3})-([0-9]{1,3}):([0-9]{1,5})$'

    if ((${#} == 0))
    then
        usage
    fi

    # Input Validation
    if [[ ! "${ip}" =~ ${IP_PATTERN} ]]
    then
        >&2 echo "Wrong argument format: ${ip}"
        usage
    fi

    local ip_start_octet="${BASH_REMATCH[2]}" # start IP octet
    local ip_end_octet="${BASH_REMATCH[3]}" # end IP octet
    local port="${BASH_REMATCH[4]}" # port

    # Extract the base IP (first three octets)
    local ip_base_octets
    ip_base_octets=$(grep -oE '^([0-9]{1,3}\.){3}' <<< "${ip}")
    local ip_base="${ip_base_octets%?}" # Remove the trailing dot

    echo "Connecting to IP range ${ip_base}.${ip_start_octet}-${ip_end_octet} on port ${port}..."

    # Scan network
    for ((current_octet = ip_start_octet; current_octet <= ip_end_octet; current_octet++))
    do
        local ip_address="${ip_base}.${current_octet}"

        scan_port "${ip_address}" "${port}"

        if (("${?}" == 0))
        then
            echo "${ip_address}"
        fi

    done
}

main "${@}"
```

Scan the network with a single port.

```
$ chmod +x curlscan.sh

$ ./curlscan.sh 192.168.1.1-254:445
```

---
## References

### Debugging Everything

- [Debugging Everything: cURL for port scanning](https://ladydebug.com/blog/2020/03/12/curl-for-port-scanning/)