# Enumerate Shares

## C

```c
#include <windows.h>
#include <winnetwk.h>
#include <wchar.h>
#include <stdio.h>

#pragma comment(lib, "mpr.lib")

void ListNetworkShares() {
    DWORD drives = GetLogicalDrives();

    for (wchar_t letter = L'A'; letter <= L'Z'; letter++) {
        if (drives & (1 << (letter - L'A'))) {

            wchar_t root[4] = { letter, L':', L'\0', L'\0' };
            wchar_t path[260];
            DWORD size = 260;

            if (WNetGetConnectionW(root, path, &size) == NO_ERROR) {
                wprintf(L"%c: -> %s\n", letter, path);
            }
        }
    }
}

int wmain() {
    ListNetworkShares();

    return 0;
}

```

## CPP

```cpp
std::vector<std::string> get_network_shares() {
    std::vector<std::string> shares;
    PSHARE_INFO_1 pShareInfo = nullptr;
    DWORD entriesRead = 0;
    DWORD totalEntries = 0;
    DWORD resumeHandle = 0;
    NET_API_STATUS status;

    do {
        status = NetShareEnum(
            NULL,
            1,
            (LPBYTE*)&pShareInfo,
            MAX_PREFERRED_LENGTH,
            &entriesRead,
            &totalEntries,
            &resumeHandle
        );

        if (status == NERR_Success || status == ERROR_MORE_DATA) {
            for (DWORD i = 0; i < entriesRead; i++) {
                shares.push_back(pShareInfo[i].shi1_netname);
            }
        }

        if (pShareInfo) {
            NetApiBufferFree(pShareInfo);
            pShareInfo = nullptr;
        }

    } while (status == ERROR_MORE_DATA);

    return shares;
}
```

---
## References

### Tenouk

- [Tenouk: Share - Part 1](https://www.tenouk.com/ModuleQ.html)

- [Tenouk: Share - Part 2](https://www.tenouk.com/ModuleQ1.html)

- [Tenouk: Windows Share - Struct and Functions](https://www.tenouk.com/cqsharesupp.html)

- [Tenouk: Windows OS Security - Access Control Story - Part 8](https://www.tenouk.com/ModuleI3.html)

### InstallSetupConfig

- [InstallSetupConfig: Win32 Windows Volume Program and Code Example 5](https://www.installsetupconfig.com/win32programming/windowsvolumeapis1_4.html)

- [InstallSetupConfig:  Win32 Windows Volume Program and Code Example 10](https://www.installsetupconfig.com/win32programming/windowsvolumeapis1_9.html)

- [InstallSetupConfig: Win32 Windows Volume Program and Code Example 27](https://www.installsetupconfig.com/win32programming/windowsvolumeapis1_26.html)

### TrustedSec

- [TrustedSec: Execution Guardrails - No One Likes Unintentional Exposure](https://trustedsec.com/blog/execution-guardrails-no-one-likes-unintentional-exposure)