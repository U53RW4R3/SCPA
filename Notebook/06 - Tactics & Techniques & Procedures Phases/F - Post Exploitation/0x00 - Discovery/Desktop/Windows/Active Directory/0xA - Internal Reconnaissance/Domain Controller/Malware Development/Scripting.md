# Scripting

## Batch

```batch
@echo off

:check_admin
echo Administrative permissions required. Detecting permissions...
net.exe session >nul 2>&1
if %ERRORLEVEL%==0 (
    echo Success: Administrative permissions confirmed.
    exit /b 0
) else (
    echo Error: Current permissions inadequate.
    exit /b 1
)

:get_domain
for /f "usebackq tokens=*" %%a in (`wmic.exe computersystem get domain /value`) do (
    echo %%a | findstr.exe /i /c:"Domain=" >nul && set "_str=%%a"
)

rem Extract the domain value
for /f "tokens=2 delims==" %%a in ("%_str%") do set "_computerDomain=%%a"

rem Remove any spaces and build the FQDN
set "_computerDomain=%_computerDomain: =%"
set "_fqdn=%COMPUTERNAME%.%_computerDomain%"

exit /b 0

:main
call :check_admin
if errorlevel 1 goto :eof

call :get_domain
echo %_fqdn%
goto :eof

rem Execute the main routine
call :main
```

## PowerShell

To enumerate nested groups in an active directory environment.

```powershell
$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()

$PDC = ($domainObj.PdcRoleOwner).Name

$SearchString = "LDAP://"

$SearchString = $PDC + "/"

$DistinguishedName = "DC=$($domainObj.Name.Replace('.', ',DC='))"

$SearchString += $DistinguishedName

Write-Output $SearchString

$Searcher = New-Object System.DirectoryServices.DirectorySearcher([ADSI]$SearchString)

$objDomain = New-Object System.DirectoryServices.DirectoryEntry

$Searcher.SearchRoot = $objDomain

# property=value
# such as => name=<domain_username>
$Searcher.filter = "samAccounType=805306368"

$Searcher.FindAll()

foreach($obj in $Result) {
    foreach($prop in $obj.Properties) {
        $prop
    }
    Write-Host "------------------------"
}

# Enumerate each group member

# (property=value)
# such as => name=<Group_name>
$Searcher.filter = "(objectClass=Group)"

$Result = $Searcher.FindAll()

foreach($obj in $Result) {
    $obj.Properties.name
}

$Searcher.filter = "(name=Domain Admins)"

$Output = $Searcher.FindAll()

foreach($obj in $Output) {
    Write-Output $obj.Properties.member
}
```