---
author(s):
  - Userware
tags:
  - post-exploitation
  - discovery
  - active-directory
  - networking
  - network-ports
  - ldap
  - third-party
  - windows
---
# Automated Recon Tool

## Scripting

### Batch

Using [[06 - Tactics & Techniques & Procedures Phases/F - Post Exploitation/0x00 - Discovery/Desktop/Windows/Active Directory/0xA - Internal Reconnaissance/Users/Third Party/ADFind|ADFind]] to automate the process.

```batch
.\AdFind.exe -f "objectcategory=computer" > active_directory_computers.txt
.\AdFind.exe -f "(objectcategory=person)" > active_directory_users.txt
.\AdFind.exe -f "(objectcategory=organizationalUnit)" > organizational_units.txt
.\AdFind.exe -f (name="Domain Admins") member -list > domain_admin_users.txt
.\AdFind.exe -f (objectcategory=*) > all_categories.txt
.\AdFind.exe -sc trustdmp > trustdmp.txt
.\AdFind.exe -gcb -sc trustdmp > forest_trustdmp.txt
```

Then use the bash script to sort output.

```bash
#!/bin/bash

OUTPATH="sorted"
F1INPATH="active_directory_computers.txt"
F2INPATH="active_directory_users.txt"
F2OUTPATH="ad_users_output.txt"

mkdir "$OUTPATH"

while read p
do
	if [[ ${p:0:17} == ">operatingSystem:" ]]
	then
		OSPATH=${p:18}
	fi

	if [[ ${p:0:13} == ">dNSHostName:" ]]
	then
		if [[ ${OSPATH:0:14} == "Windows Server" ]]
		then
			echo ${p:14} >> "$OUTPATH/SERVERS.txt"
			tmp=$(echo "$OSPATH" | cut -d' ' -f1-3)
			echo ${p:14} >> "$OUTPATH/$tmp.txt"
		else
			echo ${p:14} >> "$OUTPATH/WORKERS.txt"
			tmp=$(echo "$OSPATH" | cut -d' ' -f1-2)
			echo ${p:14} >> "$OUTPATH/$tmp.txt"
		fi
	fi

done < $F1INPATH

while read p
do
	if [[ ${p:0:13} == ">description:" ]]
	then
		DECR=${p:14}
		DECR=${DECR%$'\r'}
	fi

	if [[ ${p:0:16} == ">sAMAccountName:" ]]
	then
		ACCNAME=${p:17}
		ACCNAME=${ACCNAME%$'\r'}
		echo "$ACCNAME:$DECR" >> "$OUTPATH/$F2OUTPATH"
	fi

done < $F2INPATH
```