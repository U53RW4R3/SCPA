---
author(s):
  - Userware
tags:
  - post-exploitation
  - discovery
  - active-directory
  - staying-off-the-land
  - networking
  - network-ports
  - msrpc
  - smb
  - ldap
  - windows
---
# #network-mapper

TODO: Fill in the description to each NSE script.

Getting information about the SMB security level to see if we can use with [[02 - Responder|responder]] for NBT-NS/LLMNR poisoning to relay NTLM hashes.

```
$ nmap -p 445 -Pn --script smb-security-mode [--script-args "smbusername='<username>',smbpass='<password>'"] <IP>

$ nmap -p 445 -Pn --script smb2-security-mode <IP>
```

```
$ nmap -p 445 -Pn --script smb-protocols <IP>

$ nmap -p 445 -Pn --script smb2-capabilities.nse <IP>
```

## 01 - Enumerate user accounts

### 1.1 - SMB Port

```
$ nmap -p 445 -Pn --script smb-enum-users --script-args "smbusername='<username>',smbpass='<password>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-users "smbusername='<username>',smbpass='<password>'" <IP>
```

Pass the Hash

```
$ nmap -p 445 -Pn --script smb-enum-users --script-args "smbusername='<username>',smbhash='<nt_hash>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-users --script-args "smbusername='<username>',smbhash='<nt_hash>'" <IP>
```

Get information about the server statistics. It reveals such as, failed logins, permission errors, system errors, print jobs, opened files.

```
$ nmap -p 445 -Pn --script smb-server-stats --script-args "smbusername='<username>',smbpass='<password>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-server-stats --script-args "smbusername='<username>',smbpass='<password>'" <IP>
```

Pass the Hash

```
$ nmap -p 445 -Pn --script smb-server-stats --script-args "smbusername='<username>',smbhash='<nt_hash>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-server-stats --script-args "smbusername='<username>',smbhash='<nt_hash>'" <IP>
```

### 1.2 - LDAP Port

Enumerate **sAMAccountName**

```
$ nmap -p 389 --script ldap-search --script-args 'ldap.username="cn=<username>,cn=users,dc=<domain>,dc=<tdl>",ldap.password=<password>, ldap.qfilter=users,ldap.attrib=sAMAccountName' <IP>
```

## 02 - Enumerate groups

```
$ nmap -p 445 -Pn --script smb-enum-groups --script-args "smbusername='<username>',smbpassword='<password>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-groups "smbusername='<username>',smbpassword='<password>'" <IP>
```

Pass the Hash

```
$ nmap -p 445 -Pn --script smb-enum-groups --script-args "smbusername='<username>',smbhash='<nt_hash>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-groups --script-args "smbusername='<username>',smbhash='<nt_hash>'" <IP>
```

---
## References

### SMB Port

- [Juggernaut-Sec: AD Recon â€“ MSRPC Over SMB (135/139/445)](https://juggernaut-sec.com/ad-recon-msrpc-over-smb/)