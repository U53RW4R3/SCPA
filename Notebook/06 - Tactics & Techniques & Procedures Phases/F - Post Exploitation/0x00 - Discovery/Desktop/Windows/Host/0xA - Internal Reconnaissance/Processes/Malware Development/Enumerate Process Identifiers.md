# Enumerate Process Identifiers

## WinAPI

### C

#### `OpenProcess`

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <windows.h>
#include <tlhelp32.h>

/*
https://learn.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-createtoolhelp32snapshot
https://learn.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-process32first
https://cocomelonc.github.io/pentest/2021/09/29/getProcessIDess.html
https://github.com/cocomelonc/2021-09-29-processfind-1
https://cplusplus.com/forum/windows/12137/
https://blog.davidvassallo.me/2022/07/25/windows-c-getting-the-process-name-from-a-process-id/
https://www.programcreek.com/cpp/?CodeExample=get+process+id+by+name
https://www.codeproject.com/Articles/2702/How-to-get-handle-to-any-running-process-by-its-na
https://github.com/PierreCiholas/GetBaseAddress

https://dev.to/tbhaxor/windows-system-programming-processes-1hg7

Retrieve the process and then parse it the process ID

$ x86_64-w64-mingw32-gcc get-process-id.c -o shell.exe -s \
-ffunction-sections -fdata-sections -Wno-write-strings \
-fno-exceptions -fmerge-all-constants -static-libstdc++ -static-libgcc \
-fpermissive
*/

// Find proccess ID by process name
int getProcessID(const char *process_name) {
    HANDLE handle_snapshot;
    PROCESSENTRY32 process_entry;
    int process_id = 0;
    BOOL handle_result;

    // snapshot of all processes in the system
    handle_snapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);

    if(INVALID_HANDLE_VALUE == handle_snapshot)
        return 0;

    // initializing size: needed for using Process32First
    process_entry.dwSize = sizeof(PROCESSENTRY32);

    // info about first process encountered in a system snapshot
    handle_result = Process32First(handle_snapshot, &process_entry);

    // retrieve information about the processes
    // and exit if unsuccessful
    while(handle_result) {
        // if we find the process: return process ID
        if(strcmp(process_name, process_entry.szExeFile) == 0) {
            process_id = process_entry.th32ProcessID;
            break;
        }
        handle_result = Process32Next(handle_snapshot, &process_entry);
    }

    // closes an open handle (CreateToolhelp32Snapshot)
    CloseHandle(handle_snapshot);
    return process_id;
}

int main(int argc, char *argv[]) {
    int process_id = 0; // process ID

    process_id = getProcessID(argv[1]);
    if(process_id) {
        printf("process_id = %d\n", process_id);
    }
    return 0;
}
```

#### `EnumProcesses`

```

```

### Python

#### `ctypes`

```python
import ctypes
import ctypes.wintypes as wt

PROCESS_SOME_ACCESS = 0x000028
MEM_COMMIT = 0x1000
MEM_RESERVE = 0x2000
MEM_COMMIT_RESERVE = 0x3000

kernel32 = ctypes.windll.kernel32

OpenProcess = kernel32.OpenProcess
OpenProcess.argtypes = [wt.DWORD, wt.BOOL, wt.DWORD]
OpenProcess.restype = wt.HANDLE

process_identifier = 0
OpenProcess(PROCESS_SOME_ACCESS, False, process_identifier)
```

## VBA

### WinAPI

```vb
Public Type PROCESSENTRY32
    dwSize As Long
    cntUsage As Long
    th32ProcessID As Long
    th32DefaultHeapID As Long
    th32ModuleID As Long
    cntThreads As Long
    th32ParentProcessID As Long
    pcPriClassBase As Long
    dwFlags As Long
    szExeFile As String * 260
End Type

Const TH32CS_SNAPPROCESS As Long = &H2

Declare Function CreateToolhelp32Snapshot Lib "kernel32.dll" ( _
    ByVal dwFlags As Long, _
    ByVal th32ProcessID As Long _
) As Long

Declare PtrSafe Function Process32First Lib "kernel32.dll" ( _
    ByVal hSnapshot As LongPtr, _
    ByRef lpProcEntry As PROCESSENTRY32 _
) As Long

Declare PtrSafe Function Process32Next Lib "kernel32.dll" ( _
    ByVal hSnapshot As LongPtr, _
    ByRef lpProcEntry As PROCESSENTRY32 _
) As Long

Sub GetProcessList()
    Dim procEntry As PROCESSENTRY32
     hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0)
    procEntry.dwSize = Len(procEntry)
    success = Process32First(hSnapshot, procEntry)
    Do While success <> 0
         Debug.Print “Process: “ & procEntry.szExeFile
         procEntry.dwSize = Len(procEntry)
         procEntry.szExeFile = Space(260)
         success = Process32Next(hSnapshot, procEntry)
    Loop
End Sub
```

---
## References

### Tenouk

- [Tenouk: Processes and Threads - WinAPIs - Part 6](https://www.tenouk.com/ModuleU.html)

- [Tenouk: Processes and Threads - WinAPIs - Part 7](https://www.tenouk.com/ModuleU1.html)

- [Tenouk: Windows Services - A Supplementary Note](https://www.tenouk.com/cddeestruct.html)

- [Tenouk: Another Windows Services - A Supplementary Note](https://www.tenouk.com/cddeefunction3.html)

### TrustedSec

- [TrustedSec: Enumerating Anti-Sandboxing Techniques](https://trustedsec.com/blog/enumerating-anti-sandboxing-techniques)

### Niraj Kharel

- [Niraj Kharel: Offensive C++ - Process Enumeration (ToolHelp32 Function)](https://nirajkharel.com.np/posts/process-enumeration-toolhelp32/)

- [Niraj Kharel: Offensive C++ - Process Enumeration (Windows Terminal Services API)](https://nirajkharel.com.np/posts/process-enumeration-windows-terminal-services/)

- [Niraj Kharel: Offensive C++ - Process Enumeration (EnumProcess Function)](https://nirajkharel.com.np/posts/process-enumeration-enum-process/)