---
author(s):
  - Userware
tags:
  - post-exploitation
  - discovery
  - staying-off-the-land
  - networking
  - network-protocols
  - msrpc
  - smb
  - windows
---
# Unix Shell

## 01 - Username enumeration

### 1.1 - Samba Suite Utils

Get current username.

```
rpcclient $> getusername
```

Retrieve username SID.

```
rpcclient $> lookupnames <username_1>,<username_2>,<username_n>

rpcclient $> samlookupnames builtin <username_1>,<username_2>,<username_n>
```

Enumerate username.

```
rpcclient $> queryuser <username | SID>

rpcclient $> queryusergroups <username_rid_value>
```

Check the user's privileges.

```
rpcclient $> enumprivs
```

### 1.2 - `net`

```
$ net rpc user info "<username>" -U "<username>%<password>" -S <IP>

$ net rpc user info "<username>" -U "<username>" --pw-nt-hash <nt_hash> -S <IP>
```

## 02 - Enumerate user accounts

### 2.1 - `rpcclient`

Enumerate groups.

```
rpcclient $> lookupnames <group_1>,<group_2>,<group_n>

rpcclient $> lookupnames Administrators
```

Enumerate alias group accounts.

```
rpcclient $> enumalsgroups builtin
```

### 2.2 - `net`

Enumerate **local users**.

```
$ net rpc user -U "<username>%<password>" -S <IP>

$ net rpc user -U "<username>" --pw-nt-hash <nt_hash> -S <IP>
```

Enumerate users from a local group.

```
$ net rpc group members '<group_name>' -U '[<domain>/]<username>%<password>' -S <IP>

$ net rpc group members '<group_name>' -U '[<domain>/]<username>' --pw-nt-hash <nt_hash> -S <IP>
```

Retrieve **local administrators**.

```
$ net rpc group members 'Administrators' -U '[<domain>/]<username>' -S <IP>
```

## 03 - Local groups enumeration

```
$ net rpc group list -U '[<domain>/]<username>' -I <IP>
```

## 04 - Logged On Users

```
$ sudo nmap -p U:137,T:139 -sU -sS --script smb-enum-sessions --script-args 'smbusername=<username>,smbpass=<password>' <IP>/<CIDR>
```

Pass the Hash

```
$ sudo nmap -p U:137,T:139 -sU -sS --script smb-enum-sessions --script-args 'smbusername=<username>,smbhash=<nt_hash>' <IP>/<CIDR>
```