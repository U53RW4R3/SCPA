---
author(s):
  - Userware
tags:
  - post-exploitation
  - discovery
  - living-off-the-land
  - windows
---
# Living off the Land

## 01 - Command Prompt

### 1.1 - List Available Processes

```
C:\> tasklist.exe /v [/s <IP>] [/u <username> /p <password>]

C:\> tasklist.exe /svc [/s <IP>] [/u <username> /p <password>]

C:\> tasklist.exe /fi "imagename eq <process.exe>" [/s <IP>] [/u <username> /p <password>]
```

## 02 - PowerShell

### 1.1 - Enumerate Current Process

```
PS C:\> [System.Environment]::Is64BitProcess
```

> [!INFO] System Pointer Size
> If it prints `8` then it's an x86_64 (64-bit) architecture. Else if it's `4` then it's x86 (32-bit) architecture.

```
PS C:\> [System.IntPtr]::Size
```

### 1.2 - List Available Processes

```
PS C:\> Get-Process

PS C:\> Get-Process | Where-Object {$_.ProcessName -notlike "svchost*"} | Format-Table ProcessName, Id
```

## 03 - Sysinternals

> [!IMPORTANT] Conditions
> To execute sysinternal tool. EULA must be accepted (`-accepteula`). Otherwise this can be done in registry hive.
> ```
> C:\> reg.exe add [\\<IP>\]HKCU\Software\Sysinternals /t REG_DWORD /v 'EulaAccepted' /d 0x00000001
> 
> PS C:\> Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Sysinternals' -Type DWord -Name 'EulaAccepted' -Value 0x00000001
> ```

### 3.1 - Command Prompt

```
C:\> net.exe use z: \\live.sysinternals.com\tools

C:\> copy z:\handle64.exe .

copy z:\pslist64.exe .

copy z:\logonsessions64.exe .

C:\> net.exe use z: /delete
```

### 3.2 - PowerShell

```
PS C:\> New-PSDrive -Name Z -PSProvider FileSystem -Root "\\live.sysinternals.com\tools"

PS C:\> Copy-Item z:\handle64.exe .

Copy-Item z:\pslist64.exe .

Copy-Item z:\logonsessions64.exe .

PS C:\> Remove-PSDrive -Name Z
```

Accept the EULA.

```
C:\> .\handle64.exe -accepteula

C:\> .\pslist64.exe -accepteula

PS C:\> .\logonsessions64.exe -accepteula
```

Enumerate the processes.

```
C:\> .\handle.exe -a -y

C:\> .\pslist64.exe [\\<IP> -u <username> -p <password>]

C:\> .\logonsessions64.exe -p
```

---
## References

### Backlinks

- [[03 - Process Management|Living off the Land: Process Manipulation]]

### Hacking Articles

- [Hacking Articles: Remote Windows PC Enumeration using PSTools](https://www.hackingarticles.in/remote-windows-pc-enumeration-using-pstools/)