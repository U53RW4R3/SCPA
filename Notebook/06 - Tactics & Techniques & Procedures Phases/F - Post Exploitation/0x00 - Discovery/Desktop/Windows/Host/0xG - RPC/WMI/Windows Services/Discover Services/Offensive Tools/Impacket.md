---
author(s):
  - Userware
tags:
  - post-exploitation
  - discovery
  - privilege-escalation
  - staying-off-the-land
  - networking
  - network-protocols
  - msrpc
  - smb
  - windows
---
# Impacket

Authentication syntax.

```
$ wmiquery.py [<domain>/]<username>:"<password>"@<IP>

$ wmiquery.py [<domain>/]<username>@<IP> -hashes :<nt_hash>
```

Query all services.

```
WQL> SELECT * FROM Win32_Service
```

Enumerate current service.

```
WQL>
```

Check service current status.

```
WQL>
```

TODO: Convert commands lines to remote commands.

Discover startup services

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] startup service

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] startup list full

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] startup get caption,command

C:\> reg.exe query [\\<IP>\]HKLM\Software\Microsoft\Windows\CurrentVersion\Run

C:\> reg.exe query [\\<IP>\]HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce

C:\> reg.exe query [\\<IP>\]HKCU\Software\Microsoft\Windows\CurrentVersion\Run

C:\> reg.exe query [\\<IP>\]HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
```