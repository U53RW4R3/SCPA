---
author(s):
  - Userware
tags:
  - post-exploitation
  - discovery
  - living-off-the-land
  - windows
---
# Living off the Land

## 01 - Installed Programs

### 1.1 - Command Prompt

#### 1.1.1 - List Installed Software

```
C:\> reg.exe query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall /v "DisplayName" /s [/reg:<32 | 64>]

C:\> reg.exe query HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall /v "DisplayName" /s [/reg:<32 | 64>]

C:\> reg.exe query HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall /v "DisplayName" /s [/reg:<32 | 64>]

C:\> reg.exe query HKCU\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall /v "DisplayName" /s [/reg:<32 | 64>]
```

### 1.2 - PowerShell

#### 1.2.1 - List Installed Software

```
PS C:\> Get-ChildItem -Path "Registry::HKEY_LOCAL_MACHINE\SOFTWARE" | Format-Table Name

PS C:\> Get-ChildItem -Path "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths"

PS C:\> Get-ItemProperty "Registry::HKEY_LOCAL_MACHINE\SOFTWARE

PS C:\> Get-ItemProperty "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*"

PS C:\> Get-ItemProperty "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*" 
```

## 02 - PowerShell

### 2.1 - Command Prompt

Discover available PowerShell engines.

> [!TIP]
> If Powershell Version 2.0 exists you can perform a downgrade attack without AMSI evasion.

```
C:\> reg.exe query HKLM\SOFTWARE\Microsoft\PowerShell\1\PowerShellEngine /v PowerShellVersion
```

Scriptblock Logging.

```
C:\> reg.exe query /s "HKLM\SOFTWARE\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging"
```

### 2.2 - PowerShell

Discover available PowerShell engines.

```
PS C:\> Get-ItemPropertyValue Registry::HKEY_LOCAL_MACHINE:\SOFTWARE\Microsoft\PowerShell\1\PowerShellEngine -Name PowerShellVersion

PS C:\> Get-ItemPropertyValue Registry::HKEY_LOCAL_MACHINE:\SOFTWARE\Microsoft\PowerShell\*\PowerShellEngine -Name PowerShellVersion
```

Scriptblock Logging.

```
PS C:\> Get-ItemProperty "Registry::HKEY_LOCAL_MACHINE:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging"
```

## 03 - .NET

### 3.1 - Command Prompt

Enumerate available **Common Language Runtime (CLR)** versions.

```
C:\> reg.exe query "HKLM\SOFTWARE\Microsoft\Net Framework Setup\NDP\v4\Full Release"
```

### 3.2 - PowerShell

Enumerate available **Common Language Runtime (CLR)** versions.

```
PS C:\> Get-ItemProperty "Registry::HKLM\SOFTWARE\Microsoft\Net Framework Setup\NDP\v4\Full Release"
```

---
## References

### Backlinks

- [[06 - Tactics & Techniques & Procedures Phases/F - Post Exploitation/0x00 - Discovery/Desktop/Windows/Host/0xA - Internal Reconnaissance/Software/Discover Programs/Manual/Living off the Land]]