---
author(s):
  - Userware
tags:
  - post-exploitation
  - discovery
  - living-off-the-land
  - T1047
  - windows
---
# Living off the Land

## 01 - Command Prompt

### 1.1 - Mounted Drives

Display information of the storage size.

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] path win32_logicaldisk get caption, filesystem, freespace, size, volumename

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] logicaldisk where drivetype=3 get name, freespace, systemname, filesystem, size, volumeserialnumber

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] volume list

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] volume list brief
```

Display mounted drives.

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] logicaldisk get name

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] logicaldisk get caption

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] diskdrive list

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] diskdrive list brief
```

### 1.2 - MAC Addresses

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] nic where "NetEnabled=true" get Description, MACAddress, NetConnectionID
```

Filter only to Ethernet.

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] nic where "NetEnabled=true and AdapterTypeID=0" get Description, MACAddress, NetConnectionID
```

### 1.3 - Motherboard

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] bios

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] bios get serialnumber

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] baseboard get Manufacturer, Product, SerialNumber, Version
```

### 1.4 - Hardware Model

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] csproduct get name

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] get model, manufacturer
```

### 1.5 - CPU

Retrieving the number of CPU cores and threads.

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] cpu get deviceid, numberofcores, numberoflogicalprocessors

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] cpu list full
```

### 1.6 - RAM

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] memorychip get BankLabel, Capacity, Manufacturer, PartNumber, Speed, SerialNumber
```

### 1.7 - Monitors

```
C:\> wmic [/node:<IP>] [/user:<username> /password:<password>] path WmiMonitorID get InstanceName, UserFriendlyName
```

Screen resolution.

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] path Win32_DesktopMonitor get ScreenWidth, ScreenHeight
```

### 1.8 - Printers

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] printer list brief
```

### 1.9 - USB Devices

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] path Win32_USBControllerDevice get Dependent
```

### 1.10 - Fans

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] Win32_Fan get Name, DesiredSpeed, CurrentSpeed
```

### 1.11 - Temperature

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] path MSAcpi_ThermalZoneTemperature get CurrentTemperature
```

## 02 - PowerShell

### 2.1 - Mounted Drives

Display mounted drives.

```
PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_LogicalDisk | Select-Object -ExpandProperty Name, Caption

PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_DiskDrive | Select-Object Model,SerialNumber,Size,MediaType
```

Display information of the storage size.

```
PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_LogicalDisk

PS C:\> Get-WmiObject [-ComputerName <IP>] -ClassName Win32_LogicalDisk
```

### 2.2 - MAC Addresses

Basic hardware information

```
PS C:\> Get-CimInstance [-ComputerName <IP>] Win32_Processor | Format-List -AutoSize
```

### 2.3 - Motherboard

Motherboard (The namespace is CIMV2)

```
PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_Network_Adapter

PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_NetworkAdapterConfiguration -Filter "IPEnabled = $true"

PS C:\> Get-WmiObject [-ComputerName <IP>] -ClassName Win32_NetworkAdapterConfiguration -Filter "IPEnabled = $true"

PS C:\> Get-CimInstance [-ComputerName <IP>] -Query "SELECT * FROM Win32_NetworkAdapterConfiguration WHERE IPEnabled = True" | Where-Object {$_.Name -notlike "svchost*"} | Select Name, Handle, @{Label="Owner";Expression={$_.GetOwner().User}} | Format-Table -AutoSize

PS C:\> Get-WmiObject [-ComputerName <IP>] -Query "SELECT * FROM Win32_NetworkAdapterConfiguration WHERE IPEnabled = True" | Where-Object {$_.Name -notlike "svchost*"} | Select Name, Handle, @{Label="Owner";Expression={$_.GetOwner().User}} | Format-Table -AutoSize

PS C:\> Get-CimInstance [-ComputerName <IP>] -Query "SELECT SerialNumber FROM Win32_BIOS" | Where-Object {$_.Name -notlike "svchost*"} | Select Name, Handle, @{Label="Owner";Expression={$_.GetOwner().User}} | Format-Table -AutoSize

PS C:\> Get-WmiObject [-ComputerName <IP>] -Query "SELECT SerialNumber FROM Win32_BIOS" | Where-Object {$_.Name -notlike "svchost*"} | Select Name, Handle, @{Label="Owner";Expression={$_.GetOwner().User}} | Format-Table -AutoSize

PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_NetworkAdapterConfiguration | Format-Table -Property Name,NetConnectionStatus -AutoSize

PS C:\> Get-WmiObject [-ComputerName <IP>] -ClassName Win32_NetworkAdapterConfiguration | Format-Table -Property Name,NetConnectionStatus -AutoSize

PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_NetworkAdapterConfiguration -Filter "NetConnectionStatus = 2" | Format-List -Property [a-z]\*

PS C:\> Get-WmiObject [-ComputerName <IP>] -ClassName Win32_NetworkAdapterConfiguration -Filter "NetConnectionStatus = 2" | Format-List -Property [a-z]\*
```

### 2.4 - Hardware Model

```
PS C:\> Get-CimInstance [-ComputerName <IP>] Win32_ComputerSystem | Select-Object -Property Model, Manufacturer

PS C:\> Get-CimInstance [-ComputerName <IP>] -Query "SELECT PartNumber FROM Win32_SystemEnclosure"

PS C:\> Get-CimInstance [-ComputerName <IP>] -Query "SELECT SMBIOSAssetTag FROM Win32_SystemEnclosure"
```

### 2.5 - CPU

```
PS C:\> Get-CimInstance [-ComputerName <IP>] -Query "SELECT Name FROM Win32_Processor"
```

### 2.6 - RAM

```
PS C:\> (Get-CimInstance [-ComputerName <IP>] -ClassName Win32_ComputerSystem).TotalPhysicalMemory
```

Retrieve the memory capacity with human readable format.

```powershell
PS C:\> $cs = Get-WmiObject -ClassName "Win32_ComputerSystem" [math]::Ceiling($cs.TotalPhysicalMemory / 1024 / 1024 / 1024)

$cs
```

GPU VRAM.

```
PS C:\> Get-CimInstance Win32_VideoController | Select-Object Name, AdapterRAM,@{Expression={$_.adapterram/1MB};label="MB"}
```

### 2.7 - Monitors

```
PS C:\> Get-CimInstance [-ComputerName <IP>] -Query "SELECT * FROM WmiMonitorID"
```

Screen resolution.

```
PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_DesktopMonitor | Select-Object ScreenWidth, ScreenHeight
```

### 2.8 - Printers

```
PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_Printer | Select-Object Name, DriverName, PortName, SystemName, Default, Shared, Status
```

### 2.9 - USB Devices

```powershell
PS C:\> $devices = Get-WmiObject -Class Win32_USBControllerDevice
$devices.Count
```

### 2.10 - Fans

```
PS C:\> Get-CimInstance [-ComputerName <IP>] Win32_Fan -Namespace "root\cimv2"
```

### 2.11 - Temperature

```powershell
PS C:\> $CPUt = Get-CimInstance MSAcpi_ThermalZoneTemperature -Namespace "root/wmi"
$currentTempKelvin = $CPUt.CurrentTemperature / 10
$currentTempCelsius = $currentTempKelvin - 273.15
$currentTempCelsius
```

---
## References

### Backlinks

- [[06 - Tactics & Techniques & Procedures Phases/F - Post Exploitation/0x00 - Discovery/Desktop/Windows/Host/0xF - Operating System/Hardware/Manual/Living off the Land|Enumeration and Discovery: Windows Hardware]]

### CyberITHub

- [CyberITHub: 20 Useful WMIC Command Examples in Windows Cheatsheet](https://www.cyberithub.com/20-useful-wmic-command-examples-in-windows-cheat-sheet/)

### Hackmag

- [Hackmag: Malware under surveillance. Sandboxes and how to detect them](https://hackmag.com/security/malware-sandbox)