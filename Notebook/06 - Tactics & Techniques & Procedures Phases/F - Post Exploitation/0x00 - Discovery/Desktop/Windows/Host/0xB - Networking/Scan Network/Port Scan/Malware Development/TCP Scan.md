# TCP Scan

## Scripting

### Batch

```batch
@echo off
setlocal enabledelayexpansion

set "target=%1"
set "start_port=1"
set "end_port=1024"

for /L %%i in (%start_port%, 1, %end_port%) do (
    (
        echo . | telnet !target! %%i | find.exe "Connected" >nul
        if !errorlevel! equ 0 (
            echo Port %%i is open
        ) else (
            echo Port %%i is closed
        )
    ) 2>nul
)

endlocal
```

### PowerShell

```powershell
function QueryPort {
    param (
        [string]$HostName,
        [int]$Port
    )

    if ($Port -lt 0 -or $Port -gt 65535) {
        throw "Invalid port number. Port must be between 0 and 65535."
    }

    $tcpClient = New-Object System.Net.Sockets.TCPClient

    try {
        $connected = $tcpClient.ConnectAsync($HostName, $Port).Wait(300)
        if ($connected) {
            $stream = $tcpClient.GetStream()
            Start-Sleep -Milliseconds 500
            $response = ""
            while ($stream.DataAvailable) {
                $response += [char]$stream.ReadByte()
            }
            $tcpClient.Close()
            Write-Host "$HostName : port $Port is open, responding with: $response"
        } else {
            $tcpClient.Close()
            Write-Host "$HostName : port $Port failed to connect"
        }
    } catch {
        Write-Host "An error occurred: $($Error[0].Message)"
    }
}

# Example usage:
QueryPort -HostName "intelligenthacking.com" -Port 21
```