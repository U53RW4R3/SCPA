---
author(s):
  - Userware
tags:
  - post-exploitation
  - discovery
  - living-off-the-land
  - networking
  - network-protocols
  - icmp
  - windows
---
# Living off the Land

## 01 - Command Prompt

```
C:\> for /l %i in (1, 1, 255) do @ping.exe -n 1 -l 4 192.168.1.%i | find.exe "TTL"

C:\> for /k %i in (1, 1, 255) do @ping.exe -n 1 -w 200 192.168.1.%i 2> nul && echo 192.168.1.%i host is up
```

## 02 - PowerShell

```
PS C:\> 1..255 | % { "192.168.1.$($_): $(Test-Connection -Count 1 -ComputerName 192.168.1.$($_) -Quiet)" }

PS C:\> $ping = New-Object System.Net.NetworkInformation.Ping; 1..254 | ForEach-Object { $ping.Send("192.168.1.$_", 1) | Where-Object { $_.Status -ne [System.Net.NetworkInformation.IPStatus]::TimedOut } | Select-Object -Property Address | Format-List }
```

## 03 - Sysinternals

> [!IMPORTANT] Conditions
> To execute sysinternal tool. EULA must be accepted (`-accepteula`). Otherwise this can be done in registry hive.
> ```
> C:\> reg.exe add [\\<IP>\]HKCU\Software\Sysinternals /t REG_DWORD /v 'EulaAccepted' /d 0x00000001
> 
> PS C:\> Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Sysinternals' -Type DWord -Name 'EulaAccepted' -Value 0x00000001
> ```

^c1c1de

### 3.1 - Command Prompt

```
C:\> net.exe use z: \\live.sysinternals.com\tools

C:\> copy z:\psping64.exe .

C:\> net.exe use z: /delete
```

^d3eee1

### 3.2 - PowerShell

```
PS C:\> New-PSDrive -Name Z -PSProvider FileSystem -Root "\\live.sysinternals.com\tools"

PS C:\> Copy-Item z:\psping64.exe .

PS C:\> Remove-PSDrive -Name Z
```

^1b2c84

Accept the EULA. ^e98be1

```
C:\> .\psping64.exe -accepteula
```

^d3b20c

Ping host.

```
C:\> .\psping64.exe <IP>
```

Specify the number of pings and perform quietly.

```
C:\> .\psping64.exe <IP> -n 1 -q
```