---
author(s):
  - Userware
tags:
  - post-exploitation
  - discovery
  - living-off-the-land
  - networking
  - network-protocols
  - port-scanners
  - windows
---
# Living off the Land

## 01 - Port Sweep

### 1.1 - PowerShell

```
PS C:\> <PORT> | % { echo ((New-Object Net.Sockets.TcpClient).Connect("<IP>", $_)) "Port $_ is open" } 2>$null

PS C:\> 445 | % { echo ((New-Object Net.Sockets.TcpClient).Connect("<IP>", $_)) "Port $_ is open" } 2>$null
```

### 1.2 - Sysinternals

![[06 - Tactics & Techniques & Procedures Phases/F - Post Exploitation/0x00 - Discovery/Desktop/Windows/Host/0xB - Networking/Scan Network/Live Host Identification/Network Protocols/Ping Sweep/Living off the Land#^c1c1de]]

#### 1.2.1 - Command Prompt

![[06 - Tactics & Techniques & Procedures Phases/F - Post Exploitation/0x00 - Discovery/Desktop/Windows/Host/0xB - Networking/Scan Network/Live Host Identification/Network Protocols/Ping Sweep/Living off the Land#^d3eee1]]

#### 1.2.2 - PowerShell

![[06 - Tactics & Techniques & Procedures Phases/F - Post Exploitation/0x00 - Discovery/Desktop/Windows/Host/0xB - Networking/Scan Network/Live Host Identification/Network Protocols/Ping Sweep/Living off the Land#^1b2c84]]

![[06 - Tactics & Techniques & Procedures Phases/F - Post Exploitation/0x00 - Discovery/Desktop/Windows/Host/0xB - Networking/Scan Network/Live Host Identification/Network Protocols/Ping Sweep/Living off the Land#^e98be1]]

![[06 - Tactics & Techniques & Procedures Phases/F - Post Exploitation/0x00 - Discovery/Desktop/Windows/Host/0xB - Networking/Scan Network/Live Host Identification/Network Protocols/Ping Sweep/Living off the Land#^d3b20c]]

Scan the TCP port.

```
C:\> .\psping64.exe <IP>:<PORT>
```

Scan the UDP port.

```
C:\> .\psping64.exe -u <IP>:<PORT>
```

### 1.3 - `PortQryV2.exe`

Download the port scanner program.

```
C:\> certutil.exe -urlcache -split -f https://download.microsoft.com/download/0/d/9/0d9d81cf-4ef2-4aa5-8cea-95a935ee09c9/PortQryV2.exe PortQryV2.exe

C:\> curl.exe -o PortQryV2.exe https://download.microsoft.com/download/0/d/9/0d9d81cf-4ef2-4aa5-8cea-95a935ee09c9/PortQryV2.exe
```

Scan a single target.

```
C:\> PortQryV2.exe -n <IP> -p <tcp | udp | both> -e <PORT> -v
```

Scan multiple IP addresses through a single port.

```
C:\> for /l %i in (1,1,255) do PortQryV2.exe -n 192.168.1.%i -p <tcp | udp | both> -e <PORT> -v 2> nul && echo 192.168.1.%i

C:\> for /l %i in (1,1,255) do PortQryV2.exe -n 192.168.1.%i -p tcp -e 445 -v 2> nul && echo 192.168.1.%i
```

## 02 - Scan Multiple Ports

### 2.1 - PowerShell

Scan the range of ports.

```
PS C:\> 21..1024 | % { echo ((New-Object Net.Sockets.TcpClient).Connect("<IP>", $_)) "Port $_ is open" } 2>$null
```

Scan a list of ports.

```
PS C:\> 22,445,1433,5985 | % { echo ((New-Object Net.Sockets.TcpClient).Connect("<IP>", $_)) "Port $_ is open" } 2>$null
```

---
## References

### Microsoft

- [Microsoft: PortQry](https://www.microsoft.com/en-us/download/details.aspx?id=17148)

### InfoSec Matter

- [InfoSec Matter: Powershell Commands for Pentesters](https://www.infosecmatter.com/powershell-commands-for-pentesters/)