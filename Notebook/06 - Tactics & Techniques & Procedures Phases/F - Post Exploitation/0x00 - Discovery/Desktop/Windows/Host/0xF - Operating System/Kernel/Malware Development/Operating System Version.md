# Operating System Version

## Scripting

### Batch

```batch
@echo off
goto check_windows_version

:check_windows_version
REM when checking desktop version newer than Windows Server 2003
ver | find.exe "Version 5.2." > nul

REM when checking desktop version newer than Vista
ver | find.exe "Version 6." > nul
```

Using `systeminfo.exe` to get the OS.

```batch
@echo off

goto :OsDetection

:OsDetection

setlocal enabledelayedexpansion

set systemInfoFile=C:\Windows\System32\osVersion.txt

if exist "%systemInfoFile%" (
    del "%systemInfoFile%"
)

systeminfo.exe | find.exe "OS Version:" >> %systemInfoFile%

for /f "tokens=3 delims= " %%s in (%systemInfoFile%) do (
    for /f "tokens=1-2 delims=." %%a in ("%%s") do (
        set /a osNumber=%%a%%b
        echo %osNumber%
    )
)

exit /b 0
```

## WinAPI

### `GetVersionExA`

```c
#include <windows.h>
#include <sysinfoapi.h>

int main() {
	OSVERSIONINFOA os_version_info;
	os_version_info.dwOSVersionInfoSize = sizeof(OSVERSIONINFOA);

    if (GetVersionExA(&versionInfo)) {
        printf("Operating System Version: %lu.%lu\n", versionInfo.dwMajorVersion, versionInfo.dwMinorVersion);
        printf("Build Number: %lu\n", versionInfo.dwBuildNumber);
        printf("Platform ID: %lu\n", versionInfo.dwPlatformId);
        printf("CSD Version: %s\n", versionInfo.szCSDVersion); // Service Pack info
    } else {
        printf("Failed to get version information.\n");
    }

    return 0;
}
```

### `GetVersionExW`

```c
#include <windows.h>
#include <sysinfoapi.h>

struct _OSVERSIONINFOW os_version_information;

GetVersionExW(&os_version_information)
```

---
## References

### Microsoft

- [WinAPI Documentation: Version Helper functions](https://learn.microsoft.com/en-us/windows/win32/sysinfo/version-helper-apis)

- [WinAPI Documentation: `GetVersionExA()`](https://learn.microsoft.com/en-us/windows/win32/api/sysinfoapi/nf-sysinfoapi-getversionexa)

- [WinAPI Documentation: `GetVersionExW()`](https://learn.microsoft.com/en-us/windows/win32/api/sysinfoapi/nf-sysinfoapi-getversionexw)

### Tenouk

- [Tenouk: Registry - Part 3](https://www.tenouk.com/ModuleP.html)

- [Tenouk: Windows Registry - A Supplementary Note](https://www.tenouk.com/copregsupp.html)

- [Tenouk: Getting the Windows OS version information C program example](https://www.tenouk.com/cpluscodesnippet/getwindowsosversion.html)

### InstallSetupConfig

- [InstallSetupConfig: Win32 Windows Volume Program and Code Example 7](https://www.installsetupconfig.com/win32programming/windowsvolumeapis1_6.html)

### DexTutor

- [dextutor: How to get OS version in C](https://dextutor.com/how-to-get-os-version-in-c/)