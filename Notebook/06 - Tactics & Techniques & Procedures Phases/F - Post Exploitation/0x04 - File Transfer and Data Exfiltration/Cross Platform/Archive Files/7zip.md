---
author(s):
  - Userware
tags:
  - post-exploitation
  - file-transfer-and-data-exfiltration
  - archive-files
---
# 7zip

## 01 - Common Files

### 1.1 - Linux

```
/usr/bin/7z
```

^40f875

### 1.2 - Windows

```
C:\Program Files\7-Zip\7z.exe
C:\Progra~1\7-Zip\7z.exe
```

^939b0a

## 02 - Setup

Choose a standalone console version to use a portable program.

![[01 - 7zip Download Webpage.png]]

### 2.1 - Silent Install

Download the installer with command prompt.

```
C:\> certutil.exe -urlcache -split -f https://www.7-zip.org/a/7z2107-x64.exe 7z-installer.exe

C:\> curl.exe -o 7z-installer.exe https://www.7-zip.org/a/7z2107-x64.exe
```

Download the installer with PowerShell cmdlet.

```
PS C:\> Invoke-WebRequest -UseBasicParse -Uri https://www.7-zip.org/a/7z2107-x64.exe -OutFile 7z-installer.exe
```

Silently install 7zip program

```
C:\> .\7z-installer.exe /S
```

### 2.2 - Portable Program

Download the portable program with command prompt.

```
C:\> certutil.exe -urlcache -split -f https://github.com/ip7z/7zip/releases/download/24.08/7z2408-x64.exe 7z.exe

C:\> curl.exe -o 7z.exe https://github.com/ip7z/7zip/releases/download/24.08/7z2408-x64.exe 
```

Download the portable program with PowerShell cmdlet.

```
PS C:\> Invoke-WebRequest -UseBasicParse -Uri https://github.com/ip7z/7zip/releases/download/24.08/7z2408-x64.exe -OutFile 7z.exe
```

## 03 - Check Archive File

Reveals the information of the file archive type. Especially if it's encrypted.

```
$ 7z l -slt /path/to/file.extension
```

## 04 - Archive Files

```
> 7z a <destination> <file_1>,<file_2>,...

> 7z a -t7z -m0=lzma2 -mx=9 -mfb=64-md=32m -ms=on [-p<password>] [-o/path/to/directory/] archive.7z *.txt

> 7z a -tzip -mx=9 [-p<password>] [-o/path/to/directory/] archive.zip file.txt
```

### 4.1 - Split Into Multiple Volumes

> [!TIP] Easier Exfiltration
> Splitting volumes (`-v`) does make the exfiltration process easier.
> > [!NOTE]
> > You'll see the volume of 7zip archive files like `file.7z.001`, `file.7z.002`, etc.

```
> 7z a -t7z -v<bytes>m -mx9 -r0 [-p<password>] archive.7z [<drive_letter>:]/path/to/folder
```

You can of course archive the files from the file sharing SMB machine.

```
C:\> 7z a -t7z -v650m -mx9 -r0 [-p<password>] exfiltrated-documents.7z \\<IP>\<share_name>\
```

### 4.2 - Match Specific Extensions

#### 4.2.1 - Linux

Recursively archive files with specific file extensions

```
$ find /path/to/directory -type f \( -name "*.txt" -o -name "*.pdf" -o -name "*.doc" -o -name "*.docx" -o -name "*.jpg" -o -name "*.jpeg" -o -name "*.png" -o -name "*.ppt" -o -name "*.pptx" -o -name "*.xls" -o -name "*.xlsx" \) -exec 7z a -t7z -v650m -mx9 -r0 -p<password> archive.7z {} + 2>&1

$ find /path/to/directory -type f -regex ".*\.\(txt\|pdf\|doc\|docx\|jpg\|jpeg\|png\|ppt\|pptx\|xls\|xlsx)" -exec 7z a -t7z -v650m -mx9 -r0 -p<password> archive.7z {} + 2>&1
```

Recursively archive files with specific file extensions. Ensure the filenames are unique to avoid duplicates.

```
$ find /path/to/directory -type f \( -name "*.txt" -o -name "*.pdf" -o -name "*.doc" -o -name "*.docx" -o -name "*.jpg" -o -name "*.jpeg" -o -name "*.png" -o -name "*.ppt" -o -name "*.pptx" -o -name "*.xls" -o -name "*.xlsx" \) -exec 7z a -t7z -v650m -mx9 -r0 -p<password> archive.7z {} \; 2>&1 | rev | cut -d . -f1 | rev | sort | uniq

$ find /path/to/directory -type f -regex ".*\.\(txt\|pdf\|doc\|docx\|jpg\|jpeg\|png\|ppt\|pptx\|xls\|xlsx)" -exec 7z a -t7z -v650m -mx9 -r0 -p<password> archive.7z {} + 2>&1 | rev | cut -d . -f1 | rev | sort | uniq
```

## 05 - Extract Files

```
> 7z x archive.7z
```

---
## References

### 7Zip

- [7zip](https://www.7-zip.org/download.html)

- [7zip Source Repository](https://github.com/ip7z/7zip)

- [7zip Command Line](https://7ziphelp.com/7zip-command-line)

- [7zip FAQ (it provided a silent install flag)](https://7-zip.org/faq.html)