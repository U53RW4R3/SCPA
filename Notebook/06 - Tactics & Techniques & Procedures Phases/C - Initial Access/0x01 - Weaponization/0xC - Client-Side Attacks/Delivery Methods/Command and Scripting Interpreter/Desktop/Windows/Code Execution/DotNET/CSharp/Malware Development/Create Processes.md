# Create Processes

## Spawn Process

### Scripting

```cs
using System;
using System.Diagnostics;

namespace SpawnProcess {
    class MainClass {
        public static void Main(string[] args) {
            Process process = Process.Start(@"C:\Windows\System32\notepad.exe");
            int id = process.Id;
            Process tempProc = Process.GetProcessById(id);
        }
    }
}
```

## Create Suspended Process

### WinAPI

```cs
using System;
using System.Diagnostics;
using System.Runtime.InteropServices;

namespace SuspendedProcessDemo {
    class Program {
        [StructLayout(LayoutKind.Sequential)]
        struct STARTUPINFO {
            public int cb;
            public IntPtr lpReserved;
            public IntPtr lpDesktop;
            public IntPtr lpTitle;
            public int dwX;
            public int dwY;
            public int dwXSize;
            public int dwYSize;
            public int dwXCountChars;
            public int dwYCountChars;
            public int dwFillAttribute;
            public int dwFlags;
            public short wShowWindow;
            public short cbReserved2;
            public IntPtr lpReserved2;
            public IntPtr hStdInput;
            public IntPtr hStdOutput;
            public IntPtr hStdError;
        }

        [StructLayout(LayoutKind.Sequential)]
        struct PROCESS_INFORMATION {
            public IntPtr hProcess;
            public IntPtr hThread;
            public uint dwProcessId;
            public uint dwThreadId;
        }

        [DllImport("kernel32.dll", SetLastError = true)]
        static extern bool CreateProcess(
            string lpApplicationName,
            string lpCommandLine,
            IntPtr lpProcessAttributes,
            IntPtr lpThreadAttributes,
            bool bInheritHandles,
            uint dwCreationFlags,
            IntPtr lpEnvironment,
            string lpCurrentDirectory,
            ref STARTUPINFO lpStartupInfo,
            out PROCESS_INFORMATION lpProcessInformation);       

        static void Main() {
            STARTUPINFO si = new STARTUPINFO();
            si.cb = Marshal.SizeOf(si);
            PROCESS_INFORMATION pi = new PROCESS_INFORMATION();

            string targetProcess = "C:\\Windows\\System32\\notepad.exe";

                CreateProcess(
                targetProcess,
                null,
                IntPtr.Zero,
                IntPtr.Zero,
                false,
                0x00000004, // Suspended mode
                IntPtr.Zero,
                null,
                ref si,
                out pi);          
        }
    }
}
```

---
## References

### RootFu

- [RootFu: Creating a Suspended Process in C#](https://rootfu.in/creating-a-suspended-process-in-c/)