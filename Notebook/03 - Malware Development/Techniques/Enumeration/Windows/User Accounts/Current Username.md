# Current Username

## GetUserName

### C

```c
#include <stdio.h>
#include <tchar.h>
#include <windows.h>
#include <errhandlingapi.h>
#include <winbase.h>

// $ x86_64-w64-mingw32-gcc -l advapi32 -o implant.exe implant.c

int main() {
	TCHAR username[256];
	DWORD length = sizeof(username) / sizeof(TCHAR);

	if (GetUserName(username, &length)) {
		_tprintf(_T("Username: %s\n"), username);
	} else {
		_tprintf(_T("Failed to retrieve the username. Error code: %lu\n"), GetLastError());
	}
	return 0;
}
```

## Environment Variable

### C

```c
#include <stdio.h>
#include <tchar.h>
#include <windows.h>
#include <errhandlingapi.h>
#include <winbase.h>

// $ x86_64-w64-mingw32-gcc -l kernel32 -o implant.exe implant.c

int main() {
	TCHAR username[256];
	DWORD length = sizeof(username) / sizeof(TCHAR);

	DWORD result = GetEnvironmentVariable(_T("USERNAME"), username, length);

	if (result > 0 && result < length) {
		_tprintf(_T("Username: %s\n"), username);
	} else {
		if (result == 0) {
			_tprintf(_T("Failed to retrieve the USERNAME environment variable. Error code: %lu\n"), GetLastError());
		} else {
			_tprintf(_T("Buffer too small. Need a buffer of size %lu.\n"), result);
		}
	}
	return 0;
}
```

### Python

```python
#!/usr/bin/env python3
import os

def environment_username() -> str:
	return os.environ.get("USERNAME")

if __name__ == "__main__":
	print("Username: " + environment_username())
```

Another way to get the environment is using just the `os.getenv()` predefined method.

```python
#!/usr/bin/env python3
import os

def environment_username() -> str:
	return os.getenv("USERNAME")

if __name__ == "__main__":
	print("Username: " + environment_username())
```

---
## References

### Microsoft

- [WinAPI Documentation: `GetUserNameW`](https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-getusernamew)

### MalAPI

- [MalAPI: `GetUserNameA`](https://malapi.io/winapi/GetUserNameA)

### Tenouk

- [Tenouk: User Accounts and Groups - Part 1](https://www.tenouk.com/ModuleM.html)

- [Tenouk: User Accounts and Groups - Part 2](https://www.tenouk.com/ModuleM1.html)

- [Tenouk: Windows Users & Groups - A Supplementary Note](https://www.tenouk.com/cmnusrgrpsupp.html)

- [Tenouk: Processes and Threads - C Run-Time - Part 1](https://www.tenouk.com/ModuleR.html)

- [Tenouk: Processes and Threads - C Run-Time - Part 2](https://www.tenouk.com/ModuleR1.html)

- [Tenouk: Windows Thread Synchronization References 2](https://www.tenouk.com/crstufunction4.html)

### InstallSetupConfig

- [InstallSetupConfig:  Win32 Windows Volume Program and Code Example 6](https://www.installsetupconfig.com/win32programming/windowsvolumeapis1_5.html)

- [InstallSetupConfig: Win32 Windows Volume Program and Code Example 7](https://www.installsetupconfig.com/win32programming/windowsvolumeapis1_6.html)

### TrustedSec

- [TrustedSec: Enumerating Anti-Sandboxing Techniques](https://trustedsec.com/blog/enumerating-anti-sandboxing-techniques)