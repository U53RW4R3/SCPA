# ShellExecute

## C++

```cpp
BOOL run() {
 const std::shared_ptr<TCHAR> process_path { new TCHAR[MAX_PATH]()};
 GetModuleFileNameExW(GetCurrentProcess(), nullptr, process_path.get(), MAX_PATH);
 const auto arg = std::wstring{ L"/c " } +process_path.get();

 SHELLEXECUTEINFO exec_info{};
 exec_info.cbSize = sizeof(exec_info);
 exec_info.hwnd = nullptr;
 exec_info.lpVerb = L"runas";
 exec_info.lpFile = L"cmd.exe";
 exec_info.lpParameters = arg.c_str();
 exec_info.nShow = SW_SHOW; // SW_HIDE;

 return ShellExecuteEx(&exec_info);
}
```

## VBA

```vbscript
Private Declare PtrSafe Function ShellExecute Lib "shell32.dll" _
    Alias "ShellExecuteA" ( _
    ByVal hwnd As Long, _
    ByVal lpOperation As String, _
    ByVal lpFile As String, _
    ByVal lpParameters As String, _
    ByVal lpDirectory As String, _
    ByVal nShowCmd As Long) As Long
```

---
## References

- [MalAPI: ShellExecuteA](https://malapi.io/winapi/ShellExecuteA)

- [MalAPI: ShellExecuteExA](https://malapi.io/winapi/ShellExecuteExA)

- [secrary: RedTeamTrick](https://secrary.com/Random/RedTeamTrick/)