# Detect File in User Directory

## ReadFile

```c
#include <windows.h>
#include <fileapi.h>

#pragma comment(lib, "kernel32.lib")

#define FILE_PATH "C:\\Users\\<username>\\Documents\\file.txt"

int main() {
	HANDLE file;
	DWORD tmp;
	LPCVOID buffer = "1234";
	char output_buffer[5] = {0};

	file = CreateFile(FILE_PATH, GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, 0);

	if (WriteFile(file, buffer, strlen((const char *)buff), &tmp, NULL)) {
		CloseHandle(file);

		file = CreateFile(FILE_PATH,
					GENERIC_READ,
					FILE_SHARE_READ,
					NULL,
					OPEN_EXISTING,   // existing file only
					FILE_ATTRIBUTE_NORMAL,
					NULL);
		if (ReadFile(file, output_buffer, 4, &tmp, NULL)) {
			if (strncmp(buffer, output_buffer, 4) == 0) {
				// execute payload here
			}
		}
		CloseHandle(file);
	}

	DeleteFile(FILE_PATH);

	return 0;
}
```

---
## References

### Backlinks

- [[03 - Malware Development/Techniques/Miscellaneous/File Management/Read File]]