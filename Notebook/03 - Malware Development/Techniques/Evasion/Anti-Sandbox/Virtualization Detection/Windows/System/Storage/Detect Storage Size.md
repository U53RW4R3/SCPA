---
author(s):
  - Userware
tags:
  - malware-development
  - defense-evasion
---
# Detect Storage Size

## Total Disk Size

```c
HANDLE drive;
BOOL result;
GET_LENGTH_INFORMATION size;
DWORD lpBytesReturned;

drive = CreateFile("\\\\.\\PhysicalDrive0", GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, 0, NULL);
if (drive == INVALID_HANDLE_VALUE) {
            // Someone is playing tricks. Or not enough privileges.
            CloseHandle(drive);
            return FALSE;
}
result = DeviceIoControl(drive, IOCTL_DISK_GET_LENGTH_INFO, NULL, 0, &size,
         sizeof(GET_LENGTH_INFORMATION), &lpBytesReturned, NULL);
CloseHandle(drive);
if (result != 0) {
	if (size.Length.QuadPart / 1073741824 <= 60) /* <= 60 GB */
		return 0;
}
```

## Free Space

```

```

## Used Space

```

```

---
## References

### Backlinks

- [[03 - Malware Development/Techniques/Enumeration/Windows/System/Storage Space]]

### TrustedSec

- [TrustedSec: Enumerating Anti-Sandboxing Techniques](https://trustedsec.com/blog/enumerating-anti-sandboxing-techniques)