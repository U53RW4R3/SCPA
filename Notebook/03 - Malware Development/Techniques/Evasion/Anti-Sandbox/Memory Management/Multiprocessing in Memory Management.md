# Multiprocessing in Memory Management

## Non Uniform Memory Access

### C

```c
#include <windows.h>

int main() {
	LPVOID memory = NULL;
	memory = VirtualAllocExNuma(GetCurrentProcess(), NULL, 1000, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE, 0);

	if (memory != NULL) {
		// execute payload here
	}
	return 0;
}
```

### C\#

```cs
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Runtime.InteropServices;
using System.Net;

namespace MemoryManagement {
    class Runner {
        [DllImport("kernel32.dll")]
        static extern IntPtr GetCurrentProcess();

        [DllImport("kernel32.dll")]
        static extern IntPtr VirtualAllocExNuma(
            IntPtr hProcess,
            IntPtr lpAddress,
            uint dwSize,
            UInt32
            flAllocationType,
            UInt32 flProtect,
            UInt32 nndPreferred
            );

        static void Main(string[] args)
        {
            IntPtr memory = VirtualAllocExNuma(GetCurrentProcess(), IntPtr.Zero, 0x1000, 0x3000, 0x4, 0);
            if (memory != null) {
	            // Execute payload here
            }
            return;   
        }
    }
}
```

## Fiber Local Storage

### C

```c
int main() {
	DWORD result = FlsAlloc(NULL);
	if (result != FLS_OUT_OF_INDEXES) {
		// execute payload here
	}
	return 0;
}
```

### C\#

```cs
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Runtime.InteropServices;
using System.Net;

namespace FiberAllocation {
    class Runner {
        [DllImport("kernel32.dll")]
        static extern UInt32 FlsAlloc(IntPtr lpCallback);

        static void Main(string[] args) {
            UInt32 result = FlsAlloc(IntPtr.Zero); 
            if (result != 0xFFFFFFFF) {
                // execute payload here
            }
            return;
        }
    }
}
```

---
## References

### Source Repositories

- [cinzinga: Evasion-Practice](https://github.com/cinzinga/Evasion-Practice)