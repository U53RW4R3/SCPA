# PowerShell

## 01 - `ShowWindow`

First variant.

```powershell
$WinAPI = @"
public static void ShowConsoleWindow(int state) {
    var handle_window = GetConsoleWindow();
    ShowWindow(handle_window, state);
}
[DllImport("kernel32.dll")]
public static extern IntPtr GetConsoleWindow();

[DllImport("user32.dll")]
public static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);
"@
$hideconsole = Add-Type -MemberDefinition $WinAPI -Name Hide -Namespace HideConsole -ReferencedAssemblies System.Runtime.InteropServices -PassThru
$hideconsole::ShowConsoleWindow(0)
```

Second variant.

```powershell
$hideconsole = @"
[DllImport("user32.dll")]
public static extern bool ShowWindow(int handle, int state);
"@

Add-Type -MemberDefinition $hideconsole -Name Win -Namespace Native
[Native.Win]::ShowWindow(([System.Diagnostics.Process]::GetCurrentProcess() | Get-Process).MainWindowHandle, 0)
```

Third variant.

```powershell
$hideconsole = '[DllImport("user32.dll")] public static extern bool ShowWindow(int handle, int state);'

Add-Type -MemberDefinition $hideconsole -Name Win -Namespace Native

$ShowWindow = "ShowWindow"
$GetCurrentProcess = "GetCurrentProcess"

$Process = [System.Diagnostics.Process]::$GetCurrentProcess
$WindowHandle = ($Process.Invoke() | Get-Process).MainWindowHandle
[Native.Win]::$ShowWindow.Invoke($WindowHandle, 0)
```

Fourth variant.

```powershell
Add-Type @'
using System;
using System.Runtime.InteropServices;

public class WinAPI {

    public enum SW : int {
        Hide            = 0,
        Normal          = 1,
        ShowMinimized   = 2,
        Maximize        = 3,
        ShowNoActivate  = 4,
        Show            = 5,
        Minimize        = 6,
        ShowMinNoActive = 7,
        ShowNA          = 8,
        Restore         = 9,
        Showdefault     = 10,
        Forceminimize   = 11
    }

    [DllImport("user32.dll")]
    public static extern int ShowWindow(IntPtr hWnd, SW nCmdShow);
}
'@

$ThisWindow = [System.Diagnostics.Process]::GetCurrentProcess().MainwindowHandle
[WinAPI]::ShowWindow($ThisWindow, 'Hide')
```

## 02 - `ShowWindowAsync`

```powershell
Add-Type @"
    using System;
    using System.Runtime.InteropServices;
    public class WinAPI {
        [DllImport("user32.dll")]
        public static extern bool ShowWindowAsync(IntPtr hWnd, int nCmdShow);
        [DllImport("kernel32.dll")]
        public static extern IntPtr GetConsoleWindow();
    }
"@

$handle_window = [WinAPI]::GetConsoleWindow()
[WinAPI]::ShowWindowAsync($handle_window, 0)
```

## 03 - `FreeConsole`

```powershell
Add-Type @"
    using System;
    using System.Runtime.InteropServices;
    public class WinAPI {
        [DllImport("kernel32.dll")]
        public static extern bool FreeConsole();
    }
"@

[WinAPI]::FreeConsole()
```

---
## References

### Tenouk

- [Tenouk: Windows Process & Threads - A Supplementary Note](https://www.tenouk.com/chijklsupp.html)

### Rob van der Woude

- [Rob van der Woude: PowerShell Code Snippets](https://www.robvanderwoude.com/powershellsnippets.php)

### Cyble

- [Cyble: Bumblebee Returns with New Infection Technique](https://blog.cyble.com/2022/09/07/bumblebee-returns-with-new-infection-technique/)