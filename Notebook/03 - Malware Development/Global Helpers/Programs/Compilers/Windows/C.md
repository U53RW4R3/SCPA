# C

Search Tag(s): #helpers #command-line #compiler #windows

## 01 - MinGW

Setup the MinGW toolchain.

```
$ wget https://musl.cc/x86_64-w64-mingw32-cross.tgz && \
sudo tar xzf x86_64-w64-mingw32-cross.tgz -C /usr/local/ && \
echo "export PATH=\$PATH:/usr/local/x86_64-w64-mingw32-cross/bin" >> ~/.bashrc && \
source ~/.bashrc
```

Compile Windows binaries in Linux

```
$ i686-w64-mingw32-gcc implant.c -o implant_x86.exe

$ x86_64-w64-mingw32-gcc implant.c -o implant.exe
```

Compile Windows binaries in Linux with icons

```
$ x86_64-w64-mingw32-windres resource.rc resource.o

$ x86_64-w64-mingw32-gcc -o implant.exe resource.o implant.c
```

Compile Windows Dynamic Linked Library in Linux

```
$ i686-w64-mingw32-gcc implant-x86.c -shared -o implant-x86.dll

$ x86_64-w64-mingw32-gcc implant-x86_64.c -shared -o implant-x86_64.dll
```

## 02 - Clang

### 2.1 - Package Manager

```
$ sudo apt install -y clang
```

Compile Windows binaries in Linux

```
$ clang -target x86_64-pc-windows-gnu -o implant.exe implant.c
```

### 2.2 - Compile Source Code

Setup the `clang` toolchain.

```
$ git clone --depth 1 https://github.com/tpoechtrager/wclang.git && \
cd wclang && cmake -DCMAKE_INSTALL_PREFIX=/usr/local/wclang/ . && \
echo "export PATH=\$PATH:/usr/local/wclang/bin" >> ~/.bashrc && \
make && sudo make install
```

Compile Windows binaries in Linux

```
$ x86_64-w64-mingw32-clang -o implant.exe implant.c
```

## 03 - Zig

Compile Windows binaries in Linux

```
$ zig cc --target=x86_64-windows-gnu -static implant.c -o implant.exe
```

## 04 - CL

### 4.1 - Native

Compile Windows binaries

```
C:\> cl.exe /W4 /EHsc implant.c /link /out:implant.exe
```

Compile Windows Dynamic Linked Library

TODO: Fill this info

```
C:\>
```

Compile Windows binaries with icons

```
C:\> rc resource.rc

C:\> cvtres /machine:x64 /out:resource.o resource.res

C:\> cl.exe /nologo /0x /W0 /GS- /DNDEBUG /Tcimplant.c /link /out:implant.exe /subsystem:console /machine:x64 resource.o
```

### 4.2 - Wine

Install required dependencies.

```
$ sudo apt install -y wine64 python3 msitools ca-certificates winbind
```

Clone the repository.

```
$ git clone https://github.com/mstorsjo/msvc-wine 
```

---
## References

### Toolchains

- [musl.cc](https://musl.cc/)

- [Mingw-64 Toolchain (bleeding edge)](https://sourceforge.net/p/mingw-w64/)

- [tpoechtrager: WClang](https://github.com/tpoechtrager/wclang)

- [dryzig: Zig Debian](https://github.com/dryzig/zig-debian)

- [Cross-compiling with musl Toolchains](https://ariya.io/2020/06/cross-compiling-with-musl-toolchains)

### Compiling Guides

- [Malicious.link: Compiling a DLL using MingGW](https://room362.com/posts/2020/compiling-a-dll-using-mingw/)

- [EDR and Blending In: How Attackers Avoid Getting Caught](https://www.optiv.com/insights/source-zero/blog/edr-and-blending-how-attackers-avoid-getting-caught)

- [Didier Stevens: Quickpost Compiling EXEs and Resources with Mingw on Kali](https://blog.didierstevens.com/2018/09/17/quickpost-compiling-exes-and-resources-with-mingw-on-kali/)

- [Zig C Compiler Powerful Drop in Replacment GCC Clang](https://andrewkelley.me/post/zig-cc-powerful-drop-in-replacement-gcc-clang.html)

### Install MSVC

- [Hackernoon: A C++ Hello World And A Glass Of Wine, Oh My !](https://medium.com/hackernoon/a-c-hello-world-and-a-glass-of-wine-oh-my-263434c0b8ad)

- [Dan Kegel's Web Hostel: Using Microsoft C++ Toolkit on Linux](http://kegel.com/wine/cl-howto.html)