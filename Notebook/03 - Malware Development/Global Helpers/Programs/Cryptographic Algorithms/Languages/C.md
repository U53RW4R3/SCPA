# C

## XOR

### XOR Repeater

```c
#include <stdio.h>
#include <string.h>

void XOR(unsigned char *data, int data_length, char *key, int key_length) {
	int j = 0;
	
	for(int i = 0; i < data_length - 1; i++) {
		if(j == key_length - 1) j = 0;
		
		data[i] ^= key[j];
		j++;
  }
}

int main() {
	unsigned char shellcode[] = "";
	char key[] = "";

	XOR((char*) shellcode, sizeof(shellcode), key, sizeof(key));
	for(int i = 0; i < buf_length; i++) {
		printf("\\x%02x", buf[i]);
	}

	return 0;
}
```

## RC4

TODO: Fill this info

## AES

### Tiny AES

```c
#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include "aes.h"

#define KEYSIZE 32
#define IVSIZE 16

void generateKey(unsigned char *key) {
	for(int i = 0; i < KEYSIZE; ++i)
		key[i] = (unsigned char)rand() % 256;
}

void generateIV(unsigned char *iv) {
	for(int i = 0; i < IVSIZE; ++i)
		iv[i] = (unsigned char)rand() % 256;
}

void addPadding(unsigned char *data, size_t length) {
	unsigned char paddingValue = 16 - (length % 16);
	for(size_t i = length; i < length + paddingValue; ++i)
		data[i] = paddingValue;
}

int main() {
	unsigned char plaintext[] = "";

	struct AES_ctx ctx;

	addPadding(plaintext, sizeof(plaintext));

	unsigned char pKEY[KEYSIZE];
	unsigned char pIV[IVSIZE];

	srand((unsigned int)time(NULL));
	generateKey(pKEY);

	srand((unsigned int)time(NULL) ^ pKEY[0]);
	generateIV(pIV);

	printf("Generate Key: ");
	for(int i = 0; i < KEYSIZE; ++i) {
		printf("\\x%02x", pKEY[i]);
	}
	printf("\n");
	
	printf("Generate IV: ");
	for(int i = 0; i < IVSIZE; ++i) {
		printf("\\x%02x", pIV[i]);
	}
	printf("\n");

	AES_init_ctx_iv(&ctx, pKEY, pIV);
	AES_CBC_encrypt_buffer(&ctx, plaintext, sizeof(plaintext));
	printf("Ciphertext Size: %zu\n", sizeof(plaintext));
	for(int i = 0; i < sizeof(plaintext); ++i) {
		printf("\\x%02x", plaintext[i]);
	}

	return 0;
}
```

---
## References

- [[XOR Repeater|Cryptography: XOR Repeater]]

- [[RC4|Cryptography: RC4]]

### Github

- [Rapid7: XOR header file](https://github.com/rapid7/metasploit-framework/blob/master/data/headers/windows/xor.h)

- [Rapid7: RC4 header file](https://github.com/rapid7/metasploit-framework/blob/master/data/headers/windows/rc4.h)

- [Tiny AES in C](https://github.com/kokke/tiny-AES-c)