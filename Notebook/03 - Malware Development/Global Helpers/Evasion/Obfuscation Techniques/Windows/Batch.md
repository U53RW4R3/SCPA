---
author(s):
  - Userware
tags:
  - helpers
  - malware-development
  - defense-evasion
---
# Batch

TODO: Fill this info

## 01 - Command Aliases

| Commands         | Aliases      |
| ---------------- | ------------ |
| `cd`             | `chdir`      |
| `dir`            |              |
| `type`           | `more`       |
| `copy`           | `xcopy`      |
| `type nul`       | `copy nul`   |
| `mv`             | `move`       |
| `ren`            | `rename`     |
| `del`            | `erase`      |
| `md`             | `mkdir`      |
| `rd`             | `rmdir`      |
| `whoami.exe`     |              |
| `cls`            |              |
| `doskey.exe`     |              |
| `echo`           |              |
| `tasklist.exe`   |              |
| `taskkill.exe`   | `tskill.exe` |
| `findstr.exe`    |              |
| `find.exe`       |              |
| `systeminfo.exe` |              |
| `ipconfig.exe`   |              |
| `route.exe`      |              |
| `arp.exe`        |              |
| `ping.exe`       |              |
| `tracert.exe`    |              |
| `nslookup.exe`   |              |
| `nslookup.exe`   |              |
| `CertUtil.exe`   |              |
| `bitsadmin.exe`  |              |
| `curl.exe`       |              |
| `net.exe`        | `net1.exe`   |

## 02 - Environment Variables

TODO: Fill in the descriptions for the rest of the environment names.

| Environment Variable                           | Output                                                                                                                                                                                          | Equivalent Command | Description                                     |
| ---------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ | ----------------------------------------------- |
| `%ALLUSERSPROFILE%`, `%PROGRAMDATA%`           | `C:\ProgramData`                                                                                                                                                                                | None               |                                                 |
| `%APPDATA%`                                    | `C:\Users\<username>\AppData\Roaming`                                                                                                                                                           | None               |                                                 |
| `%CD%`                                         | Prints out the current working directory.                                                                                                                                                       | `pwd`              | Variable name of the current working directory. |
| `%CMDCMDLINE%`                                 | Returns exact command line used to start current `cmd.exe` session.                                                                                                                             | None               |                                                 |
| `%CMDEXTVERSION%`                              | Number of current command processor extensions.                                                                                                                                                 | None               |                                                 |
| `%COMMONPROGRAMFILES%`, `%CommonProgramW6432%` | `C:\Program Files\Common Files`                                                                                                                                                                 | None               |                                                 |
| `%COMMONPROGRAMFILES(x86)%`                    | `C:\Program Files (x86)\Common Files`                                                                                                                                                           | None               |                                                 |
| `%COMPUTERNAME%`                               | `<hostname>`                                                                                                                                                                                    | `hostname`         | Variable name of the computer name.             |
| `%COMSPEC%`                                    | `C:\Windows\System32\cmd.exe`                                                                                                                                                                   | None               | Variable name of the command prompt.            |
| `%DATE%`                                       | Prints out the current date.                                                                                                                                                                    | `date`             |                                                 |
| `%TIME%`                                       | Prints out the current time format.                                                                                                                                                             | `net.exe time`     |                                                 |
| `%ERRORLEVEL%`                                 | Number defining exit status of previous command or program.                                                                                                                                     |                    |                                                 |
| `%HOMEDRIVE%`                                  | `C:\`                                                                                                                                                                                           |                    |                                                 |
| `%HOMEPATH%`                                   | `C:\Users\<username>`                                                                                                                                                                           |                    |                                                 |
| `%LOCALAPPDATA%`                               | `C:\Users\<username>\AppData\Local`                                                                                                                                                             |                    |                                                 |
| `%LOGONSERVER%`                                | `\\<domain_logon_server>`                                                                                                                                                                       |                    |                                                 |
| `%NUMBER_OF_PROCESSORS%`                       | Prints out the number of processors.                                                                                                                                                            | TODO: check `wmic` | Variable name contains a number of processors.  |
| `%OS%`                                         | `Windows_NT`                                                                                                                                                                                    | None               |                                                 |
| `%PATH%`                                       | `C:\Windows`, `C:\Windows\System32`, `C:\Windows\System32\Wbem`, and `%SYSTEMROOT%\System32\WindowsPowerShell\v1.0\Modules\`                                                                    | None               |                                                 |
| `%PATHEXT%`                                    | `.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC`                                                                                                                                         | `assoc`            |                                                 |
| `%PROCESSOR_ARCHITECTURE%`                     | Prints out the architecture.                                                                                                                                                                    | None               |                                                 |
| `%PROCESSOR_IDENTIFIER%`                       | Prints out process identifier.                                                                                                                                                                  | None               |                                                 |
| `%PROCESSOR_LEVEL%`                            | Prints out the process level.                                                                                                                                                                   | None               |                                                 |
| `%PROCESSOR_REVISION%`                         | Prints out the processor revision.                                                                                                                                                              | None               |                                                 |
| `%PROGRAMFILES%`, `%PROGRAMW6432%`             | `C:\Program Files`                                                                                                                                                                              | None               |                                                 |
| `%PROGRAMFILES(X86)%`                          | `C:\Program Files (x86)`                                                                                                                                                                        | None               |                                                 |
| `%PROMPT%`                                     | Code for current command prompt format. Code is usually `$P$G`                                                                                                                                  | None               |                                                 |
| `%SYSTEMDRIVE%`                                | `C:`                                                                                                                                                                                            | None               |                                                 |
| `%SYSTEMROOT%`, `%WINDIR%`                     | `C:\Windows`                                                                                                                                                                                    | None               |                                                 |
| `%SYSTEMDIRECTORY%`                            | `C:\Windows\System32`                                                                                                                                                                           | None               |                                                 |
| `%TEMP%`, `%TMP%`                              | `C:\Users\<username>\AppData\Local\Temp`                                                                                                                                                        | None               |                                                 |
| `%USERDOMAIN%`                                 | `<userdomain>`                                                                                                                                                                                  | `whoami.exe /fqdn` |                                                 |
| `%USERNAME%`                                   | `<username>`                                                                                                                                                                                    | `whoami.exe`       |                                                 |
| `%USERPROFILE%`                                | `C:\Users\<username>`                                                                                                                                                                           | None               |                                                 |
| `%PUBLIC%`                                     | `C:\Users\Public`                                                                                                                                                                               | None               |                                                 |
| `%PSMODULEPATH%`                               | `%SYSTEMROOT%\System32\WindowsPowerShell\v1.0\Modules\`                                                                                                                                         | None               |                                                 |
| `%RANDOM%`                                     | To get random number between from `0` to `32767`.                                                                                                                                               |                    |                                                 |
| `%SESSIONNAME%`                                | When logging on directly to machine, returns "Console". When client connects via terminal server session, is combination of connection name, followed by pound symbol (`#`) and session number. |                    |                                                 |

## 03 - String Manipulation

### Remove Extension

Just remove `.exe` to execute the command.

```
cmd

powershell
```

### Shorten Flags

```
powershell.exe -e <base64_encoded>
powershell.exe -ec <base64_encoded>
powershell.exe -en <base64_encoded>
powershell.exe -enc <base64_encoded>
powershell.exe -enco <base64_encoded>
powershell.exe -encod <base64_encoded>
powershell.exe -encode <base64_encoded>
powershell.exe -encoded <base64_encoded>
powershell.exe -encodedc <base64_encoded>
powershell.exe -encodedco <base64_encoded>
powershell.exe -encodedcom <base64_encoded>
powershell.exe -encodedcomm <base64_encoded>
powershell.exe -encodedcomma <base64_encoded>
powershell.exe -encodedcomman <base64_encoded>
powershell.exe -encodedcommand <base64_encoded>
```

### Case Insensitive

```
pOweRsHeLl.eXE
```

### Concatenation

```batch
"pow" & "er" & "shell.exe"
```

## Regular Expression

### Wildcards

Using the asterisk (`*`) as a placeholder to interpret whatever character will from the start to the end.

```
dir C:\*indows
```

### Character Substitution

```
dir C:\?indo?s
```

---
## References

### r00t-3xp10it

- [r00t-3xp10it: Simple Obfuscation](https://github.com/r00t-3xp10it/hacking-material-books/blob/master/obfuscation/simple_obfuscation.md)

### Bordergate

- [Bordergate: Obfuscating Command Line Arguments](https://www.bordergate.co.uk/obfuscating-command-line-arguments/)

### Jeffrey Bencteux

- [Jeffrey Bencteux: File Types](https://www.bencteux.fr/posts/filetypes/)

### Rob van der Woude

- [Rob van der Woude: Useful commands for Windows administrators](https://www.robvanderwoude.com/ntadmincommands.php)