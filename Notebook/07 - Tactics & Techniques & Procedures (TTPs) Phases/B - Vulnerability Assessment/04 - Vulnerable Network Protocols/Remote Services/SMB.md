# SMB

## 01 - Anonymous Login

### 1.1 - Manual

#### 1.1.1 - Samba Suite Utils

```
$ smbclient -N -L //<IP>

$ smbclient -u "%" -L //<IP>

$ smbclient -u "guest%" -L //<IP>

$ smbclient -N -L //<IP> -mSMB2

$ smbclient -N -L //<IP> -mSMB3
```

#### 1.1.2 - Impacket

```
$ smbclient.py -no-pass [<domain>/]''@<IP>

$ smbclient.py -no-pass [<domain>/]guest@<IP>
```

#### 1.1.3 - SMBMap

```
$ smbmap -u "" -p "" -H <IP> [-P <PORT>]

$ smbmap -u "guest" -p "" -H <IP> [-P <PORT>]
```

#### 1.1.4 - Enum4Linux

```
$ enum4linux-ng -A -u "" -p "" <IP>

$ enum4linux-ng -A -u "guest" -p "" <IP>
```

#### 1.1.5 - NetExec

```
$ netexec smb <IP>/<CIDR> [-d <domain> | --local-auth] --shares

$ netexec smb <IP>/<CIDR> -u "guest" -p "" [-d <domain> | --local-auth] --shares
```

### 1.2 - Automated

#### 1.2.1 - Network Mapper

```
$ nmap -p 445 -Pn -n --script smb-os-discovery,smb-enum-shares,smb-enum-domains <IP>

$ nmap -p 445 -Pn -n --script smb-os-discovery,smb-enum-shares,smb-enum-domains -iL ip_targets.txt
```

#### 1.2.2 - Nuclei

```
$ nuclei -l ip_targets.txt -t ~/nuclei-templates -id smb-anonymous-access
```

## 02 - RCE

### 2.1 - EternalBlue

#### 2.1.1 - Network Mapper

```
$ nmap -p 445 -Pn -n --script smb-vuln-ms17-010 <IP>

$ nmap -p 445 -Pn -n --script smb-vuln-ms17-010 -iL ip_targets.txt
```

#### 2.1.2 - Metasploit

```
msf > use auxiliary/scanner/smb/smb_ms17_010

msf auxiliary(scanner/smb/smb_ms17_010) > options

Module options (auxiliary/scanner/smb/smb_ms17_010):

   Name         Current Setting                                              Required  Description
   ----         ---------------                                              --------  -----------
   CHECK_ARCH   true                                                         no        Check for architecture on vulnerable hosts
   CHECK_DOPU   true                                                         no        Check for DOUBLEPULSAR on vulnerable hosts
   CHECK_PIPE   false                                                        no        Check for named pipe on vulnerable hosts
   NAMED_PIPES  /usr/share/metasploit-framework/data/wordlists/named_pipes.  yes       List of named pipes to check
                txt
   RHOSTS                                                                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT        445                                                          yes       The SMB service port (TCP)
   SMBDomain    .                                                            no        The Windows domain to use for authentication
   SMBPass                                                                   no        The password for the specified username
   SMBUser                                                                   no        The username to authenticate as
   THREADS      1                                                            yes       The number of concurrent threads (max one per host)


View the full module info with the info, or info -d command.

msf auxiliary(scanner/smb/smb_ms17_010) > set check_arch <true | false>

msf auxiliary(scanner/smb/smb_ms17_010) > set check_dopu <true | false>

msf auxiliary(scanner/smb/smb_ms17_010) > set check_pipe [true | false]

msf auxiliary(scanner/smb/smb_ms17_010) > set threads 4

msf auxiliary(scanner/smb/smb_ms17_010) > set rhosts <<IP/<CIDR> | file:/path/to/ip_targets.txt>

msf auxiliary(scanner/smb/smb_ms17_010) > run
```

---
## References

- [Enum4Linux-NG](https://github.com/cddmp/enum4linux-ng)