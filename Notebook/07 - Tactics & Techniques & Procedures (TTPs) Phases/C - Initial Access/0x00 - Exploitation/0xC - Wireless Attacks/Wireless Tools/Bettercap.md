# Bettercap

TODO: Provide a usage coverage for wireless attacks using bettercap

New method 2019: PMKID, client-less and only ONE packet! No de-auth required. 4-way handshake that can be captured and cracked. When a client connects to the AP, there is a 4-way handshake where the pre-shared key (PSK) is transferred from the client machine to the AP. We can capture that PSK hash and then use a dictionary or brute-force attack against it. This can be time-consuming and is not always successful. Success is dependent upon the wordlist you use and the time you have to crack it. Once you have the hash of the PSK captured, you don't need to be connected to the AP. With enough resources, you can brute-force any PSK.

It turns out that a lot of modern routers append an optional field at the end of the first EAPOL frame sent by the AP itself when someone is associating, the so called Robust Security Network, which includes something called PMKID.

the PMKID is derived by using data which is known to us:
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)

Since the “PMK Name” string is constant, we know both the BSSID of the AP and the station and the PMK is the same one obtained from a full 4-way handshake, this is all hashcat needs in order to crack the PSK and recover the passphrase!

This can be done in bettercap or possibly other tools

```
$ sudo bettercap -iface wlan0
wifi.recon on
set wifi.show.sort clients desc
set ticker.commands 'clear; wifi.show'
ticker on
```

Now you'll be able to see a bunch of SSIDs that are being broadcast. 

Pick a channel of an SSID you want to attack:

```
wifi.recon.channel 1
```

Send association request to every AP and see who'll respond with useful information:

```
wifi.assoc all
```

All nearby vulnerable routers will start sending their PMKID, which bettercap will dump to the usual pcap file

PMKID Cracking

Convert the PMKID data to a hash format for hashcap with `hcxpcaptool`:

```
hcxpcaptool -z bettercap-wifi-handshakes.pmkid /root/bettercap-wifi-handshakes.pcap
```

Now crack using hashcap 16800:

```
hashcat -m 16800 -a 3 -w 3 bettercap-wifi-handshakes.pmkid '?d?d?d?d?d?d?d?d'
```


https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/#.XGUsG5SMxYE.reddit
https://hashcat.net/forum/thread-7717.html