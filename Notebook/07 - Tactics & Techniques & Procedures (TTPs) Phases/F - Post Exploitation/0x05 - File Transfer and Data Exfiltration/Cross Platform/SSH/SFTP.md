# SFTP

Search Tag(s): #post-exploitation #file-transfer-and-data-exfiltration #ssh #linux

## 01 - Setup

### 1.1 - Hardening

```
$ export username=<USERNAME>

sudo groupadd sftp

sudo mkdir -p /data/$username/uploads

sudo useradd -g sftp -s /bin/false -M $username

sudo passwd $username

sudo chown $user:sftp /data/$username/uploads

$ sudo chmod 755 /data/$username
```

```
$ cat /etc/ssh/sshd_config
..[omitted]..
# AllowGroups sftp

# Subsystem     sftp    /usr/libexec/openssh/sftp-server
Subsystem       sftp    internal-sftp

Match User <USERNAME>
	ForceCommand internal-sftp
	PasswordAuthentication yes
	# PubkeyAuthentication no
	ChrootDirectory /data/<USERNAME>
	AllowAgentForwarding no
	AllowTcpForwarding no
	X11Forwarding no
```

Restart SSH server.

```
$ sudo systemctl restart sshd
```

### 1.2 - Usage

```
$ sftp [-P <PORT>] <username>@<IP>
```