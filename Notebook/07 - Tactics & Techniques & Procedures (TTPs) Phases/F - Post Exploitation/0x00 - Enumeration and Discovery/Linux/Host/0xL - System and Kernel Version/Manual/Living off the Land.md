---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - living-off-the-land
  - linux
---
# Living off the Land

## 01 - Window Display Server

> [!NOTE] `$DISPLAY` environment
> - `:0` means `x11`
> - `:1` means `wayland`

```
$ loginctl show-session $(loginctl | grep $USER | awk '{print $1}') -p Type

$ echo $DISPLAY

$ echo $XDG_SESSION_TYPE
```

## 02 - Desktop Environment

```
$ echo $DESKTOP_SESSION
```

## 03 - Operating System

### 3.1 - Distro Variant

Universal distro enumeration.

```
$ cat /etc/issue

$ cat /etc/os-release

$ cat /usr/lib/os-release

$ cat /etc/lsb-release

$ cat /etc/*-release
```

Debian distro.

```
$ cat /etc/debian_release

$ cat /etc/debian_version
```

Redhat distro.

```
$ cat /etc/redhat-release

$ cat /etc/redhat_version
```

Fedora distro

```
$ cat /etc/fedora-release
```

SUSE distro.

```
$ cat /etc/SUSE-release
```

Arch Linux distro.

```
$ cat /etc/arch-release
```

Gentoo distro.

```
$ cat /etc/gentoo-release
```

### 3.2 - Locale

```
$ locale

$ localectl status

$ echo $LANG

$ echo $LANGUAGE

$ cat /etc/default/locale
```

### 3.3 - Kernel

```
$ uname -a

$ uname -mrs

$ lsb_release -a

$ hostnamectl status

$ dmesg | grep Linux

$ ls /boot | grep vmlinuz

$ cat /proc/version
```

```
$ rpm -q kernel
```

Architecture type.

```
$ arch
```

List of drivers.

```
$ lsmod
```

Looking for kernel modules and to enumerate the version number

```
$ modinfo <module_name>
```

## 04 - Hardware

### 4.1 - Time

Check the current locale date.

```
$ date

$ date +%c
```

Check the formatted current date.

```
$ date +%F

$ date "+%m-%Y"

$ date +%D

$ date "+%b %a"

$ date "+%B %A"
```

Day, year and month

```
$ date "+Day: %u Month: %m Year: %Y"

$ date "+Day: %u Month: %m Year: %C%y"
```

Convert the current date into the day of the year.

```
$ date +%j
```

Convert the current date into the day of the month.

```
$ date +%_d

$ date +%e
```

Local time date.

```
$ date +%T

$ date +%H:%M:%S
```

PM and AM time date format.

```
$ date +%X

$ date "+%I:%M:%S %p"
```

Check the duration of how long the system was running.

```
$ uptime

$ uptime -p

$ uptime -s

$ cat /proc/uptime
```

Idle time user activity.

```
$ w [username]

$ pinky [-l <username>]
```

### 4.2 - Storage

```
$ df -h

$ df -aH

$ dmesg | grep -E sd.{1}

$ sudo fdisk -l

$ sudo fdisk -l | grep -B 1 "Disk model"

$ ls /dev/ 2>/dev/null

$ ls /dev/ 2>/dev/null | grep -i "sd"
```

### 4.3 - Mounted Drives

Looking for mount drives with credentials or we can mount on to further move laterally.

```
$ findmnt -s

$ cat /etc/fstab

$ sed 's/#.*//' /etc/fstab | column -t -N SOURCE,TARGET,TYPE,OPTIONS,PASS,FREQ -R PASS,FREQ

$ grep -v "^#" /etc/fstab | grep -Pv "\W*\#" 2>/dev/null

$ mount [-l]

$ mount [-l] | column -t

$ cat /proc/mounts

$ cat /proc/self/mounts

$ cat /proc/1/mounts

$ cat /proc/self/mountinfo

$ cat /proc/1/mountinfo
```

List mounted drives that is connected to the Linux system.

```
$ lsblk

$ sudo blockdev --report
```

### 4.4 - Mounted CD/DVD Tray

List default device name.

```
$ eject -d
```

More information of the command execution.

```
$ eject -v
```

### 4.5 - Network Interfaces

```
$ ip -o link show | awk -F ": " '{print $2}'

$ grep -Eo "[a-z0-9]+:" /proc/net/dev | cut -d ":" -f 1

$ cut -d ":" -f 1 < /proc/net/dev | tail -n +3 | sort -u | sed -e 's/[ \t]*//'
```

### 4.6 - MAC Address

Show current network interface's MAC address

```
$ ip link show <interface> | grep -Eo "..:..:..:..:..:.."

$ ip link show <interface> | grep -Eo ..\(\:..\){5}

$ ip link show <interface> | grep -Eo '([[:xdigit:]]{1,2}:){5}[[:xdigit:]]{1,2}'

$ ip link show <interface> | awk '/ether/ {print $2}'

$ ethtool -P <interface> | awk '{print $NF}'

$ ifconfig <interface> | grep -Eo ..\(\:..\){5}

$ cat /sys/class/net/<interface>/address
```

List all MAC addresses of network interfaces.

```
$ ifconfig -a | grep -Eo "..:..:..:..:..:.."

$ ifconfig -a | grep -Eo '([[:xdigit:]]{1,2}:){5}[[:xdigit:]]{1,2}'

$ LANG=C ip link show | awk '/link\/ether/ {print $2}'

$ cat /sys/class/net/*/address
```

### 4.7 - Motherboard

```
$ cat /sys/class/dmi/id/board_vendor
```

### 4.8 - RAM

Memory size in bytes,

```
$ free -b
```

Memory size in kilobytes,

```
$ free -k

$ vmstat -s

$ grep "MemTotal\|MemFree\|MemAvailable" /proc/meminfo
```

Memory size in megabytes,

```
$ free -m
```

Memory size in gigabytes.

```
$ free -g
```

TODO: This is for scraping credentials but check if it works or not.

```
$ sudo grep -i PASS /dev/mem
```

### 4.9 - CPU

#### 4.9.1 - Overview

```
$ lscpu

$ cat /proc/cpuinfo
```

#### 4.9.2 - Processors

Physical cores

```
$ grep -m 1 "cores" /proc/cpuinfo | tr -d '[a-z]:[:space:]'
```

Logical cores

```
$ lscpu | grep '^CPU(s):' | awk '{print $2}'

$ lscpu | grep '^CPU(s):' | tr -d "[:blank:]" | cut -d ":" -f 2

$ lscpu | grep '^CPU(s):' | tr -d "[:space:]" | cut -d ":" -f 2

$ grep -c "processor" /proc/cpuinfo

$ grep -c "cores" /proc/cpuinfo

$ grep "model name" /proc/cpuinfo | wc -l

$ grep -c "cpu" /proc/schedstat

$ grep -cE "cpu[0-9]+" /proc/stat
```

TODO: check these

```
$ head -n 1 /proc/interrupts

$ grep "CPU" /proc/interrupts
```

---
## References

- [Hacktricks: Privilege Escalation Drives](https://book.hacktricks.xyz/linux-unix/privilege-escalation#drives)

- [Hacktricks: Privilege Escalation /dev/mem](https://book.hacktricks.xyz/linux-hardening/privilege-escalation#dev-mem)