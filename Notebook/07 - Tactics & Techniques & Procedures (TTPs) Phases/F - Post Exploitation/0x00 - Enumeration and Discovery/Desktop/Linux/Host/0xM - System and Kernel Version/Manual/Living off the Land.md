---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - living-off-the-land
  - linux
---
# Living off the Land

## 01 - Window Display Server

> [!NOTE] `$DISPLAY` environment
> - `:0` means `x11`
> - `:1` means `wayland`

```
$ loginctl show-session $(loginctl | grep $USER | awk '{print $1}') -p Type

$ echo $DISPLAY

$ echo $XDG_SESSION_TYPE
```

## 02 - Desktop Environment

```
$ echo $DESKTOP_SESSION
```

## 03 - Operating System

### 3.1 - Distro Variant

Universal distro enumeration.

```
$ cat /etc/issue

$ cat /etc/issue.net

$ cat /etc/os-release

$ cat /usr/lib/os-release

$ cat /etc/lsb-release

$ cat /etc/*-release
```

Debian distro.

```
$ cat /etc/debian_release

$ cat /etc/debian_version
```

Redhat distro.

```
$ cat /etc/redhat-release

$ cat /etc/redhat_version
```

Fedora distro

```
$ cat /etc/fedora-release
```

SUSE distro.

```
$ cat /etc/SUSE-release
```

Arch Linux distro.

```
$ cat /etc/arch-release
```

Gentoo distro.

```
$ cat /etc/gentoo-release
```

### 3.2 - Locale

```
$ locale

$ localectl status

$ echo $LANG

$ echo $LANGUAGE

$ cat /etc/default/locale
```

### 3.3 - Kernel

```
$ uname -a

$ uname -mrs

$ lsb_release -a

$ hostnamectl status

$ dmesg | grep Linux

$ rpm -q kernel

$ ls /boot | grep vmlinuz

$ cat /proc/version
```

List of drivers.

```
$ lsmod
```

Looking for kernel modules and to enumerate the version number

```
$ modinfo <module_name>
```

## 04 - Hardware

### 4.1 - Date and Time

Check the current locale date.

```
$ date

$ date +%c

$ timedatectl
```

Check the formatted current date.

```
$ date +%F

$ date "+%m-%Y"

$ date +%D

$ date "+%b %a"

$ date "+%B %A"
```

Day, year and month

```
$ date "+Day: %u Month: %m Year: %Y"

$ date "+Day: %u Month: %m Year: %C%y"
```

Convert the current date into the day of the year.

```
$ date +%j
```

Convert the current date into the day of the month.

```
$ date +%_d

$ date +%e
```

Local time date.

```
$ date +%T

$ date +%H:%M:%S
```

PM and AM time date format.

```
$ date +%X

$ date "+%I:%M:%S %p"
```

Check the duration of how long the system was running.

```
$ uptime

$ uptime -p

$ uptime -s

$ cat /proc/uptime
```

Idle time user activity.

```
$ w [username]

$ pinky [-l <username>]
```

### 4.2 - Storage

```
$ df -h

$ df -aH

$ du -hd 0 / 2>/dev/null

$ dmesg | grep -E sd.{1}

$ sudo fdisk -l

$ sudo fdisk -l | grep -B 1 "Disk model"

$ ls /dev/ 2>/dev/null

$ ls /dev/ 2>/dev/null | grep -i "sd"
```

### 4.3 - Mounted Drives

^017cc1

Looking for mount drives with credentials or we can mount on to further move laterally.

```
$ findmnt -s

$ cat /etc/fstab

$ cat /etc/mtab

$ sed 's/#.*//' /etc/fstab | column -t -N SOURCE,TARGET,TYPE,OPTIONS,PASS,FREQ -R PASS,FREQ

$ grep -v "^#" /etc/fstab | grep -Pv "\W*\#" 2>/dev/null

$ mount [-l]

$ mount [-l] | column -t

$ cat /proc/mounts

$ cat /proc/self/mounts

$ cat /proc/1/mounts

$ cat /proc/self/mountinfo

$ cat /proc/1/mountinfo
```

List mounted drives that is connected to the Linux system.

```
$ lsblk

$ sudo blockdev --report
```

### 4.4 - Mounted CD/DVD Tray

List default device name.

```
$ eject -d
```

More information of the command execution.

```
$ eject -v
```

### 4.5 - Mounted USB Devices

```
$ lsusb

$ lsusb -tv
```

### 4.6 - Network Interfaces

```
$ ip -o link show | awk -F ": " '{print $2}'

$ nmcli -g DEVICE device status

$ tcpdump -D

$ iwconfig

$ lspci | grep -Ei 'network\|ethernet\|wireless\|wi\-fi'

$ netstat -i

$ sudo hwinfo --short --network

$ sudo lshw -class network -short

$ grep -Eo "[a-z0-9]+:" /proc/net/dev | cut -d ":" -f 1

$ grep -Eo "[a-z0-9]+:" /proc/net/dev | awk -F ":" '{print $1}'

$ cut -d ":" -f 1 /proc/net/dev | tail -n +3 | sort -u | sed -e 's/[ \t]*//'

$ awk -F "[[:space:]]" '{print $5}' /proc/net/dev_mcast | sort -u

$ cut -d " " -f 5 /proc/net/dev_mcast | sort -u

$ ls -1 /proc/net/dev_snmp6
```

### 4.7 - MAC Address

#### 4.7.1 - Network Interfaces

Show current network interface's MAC address

```
$ ip link show <interface> | grep -Eo "..:..:..:..:..:.."

$ ip link show <interface> | grep -Eo ..\(\:..\){5}

$ ip link show <interface> | grep -Eo '([[:xdigit:]]{1,2}:){5}[[:xdigit:]]{1,2}'

$ ip link show <interface> | awk '/ether/ {print $2}'

$ ip -o link show <interface> | awk '/permaddr/ {print $NF}'

$ ethtool -P <interface> | awk '{print $NF}'

$ ifconfig <interface> | grep -Eo ..\(\:..\){5}

$ cat /sys/class/net/<interface>/address
```

List all MAC addresses of network interfaces.

```
$ ifconfig -a | grep -Eo "..:..:..:..:..:.."

$ ifconfig -a | grep -Eo '([[:xdigit:]]{1,2}:){5}[[:xdigit:]]{1,2}'

$ ip address | awk '/link\/ether/{print $2}'

$ LANG=C ip link show | awk '/link\/ether/ {print $2}'

$ ip link show | awk '/permaddr/ {print $NF}'

$ ip -o link show | awk '/permaddr/ {print $NF}'

$ cat /sys/class/net/*/address
```

#### 4.7.2 - Bluetooth

Show current network interface's MAC address

```
$ /var/lib/bluetooth/<interface>/classes
```

List all bluetooth MAC addresses.

```
$ cat /var/lib/bluetooth/*/classes
```

### 4.8 - Motherboard

```
$ cat /sys/class/dmi/id/board_vendor
```

### 4.9 - RAM

Memory size in bytes,

```
$ free -b
```

Memory size in kilobytes,

```
$ free -k

$ vmstat -s

$ grep "MemTotal\|MemFree\|MemAvailable" /proc/meminfo
```

Memory size in megabytes,

```
$ free -m
```

Memory size in gigabytes.

```
$ free -g
```

TODO: This is for scraping credentials but check if it works or not.

```
$ sudo strings /dev/mem -n10 | grep -i PASS
```

### 4.10 - CPU

#### 4.10.1 - Overview

```
$ lscpu

$ cat /proc/cpuinfo
```

#### 4.10.2 - Architecture

```
$ arch

$ uname -m

$ uname -mpi

$ getconf LONG_BIT

$ inxi -Fxz | grep bits

$ sudo lshw -class processor

$ dpkg --print-architecture

$ echo $HOSTTYPE
```

> [!INFO]
> - `lm` is short for Long Mode. Which is a 64-bit architecture.
> - Real mode 16 bit CPU
> - Protected Mode is 32-bit CPU.

```
$ grep -o -w 'lm' /proc/cpuinfo | sort -u 
```

#### 4.10.3 - Processors

Physical cores

```
$ sudo dmidecode -t 4 | grep -Ei 'core (count|enabled)'

$ grep '^core id' /proc/cpuinfo | sort -u | wc -l

$ grep -m 1 "cores" /proc/cpuinfo | tr -d '[a-z]:[:space:]'
```

Logical cores

```
$ nproc --all

$ hwinfo --cpu --short

$ getconf _NPROCESSORS_CONF

$ getconf _NPROCESSORS_ONLN

$ lscpu | grep '^CPU(s):' | awk '{print $2}'

$ lscpu | grep '^CPU(s):' | tr -d "[:blank:]" | cut -d ":" -f 2

$ lscpu | grep '^CPU(s):' | tr -d "[:space:]" | cut -d ":" -f 2

$ sudo dmidecode -t 4 | grep -Ei 'thread count'

$ grep -c "processor" /proc/cpuinfo

$ grep -c "cores" /proc/cpuinfo

$ grep "model name" /proc/cpuinfo | wc -l

$ grep -c "cpu" /proc/schedstat

$ grep -cEo "cpu[0-9]+" /proc/stat

$ grep -Eo "^cpu[0-9]{1,2}" /proc/stat | wc -l

$ grep -Eo "CPU[0-9]+" /proc/interrupts | wc -l

$ grep -Eo "CPU[0-9]{1,2}" /proc/softirqs | wc -l
```

---
## References

### Hacktricks

- [Hacktricks: Privilege Escalation](https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html)