---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - active-directory
  - staying-off-the-land
  - networking
  - network-protocols
  - msrpc
  - smb
  - ldap
  - network-mapper
  - windows
---
# Network Mapper

## 01 - Enumerate user accounts

### 1.1 - SMB Port

```
$ nmap -p 445 -Pn --script smb-enum-users --script-args "smbuser='<username>',smbpass='<password>'" <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-users "smbuser='<username>',smbpass='<password>'" <IP>
```

Pass the Hash

```
$ nmap -p 445 -Pn --script smb-enum-users --script-args "smbuser='<username>',smbhash='<nt_hash>' <IP>

$ sudo nmap -p U:137,T:139 -Pn -sUS --script smb-enum-users --script-args "smbuser='<username>',smbhash='<nt_hash>'" <IP>
```

TODO: Fill in the description to each NSE script.

```
$ nmap -p 445 -Pn --script smb-os-discovery --script-args unsafe=1 <IP>
```

Getting information about the SMB security level to see if we can use with [[02 - Responder|responder]] for NBT-NS/LLMNR poisoning to relay NTLM hashes.

```
$ nmap -p 445 -Pn --script smb-security-mode <IP>
```

```
$ nmap -p 445 -Pn --script smb2-security-mode,smb2-capabilities.nse <IP>
```

Get information about the server statistics. It reveals such as, failed logins, permission errors, system errors, print jobs, opened files.

```
$ nmap -p 445 -Pn --script smb-server-stats <IP>
```

```
$ nmap -p 445 -Pn --script smb-system-info <IP>
```

```
$ nmap -p 445 -Pn --script smb-protocols <IP>
```

### 1.2 - LDAP Port

Enumerate **sAMAccountName**

```
$ nmap -p 389 --script ldap-search --script-args 'ldap.username="cn=<username>,cn=users,dc=<domain>,dc=<tdl>",ldap.password=<password>, ldap.qfilter=users,ldap.attrib=sAMAccountName' <IP>
```

## Vulnerable Computer

```
$ nmap -p 445 -Pn --script smb-vuln-* --script-args unsafe=1 <IP>
```