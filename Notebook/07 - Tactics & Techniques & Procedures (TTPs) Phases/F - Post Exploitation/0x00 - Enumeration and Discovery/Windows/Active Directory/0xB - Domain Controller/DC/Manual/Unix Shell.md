---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - active-directory
  - staying-off-the-land
  - networking
  - network-protocols
  - msrpc
  - windows
---
# Unix Shell

## 01 - MSRPC Port

TODO: Fill this info

Domain Information

```
rpcclient $> querydominfo

rpcclient $> enumdomains
```

Enumerate trusted domains within an AD forest.

```
rpcclient $> dsenumdomtrusts
```

Enumerate domain name and SID

```
rpcclient $> lsaquery

rpcclient $> dsroledominfo
```

Retrieve Domain SID

```
rpcclient $> lookupdomain <domain>
```

## 02 - LDAP Port

Enumerate **domain controllers**.

```
$ ldapsearch -x -D '<DOMAIN>\<username>' -w '' -b "(&(objectCategory=Computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))" -H ldap://<IP>
```

Enumerate **windows servers**.

```
$ ldapsearch -x -D '<DOMAIN>\<username>' -w '' -b "(&(&(&(&(samAccountType=805306369)(!(primaryGroupId=516)))(objectCategory=computer)(operatingSystem=Windows Server*))))" -H ldap://<IP>
```

---
## References

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/A - Information Gathering/0x02 - Active Fingerprinting/Network Enumeration/Cross Platform/Remote Services/Telnet|Manual: Telnet Active Enumeration]]