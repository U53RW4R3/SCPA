---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - active-directory
  - networking
  - network-protocols
  - ldap
  - third-party-tools
  - windows
---
# ADFind

## 01 - Basic Usage with Examples

```
C:\> adfind.exe -h <IP> -sc < adinfo | computers_pwdnotreqd | dclist | dcmodes | domainlist | trustdmp | u:<username> > -f <filter>

C:\> adfind.exe -b dc=<domain>,dc=<tdl> -sc u:<username>

C:\> adfind.exe -f "(objectcategory=<group>)"
```

## 02 - Enumerate computers

```
C:\> adfind.exe -f "objectcategory=computer" > active_directory_computers.txt

C:\> adfind.exe -f "objectcategory=computer" -csv name cn OperatingSystem DNSHostName > dns_hostnames.csv
```

## 03 - Gather all subnets in the active directory network

```
C:\> adfind.exe -subnets -f (objectCategory=subnet) > subnets.txt
```

## 04 - Enumerate users

```
C:\> adfind.exe -f "(objectcategory=person)" > active_directory_users.txt

C:\> adfind.exe -f "(objectcategory=organizationalUnit)" > organizational_units.txt

C:\> adfind.exe [-h <IP>] -f (name="Domain Admins") member -list > domain_admin_users.txt

C:\> adfind.exe [-h <IP>] -f (objectcategory=*) > all_categories.txt
```

## 05 - Dump Trust Objects of the domain controllers

```
C:\> adfind.exe -sc trustdmp > trustdmp.txt
```

## 06 - Dump Trust Objects of the Forest (the root of the active directory network of the hierarchy)

```
C:\> adfind.exe -gcb -sc trustdmp > forest_trustdmp.txt
```

## 07 - Automated Script

```batch
adfind.exe -f "objectcategory=computer" > active_directory_computers.txt
adfind.exe -f "(objectcategory=person)" > active_directory_users.txt
adfind.exe -f "(objectcategory=organizationalUnit)" > organizational_units.txt
adfind.exe -f (name="Domain Admins") member -list > domain_admin_users.txt
adfind.exe -f (objectcategory=*) > all_categories.txt
adfind.exe -sc trustdmp > trustdmp.txt
adfind.exe -gcb -sc trustdmp > forest_trustdmp.txt
```

Then use the bash script to sort output.

```bash
#!/bin/bash

OUTPATH="sorted"
F1INPATH="active_directory_computers.txt"
F2INPATH="active_directory_users.txt"
F2OUTPATH="ad_users_output.txt"

mkdir "$OUTPATH"

while read p; do

  if [[ ${p:0:17} == ">operatingSystem:" ]]; then
    OSPATH=${p:18}
  fi

  if [[ ${p:0:13} == ">dNSHostName:" ]]; then
    if [[ ${OSPATH:0:14} == "Windows Server" ]]; then
      echo ${p:14} >> "$OUTPATH/SERVERS.txt"
      tmp=$(echo "$OSPATH" | cut -d' ' -f1-3)
      echo ${p:14} >> "$OUTPATH/$tmp.txt"
    else
      echo ${p:14} >> "$OUTPATH/WORKERS.txt"
      tmp=$(echo "$OSPATH" | cut -d' ' -f1-2)
      echo ${p:14} >> "$OUTPATH/$tmp.txt"
    fi
  fi

done < $F1INPATH



while read p; do

  if [[ ${p:0:13} == ">description:" ]]; then
    DECR=${p:14}
    DECR=${DECR%$'\r'}
  fi

  if [[ ${p:0:16} == ">sAMAccountName:" ]]; then
    ACCNAME=${p:17}
   ACCNAME=${ACCNAME%$'\r'}
    echo "$ACCNAME:$DECR" >> "$OUTPATH/$F2OUTPATH"
  fi

done < $F2INPATH
```

---
## References

### Joeware

- [ADFind Usage](https://www.joeware.net/freetools/tools/adfind/usage.htm)

### The DFIR Report

- [The DFIR Report: PYSA/Mespinoza Ransomware](https://thedfirreport.com/2020/11/23/pysa-mespinoza-ransomware/)

### Certcube

- [Certcube: AD Recon for Beginners](https://blog.certcube.com/ad-recon-for-beginners/)

### NoRed0x

- [NoRed0x: Active Directory Domain Enumeration Part 1](https://nored0x.github.io/red-teaming/active-directory-domain-enumeration-part-1/)