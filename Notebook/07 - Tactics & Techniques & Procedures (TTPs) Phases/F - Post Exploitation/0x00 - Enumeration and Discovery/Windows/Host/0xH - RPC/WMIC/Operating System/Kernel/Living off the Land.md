---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - living-off-the-land
  - T1047
  - windows
---
# Living off the Land

## 01 - Command Prompt

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] computersystem list full
```

Enumerate hotfixes.

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] qfe get caption,description,hotfixid,installedon

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] qfe get Caption,Description,HotFixID,InstalledOn | findstr /C:"KB4012212" /C:"KB4012215"
```

Windows product key activation. (TODO: Convert it to command prompt via `wmic.exe`)

```
PS C:\> Get-WmiObject -Query "SELECT OA3xOriginalProductKey FROM SoftwareLicensingService"

PS C:\> (Get-WmiObject -Query "SELECT * FROM SoftwareLicensingService").OA3xOriginalProductKey

PS C:\> Get-CimInstance -Query "SELECT OA3xOriginalProductKey FROM SoftwareLicensingService"

PS C:\> (Get-CimInstance -Query "SELECT * FROM SoftwareLicensingService").OA3xOriginalProductKey
```

## 02 - PowerShell

Enumerating the system to see any kind of potential version we can take over. (TODO: The namespace is CIMV2)

```
PS C:\> Get-WmiObject -ClassName Win32_OperatingSystem | Select-Object Name

PS C:\> Get-CimInstance -ClassName Win32_OperatingSystem | Select-Object Name
```

Enumerate hotfixes.

```
PS C:\> Get-Hotfix

PS C:\> Get-CimInstance -ClassName Win32_QuickFixEngineering
```

Windows product key activation. (TODO: The namespace is CIMV2)

```
PS C:\> Get-WmiObject -Query "SELECT OA3xOriginalProductKey FROM SoftwareLicensingService"

PS C:\> (Get-WmiObject -Query "SELECT * FROM SoftwareLicensingService").OA3xOriginalProductKey

PS C:\> Get-CimInstance -Query "SELECT OA3xOriginalProductKey FROM SoftwareLicensingService"

PS C:\> (Get-CimInstance -Query "SELECT * FROM SoftwareLicensingService").OA3xOriginalProductKey
```

---
## References

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x00 - Enumeration and Discovery/Windows/Host/0xI - Operating System/Hardware/Manual/Living off the Land]]