---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - living-off-the-land
  - T1047
  - windows
---
# Living off the Land

## 01 - Command Prompt

### 1.1 - Hardware Information

#### 1.1.1 - Hostname

TODO: Convert it to `wmic`

```
C:\> hostname.exe

C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName

C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters /v Hostname

C:\> echo %COMPUTERNAME%
```

#### 1.1.2 - Date and Time

```
C:\> date.exe /T

C:\> time.exe /T

C:\> tzutil.exe /g

C:\> net.exe time [\\<IP>]

C:\> reg.exe query HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation
```

#### 1.1.3 - Mounted Drives

Enumerate for mounted and unmounted drives

```
C:\> mountvol.exe

C:\> vol

C:\> fsutil.exe fsInfo drives
```

TODO: Inspect the module and convert into commands

Check if there are external USB drives history activity to the workstation. This will provide leverage to insert malware to spread the infection or possibly to exfiltrate data.

```
meterpreter > run post/windows/gather/usb_history
```

- Find Serial # to obtain the Drive Letter of the USB device
- Find Serial # to obtain the Volume GUID of the USB device

```
C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\MountedDevices
```

USB Times:
- First time device is connected
- Last time device is connected
- Removal time

```
C:\> reg.exe query [\\<IP>\]HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Mountpoints2
```

```
C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Enum\USB

C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR
```

```
C:\> reg.exe query "[\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR\Ven_Prod_Version\USB iSerial"

#\Properties\{83da6326-97a6-4088-9453-a1923f573b29}\####
```

Display information of the storage size.

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] path win32_logicaldisk get caption, filesystem, freespace, size, volumename

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] logicaldisk where drivetype=3 get name, freespace, systemname, filesystem, size, volumeserialnumber

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] volume list

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] volume list brief
```

Display mounted drives.

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] logicaldisk get name

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] logicaldisk get caption

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] diskdrive list

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] diskdrive list brief
```

#### 1.1.4 - MAC Addresses

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>]
```

#### 1.1.5 - Motherboard

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] bios

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] bios get serialnumber

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] baseboard get Manufacturer, Product, SerialNumber, Version
```

#### 1.1.6 - Hardware Model

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] csproduct get name
```

#### 1.1.7 - CPU

Retrieving the number of CPU cores and threads.

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] cpu get deviceid, numberofcores, numberoflogicalprocessors

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] cpu list full
```

#### 1.1.8 - RAM

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>]

PS C:\> SELECT TotalPhysicalMemory FROM Win32_ComputerSystem
```

### 1.2 - Printers

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] printer list brief
```

## 02 - PowerShell

### 2.1 - Hardware Information

#### 2.1.1 - Hostname

Computer name.

```
PS C:\> Get-CimInstance -ClassName Win32_ComputerSystem | Select-Object Name

PS C:\> Get-WmiObject -ClassName Win32_ComputerSystem | Select-Object Name
```

#### 2.1.2 - Date and Time

TODO: Convert it to Get-CimInstance and Get-WmiObject

Retrieve time

```
PS C:\> Get-Date

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock { Get-Date }
```

#### 2.1.3 - Mounted Drives

Display mounted drives.

TODO: Inspect the module and convert into cmdlets

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] logicaldisk get name

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] logicaldisk get caption

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] diskdrive list

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] diskdrive list brief
```

Display information of the storage size.

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] path win32_logicaldisk get caption, filesystem, freespace, size, volumename

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] logicaldisk where drivetype=3 get name, freespace, systemname, filesystem, size, volumeserialnumber

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] volume list

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] volume list brief
```

Check if there are external USB drives history activity to the workstation. This will provide leverage to insert malware to spread the infection or possibly to exfiltrate data.

```
meterpreter > run post/windows/gather/usb_history
```

- Find Serial # to obtain the Drive Letter of the USB device
- Find Serial # to obtain the Volume GUID of the USB device

```
C:\> reg.exe query HKLM\SYSTEM\MountedDevices
```

USB Times:
- First time device is connected
- Last time device is connected
- Removal time

```
C:\> reg.exe query HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Mountpoints2
```

```
C:\> reg.exe query HKLM\SYSTEM\CurrentControlSet\Enum\USB

C:\> reg.exe query HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR
```

```
C:\> reg.exe query HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR\Ven_Prod_Version\USB iSerial
#\Properties\{83da6326-97a6-4088-9453-a1923f573b29}\####
```

#### 2.1.4 - MAC Addresses

- Basic hardware information

```
PS C:\> Get-CimInstance Win32_Processor | Format-List -AutoSize
```

#### 2.1.5 - Motherboard

Motherboard (The namespace is CIMV2)

```
PS C:\> SELECT * FROM Win32_NetworkAdapterConfiguration WHERE IPEnabled = True

PS C:\> SELECT * FROM Win32_NetworkAdapterConfiguration WHERE IPEnabled = True

PS C:\> SELECT SerialNumber FROM Win32_BIOS
```

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] baseboard get manufacturer

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] cpu list full
```

#### 2.1.6 - Hardware Model

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] csproduct get name

Computer Model: SELECT Model FROM Win32_ComputerSystem

Part Number: SELECT PartNumber FROM Win32_SystemEnclosure

Asset Tag: SELECT SMBIOSAssetTag FROM Win32_SystemEnclosure
```

#### 2.1.7 - CPU

```
PS C:\> SELECT Name FROM Win32_Processor
```

#### 2.1.8 - RAM

```
PS C:\> SELECT TotalPhysicalMemory FROM Win32_ComputerSystem -Name ProcessNameString
```

#### 2.1.9 - Monitors

```
PS C:\> SELECT * FROM WmiMonitorID
```

### 2.2 - Printers

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] printer list brief
```

---
## References

### Backlinks

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x00 - Enumeration and Discovery/Windows/Host/0xI - Operating System/Hardware/Manual/Living off the Land]]

### CyberITHub

- [CyberITHub: 20 Useful WMIC Command Examples in Windows Cheatsheet](https://www.cyberithub.com/20-useful-wmic-command-examples-in-windows-cheat-sheet/)