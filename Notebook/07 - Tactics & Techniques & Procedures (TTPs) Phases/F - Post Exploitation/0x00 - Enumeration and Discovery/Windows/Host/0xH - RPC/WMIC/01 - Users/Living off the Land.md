# Living off the Land

Search Tag(s): #post-exploitation #enumeration-and-discovery #living-off-the-land #windows

## 01 - Enumerate Local Usernames

### 1.1 - Command Prompt

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] useraccount

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] useraccount list

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] useraccount get name,sid

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] useraccount get /all

C:\> dir /b /ad "C:\Users\"
```

### 1.2 - PowerShell

```
PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_UserAccount | Format-Table -AutoSize

PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_UserAccount -Filter "LocalAccount=True" | Select-Object PSComputername, Name, Status, Disabled, AccountType, Lockout, PasswordRequired, PasswordChangeable
```

TODO: Check these cmdlets one by one

```
PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_Account | Format-Table -AutoSize
```

```
PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_UserDesktop | Format-Table -AutoSize
```

## 02 - Enumerate Local Groups

### 2.1 - Command Prompt

Enumerate local groups. (TODO: convert it from the cmdlets)

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>]
```

Enumerate current local group users.

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>]
```

### 2.2 - PowerShell

```
PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_Group | Format-Table -AutoSize

PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_Group -Filter "Domain = 'dev'" AND Name Like '%Admin%'" | Format-Table -AutoSize

PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_Group -Filter "Domain = 'dev'" AND Name Like 'Enterprise Admins'" | Get-CimAssociatedInstance -Association Win32_GroupUser

PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_Group -Filter "Domain = 'dev'" AND Name Like 'Microsoft Advanced Threat Analytics Administrator'" | Get-CimAssociatedInstance -Association Win32_GroupUser
```

## 03 - Logged On Users

### 3.1 - Command Prompt

Gather logged-on local users. (TODO: convert it from the cmdlets)

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>]
```

### 3.2 - PowerShell

Gather logged-on local users.

```
PS C:\> Get-CimInstance [-ComputerName <IP>] -ClassName Win32_ComputerSystem | Select-Object Name

PS C:\> Get-WmiObject [-ComputerName <IP>] -ClassName Win32_ComputerSystem | Select-Object Name

PS C:\> Get-CimInstance [-ComputerName <IP>] -Query "SELECT * FROM Win32_LoggedOnUser" | ?{$_.LogonType -notmatch '(Service|Network|System)'}
```

---
## References

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x00 - Enumeration and Discovery/Windows/Host/0xA - Users/Manual/Living off the Land]]