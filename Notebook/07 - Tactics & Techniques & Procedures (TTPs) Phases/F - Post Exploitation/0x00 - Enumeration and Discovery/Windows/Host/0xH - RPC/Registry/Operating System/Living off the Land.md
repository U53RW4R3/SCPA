# Living off the Land

## 01 - Command Prompt

### 1.1 - Kernel

```
C:\> reg.exe query "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v ProductName
```

### 1.2 - Hardware Information

#### 1.2.1 - Hostname

```
C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName

C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters /v Hostname
```

#### 1.2.2 - Date and Time

```
C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation
```

#### 1.2.3 - Mounted Drives

Check if there are external USB drives history activity to the workstation. This will provide leverage to insert malware to spread the infection or possibly to exfiltrate data.

```
C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Control\DeviceClasses\{53f56307-b6bf-11d0-94f2-00a0c91efb8b} /s
```

- Find Serial # to obtain the Drive Letter of the USB device
- Find Serial # to obtain the Volume GUID of the USB device

```
C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\MountedDevices
```

USB Times:
- First time device is connected
- Last time device is connected
- Removal time

```
C:\> reg.exe query [\\<IP>\]HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Mountpoints2
```

```
C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Enum\USB

C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR
```

```
C:\> reg.exe query "[\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR\Ven_Prod_Version\USB iSerial"

#\Properties\{83da6326-97a6-4088-9453-a1923f573b29}\####
```

#### 1.2.4 - CPU

Retrieving the number of CPU cores and threads.

```
C:\> reg.exe query [\\<IP>\]HKLM\HARDWARE\DESCRIPTION\System\CentralProcessor\* /v ProcessNameString
```

## 02 - PowerShell

### 2.1 - Kernel

```
PS C:\> Get-ItemProperty "HKLM:SOFTWARE\Microsoft\Windows NT\CurrentVersion" -Name ProductName
```

### 2.2 - Hardware Information

#### 2.2.1 - Hostname

Computer name.

```
PS C:\> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName

PS C:\> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters /v Hostname
```

#### 2.2.3 - Mounted Drives

Check if there are external USB drives history activity to the workstation. This will provide leverage to insert malware to spread the infection or possibly to exfiltrate data.

```
PS C:\> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\DeviceClasses\{53f56307-b6bf-11d0-94f2-00a0c91efb8b}\*
```

- Find Serial # to obtain the Drive Letter of the USB device
- Find Serial # to obtain the Volume GUID of the USB device

```
PS C:\> Get-ItemProperty HKLM:\SYSTEM\MountedDevices
```

USB Times:
- First time device is connected
- Last time device is connected
- Removal time

```
PS C:\> Get-ItemProperty HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Mountpoints2
```

```
PS C:\> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Enum\USB

PS C:\> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Enum\USBSTOR
```

```
PS C:\> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Enum\USBSTOR\Ven_Prod_Version\USB iSerial

#\Properties\{83da6326-97a6-4088-9453-a1923f573b29}\####
```

#### 2.2.4 - CPU

```
PS C:\> Get-ItemProperty HKLM:\HARDWARE\DESCRIPTION\System\CentralProcessor\*
```

---
## References

### PDQ

- [PDQ: Powershell Guide Get CimInstance and Get WMIObject](https://www.pdq.com/blog/powershell-guide-get-ciminstance-and-get-wmiobject/)

### LOFLCAB

- [LOFLCAB: quser](https://lofl-project.github.io/loflcab/Binaries/quser/)

- [LOFLCAB: Get-NetAdapter](https://lofl-project.github.io/loflcab/Cmdlets/Get-NetAdapter/)

### Hacking Articles

- [Hacking Articles: Post Exploitation Using WMIC (System Command)](https://www.hackingarticles.in/post-exploitation-using-wmic-system-command/)

### 13cubed

- [13cubed: Windows Registry Cheat Sheet](https://13cubed.s3.amazonaws.com/downloads/windows_registry_cheat_sheet.pdf)