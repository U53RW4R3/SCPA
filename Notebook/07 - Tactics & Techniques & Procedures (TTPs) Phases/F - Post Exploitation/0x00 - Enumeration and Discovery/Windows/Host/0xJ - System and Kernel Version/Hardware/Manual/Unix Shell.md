# Unix Shell

Search Tag(s): #post-exploitation #enumeration-and-discovery #staying-off-the-land #windows

## 01 - Hardware Information

### 1.1 - MSRPC Port

#### 1.1.1 - `rpcclient`

Enumerate for mounted and unmounted drives.

```
rpcclient $> netdiskenum
```

Operating system version and server type.

```
rpcclient $> srvinfo
```

#### 1.1.2 - Impacket

##### 1.1.2.1 - `net`

```
$ getArch.py -targets ip_targets.txt
```

##### 1.1.2.2 - `net`

TODO: Inspect the module (`meterpreter > run post/windows/gather/usb_history`) and convert into commands

Check if there are external USB drives history activity to the workstation. This will provide leverage to insert malware to spread the infection or possibly to exfiltrate data.

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> query -keyName "HKLM"

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> query -keyName "HKLM"
```

##### 1.1.2.3 - `wmiquery`

Authentication syntax

```
$ wmiquery.py <domain>/<username>:<password>@<IP>

$ wmiquery.py <domain>/<username>@<IP> -hashes :<nt_hash>
```

Query operating system.

```
WQL> SELECT Caption FROM Win32_OperatingSystem
```

Query CPU.

```
WQL> SELECT NumberOfCores,NumberOfLogicalProcessors FROM Win32_Logicaldisk
```

Query only if the free space is less than 21 MB.

```
WQL> SELECT * FROM Win32_Logicaldisk WHERE FreeSpace < 2147483648
```

### 1.2 - SMB Port

#### 1.2.1 - Samba Suite Utils

Retrieve information about the storage.

```
smb: \> du
```

#### 1.2.2 - NetExec

Enumerate mounted disks.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --disks

$ netexec smb <IP> -u "<username>" -H <nt_hash> [-d <domain> | --local-auth] --disks
```

#### 1.2.3 - SMBMap

```
$ smbmap -u <username> -p "< <password> | <nt_hash> >" -L -H <IP>
```