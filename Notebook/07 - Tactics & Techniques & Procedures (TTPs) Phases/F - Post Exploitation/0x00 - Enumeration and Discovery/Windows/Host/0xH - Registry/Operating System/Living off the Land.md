# Living off the Land

## 01 - Command Prompt

### 1.1 - Hardware Information

#### 1.1.1 - Hostname

```
C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName

C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters /v Hostname
```

#### 1.1.2 - Date and Time

```
C:\> reg.exe query HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation
```

#### 1.1.3 - Mounted Drives

TODO: Inspect the module and convert into commands

Check if there are external USB drives history activity to the workstation. This will provide leverage to insert malware to spread the infection or possibly to exfiltrate data.

```
meterpreter > run post/windows/gather/usb_history
```

- Find Serial # to obtain the Drive Letter of the USB device
- Find Serial # to obtain the Volume GUID of the USB device

```
C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\MountedDevices
```

USB Times:
- First time device is connected
- Last time device is connected
- Removal time

```
C:\> reg.exe query [\\<IP>\]HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Mountpoints2
```

```
C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Enum\USB

C:\> reg.exe query [\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR
```

```
C:\> reg.exe query "[\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR\Ven_Prod_Version\USB iSerial"

#\Properties\{83da6326-97a6-4088-9453-a1923f573b29}\####
```

#### 1.1.7 - CPU

Retrieving the number of CPU cores and threads.

```
C:\> reg.exe query [\\<IP\]HKLM\HARDWARE\DESCRIPTION\System\CentralProcessor\* /v ProcessNameString
```

## 02 - Powershell

### 2.1 - Hardware Information

#### 2.1.1 - Hostname

Computer name.

```
PS C:\> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName

PS C:\> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters /v Hostname
```

#### 2.1.3 - Mounted Drives

TODO: Inspect the module and convert into commands

Check if there are external USB drives history activity to the workstation. This will provide leverage to insert malware to spread the infection or possibly to exfiltrate data.

```
meterpreter > run post/windows/gather/usb_history
```

- Find Serial # to obtain the Drive Letter of the USB device
- Find Serial # to obtain the Volume GUID of the USB device

```
PS C:\> Get-ItemProperty HKLM:\SYSTEM\MountedDevices
```

USB Times:
- First time device is connected
- Last time device is connected
- Removal time

```
PS C:\> Get-ItemProperty HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Mountpoints2
```

```
PS C:\> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Enum\USB

PS C:\> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Enum\USBSTOR
```

```
PS C:\> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Enum\USBSTOR\Ven_Prod_Version\USB iSerial

#\Properties\{83da6326-97a6-4088-9453-a1923f573b29}\####
```

#### 2.1.7 - CPU

```
PS C:\> Get-ItemProperty HKLM:\HARDWARE\DESCRIPTION\System\CentralProcessor\*
```

---
## References

- [LOFLCAB: quser](https://lofl-project.github.io/loflcab/Binaries/quser/)

- [LOFLCAB: Get-NetAdapter](https://lofl-project.github.io/loflcab/Cmdlets/Get-NetAdapter/)

- [Hacking Articles: Post Exploitation Using WMIC (System Command)](https://www.hackingarticles.in/post-exploitation-using-wmic-system-command/)

- [Powershell Guide Get CimInstance and Get WMIObject](https://www.pdq.com/blog/powershell-guide-get-ciminstance-and-get-wmiobject/)

- [20 Useful WMIC Command Examples in Windows Cheatsheet](https://www.cyberithub.com/20-useful-wmic-command-examples-in-windows-cheat-sheet/)

- [13cubed: Windows Registry Cheat Sheet](https://13cubed.s3.amazonaws.com/downloads/windows_registry_cheat_sheet.pdf)