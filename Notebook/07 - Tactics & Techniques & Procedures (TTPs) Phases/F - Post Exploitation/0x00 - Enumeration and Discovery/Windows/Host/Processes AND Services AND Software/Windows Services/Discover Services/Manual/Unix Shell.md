# Unix Shell

Search Tag(s): #post-exploitation #enumeration-and-discovery #privilege-escalation #staying-off-the-land #windows

TODO: Convert commands lines to remote commands.

## 01 - Service Control Management

### 1.1 - Samba Suite Utils

```
$ net <ads | rpc> service list -U "[<domain>/]<username>%<password>" -S <IP>

$ net <ads | rpc> service list -U "[<domain>/]<username>" --pw-nt-hash <nt_hash> -S <IP>
```

### 1.2 - Impacket

#### 1.2.1 - `services`

```
$ services.py [<domain>/]<username>:"<password>"@<IP> list

$ services.py [<domain>/]<username>@<IP> -hashes :<nt_hash> list
```

#### 1.2.2 - `wmiquery`

Authentication syntax.

```
$ wmiquery.py [<domain>/]<username>:"<password>"@<IP>

$ wmiquery.py [<domain>/]<username>@<IP> -hashes :<nt_hash>
```

Query all services.

```
WQL> SELECT * FROM Win32_Service
```

Enumerate current service.

```
WQL>
```

Check service current status.

```
WQL>
```

### 1.3 - NetExec

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --wmi "SELECT * FROM Win32_Service"
```

Using `smbclient` to enumerate the existing files while enabling `showacls`.

```
smb: \> showacls

ls "/Users/All Users/Start Menu/Programs/Startup"

ls "/Users/<username>/Start Menu/Programs/Startup"
```

Discover startup services

```
C:\> wmic [/node:<IP>] [/user:<username> /password:<password>] startup service

C:\> wmic [/node:<IP>] [/user:<username> /password:<password>] startup list full

C:\> wmic [/node:<IP>] [/user:<username> /password:<password>] startup get caption,command

C:\> reg query [\\<IP>\]HKLM\Software\Microsoft\Windows\CurrentVersion\Run

C:\> reg query [\\<IP>\]HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce

C:\> reg query [\\<IP>\]HKCU\Software\Microsoft\Windows\CurrentVersion\Run

C:\> reg query [\\<IP>\]HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
```

### SNMP Port

```
$ snmpwalk -c public -v1 <IP> | grep hrSWRunName | cut -d " " -f 4

$ snmpwalk -v 2c -c public <IP>:<PORT> | grep hrSWRunName | cut -d " " -f 4
```