# Unix Shell

Search Tag(s): #post-exploitation #enumeration-and-discovery #staying-off-the-land #windows

TODO: Convert command lines to remote commands

## 01 - List Installed Software

### 1.1 - MSRPC Network Protocol

#### 1.1.1 - `wmiquery`

Authentication syntax

```
$ wmiquery.py "<username>":"<password>"@<IP>

$ wmiquery.py [<domain>/]<username>@<IP> -hashes :<nt_hash>
```

Query installed programs.

```
WQL> SELECT Name,Version,Vendor FROM Product

WQL> SELECT Name,Caption,Version,IdentifyingNumber,InstallLocation FROM Win32_Product
```

#### 1.1.2 - `reg`

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> query -keyName "HKLM\SOFTWARE"

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> query -keyName "HKLM\SOFTWARE"
```

DotNET MSBuild compilers

```
C:\> dir %windir%\Microsoft.NET\Framework64 /ad

C:\> dir /b %windir%\Microsoft.NET\Framework64\v*

C:\> wmic product get description | findstr /c:.NET
```

### 1.2 - SNMP Network Protocol

```
$ snmpwalk -c public -v1 <IP> | grep hrSWInstalledName | cut -d " " -f 4

$ snmpwalk -v 2c -c public <IP>:<PORT> | grep hrSWInstalledName | cut -d " " -f 4
```

### 1.2 - List directories including hidden files and folders

#### 1.2.1 - Samba Suite Utils

```
smb: \> ls "/Program Files/"

smb: \> ls "/Program Files (x86)/"
```

#### 1.2.2 - Impacket

```
WQL> SELECT Name FROM Win32_Directory WHERE Name LIKE 'C:\\%' AND Hidden = True
```

## 03 - Device Drivers

### 3.1 - Impacket

Query installed drivers.

```
WQL> SELECT DeviceName, DriverVersion, Manufacturer FROM Win32_PnPSignedDriver WHERE LIKE '%VMWare%'
```

## 04 - Antivirus and EDR

### 4.1 - NetCommands

```
$ net rpc service list -U "<username>%<password>" -S <IP>

$ net rpc service status <service> -U "<username>%<password>" -S <IP>
```

Check service current status.

```
$ net <ads | rpc> service status "<ServiceSVC>" -U "[<domain>/]<username>%<password>" -S <IP>

$ net <ads | rpc> service status "<ServiceSVC>" -U "[<domain>/]<username>" --pw-nt-hash <nt_hash> -S <IP>
```

### 4.2 - Impacket

#### 4.2.1 - `services.py`

List all services.

```
$ services.py [<domain>/]<username>:"<password>"@<IP> list

$ services.py [<domain>/]<username>@<IP> -hashes :<nt_hash> list
```

Enumerate current service.

```
$ services.py "<username>":"<password>"@<IP> config -name <service>

$ services.py [<domain>/]<username>@<IP> -hashes :<nt_hash> config -name <service>
```

Check service current status.

```
$ services.py "<username>":"<password>"@<IP> status -name <service>

$ services.py [<domain>/]<username>@<IP> -hashes :<nt_hash> status -name <service>
```

#### 4.2.2 - `wmiquery.py`

```
$ wmiquery.py "<username>":"<password>"@<IP>

$ wmiquery.py [<domain>/]<username>@<IP> -hashes :<nt_hash>
```

Query installed 

```
WQL> SELECT Name,Caption,Version,IdentifyingNumber FROM Win32_Product
```