# Living off the Land

Search Tag(s): #post-exploitation #enumeration-and-discovery #networking #living-off-the-land #windows

## 01 - Basic

### 1.1 - Command Prompt

IP Addresses and Subnet.

```
C:\> ipconfig

C:\> ipconfig | findstr "IPv4 Address"

C:\> ipconfig /all

C:\> ipconfig /allcompartments /all

C:\> netsh [-r <IP>] [-u [DOMAIN\]username] [-p password | *] interface ipv4 show ipaddresses

C:\> netsh [-r <IP>] [-u [DOMAIN\]username] [-p password | *] interface ipv4 show addresses

C:\> netsh [-r <IP>] [-u [DOMAIN\]username] [-p password | *] interface ipv4 show config

C:\> wmic nicconfig get description,ipaddress,macaddress
```

Network interfaces.

```
C:\> netsh [-r <IP>] [-u [DOMAIN\]username] [-p password | *] interface ipv4 show interfaces

C:\> netsh [-r <IP>] [-u [DOMAIN\]username] [-p password | *] interface ipv4 show subinterfaces

C:\> netsh [-r <IP>] [-u [DOMAIN\]username] [-p password | *] interface ipv4 show joins
```

Get RDP connections.

```
C:\> wmic rdtoggle list
```

Last logon connection.

```
C:\> wmic netlogin get name,lastlogon,badpasswordcount
```

### 1.2 - Powershell

IP Addresses and Subnet

```
PS C:\> Get-NetIPAddress -AddressFamily IPv4 | Format-Table Interfacealias, IPv4Address

PS C:\> Get-NetIPConfiguration | Format-Table InterfaceAlias,InterfaceDescription,IPv4Address

PS C:\> Get-DnsClientServerAddress -AddressFamily IPv4 | Format-Table -Autosize

PS C:\> Get-CimInstance -ClassName CIM_System | Format-Table -AutoSize

PS C:\> Get-CimInstance -ClassName Win32_NTDomain | Format-Table -AutoSize
```

## 02 - ARP Discovery

### 2.1 - Command Prompt

Returns an ARP network with a list of IP and MAC addresses.

```
C:\> arp -a

C:\> netsh [-r <IP>] [-u [DOMAIN\]username] [-p password | *] interface ipv4 show neighbors

C:\> netsh [-r <IP>] [-u [DOMAIN\]username] [-p password | *] interface ipv4 show ipnettomedia
```

### 2.2 - Powershell

Returns an ARP network with a list of IP Addresses.

```
PS C:\> Get-NetNeighbor -AddressFamily IPv4 | Format-Table ifIndex,IPAddress,LinkLayerAddress,State
```

## 03 - Route Table

### 3.1 - Command Prompt

Print the routing table

```
C:\> route print

C:\> netstat -r

C:\> netstat -ano

C:\> netsh [-r <IP>] [-u [DOMAIN\]username] [-p password | *] interface ipv4 show route
```

### 3.2 - Powershell

Print the routing table

```
PS C:\> Get-NetRoute -AddressFamily IPv4 | Format-Table DestinationPrefix,NextHop,RouteMetric,ifIndex
```

## 04 - Netstat

### 4.1 - Command Prompt

> [!NOTE] Elevated Privileges is required
> Must be with elevated privileges when running a with flag `-b`.

```
C:\> netstat -abno
```

Prints the network statistics. Display the loopback services and other computers that is which the machine is interacting with.

```
C:\> netstat -anto

C:\> netsh [-r <IP>] [-u [DOMAIN\]username] [-p password | *] interface ipv4 show tcpconnections

C:\> netsh [-r <IP>] [-u [DOMAIN\]username] [-p password | *] interface ipv4 show udpconnections
```

Find all `LISTENING` ports and connection on port 445.

```
C:\> netstat -na | findstr :445
```

Find all `ESTABLISHED` ports connections

```
C:\> netstat -an | findstr ES
```

Specify a protocol with `-p` flag either via `IP`, `IPv6`, `ICMP`, `ICMPv6`, `TCP`, `TCPv6`, `UDP`, and `UDPv6`.

```
C:\> netstat -antp <IP | IPv6 | ICMP | ICMPv6 | TCP | TCPv6 | UDP | UDPv6>
```

### 4.2 - Powershell

Discover listening TCP ports.

```
PS C:\> Get-NetTCPConnection -LocalAddress 0.0.0.0 -State Listen
```

Discover listening UDP ports.

```
PS C:\> Get-NetUDPEndpoint
```

## 05 - DNS

### 5.1 - Command Prompt

DNS nameservers

```
C:\> ipconfig /displaydns

C:\> netsh [-r <IP>] [-u [DOMAIN\]username] [-p password | *] interface ipv4 show dnsservers

C:\> type c:\Windows\system32\drivers\etc\hosts
```

Discover network infrastructure.

```
C:\> tracert <dns_nameserver>
```

### 5.2 - Powershell

Retrieve IPv4 addresses.

```
PS C:\> Resolve-DnsName <dns_nameserver> -Type A

PS C:\> (Resolve-DnsName <dns_nameserver> -Type A).IPAddress
```

Retrieve IPv6 addresses.

```
PS C:\> Resolve-DnsName <dns_nameserver> -Type AAAA

PS C:\> (Resolve-DnsName <dns_nameserver> -Type AAAA).IPAddress
```

Retrieve DNS records.

```
PS C:\> Get-DNSServerZone

PS C:\> Get-DNSServerZoneResourceRecord -ZoneName <domain>.<tld>
```

---
## References

- [LOFLCAB: Getn-NetIPAddress](https://lofl-project.github.io/loflcab/Cmdlets/Get-NetIPAddress/)

- [LOFLCAB: Get-NetNeighbor](https://lofl-project.github.io/loflcab/Cmdlets/Get-NetNeighbor/)

- [LOFLCAB: Get-NetRoute](https://lofl-project.github.io/loflcab/Cmdlets/Get-NetRoute/)

- [LOFLCAB: Get-NetTCPConnection](https://lofl-project.github.io/loflcab/Cmdlets/Get-NetTCPConnection/)

- [LOFLCAB: Get-NetUDPEndpoint](https://lofl-project.github.io/loflcab/Cmdlets/Get-NetUDPEndpoint/)

- [Hacking Articles: Manual Post Exploitation on Windows PC (Network Command)](https://www.hackingarticles.in/manual-post-exploitation-windows-pc-network-command/)