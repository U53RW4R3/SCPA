---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - staying-off-the-land
  - networking
  - network-protocols
  - msrpc
  - smb
  - snmp
  - windows
---
# Unix Shell

## 01 - Username enumeration

### 1.1 - Samba Suite Utils

Get current username.

```
rpcclient $> getusername
```

Retrieve username SID.

```
rpcclient $> lookupnames <username_1>,<username_2>,<username_n>

rpcclient $> samlookupnames builtin <username_1>,<username_2>,<username_n>
```

Enumerate username.

```
rpcclient $> queryuser <username | SID>

rpcclient $> queryusergroups <username_rid_value>
```

Check the user's privileges.

```
rpcclient $> enumprivs
```

### 1.2 - `net`

```
$ net rpc user info "<username>" -U "<username>%<password>" -S <IP>

$ net rpc user info "<username>" -U "<username>" --pw-nt-hash <nt_hash> -S <IP>
```

### 1.3 - NetExec

Enumerate current local users.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --users <user_1>,<user_2>,<user_n>
```

## 02 - Enumerate user accounts

### 2.1 - MSRPC Port

#### 2.1.1 - `rpcclient`

Enumerate groups.

```
rpcclient $> lookupnames <group_1>,<group_2>,<group_n>

rpcclient $> lookupnames Administrators
```

Enumerate alias group accounts.

```
rpcclient $> enumalsgroups builtin
```

#### 2.1.2 - `net`

Enumerate **local users**.

```
$ net rpc user -U "<username>%<password>" -S <IP>

$ net rpc user -U "<username>" --pw-nt-hash <nt_hash> -S <IP>
```

Enumerate users from a local group.

```
$ net rpc group members '<group_name>' -U '[<domain>/]<username>%<password>' -S <IP>

$ net rpc group members '<group_name>' -U '[<domain>/]<username>' --pw-nt-hash <nt_hash> -S <IP>
```

Retrieve **local administrators**.

```
$ net rpc group members 'Administrators' -U '[<domain>/]<username>' -S <IP>
```

### 2.2 - SMB Port

#### 2.2.1 - NetExec

Enumerate local users.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --users
```

#### 2.2.2 - Impacket

```
$ net.py [<domain>/]<username>:"<password>"@<IP> user

$ net.py [<domain>/]<username>@<IP> -hashes :<nt_hash> user
```

### 2.4 - SNMP Port

```
$ snmpwalk -c public -v1 <IP> | grep | cut -d " " -f 4

$ snmpwalk -v 2c -c public <IP>:<PORT> | grep | cut -d " " -f 4
```

## 03 - Local groups enumeration

### 3.1 - `net`

```
$ net rpc group list -U '[<domain>/]<username>' -I <IP>
```

### 3.2 - `netexec`

Enumerate local groups.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --local-groups
```

Enumerate current local group to retrieve user accounts.

```
$ netexec smb <IP> -u "<username>" -p "<password>" [-d <domain> | --local-auth] --local-groups "Administrators"
```

### 3.3 - Impacket

```
$ net.py "[<domain>/]<username>":"<password>"@<IP> localgroup

$ net.py "[<domain>/]<username>"@<IP> -hashes :<nt_hash> localgroup
```

## 04 - Logged On Users

```
$ sudo nmap -p U:137,T:139 -sU -sS --script smb-enum-sessions --script-args 'smbuser=<username>,smbpass=<password>' <IP>/<CIDR>
```

Pass the Hash

```
$ sudo nmap -p U:137,T:139 -sU -sS --script smb-enum-sessions --script-args 'smbuser=<username>,smbhash=<nt_hash>' <IP>/<CIDR>
```