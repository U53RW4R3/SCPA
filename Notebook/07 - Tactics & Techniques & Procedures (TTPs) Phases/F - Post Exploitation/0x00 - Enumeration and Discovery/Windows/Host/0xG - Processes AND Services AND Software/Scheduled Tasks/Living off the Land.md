---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - privilege-escalation
  - living-off-the-land
  - network-protocols
  - msrpc
  - windows
---
# Living off the Land

## 01 - Command Prompt

```
C:\> schtasks.exe /query /fo list /v [/ru <DOMAIN>\<username>] [/rp <password>] /s <IP>

C:\> schtasks.exe /query /fo list [/ru <DOMAIN>\<username>] [/rp <password>] /s <IP> 2>nul | findstr.exe TaskName

C:\> dir C:\Windows\Tasks
```

Filter the **SYSTEM** schedule tasks.

```
C:\> schtasks.exe /query /fo list /v [/ru <DOMAIN>\<username>] [/rp <password>] /s <IP> > schtasks.txt

$ grep "SYSTEM\|Task To Run" schtasks.txt | grep -B 1 SYSTEM
```

## 02 - PowerShell

```
PS C:\> Get-ScheduledTask

PS C:\> Get-ScheduledTaskInfo -TaskName <TaskPath>

PS C:\> Get-ScheduledTask | where {$_.TaskPath -NOTLIKE "\Microsoft*"} | Format-Table TaskName,TaskPath,State
```

---
## References

- [LOFLCAB: Get-ScheduledTask](https://lofl-project.github.io/loflcab/Cmdlets/Get-ScheduledTask/)

- [LOFLCAB: Get-ScheduledTaskInfo](https://lofl-project.github.io/loflcab/Cmdlets/Get-ScheduledTaskInfo/)