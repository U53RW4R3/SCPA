---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - living-off-the-land
  - windows
---
# Living off the Land

## 01 - Installed Programs

### 1.1 - Command Prompt

#### 1.1.1 - List Installed Software

DotNET MSBuild compilers

```
C:\> dir %WINDIR%\Microsoft.NET\Framework64\ /ad

C:\> dir /b %windir%\Microsoft.NET\Framework64\v*
```

#### 1.1.2 - List directories including hidden files and folders

```
C:\> dir /a "C:\Program Files"

C:\> dir /a "C:\Program Files (x86)"
```

#### 1.1.3 - Find a specific program

Syntax

```
C:\> where.exe <program.exe>

C:\> where.exe /r <C:\ | \\<IP>\c$> <program.exe>

C:\> where.exe /r <program.exe>

C:\> dir /s /b c:\ | findstr "<program.exe>"
```

File Explorer

```
C:\> where.exe explorer.exe

C:\> where.exe /r C:\ explorer.exe

C:\> dir /s /b c:\ | findstr "explorer.exe"
```

Internet Explorer

```
C:\> where.exe iexplore.exe

C:\> where.exe /r C:\ iexplore.exe

C:\> dir /s /b c:\ | findstr "iexplore.exe"
```

Java Updater

```
C:\> where.exe jucheck.exe

C:\> where.exe /r C:\ jucheck.exe

C:\> dir /s /b c:\ | findstr "jucheck.exe"
```

Find MSBuild C# compiler versions

```
C:\> where.exe /r C:\ MSBuild.exe

C:\> where.exe /r \\<IP>\c$ MSBuild.exe

C:\> dir /s /b c:\ | findstr "MSBuild.exe"
```

### 1.2 - PowerShell

#### 1.2.1 - List Installed Software

```
PS C:\> Get-ChildItem -Recursive -Path $Env:WINDIR\Microsoft.NET\Framework64\

PS C:\> Get-Item C:\Windows\Microsoft.Net\Framework64\v4.0.30319\clr.dll | Format-Table
```

#### 1.2.2 - List directories including hidden files and folders

```
PS C:\> Get-ChildItem 'C:\Program Files\','C:\Program Files (x86)\' | Format-Table Parent,Name,LastWriteTime

PS C:\> Get-ChildItem '\\<IP>\C$\Program Files\','\\<IP>\C$\Program Files (x86)\' | Format-Table Parent,Name,LastWriteTime
```

#### 1.2.3 - Find a specific program

Syntax

```
PS C:\> Get-Command <program.exe> | Format-Table CommandType, Name, Definition

PS C:\> (Get-Command <program.exe>).Definition

PS C:\> (Get-ChildItem -Recurse -Path <C:\ | \\<IP>\C$\> -Include "<program.exe>" -ErrorAction SilentlyContinue).FullName

PS C:\> Get-ChildItem -Recurse -Path <C:\ | \\<IP>\C$\> -Include "<program.exe>" -ErrorAction SilentlyContinue | ForEach-Object {$_.FullName}

PS C:\> Get-ChildItem -Recurse -Path <C:\ | \\<IP>\C$\> -ErrorAction SilentlyContinue | Where-Object {($_.Name -eq "<program.exe>")} | % {$_.FullName}
```

File Explorer

```
PS C:\> (Get-Command explorer.exe).Definition

PS C:\> (Get-ChildItem -Recurse -Path C:\ -Include "explorer.exe" -ErrorAction SilentlyContinue).FullName
```

Internet Explorer

```
PS C:\> (Get-Command iexplore.exe).Definition

PS C:\> (Get-ChildItem -Recurse -Path C:\ -Include "iexplore.exe" -ErrorAction SilentlyContinue).FullName
```

Java Updater

```
PS C:\> (Get-ChildItem -Recurse -Path C:\ -Include "jucheck.exe" -ErrorAction SilentlyContinue).FullName
```

Find MSBuild C# compiler versions

```
PS C:\> (Get-ChildItem -Recurse -Path C:\ -Include "MSBuild.exe" -ErrorAction SilentlyContinue).FullName

PS C:\> (Get-ChildItem -Recurse -Path \\<IP>\C$ -Include "MSBuild.exe" -ErrorAction SilentlyContinue).FullName
```

## 02 - Common Language Runtime

### 2.1 - Command Prompt

Enumerate available **Common Language Runtime (CLR)** versions.

```
C:\> dir %WINDIR%\Microsoft.Net\Framework\ /s /b | find "System.dll"
```

### 2.2 - PowerShell

Enumerate available Common Language Runtime (CLR) versions.

```powershell
PS C:\> [AppDomain]::CurrentDomain.GetAssemblies() | Sort-Object -Property FullName | Format-Table FullName

PS C:\> [System.IO.File]::Exists("$Env:WINDIR\Microsoft.Net\Framework\v2.0.50727\System.dll")
```

## 03 - Device Drivers

### 3.1 - Command Prompt

```
C:\> driverquery.exe [/s <IP>] [/u [<DOMAIN>\]username>] [/p <password>] [/v] /fo list

C:\> driverquery.exe [/s <IP>] [/u [<DOMAIN>\]username>] [/p <password>] /fo table

C:\> driverquery.exe [/s <IP>] [/u [<DOMAIN>\]username>] [/p <password>] --no-msft
```

### 3.2 - PowerShell

Filtering the installed 3rd party drivers with WMI.

```powershell
PS C:\> driverquery.exe [/s <IP>] [/u [<DOMAIN>\]username>] [/p <password>] /v /fo csv | ConvertFrom-CSV | Select-Object 'Display Name', 'Start Mode', Path
```

## 04 - Antivirus and EDR

### 4.1 - Command Prompt

```
C:\> sc.exe [\\<IP>] query WinDefend
```

### 4.2 - PowerShell

```
PS C:\> Get-MpComputerStatus

PS C:\> Get-WindowsFeature -Name Windows-Defender
```

Retrieve exclusions of Windows Security.

```
PS C:\> Get-MpPreference | Select-Object -Property ExclusionPath | Format-Table -AutoSize

PS C:\> $exclusions = Get-MpPreference
$exclusions.ExclusionPath
```

---
## References

- [LOFLCAB: Get-ChildItem](https://lofl-project.github.io/loflcab/Cmdlets/Get-ChildItem/)

- [LOFLCAB: driverquery](https://lofl-project.github.io/loflcab/Binaries/driverquery/)

- [Config Server Firewall: CMD Where Command | Find Files Using Command Prompt](https://www.configserverfirewall.com/windows-10/cmd-where-command/)

- [Deep Dive into the Solorigate Second Stage Activation from Sunburst to Teardrop and Raindrop](https://www.microsoft.com/en-us/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/)

- [SentinelOne: Black Basta Ransomware | Attacks Deploy Custom EDR Evasion Tools Tied to FIN7 Threat Actor](https://www.sentinelone.com/labs/black-basta-ransomware-attacks-deploy-custom-edr-evasion-tools-tied-to-fin7-threat-actor/)