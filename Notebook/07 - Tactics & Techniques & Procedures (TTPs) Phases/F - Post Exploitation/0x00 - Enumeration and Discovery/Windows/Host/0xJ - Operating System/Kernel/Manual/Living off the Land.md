# Living off the Land

## 01 - Command Prompt

Enumerating the system to see any kind of potential version we can take over.

```
C:\> systeminfo.exe [/s <IP>] [/u <username> /p <password>]

C:\> systeminfo.exe [/s <IP>] [/u <username> /p <password>] | findstr /b /c:"OS Name" /c:"OS Version"

C:\> ver.exe

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] computersystem list full

C:\> reg.exe query "[[\<IP>\]HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v ProductName

C:\> type C:\Windows\system32\eula.txt

C:\> type c:\Windows\WindowsUpdate.log
```

Enumerate hotfixes.

```
C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] qfe get caption,description,hotfixid,installedon

C:\> wmic.exe [/node:<IP>] [/user:<username> /password:<password>] qfe get Caption,Description,HotFixID,InstalledOn | findstr /C:"KB4012212" /C:"KB4012215"
```

Windows product key activation. (TODO: Convert it to command prompt via `wmic.exe`)

```
PS C:\> Get-WmiObject -Query "SELECT OA3xOriginalProductKey FROM SoftwareLicensingService"

PS C:\> (Get-WmiObject -Query "SELECT * FROM SoftwareLicensingService").OA3xOriginalProductKey

PS C:\> Get-CimInstance -Query "SELECT OA3xOriginalProductKey FROM SoftwareLicensingService"

PS C:\> (Get-CimInstance -Query "SELECT * FROM SoftwareLicensingService").OA3xOriginalProductKey
```

## 02 - Powershell

Enumerating the system to see any kind of potential version we can take over. (TODO: The namespace is CIMV2)

```
PS C:\> [System.Environment]::OSVersion.Version

PS C:\> Get-WmiObject -Classname Win32_OperatingSystem | Select-Object Name

PS C:\> Get-CimInstance -Classname Win32_OperatingSystem | Select-Object Name

PS C:\> Get-ItemPropery "HKLM:SOFTWARE\Microsoft\Windows NT\CurrentVersion" -Name ProductName
```

Enumerate hotfixes.

```
PS C:\> Get-Hotfix

PS C:\> Get-CimInstance -Classname Win32_QuickFixEngineering
```

Windows product key activation. (TODO: The namespace is CIMV2)

```
PS C:\> Get-WmiObject -Query "SELECT OA3xOriginalProductKey FROM SoftwareLicensingService"

PS C:\> (Get-WmiObject -Query "SELECT * FROM SoftwareLicensingService").OA3xOriginalProductKey

PS C:\> Get-CimInstance -Query "SELECT OA3xOriginalProductKey FROM SoftwareLicensingService"

PS C:\> (Get-CimInstance -Query "SELECT * FROM SoftwareLicensingService").OA3xOriginalProductKey
```

---
## References

- [LOFLCAB: systeminfo](https://lofl-project.github.io/loflcab/Binaries/systeminfo/)

- [List Security Patches](https://support.moonpoint.com/os/windows/PowerShell/list-security-patches/)