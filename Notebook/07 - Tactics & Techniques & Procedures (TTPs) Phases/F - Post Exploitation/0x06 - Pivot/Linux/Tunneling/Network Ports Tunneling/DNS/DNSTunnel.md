# DNSTunnel

## Setup

### Install Dependencies

Install it according to your package manager.

```
$ sudo apt install -y screen libnet-dns-perl libmime-base32-perl

$ sudo dnf install -y screen

$ sudo pacman -S --noconfirm screen perl-net-dns perl-mime-base32
```

### Universal Install

Clone the repository.

```
$ sudo git clone https://github.com/splitbrain/dnstunnel /opt/dnstunnel
```

Download the tarball archive file then extract it.

```
$ curl -so master.tgz "https://github.com/splitbrain/dnstunnel/tarball/master?.tgz"

$ wget -qO master.tgz "https://github.com/splitbrain/dnstunnel/tarball/master?.tgz"

$ tar xzf master.tgz && rm -f master.tgz && \
sudo mv splitbrain-dnstunnel-72f3aca /opt/dnstunnel/
```

Download the zip archive file then extract it.

```
$ curl -so master.zip https://github.com/splitbrain/dnstunnel/archive/refs/heads/master.zip

$ wget -q https://github.com/splitbrain/dnstunnel/archive/refs/heads/master.zip

$ unzip master.zip && rm -f master.zip && \
sudo mv dnstunnel-master /opt/dnstunnel/
```

## Server

> [!TIP] Hijack DNS Nameserver (OPSEC Consideration)
> Compromised DNS namserver can be used to maintain access and evade security endpoints due to it's legitimacy.

Modify the `dnstunneld.wrapper` file.

```
# cat /opt/dnstunnel/dnstunneld.wrapper
DNSHOST="subdomain.domain.tld"             # change this to your DNS name  
REPLYIP="127.0.0.1"                        # what to answer on real DNS requests  
OPTIONS="-l <VPS_IP> -u nobody -g nogroup" # give additional options here
```

Create a symbolic link then start the service.

```
# ln -s /opt/dnstunnel/dnstunneld.init /etc/init.d/dnstunneld && \
/etc/init.d/dnstunneld start
```

## Client

Copy the client in your `PATH`.

```
# cp /opt/dnstunnel/dnstunnelc /usr/local/bin/
```

Test the connection to see if it's being tunneled.

```
$ ssh -Co ProxyCommand="dnstunnelc sshdns.subdomain.domain.tld" <username>@localhost
```

If everything is working as expected then open the SOCKS proxy.

```
$ ssh -NCD 1080 -o ProxyCommand="dnstunnelc sshdns.subdomain.domain.tld" <username>@localhost
```

---
## References

### Source Repositories

- [splitbrain: dnstunnel](https://github.com/splitbrain/dnstunnel)

### DNSTunnel

- [DNSTunnel](https://dnstunnel.de/)

### SplitBrain

- [SplitBrain: DNS Tunneling made easy](https://www.splitbrain.org/blog/2008-11/02-dns_tunneling_made_simple)