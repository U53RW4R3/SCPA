---
author(s):
  - Userware
tags:
  - post-exploitation
  - pivot
  - tunneling
  - networking
  - icmp
---
# ICMPTunnel

## 01 - Setup

### 1.1 - Compile Source Code

Clone the repository.

```
# git clone https://github.com/DhavalKapil/icmptunnel && cd icmptunnel/
```

Download the zip archived source code.

```
# wget --no-hsts -qO icmptunnel.zip https://github.com/DhavalKapil/icmptunnel/zipball/master

# curl -o icmptunnel.zip https://github.com/DhavalKapil/icmptunnel/zipball/master
```

Then extract the zip file then compile.

```
# unzip icmptunnel.zip && cd DhavalKapil-icmptunnel-267a9ec/

# 7z x icmptunnel.zip && cd DhavalKapil-icmptunnel-267a9ec/
```

Download the tarball file.

```
# wget --no-hsts -qO icmptunnel.tar.gz https://github.com/DhavalKapil/icmptunnel/tarball/master

# curl -o icmptunnel.tar.gz https://github.com/DhavalKapil/icmptunnel/tarball/master
```

Then extract the zip file then compile.

```
# tar xzf icmptunnel.tar.gz && cd DhavalKapil-icmptunnel-267a9ec/
```

Compile the source code.

```
# make
```

### 1.2 - Disable ICMP Echo Reply

This must configured on both the server and the client.

```
# sysctl -w net.ipv4.icmp_echo_ignore_all=1

# echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all
```

## 02 - Help Menu

```
# ./icmptunnel -h
Wrong argument
usage: icmptunnel [-s serverip] | [-c clientip]
```

## 03 - Usage

### 3.1 - Server

Launch ICMP tunnel to create a virtual network interface `tun0`.

```
root@server:~# ./icmptunnel -s <server_IP>
```

### 3.2 - Client

```
root@hackware-os:~# ./icmptunnel -c <server_IP>
```

### 3.3 - Cleanup and Revert Settings

#### 3.3.1 - Terminate Program

Then terminate the program via process ID.

```
# pgrep -a icmptunnel

# kill -9 <PID>
```

Terminate the program via the process name.

```
# pkill icmptunnel
```

#### 3.3.2 - Re-enable ICMP Echo Reply

```
# sysctl -w net.ipv4.icmp_echo_ignore_all=1

# echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all
```

---
## References

- [ICMPTunnel](https://dhavalkapil.com/icmptunnel/)

- [ICMPTunnel Source Repository](https://github.com/DhavalKapil/icmptunnel)

- [Hacking Articles: Port Forwarding Tunneling CheatSheet](https://www.hackingarticles.in/port-forwarding-tunnelling-cheatsheet/)