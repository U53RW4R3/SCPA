# Living off the Land

## 01 - Command Prompt

TODO: show the steps to convert the `.cap` into `.pcap`

List the interfaces.

```
C:\> pktmon.exe comp list
```

Start capturing packets.

```
C:\> netsh.exe trace start persistent=yes capture=yes overwrite=<yes | no> tracefile=c:\path\to\file.etl

C:\> pktmon.exe start --etw -c <interface_ID>
```

Stop capturing packets.

```
C:\> netsh.exe trace stop

C:\> pktmon.exe stop
```

Convert packets

```
C:\> pktmon.exe pcapng PktMon.etl -o pktmon.pcapng
```

## 02 - PowerShell

```powershell
PS C:\> $adapter = Get-NetAdapter | Select-Object -First 1; New-NetEventSession -Name 'Session1' -CaptureMode
SaveToFile -LocalFilePath 'C:\temp\network_capture.etl'; Add-NetEventPacketCaptureProvider -SessionName
'Session1' -Level 4 -CaptureType Both -Enable; Start-NetEventSession -Name 'Session1'; Stop-
NetEventSession -Name 'Session1' after 60
```

---
## References

- [joswr1ght: nm2lp](https://github.com/joswr1ght/nm2lp)