# Living off the Land

Search Tag(s): #post-exploitation #lateral-movement #living-off-the-land #windows

## 01 - Powershell

> [!INFO] What FQDN looks like?
> `<FQDN_domain>` is literally `<IP>.<domain>`.

Retrieving MSSQL SPN and domain.

```
PS C:\> Get-SQLInstanceDomain

PS C:\> Get-SQLInstanceDomain | Get-SQLConnectionTest | ? { $_.Status -eq "Accessible" } | Get-SQLServerInfo

PS C:\> Get-SQLServerLinkCrawl -Instance "<FQDN_domain>,1433"

PS C:\> Get-SQLConnectionTest -Instance "<FQDN_domain>,1433" | fl

PS C:\> Get-SQLServerInfo -Instance "<FQDN_domain>,1433"

PS C:\> Get-SQLServerInfo -Instance "<FQDN_domain>,1433" -Query "<SQL_queries>"

PS C:\> Get-SQLServerInfo -Instance "<FQDN_domain>,1433" -Query "SELECT @@SERVERNAME"
```

---
## References

- [SS64: SQLCMD](https://ss64.com/sql/sqlcmd.html)

- [Microsoft Documentation: Invoke-SQLCMD](https://learn.microsoft.com/en-us/powershell/module/sqlserver/invoke-sqlcmd?view=sqlserver-ps)

- [MSSQL for Pentester Abusing Linked Database](https://www.hackingarticles.in/mssql-for-pentester-abusing-linked-database/)