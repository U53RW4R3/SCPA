# Socat

Search Tag(s): #post-exploitation #pivoting #port-forwarding #cross-platform #socat

## 01 - Bind Port via SOCKS Proxy Server

### 1.1 - SOCKS4A

```
> socat tcp-listen:<local_PORT> socks4a:<SOCKS_server_IP>:<bind_target_IP>:<bind_target_PORT>,<SOCKS_server_PORT>
```

### 1.2 - SOCKS4

```
> socat tcp-listen:<local_PORT> socks4:<SOCKS_server_IP>:<bind_target_IP>:<bind_target_PORT>,<SOCKS_server_PORT>
```

## 02 - Automated Script

```bash
#!/bin/bash
function check_dependencies() {
    if [[ -z $(which socat) ]]
    then
        echo "socat isn't installed!"
        exit 0
    fi
}

function usage() {
    read -d '' help << EOF
Usage:
    $(basename ${0}) -l <local_PORT> [-s <proxy_IP>] [-p <proxy_PORT>] -t <target_IP> -b <target_PORT>
Flags:
    -l, --local                     Create a listening local port
    -r, --remote                    IP address of the SOCKS4A proxy server (127.0.0.1 is set by
                                    default if not specified)

    -p, --port                      Port of the SOCKS4A proxy server (9050 is set by default if
                                    not specified)

    -t, --target                    The remote IP address to bind
    -b, --bindport                  The remote port to bind
    -h, --help                      Display help menu
EOF

    echo "${help}"
    exit 1
}

function main() {
    check_dependencies

    if [[ ${#} -eq 0 ]]
    then
        usage
    fi

    while [[ ${#} -gt 0 ]]
    do
        case ${1} in
            -l | --local)
                LOCAL_PORT=${2}
                shift 2
                ;;
            -r | --remote)
                PROXY_SERVER_IP="${2}"
                shift 2
                ;;
            -p | --port)
                PROXY_SERVER_PORT=${2}
                shift 2
                ;;
            -t | --target)
                REMOTE_IP="${2}"
                shift 2
                ;;
            -b | --bindport)
                REMOTE_PORT=${2}
                shift 2
                ;;
            -h | --help)
                usage
                ;;
            *)
                echo "Invalid option: ${1}" >&2
                exit 1
                ;;
        esac
    done

    if [[ -z "${LOCAL_PORT}" ]]
    then
        echo "Missing local port listener!"
        exit 1
    fi

    # If input was empty. Set to localhost by default.
    if [[ -z "${PROXY_SERVER_IP}" ]]
    then
        PROXY_SERVER_IP="127.0.0.1"
    fi

    # Set to TOR port by default.
    if [[ -z ${PROXY_SERVER_PORT} ]]
    then
        PROXY_SERVER_PORT=9050
    fi

    if [[ (-z "${REMOTE_IP}" || -z ${REMOTE_PORT}) ]]
    then
        echo "Specify the target's IP address and port to pivot."
        exit 1
    fi

    socat TCP4-LISTEN:"${LOCAL_PORT}",fork SOCKS4A:"${PROXY_SERVER_IP}":"${REMOTE_IP}":"${REMOTE_PORT}",socksport="${PROXY_SERVER_PORT}" & > /dev/null
}

main "${@}"
```

### 2.1 - Usage

```
$ chmod 755 proxybind.sh
```

It'll set to localhost and TOR port (9050) to pivot to the target.

```
$ ./proxybind.sh -l <local_PORT> -t <target_IP> -b <target_PORT>
```

You can set a custom SOCKS4A port.

```
$ ./proxybind.sh -l <local_PORT> -p <SOCKS_server_PORT> -r <target_IP> -b <target_PORT>
```

You can set socks proxy IP address and/or port to pivot.

```
$ ./proxybind.sh -l <local_PORT> -r <SOCKS_server_IP> -p <SOCKS_server_PORT> -r <target_IP> -b <target_PORT>
```

---
## References

### Backlinks

- [[07 - Tactics & Techniques & Procedures (TTPs) Phases/F - Post Exploitation/0x06 - Pivoting and Lateral Movement/Pivoting/Cross Platform/Port Forwarding/Socat|Socat]]