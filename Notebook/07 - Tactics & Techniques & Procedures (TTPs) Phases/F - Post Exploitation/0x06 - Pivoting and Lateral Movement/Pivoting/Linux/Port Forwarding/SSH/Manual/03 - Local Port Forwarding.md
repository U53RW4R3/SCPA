# Local Port Forwarding

## 01 - Usage

```
$ cat /etc/ssh/sshd_config
..[omitted]..
AllowTcpForwarding yes
..[omitted]..
```

### 1.1 - Syntax

```
$ ssh -NTfCq -L [<bind_local_IP>:]<local_PORT>:<bind_remote_IP>:<bind_remote_PORT> <username>@<pivot_SSH_IP>
```

## 02 - Scenarios

### 2.1 - Reverse Shell Callback Tunnel

TODO: Make a network topology diagram to illustrate the pivoting scenario

### 2.2 - Bind Shell Callback Tunnel

### 2.3 - UDP over SSH

#### 2.3.1 - Using Netcat to grab UDP port

```
userware@hackware-os:~$ ssh -L <local_PORT>:<server_IP>:<bind_remote_PORT> <username>@<IP>
```

```
user@server:~# mkfifo /tmp/fifo

user@server:~# nc -lp <local_PORT> < /tmp/fifo | nc -u <target_IP> <target_PORT> > /tmp/fifo
```

```
userware@hackware-os:~# mkfifo /tmp/fifo

userware@hackware-os:~# nc -lup <target_PORT> < /tmp/fifo | nc localhost <local_PORT> > /tmp/fifo

userware@hackware-os:~# cat /etc/resolv.conf
..[omitted]..
nameserver 127.0.0.1
```

#### 2.3.2 - DNS

```
userware@hackware-os:~$ ssh -L 6667:localhost:6667 <username>@<IP>
```

```
user@server:~# mkfifo /tmp/fifo

user@server:~# nc -lp 6667 < /tmp/fifo | nc -u <dns_nameserver_IP> 53 > /tmp/fifo
```

```
userware@hackware-os:~# mkfifo /tmp/fifo

userware@hackware-os:~# nc -lup 53 < /tmp/fifo | nc localhost 6667 > /tmp/fifo

userware@hackware-os:~# cat /etc/resolv.conf
..[omitted]..
nameserver 127.0.0.1
```

---
## References

- [PayloadsAllTheThings: Network Pivoting Techniques](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Network%20Pivoting%20Techniques.md)

- [FareedFauzi OSCP Playbook: Port Forwarding SSH Tunneling](https://fareedfauzi.gitbook.io/oscp-notes/others/port-forwarding-ssh-tunneling)

- [Certcube: Pivoting and SSH Port Forwarding Basics](https://blog.certcube.com/pivoting-and-ssh-port-forwarding-basics/)

- [Certcube: Pivoting Port Forwarding](https://blog.certcube.com/pivoting-port-forwarding/)

- [RawSec: Overview of Network Pivoting and Tunneling](https://blog.raw.pm/en/state-of-the-art-of-network-pivoting-in-2019/)

### Scenarios

- [Cocomelonc: Pivoting Part 1](https://cocomelonc.github.io/pentest/2021/11/04/pivoting-1.html)