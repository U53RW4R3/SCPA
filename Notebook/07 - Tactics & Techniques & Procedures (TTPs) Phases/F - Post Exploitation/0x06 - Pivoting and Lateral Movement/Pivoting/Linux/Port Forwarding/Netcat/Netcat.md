# Netcat

## 01 - Pivoting Listening Ports

Let's say you're stuck in a situation that there's no other way to perform pivoting except one of the netcat variants were preinstalled in the compromised Linux system.

```
$ mkfifo /tmp/backpipe

$ mknod /tmp/backpipe p

$ nc -lnvp <pivot_PORT> 0 < /tmp/backpipe | nc <bind_IP> <bind_PORT> 1 > /tmp/backpipe
```

## 02 - Scenarios

### 2.1 - Port Relay

> [!INFO] Netcat Port Forwarding
> You can bind any exposed port to establish connection as long it works. Do not limit yourself to one service port only.


```
$ mknod /tmp/backpipe p; nc -lnvp 8443 0 < /tmp/backpipe | nc <webserver_IP> 443 1 > /tmp/backpipe
```

Another way is to port forward through SSH then pipe it in the `netcat` listener.

```
$ mkfifo /tmp/backpipe

$ while [ 1 ]; do nc -lp 8443 < /tmp/backpipe | ssh <ssh_server_IP> [-p <PORT>] "nc <webserver_IP> 80" | tee /tmp/backpipe; done
```

Then use `curl` to check connect to the pivot server.

```
userware@hackware-os:~$ curl -k https://<pivot_IP>:8443
```

### 2.3 - Examples

#### 1.2.2 - Proxy (Port 80 to 8080)

```
$ mknod /tmp/backpipe p; nc -l -p 8080 0 & < /tmp/backpipe | tee -a inflow | nc localhost 80 | tee -a outflow 1 > /tmp/backpipe

$ mknod

$ /tmp/backpipe p; nc -l -p 8080 0 & < backpipe | tee -a inflow | nc
```

#### 1.2.3 - Proxy monitor (Port 80 to 8080)

```
$ localhost 80 | tee -a outflow & 1 > /tmp/backpipe
```

---
## References

- [Michael Nikitochkin: Netcat with SSH Port Forwarding](https://medium.com/notes-and-tips-in-full-stack-development/netcat-with-ssh-port-forwarding-148177b2e850)